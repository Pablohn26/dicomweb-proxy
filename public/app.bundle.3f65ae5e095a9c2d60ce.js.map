{"version":3,"file":"app.bundle.3f65ae5e095a9c2d60ce.js","mappings":"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","sources":["webpack:///webpack/runtime/chunk loaded","webpack:///webpack/runtime/load script","webpack:///../../../extensions/dicom-sr/src/constants/scoordTypes.js","webpack:///../../../extensions/dicom-sr/src/constants/toolNames.js","webpack:///../../../extensions/dicom-sr/src/id.js","webpack:///../../../extensions/measurement-tracking/src/_shared/PROMPT_RESPONSES.js","webpack:///../../../extensions/measurement-tracking/src/_shared/createReportDialogPrompt.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/measurementTrackingMachine.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/promptBeginTracking.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/promptTrackNewSeries.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/promptTrackNewStudy.js","webpack:///../../../extensions/measurement-tracking/src/_shared/createReportAsync.js","webpack:///../../../extensions/measurement-tracking/src/_shared/getNextSRSeriesNumber.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/promptSaveReport.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/getCornerstoneToolStateToMeasurementSchema.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/_hydrateStructuredReport.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/utils/getLabelFromDCMJSImportedToolData.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/promptHydrateStructuredReport.js","webpack:///../../../extensions/measurement-tracking/src/contexts/TrackedMeasurementsContext/TrackedMeasurementsContext.jsx","webpack:///../../../extensions/measurement-tracking/src/getContextModule.js","webpack:///../../core/src/DICOMSR/dataExchange.js","webpack:///../../core/src/DICOMSR/utils/isToolSupported.js","webpack:///../../core/src/DICOMSR/index.js","webpack:///../../core/src/DICOMWeb/index.js","webpack:///../../core/src/DICOMWeb/getAttribute.js","webpack:///../../core/src/DICOMWeb/getAuthorizationHeader.js","webpack:///../../core/src/DICOMWeb/getModalities.js","webpack:///../../core/src/DICOMWeb/getName.js","webpack:///../../core/src/DICOMWeb/getNumber.js","webpack:///../../core/src/DICOMWeb/getString.js","webpack:///../../core/src/DataSources/IWebApiDataSource.js","webpack:///../../core/src/classes/CommandsManager.js","webpack:///../../core/src/classes/HotkeysManager.js","webpack:///../../core/src/classes/ImageSet.js","webpack:///../../core/src/classes/MetadataProvider.js","webpack:///../../core/src/utils/metadataProvider/getPixelSpacingInformation.js","webpack:///../../core/src/classes/index.js","webpack:///../../core/src/defaults/windowLevelPresets.js","webpack:///../../core/src/defaults/index.js","webpack:///../../core/src/defaults/hotkeyBindings.js","webpack:///../../core/src/errorHandler.js","webpack:///../../core/src/extensions/ExtensionManager.js","webpack:///../../core/src/extensions/MODULE_TYPES.js","webpack:///../../core/src/object.js","webpack:///../../core/src/string.js","webpack:///../../core/src/user.js","webpack:///../../core/src/index.js","webpack:///../../core/src/log.js","webpack:///../../core/src/services/CineService/CineService.js","webpack:///../../core/src/services/CineService/index.js","webpack:///../../core/src/services/DicomMetadataStore/createSeriesMetadata.js","webpack:///../../core/src/services/DicomMetadataStore/createStudyMetadata.js","webpack:///../../core/src/services/DicomMetadataStore/EVENTS.js","webpack:///../../core/src/services/DicomMetadataStore/DicomMetadataStore.js","webpack:///../../core/src/services/DicomMetadataStore/index.js","webpack:///../../core/src/services/DisplaySetService/EVENTS.js","webpack:///../../core/src/services/DisplaySetService/DisplaySetService.js","webpack:///../../core/src/services/DisplaySetService/index.js","webpack:///../../core/src/services/HangingProtocolService/lib/validator.js","webpack:///../../core/src/services/HangingProtocolService/HPMatcher.js","webpack:///../../core/src/services/HangingProtocolService/ProtocolEngine.js","webpack:///../../core/src/services/HangingProtocolService/lib/sortByScore.js","webpack:///../../core/src/services/HangingProtocolService/HangingProtocolService.js","webpack:///../../core/src/services/HangingProtocolService/index.js","webpack:///../../core/src/services/MeasurementService/MeasurementService.js","webpack:///../../core/src/services/MeasurementService/index.js","webpack:///../../core/src/services/ServicesManager.js","webpack:///../../core/src/services/ToolBarService/ToolBarService.js","webpack:///../../core/src/services/ToolBarService/index.js","webpack:///../../core/src/services/UIDialogService/index.js","webpack:///../../core/src/services/UIModalService/index.js","webpack:///../../core/src/services/UINotificationService/index.js","webpack:///../../core/src/services/UIViewportDialogService/index.js","webpack:///../../core/src/services/UserAuthenticationService/UserAuthenticationService.js","webpack:///../../core/src/services/UserAuthenticationService/index.js","webpack:///../../core/src/services/ViewportGridService/ViewportGridService.js","webpack:///../../core/src/services/ViewportGridService/index.js","webpack:///../../core/src/services/_shared/pubSubServiceInterface.js","webpack:///../../core/src/utils/guid.js","webpack:///../../core/src/utils/hotkeys/pausePlugin.js","webpack:///../../core/src/utils/hotkeys/recordPlugin.js","webpack:///../../core/src/utils/hotkeys/index.js","webpack:///../../core/src/utils/objectPath.js","webpack:///../../core/src/utils/StackManager.js","webpack:///../../core/src/utils/absoluteUrl.js","webpack:///../../core/src/utils/sortBySeriesDate.js","webpack:///../../core/src/utils/dicomLoaderService.js","webpack:///../../core/src/utils/b64toBlob.js","webpack:///../../core/src/utils/urlUtil.js","webpack:///../../core/src/utils/makeDeferred.js","webpack:///../../core/src/utils/Queue.js","webpack:///../../core/src/utils/hierarchicalListUtils.js","webpack:///../../core/src/utils/progressTrackingUtils.js","webpack:///../../core/src/utils/isLowPriorityModality.js","webpack:///../../core/src/utils/index.js","webpack:///../../core/src/utils/writeScript.js","webpack:///../../core/src/utils/formatDate.js","webpack:///../../core/src/utils/formatPN.js","webpack:///../../core/src/utils/makeCancelable.js","webpack:///../../core/src/utils/isDicomUid.js","webpack:///../../core/src/utils/resolveObjectPath.js","webpack:///../../core/src/utils/sortBy.js","webpack:///../../ui/src/contextProviders/DialogProvider.jsx","webpack:///../../ui/src/contextProviders/DragAndDropProvider.jsx","webpack:///../../ui/src/contextProviders/ModalProvider.jsx","webpack:///../../ui/src/contextProviders/ImageViewerProvider.jsx","webpack:///../../ui/src/contextProviders/CineProvider.jsx","webpack:///../../ui/src/components/Snackbar/SnackbarTypes.js","webpack:///../../ui/src/components/Snackbar/SnackbarItem.jsx","webpack:///../../ui/src/components/Snackbar/SnackbarContainer.jsx","webpack:///../../ui/src/contextProviders/SnackbarProvider.jsx","webpack:///../../ui/src/contextProviders/ViewportDialogProvider.jsx","webpack:///../../ui/src/contextProviders/ViewportGridProvider.jsx","webpack:///../../ui/src/contextProviders/UserAuthenticationProvider.js","webpack:///../../ui/src/components/AboutModal/AboutModal.jsx","webpack:///../../ui/src/components/AboutModal/index.js","webpack:///../../ui/src/components/Button/Button.jsx","webpack:///../../ui/src/components/Button/index.js","webpack:///../../ui/src/components/ButtonGroup/ButtonGroup.jsx","webpack:///../../ui/src/components/ButtonGroup/index.js","webpack:///../../ui/src/components/ContextMenu/ContextMenu.jsx","webpack:///../../ui/src/components/CinePlayer/CinePlayer.jsx","webpack:///../../ui/src/components/CinePlayer/index.js","webpack:///../../ui/src/components/DateRange/DateRange.jsx","webpack:///../../ui/src/components/DateRange/index.js","webpack:///../../ui/src/components/Dialog/Footer.js","webpack:///../../ui/src/components/Dialog/Body.js","webpack:///../../ui/src/components/Dialog/Header.js","webpack:///../../ui/src/components/Dialog/Dialog.jsx","webpack:///../../ui/src/components/Dialog/index.js","webpack:///../../ui/src/components/Dropdown/Dropdown.jsx","webpack:///../../ui/src/components/EmptyStudies/EmptyStudies.js","webpack:///../../ui/src/components/EmptyStudies/index.js","webpack:///../../ui/src/components/Modal/Modal.jsx","webpack:///../../ui/src/components/Modal/index.js","webpack:///../../ui/src/components/ErrorBoundary/ErrorBoundary.jsx","webpack:///../../ui/src/components/ErrorBoundary/index.js","webpack:///../../ui/src/components/Icon/getIcon.js","webpack:///../../ui/src/components/Icon/Icon.jsx","webpack:///../../ui/src/components/Icon/index.js","webpack:///../../ui/src/components/IconButton/IconButton.jsx","webpack:///../../ui/src/components/IconButton/index.js","webpack:///../../ui/src/components/Label/Label.jsx","webpack:///../../ui/src/components/Label/index.js","webpack:///../../ui/src/components/Input/Input.jsx","webpack:///../../ui/src/components/Input/index.js","webpack:///../../ui/src/components/InputDateRange/InputDateRange.jsx","webpack:///../../ui/src/components/InputDateRange/index.js","webpack:///../../ui/src/utils/getGridWidthClass.js","webpack:///../../ui/src/components/InputGroup/InputGroup.jsx","webpack:///../../ui/src/components/InputGroup/index.js","webpack:///../../ui/src/components/InputLabelWrapper/InputLabelWrapper.jsx","webpack:///../../ui/src/components/InputLabelWrapper/index.js","webpack:///../../ui/src/components/InputMultiSelect/InputMultiSelect.jsx","webpack:///../../ui/src/components/InputMultiSelect/index.js","webpack:///../../ui/src/components/InputText/InputText.jsx","webpack:///../../ui/src/components/InputText/index.js","webpack:///../../ui/src/components/LayoutSelector/LayoutSelector.jsx","webpack:///../../ui/src/components/LayoutSelector/index.js","webpack:///../../ui/src/components/MeasurementTable/MeasurementItem.js","webpack:///../../ui/src/components/MeasurementTable/MeasurementTable.jsx","webpack:///../../ui/src/components/MeasurementTable/index.js","webpack:///../../ui/src/components/NavBar/NavBar.jsx","webpack:///../../ui/src/components/NavBar/index.js","webpack:///../../ui/src/components/Notification/Notification.jsx","webpack:///../../ui/src/components/Notification/index.js","webpack:///../../ui/src/components/Select/Select.jsx","webpack:///../../ui/src/components/Select/index.js","webpack:///../../ui/src/components/SegmentationTable/SegmentationTable.jsx","webpack:///../../ui/src/components/SidePanel/SidePanel.jsx","webpack:///../../ui/src/components/SidePanel/index.js","webpack:///../../ui/src/components/SplitButton/SplitButton.jsx","webpack:///../../ui/src/components/SplitButton/index.js","webpack:///../../ui/src/components/StudyBrowser/StudyBrowser.jsx","webpack:///../../ui/src/components/StudyBrowser/index.js","webpack:///../../ui/src/components/StudyItem/StudyItem.jsx","webpack:///../../ui/src/components/StudyItem/index.js","webpack:///../../ui/src/components/StudyListExpandedRow/StudyListExpandedRow.js","webpack:///../../ui/src/components/StudyListExpandedRow/index.js","webpack:///../../ui/src/components/StudyListFilter/StudyListFilter.jsx","webpack:///../../ui/src/components/StudyListPagination/StudyListPagination.js","webpack:///../../ui/src/components/StudyListPagination/index.js","webpack:///../../ui/src/components/StudyListTable/StudyListTableRow.js","webpack:///../../ui/src/components/StudyListTable/StudyListTable.js","webpack:///../../ui/src/components/StudySummary/StudySummary.jsx","webpack:///../../ui/src/components/StudySummary/index.js","webpack:///../../ui/src/components/Svg/getSvg.jsx","webpack:///../../ui/src/components/Svg/Svg.jsx","webpack:///../../ui/src/components/Svg/index.js","webpack:///../../ui/src/components/Table/Table.jsx","webpack:///../../ui/src/components/Table/index.js","webpack:///../../ui/src/components/TableBody/TableBody.jsx","webpack:///../../ui/src/components/TableBody/index.js","webpack:///../../ui/src/components/TableCell/TableCell.jsx","webpack:///../../ui/src/components/TableCell/index.js","webpack:///../../ui/src/components/TableHead/TableHead.jsx","webpack:///../../ui/src/components/TableHead/index.js","webpack:///../../ui/src/components/TableRow/TableRow.jsx","webpack:///../../ui/src/components/TableRow/index.js","webpack:///../../ui/src/components/ThemeWrapper/index.js","webpack:///../../ui/src/components/ThemeWrapper/ThemeWrapper.js","webpack:///../../ui/src/components/Thumbnail/Thumbnail.jsx","webpack:///../../ui/src/components/Thumbnail/index.js","webpack:///../../ui/src/components/ThumbnailNoImage/ThumbnailNoImage.jsx","webpack:///../../ui/src/components/ThumbnailNoImage/index.js","webpack:///../../ui/src/components/ThumbnailTracked/ThumbnailTracked.jsx","webpack:///../../ui/src/components/ThumbnailTracked/index.js","webpack:///../../ui/src/components/ThumbnailList/ThumbnailList.jsx","webpack:///../../ui/src/components/ThumbnailList/index.js","webpack:///../../ui/src/components/ToolbarButton/ToolbarButton.jsx","webpack:///../../ui/src/components/ToolbarButton/index.js","webpack:///../../ui/src/components/ContextMenuMeasurements/ContextMenuMeasurements.jsx","webpack:///../../ui/src/components/ExpandableToolbarButton/ExpandableToolbarButton.jsx","webpack:///../../ui/src/components/ListMenu/ListMenu.jsx","webpack:///../../ui/src/components/ListMenu/index.js","webpack:///../../ui/src/components/Tooltip/Tooltip.jsx","webpack:///../../ui/src/components/Tooltip/index.js","webpack:///../../ui/src/components/TooltipClipboard/TooltipClipboard.jsx","webpack:///../../ui/src/components/Typography/Typography.jsx","webpack:///../../ui/src/components/Typography/index.js","webpack:///../../ui/src/components/Viewport/Viewport.jsx","webpack:///../../ui/src/components/ViewportActionBar/ViewportActionBar.jsx","webpack:///../../ui/src/utils/useOnClickOutside.js","webpack:///../../ui/src/components/ViewportActionBar/index.js","webpack:///../../ui/src/components/ViewportDownloadForm/ViewportDownloadForm.jsx","webpack:///../../ui/src/components/ViewportGrid/ViewportGrid.jsx","webpack:///../../ui/src/components/ViewportGrid/index.js","webpack:///../../ui/src/components/ViewportPane/ViewportPane.jsx","webpack:///../../ui/src/components/ViewportPane/index.js","webpack:///../../ui/src/components/WindowLevelMenuItem/WindowLevelMenuItem.jsx","webpack:///../../ui/src/components/WindowLevelMenuItem/index.js","webpack:///../../ui/src/components/UserPreferences/UserPreferences.jsx","webpack:///../../ui/src/components/UserPreferences/index.js","webpack:///../../ui/src/components/HotkeysPreferences/hotkeysConfig.js","webpack:///../../ui/src/components/HotkeysPreferences/hotkeysValidators.js","webpack:///../../ui/src/components/HotkeysPreferences/HotkeysPreferences.jsx","webpack:///../../ui/src/components/HotkeysPreferences/utils.js","webpack:///../../ui/src/components/HotkeysPreferences/index.js","webpack:///../../ui/src/components/HotkeyField/HotkeyField.jsx","webpack:///../../ui/src/components/HotkeyField/utils.js","webpack:///../../ui/src/components/HotkeyField/index.js","webpack:///../../ui/src/components/Header/Header.jsx","webpack:///../../ui/src/components/Header/index.js","webpack:///../../ui/src/pages/Colors/BackgroundColor.jsx","webpack:///../../ui/src/contextProviders/ModalComponent.jsx","webpack:///../../i18n/src/config.js","webpack:///../../i18n/src/utils.js","webpack:///../../i18n/src/locales/ar/index.js","webpack:///../../i18n/src/locales/en-US/index.js","webpack:///../../i18n/src/locales/es/index.js","webpack:///../../i18n/src/locales/fr/index.js","webpack:///../../i18n/src/locales/ja-JP/index.js","webpack:///../../i18n/src/locales/nl/index.js","webpack:///../../i18n/src/locales/pt-BR/index.js","webpack:///../../i18n/src/locales/vi/index.js","webpack:///../../i18n/src/locales/zh/index.js","webpack:///../../i18n/src/locales/test-LNG/index.js","webpack:///../../i18n/src/locales/index.js","webpack:///../../i18n/src/index.js","webpack:///./routes/Mode/Compose.js","webpack:///./state/appConfig.js","webpack:///./routes/DataSourceWrapper.jsx","webpack:///./routes/WorkList/filtersMeta.js","webpack:///./hooks/useDebounce.js","webpack:///./hooks/useQuery.js","webpack:///./routes/WorkList/WorkList.jsx","webpack:///./routes/Local/fileLoader.js","webpack:///./routes/Local/pdfFileLoader.js","webpack:///./routes/Local/dicomFileLoader.js","webpack:///./routes/Local/fileLoaderService.js","webpack:///./routes/Local/filesToStudies.js","webpack:///./routes/Local/Local.jsx","webpack:///./routes/NotFound/NotFound.jsx","webpack:///./components/EmptyViewport.jsx","webpack:///./components/ViewportGrid.jsx","webpack:///./routes/Mode/Mode.jsx","webpack:///./routes/PrivateRoute.jsx","webpack:///./routes/index.js","webpack:///./routes/buildModeRoutes.js","webpack:///./appInit.js","webpack:///./routes/CallbackPage.js","webpack:///./routes/SignoutCallbackComponent.js","webpack:///./utils/OpenIdConnectRoutes.jsx","webpack:///./utils/getUserManagerForOpenIdConnectClient.js","webpack:///../../../modes/longitudinal/src/toolbarButtons.js","webpack:///../../../modes/longitudinal/src/index.js","webpack:///./App.jsx","webpack:///../../../extensions/default/src/DicomWebDataSource/qido.js","webpack:///../../../extensions/default/src/DicomWebDataSource/utils/getImageId.js","webpack:///../../../extensions/default/src/DicomWebDataSource/utils/getWADORSImageId.js","webpack:///../../../extensions/default/src/DicomWebDataSource/utils/isLowPriorityModality.js","webpack:///../../../extensions/default/src/DicomWebDataSource/utils/sortStudy.js","webpack:///../../../extensions/default/src/DicomWebDataSource/wado/retrieveMetadataLoaderAsync.js","webpack:///../../../extensions/default/src/DicomWebDataSource/wado/retrieveMetadataLoader.js","webpack:///../../../extensions/default/src/DicomWebDataSource/wado/retrieveMetadata.js","webpack:///../../../extensions/default/src/DicomWebDataSource/retrieveStudyMetadata.js","webpack:///../../../extensions/default/src/DicomWebDataSource/utils/StaticWadoClient.js","webpack:///../../../extensions/default/src/DicomWebDataSource/index.js","webpack:///../../../extensions/default/src/DicomWebDataSource/dcm4cheeReject.js","webpack:///../../../extensions/default/src/DicomJSONDataSource/index.js","webpack:///../../../extensions/default/src/DicomLocalDataSource/index.js","webpack:///../../../extensions/default/src/getDataSourcesModule.js","webpack:///../../../extensions/default/src/ViewerLayout/index.jsx","webpack:///../../../extensions/default/src/Panels/PanelStudyBrowser.jsx","webpack:///../../../extensions/default/src/Panels/getImageSrcFromImageId.js","webpack:///../../../extensions/default/src/Panels/getStudiesForPatientByStudyInstanceUID.js","webpack:///../../../extensions/default/src/Panels/requestDisplaySetCreationForStudy.js","webpack:///../../../extensions/default/src/Panels/WrappedPanelStudyBrowser.jsx","webpack:///../../../extensions/default/src/debounce.js","webpack:///../../../extensions/default/src/PanelMeasurementTable.js","webpack:///../../../extensions/default/src/getPanelModule.js","webpack:///../../core/src/utils/isImage.js","webpack:///../../core/src/utils/sopClassDictionary.js","webpack:///../../../extensions/default/src/id.js","webpack:///../../../extensions/default/src/getSopClassHandlerModule.js","webpack:///../../../extensions/default/src/getHangingProtocolModule.js","webpack:///../../../extensions/default/src/Toolbar/ToolbarDivider.jsx","webpack:///../../../extensions/default/src/Toolbar/ToolbarLayoutSelector.jsx","webpack:///../../../extensions/default/src/Toolbar/ToolbarSplitButton.jsx","webpack:///../../../extensions/default/src/commandsModule.js","webpack:///../../../extensions/default/src/index.js","webpack:///../../../extensions/default/src/getLayoutTemplateModule.js","webpack:///../../../extensions/default/src/getToolbarModule.js","webpack:///../../../extensions/cornerstone/src/utils/getTools.js","webpack:///../../../extensions/cornerstone/src/initCornerstoneTools.js","webpack:///../../../extensions/cornerstone/src/initWADOImageLoader.js","webpack:///../../../extensions/cornerstone/src/utils/getCornerstoneMeasurementById.js","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/constants/supportedTools.js","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/utils/getPointsFromHandles.js","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/utils/getSOPInstanceAttributes.js","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/Length.js","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/Bidirectional.js","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/ArrowAnnotate.js","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/EllipticalRoi.js","webpack:///../../../extensions/cornerstone/src/utils/measurementServiceMappings/measurementServiceMappingsFactory.js","webpack:///../../../extensions/cornerstone/src/state.js","webpack:///../../../extensions/cornerstone/src/callInputDialog.js","webpack:///../../../extensions/cornerstone/src/init.js","webpack:///../../../extensions/cornerstone/src/CornerstoneViewportDownloadForm.js","webpack:///../../../extensions/cornerstone/src/commandsModule.js","webpack:///../../../extensions/cornerstone/src/index.js","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/PanelStudyBrowserTracking.jsx","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/getImageSrcFromImageId.js","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/getStudiesForPatientByStudyInstanceUID.js","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/requestDisplaySetCreationForStudy.js","webpack:///../../../extensions/measurement-tracking/src/panels/PanelStudyBrowserTracking/index.jsx","webpack:///../../../extensions/measurement-tracking/src/panels/PanelMeasurementTableTracking/ActionButtons.jsx","webpack:///../../../extensions/measurement-tracking/src/_shared/downloadCSVReport.js","webpack:///../../../extensions/measurement-tracking/src/panels/PanelMeasurementTableTracking/index.js","webpack:///../../../extensions/measurement-tracking/src/getPanelModule.js","webpack:///../../../extensions/measurement-tracking/src/getViewportModule.js","webpack:///../../../extensions/measurement-tracking/src/index.js","webpack:///../../../extensions/dicom-sr/src/utils/addMeasurement.js","webpack:///../../../extensions/dicom-sr/src/utils/isRehydratable.js","webpack:///../../../extensions/dicom-sr/src/getSopClassHandlerModule.js","webpack:///../../../extensions/dicom-sr/src/tools/modules/dicomSRModule.js","webpack:///../../../extensions/dicom-sr/src/init.js","webpack:///../../../extensions/dicom-sr/src/index.js","webpack:///../../../extensions/dicom-sr/src/onModeEnter.js","webpack:///./index.js","webpack:///../../../node_modules/moment/locale|sync|/^/.*$","webpack:///webpack/bootstrap","webpack:///webpack/runtime/amd define","webpack:///webpack/runtime/chunk prefetch function","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/ensure chunk","webpack:///webpack/runtime/get javascript chunk filename","webpack:///webpack/runtime/get mini-css chunk filename","webpack:///webpack/runtime/global","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///webpack/runtime/node module decorator","webpack:///webpack/runtime/publicPath","webpack:///webpack/runtime/jsonp chunk loading","webpack:///webpack/runtime/startup prefetch","webpack:///webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","var inProgress = {};\n// data-webpack is not used as build has no uniqueName\n// loadScript function to load a script via script tag\n__webpack_require__.l = function(url, done, key, chunkId) {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = function(prev, event) {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach(function(fn) { return fn(event); });\n\t\tif(prev) return prev(event);\n\t}\n\t;\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","export default {\r\n  POINT: 'POINT',\r\n  MULTIPOINT: 'MULTIPOINT',\r\n  POLYLINE: 'POLYLINE',\r\n  CIRCLE: 'CIRCLE',\r\n  ELLIPSE: 'ELLIPSE',\r\n};\r\n","const TOOL_NAMES = {\r\n  DICOM_SR_DISPLAY_TOOL: 'DICOMSRDisplayTool',\r\n};\r\n\r\nexport default TOOL_NAMES;\r\n","const id = 'org.ohif.dicom-sr';\r\n\r\nexport default id;\r\n\r\nconst SOPClassHandlerName = 'dicom-sr';\r\nconst SOPClassHandlerId = `${id}.sopClassHandlerModule.${SOPClassHandlerName}`;\r\nexport { SOPClassHandlerName, SOPClassHandlerId };\r\n","const RESPONSE = {\r\n  NO_NEVER: -1,\r\n  CANCEL: 0,\r\n  CREATE_REPORT: 1,\r\n  ADD_SERIES: 2,\r\n  SET_STUDY_AND_SERIES: 3,\r\n  NO_NOT_FOR_SERIES: 4,\r\n};\r\n\r\nexport default RESPONSE;\r\n","/* eslint-disable react/display-name */\r\nimport React from 'react';\r\nimport { Dialog, Input } from '@ohif/ui';\r\nimport RESPONSE from './PROMPT_RESPONSES';\r\n\r\nexport default function createReportDialogPrompt(UIDialogService) {\r\n  return new Promise(function(resolve, reject) {\r\n    let dialogId = undefined;\r\n\r\n    const _handleClose = () => {\r\n      // Dismiss dialog\r\n      UIDialogService.dismiss({ id: dialogId });\r\n      // Notify of cancel action\r\n      resolve({ action: RESPONSE.CANCEL, value: undefined });\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {string} param0.action - value of action performed\r\n     * @param {string} param0.value - value from input field\r\n     */\r\n    const _handleFormSubmit = ({ action, value }) => {\r\n      UIDialogService.dismiss({ id: dialogId });\r\n      switch (action.id) {\r\n        case 'save':\r\n          resolve({ action: RESPONSE.CREATE_REPORT, value: value.label });\r\n          break;\r\n        case 'cancel':\r\n          resolve({ action: RESPONSE.CANCEL, value: undefined });\r\n          break;\r\n      }\r\n    };\r\n\r\n    dialogId = UIDialogService.create({\r\n      centralize: true,\r\n      isDraggable: false,\r\n      content: Dialog,\r\n      useLastPosition: false,\r\n      showOverlay: true,\r\n      contentProps: {\r\n        title: 'Provide a name for your report',\r\n        value: { label: '' },\r\n        noCloseButton: true,\r\n        onClose: _handleClose,\r\n        actions: [\r\n          { id: 'cancel', text: 'Cancel', type: 'primary' },\r\n          { id: 'save', text: 'Save', type: 'secondary' },\r\n        ],\r\n        // TODO: Should be on button press...\r\n        onSubmit: _handleFormSubmit,\r\n        body: ({ value, setValue }) => {\r\n          const onChangeHandler = event => {\r\n            event.persist();\r\n            setValue(value => ({ ...value, label: event.target.value }));\r\n          };\r\n          const onKeyPressHandler = event => {\r\n            if (event.key === 'Enter') {\r\n              UIDialogService.dismiss({ id: dialogId });\r\n              resolve({ action: RESPONSE.CREATE_REPORT, value: value.label });\r\n            }\r\n          };\r\n          return (\r\n            <div className=\"p-4 bg-primary-dark\">\r\n              <Input\r\n                autoFocus\r\n                className=\"mt-2 bg-black border-primary-main\"\r\n                type=\"text\"\r\n                containerClassName=\"mr-2\"\r\n                value={value.label}\r\n                onChange={onChangeHandler}\r\n                onKeyPress={onKeyPressHandler}\r\n              />\r\n            </div>\r\n          );\r\n        },\r\n      },\r\n    });\r\n  });\r\n}\r\n","import { assign } from 'xstate';\r\n\r\nconst RESPONSE = {\r\n  NO_NEVER: -1,\r\n  CANCEL: 0,\r\n  CREATE_REPORT: 1,\r\n  ADD_SERIES: 2,\r\n  SET_STUDY_AND_SERIES: 3,\r\n  NO_NOT_FOR_SERIES: 4,\r\n  HYDRATE_REPORT: 5,\r\n};\r\n\r\nconst machineConfiguration = {\r\n  id: 'measurementTracking',\r\n  initial: 'idle',\r\n  context: {\r\n    trackedStudy: '',\r\n    trackedSeries: [],\r\n    ignoredSeries: [],\r\n    //\r\n    prevTrackedStudy: '',\r\n    prevTrackedSeries: [],\r\n    prevIgnoredSeries: [],\r\n    //\r\n    ignoredSRSeriesForHydration: [],\r\n    isDirty: false,\r\n  },\r\n  states: {\r\n    off: {\r\n      type: 'final',\r\n    },\r\n    idle: {\r\n      entry: 'clearContext',\r\n      on: {\r\n        TRACK_SERIES: 'promptBeginTracking',\r\n        // Unused? We may only do PROMPT_HYDRATE_SR now?\r\n        SET_TRACKED_SERIES: [\r\n          {\r\n            target: 'tracking',\r\n            actions: ['setTrackedStudyAndMultipleSeries', 'setIsDirtyToClean'],\r\n          },\r\n        ],\r\n        PROMPT_HYDRATE_SR: {\r\n          target: 'promptHydrateStructuredReport',\r\n          cond: 'hasNotIgnoredSRSeriesForHydration',\r\n        },\r\n        RESTORE_PROMPT_HYDRATE_SR: 'promptHydrateStructuredReport'\r\n      },\r\n    },\r\n    promptBeginTracking: {\r\n      invoke: {\r\n        src: 'promptBeginTracking',\r\n        onDone: [\r\n          {\r\n            target: 'tracking',\r\n            actions: ['setTrackedStudyAndSeries', 'setIsDirty'],\r\n            cond: 'shouldSetStudyAndSeries',\r\n          },\r\n          {\r\n            target: 'off',\r\n            cond: 'shouldKillMachine',\r\n          },\r\n          {\r\n            target: 'idle',\r\n          },\r\n        ],\r\n        onError: {\r\n          target: 'idle',\r\n        },\r\n      },\r\n    },\r\n    tracking: {\r\n      on: {\r\n        TRACK_SERIES: [\r\n          {\r\n            target: 'promptTrackNewStudy',\r\n            cond: 'isNewStudy',\r\n          },\r\n          {\r\n            target: 'promptTrackNewSeries',\r\n            cond: 'isNewSeries',\r\n          },\r\n        ],\r\n        UNTRACK_SERIES: [\r\n          {\r\n            target: 'tracking',\r\n            actions: ['removeTrackedSeries', 'setIsDirty'],\r\n            cond: 'hasRemainingTrackedSeries',\r\n          },\r\n          {\r\n            target: 'idle',\r\n          },\r\n        ],\r\n        SET_TRACKED_SERIES: [\r\n          {\r\n            target: 'tracking',\r\n            actions: ['setTrackedStudyAndMultipleSeries'],\r\n          },\r\n        ],\r\n        SAVE_REPORT: 'promptSaveReport',\r\n        SET_DIRTY: [\r\n          {\r\n            target: 'tracking',\r\n            actions: ['setIsDirty'],\r\n            cond: 'shouldSetDirty',\r\n          },\r\n          {\r\n            target: 'tracking',\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    promptTrackNewSeries: {\r\n      invoke: {\r\n        src: 'promptTrackNewSeries',\r\n        onDone: [\r\n          {\r\n            target: 'tracking',\r\n            actions: ['addTrackedSeries', 'setIsDirty'],\r\n            cond: 'shouldAddSeries',\r\n          },\r\n          {\r\n            target: 'tracking',\r\n            actions: [\r\n              'discardPreviouslyTrackedMeasurements',\r\n              'setTrackedStudyAndSeries',\r\n              'setIsDirty',\r\n            ],\r\n            cond: 'shouldSetStudyAndSeries',\r\n          },\r\n          {\r\n            target: 'promptSaveReport',\r\n            cond: 'shouldPromptSaveReport',\r\n          },\r\n          {\r\n            target: 'tracking',\r\n          },\r\n        ],\r\n        onError: {\r\n          target: 'idle',\r\n        },\r\n      },\r\n    },\r\n    promptTrackNewStudy: {\r\n      invoke: {\r\n        src: 'promptTrackNewStudy',\r\n        onDone: [\r\n          {\r\n            target: 'tracking',\r\n            actions: [\r\n              'discardPreviouslyTrackedMeasurements',\r\n              'setTrackedStudyAndSeries',\r\n              'setIsDirty',\r\n            ],\r\n            cond: 'shouldSetStudyAndSeries',\r\n          },\r\n          {\r\n            target: 'tracking',\r\n            actions: ['ignoreSeries'],\r\n            cond: 'shouldAddIgnoredSeries',\r\n          },\r\n          {\r\n            target: 'promptSaveReport',\r\n            cond: 'shouldPromptSaveReport',\r\n          },\r\n          {\r\n            target: 'tracking',\r\n          },\r\n        ],\r\n        onError: {\r\n          target: 'idle',\r\n        },\r\n      },\r\n    },\r\n    promptSaveReport: {\r\n      invoke: {\r\n        src: 'promptSaveReport',\r\n        onDone: [\r\n          // \"clicked the save button\"\r\n          // - should clear all measurements\r\n          // - show DICOM SR\r\n          {\r\n            target: 'idle',\r\n            actions: [\r\n              'clearAllMeasurements',\r\n              'showStructuredReportDisplaySetInActiveViewport',\r\n            ],\r\n            cond: 'shouldSaveAndContinueWithSameReport',\r\n          },\r\n          // \"starting a new report\"\r\n          // - remove \"just saved\" measurements\r\n          // - start tracking a new study + report\r\n          {\r\n            target: 'tracking',\r\n            actions: [\r\n              'discardPreviouslyTrackedMeasurements',\r\n              'setTrackedStudyAndSeries',\r\n            ],\r\n            cond: 'shouldSaveAndStartNewReport',\r\n          },\r\n          // Cancel, back to tracking\r\n          {\r\n            target: 'tracking',\r\n          },\r\n        ],\r\n        onError: {\r\n          target: 'idle',\r\n        },\r\n      },\r\n    },\r\n    promptHydrateStructuredReport: {\r\n      invoke: {\r\n        src: 'promptHydrateStructuredReport',\r\n        onDone: [\r\n          {\r\n            target: 'tracking',\r\n            actions: [\r\n              'setTrackedStudyAndMultipleSeries',\r\n              'jumpToFirstMeasurementInActiveViewport',\r\n              'setIsDirtyToClean',\r\n            ],\r\n            cond: 'shouldHydrateStructuredReport',\r\n          },\r\n          {\r\n            target: 'idle',\r\n            actions: ['ignoreHydrationForSRSeries'],\r\n            cond: 'shouldIgnoreHydrationForSR'\r\n          },\r\n        ],\r\n        onError: {\r\n          target: 'idle',\r\n        },\r\n      },\r\n    },\r\n  },\r\n  strict: true,\r\n};\r\n\r\nconst defaultOptions = {\r\n  services: {\r\n    promptBeginTracking: (ctx, evt) => {\r\n      // return { userResponse, StudyInstanceUID, SeriesInstanceUID }\r\n    },\r\n    promptTrackNewStudy: (ctx, evt) => {\r\n      // return { userResponse, StudyInstanceUID, SeriesInstanceUID }\r\n    },\r\n    promptTrackNewSeries: (ctx, evt) => {\r\n      // return { userResponse, StudyInstanceUID, SeriesInstanceUID }\r\n    },\r\n  },\r\n  actions: {\r\n    discardPreviouslyTrackedMeasurements: (ctx, evt) => {\r\n      console.log('discardPreviouslyTrackedMeasurements: not implemented');\r\n    },\r\n    clearAllMeasurements: (ctx, evt) => {\r\n      console.log('clearAllMeasurements: not implemented');\r\n    },\r\n    jumpToFirstMeasurementInActiveViewport: (ctx, evt) => {\r\n      console.warn('jumpToFirstMeasurementInActiveViewport: not implemented');\r\n    },\r\n    showStructuredReportDisplaySetInActiveViewport: (ctx, evt) => {\r\n      console.warn(\r\n        'showStructuredReportDisplaySetInActiveViewport: not implemented'\r\n      );\r\n    },\r\n    clearContext: assign({\r\n      trackedStudy: '',\r\n      trackedSeries: [],\r\n      ignoredSeries: [],\r\n      prevTrackedStudy: '',\r\n      prevTrackedSeries: [],\r\n      prevIgnoredSeries: [],\r\n    }),\r\n    // Promise resolves w/ `evt.data.*`\r\n    setTrackedStudyAndSeries: assign((ctx, evt) => ({\r\n      prevTrackedStudy: ctx.trackedStudy,\r\n      prevTrackedSeries: ctx.trackedSeries.slice(),\r\n      prevIgnoredSeries: ctx.ignoredSeries.slice(),\r\n      //\r\n      trackedStudy: evt.data.StudyInstanceUID,\r\n      trackedSeries: [evt.data.SeriesInstanceUID],\r\n      ignoredSeries: [],\r\n    })),\r\n    setTrackedStudyAndMultipleSeries: assign((ctx, evt) => {\r\n      const studyInstanceUID =\r\n        evt.StudyInstanceUID || evt.data.StudyInstanceUID;\r\n      const seriesInstanceUIDs =\r\n        evt.SeriesInstanceUIDs || evt.data.SeriesInstanceUIDs;\r\n\r\n      return {\r\n        prevTrackedStudy: ctx.trackedStudy,\r\n        prevTrackedSeries: ctx.trackedSeries.slice(),\r\n        prevIgnoredSeries: ctx.ignoredSeries.slice(),\r\n        //\r\n        trackedStudy: studyInstanceUID,\r\n        trackedSeries: [...ctx.trackedSeries, ...seriesInstanceUIDs],\r\n        ignoredSeries: [],\r\n      };\r\n    }),\r\n    setIsDirtyToClean: assign((ctx, evt) => ({\r\n      isDirty: false,\r\n    })),\r\n    setIsDirty: assign((ctx, evt) => ({\r\n      isDirty: true,\r\n    })),\r\n    ignoreSeries: assign((ctx, evt) => ({\r\n      prevIgnoredSeries: [...ctx.ignoredSeries],\r\n      ignoredSeries: [...ctx.ignoredSeries, evt.data.SeriesInstanceUID],\r\n    })),\r\n    ignoreHydrationForSRSeries: assign((ctx, evt) => ({\r\n      ignoredSRSeriesForHydration: [...ctx.ignoredSRSeriesForHydration, evt.data.srSeriesInstanceUID],\r\n    })),\r\n    addTrackedSeries: assign((ctx, evt) => ({\r\n      prevTrackedSeries: [...ctx.trackedSeries],\r\n      trackedSeries: [...ctx.trackedSeries, evt.data.SeriesInstanceUID],\r\n    })),\r\n    removeTrackedSeries: assign((ctx, evt) => ({\r\n      prevTrackedSeries: ctx.trackedSeries\r\n        .slice()\r\n        .filter(ser => ser !== evt.SeriesInstanceUID),\r\n      trackedSeries: ctx.trackedSeries\r\n        .slice()\r\n        .filter(ser => ser !== evt.SeriesInstanceUID),\r\n    })),\r\n  },\r\n  guards: {\r\n    // We set dirty any time we performan an action that:\r\n    // - Tracks a new study\r\n    // - Tracks a new series\r\n    // - Adds a measurement to an already tracked study/series\r\n    //\r\n    // We set clean any time we restore from an SR\r\n    //\r\n    // This guard/condition is specific to \"new measurements\"\r\n    // to make sure we only track dirty when the new measurement is specific\r\n    // to a series we're already tracking\r\n    //\r\n    // tl;dr\r\n    // Any report change, that is not a hydration of an existing report, should\r\n    // result in a \"dirty\" report\r\n    //\r\n    // Where dirty means there would be \"loss of data\" if we blew away measurements\r\n    // without creating a new SR.\r\n    shouldSetDirty: (ctx, evt) => {\r\n      return (\r\n        // When would this happen?\r\n        evt.SeriesInstanceUID === undefined ||\r\n        ctx.trackedSeries.includes(evt.SeriesInstanceUID)\r\n      );\r\n    },\r\n    shouldKillMachine: (ctx, evt) =>\r\n      evt.data && evt.data.userResponse === RESPONSE.NO_NEVER,\r\n    shouldAddSeries: (ctx, evt) =>\r\n      evt.data && evt.data.userResponse === RESPONSE.ADD_SERIES,\r\n    shouldSetStudyAndSeries: (ctx, evt) =>\r\n      evt.data && evt.data.userResponse === RESPONSE.SET_STUDY_AND_SERIES,\r\n    shouldAddIgnoredSeries: (ctx, evt) =>\r\n      evt.data && evt.data.userResponse === RESPONSE.NO_NOT_FOR_SERIES,\r\n    shouldPromptSaveReport: (ctx, evt) =>\r\n      evt.data && evt.data.userResponse === RESPONSE.CREATE_REPORT,\r\n    shouldIgnoreHydrationForSR: (ctx, evt) =>\r\n      evt.data && evt.data.userResponse === RESPONSE.CANCEL,\r\n    shouldSaveAndContinueWithSameReport: (ctx, evt) =>\r\n      evt.data &&\r\n      evt.data.userResponse === RESPONSE.CREATE_REPORT &&\r\n      evt.data.isBackupSave === true,\r\n    shouldSaveAndStartNewReport: (ctx, evt) =>\r\n      evt.data &&\r\n      evt.data.userResponse === RESPONSE.CREATE_REPORT &&\r\n      evt.data.isBackupSave === false,\r\n    shouldHydrateStructuredReport: (ctx, evt) =>\r\n      evt.data && evt.data.userResponse === RESPONSE.HYDRATE_REPORT,\r\n    // Has more than 1, or SeriesInstanceUID is not in list\r\n    // --> Post removal would have non-empty trackedSeries array\r\n    hasRemainingTrackedSeries: (ctx, evt) =>\r\n      ctx.trackedSeries.length > 1 ||\r\n      !ctx.trackedSeries.includes(evt.SeriesInstanceUID),\r\n    hasNotIgnoredSRSeriesForHydration: (ctx, evt) => {\r\n      return !ctx.ignoredSRSeriesForHydration.includes(evt.SeriesInstanceUID)\r\n    },\r\n    isNewStudy: (ctx, evt) =>\r\n      !ctx.ignoredSeries.includes(evt.SeriesInstanceUID) &&\r\n      ctx.trackedStudy !== evt.StudyInstanceUID,\r\n    isNewSeries: (ctx, evt) =>\r\n      !ctx.ignoredSeries.includes(evt.SeriesInstanceUID) &&\r\n      !ctx.trackedSeries.includes(evt.SeriesInstanceUID),\r\n  },\r\n};\r\n\r\nexport { defaultOptions, machineConfiguration };\r\n","const RESPONSE = {\r\n  NO_NEVER: -1,\r\n  CANCEL: 0,\r\n  CREATE_REPORT: 1,\r\n  ADD_SERIES: 2,\r\n  SET_STUDY_AND_SERIES: 3,\r\n};\r\n\r\nfunction promptUser({ servicesManager, extensionManager }, ctx, evt) {\r\n  const { UIViewportDialogService } = servicesManager.services;\r\n  const { viewportIndex, StudyInstanceUID, SeriesInstanceUID } = evt;\r\n\r\n  return new Promise(async function(resolve, reject) {\r\n    let promptResult = await _askTrackMeasurements(\r\n      UIViewportDialogService,\r\n      viewportIndex\r\n    );\r\n\r\n    resolve({\r\n      userResponse: promptResult,\r\n      StudyInstanceUID,\r\n      SeriesInstanceUID,\r\n      viewportIndex,\r\n    });\r\n  });\r\n}\r\n\r\nfunction _askTrackMeasurements(UIViewportDialogService, viewportIndex) {\r\n  return new Promise(function(resolve, reject) {\r\n    const message = 'Track measurements for this series?';\r\n    const actions = [\r\n      {\r\n        id: 'prompt-begin-tracking-cancel',\r\n        type: 'cancel',\r\n        text: 'No',\r\n        value: RESPONSE.CANCEL\r\n      },\r\n      {\r\n        id: 'prompt-begin-tracking-no-do-not-ask-again',\r\n        type: 'secondary',\r\n        text: 'No, do not ask again',\r\n        value: RESPONSE.NO_NEVER,\r\n      },\r\n      {\r\n        id: 'prompt-begin-tracking-yes',\r\n        type: 'primary',\r\n        text: 'Yes',\r\n        value: RESPONSE.SET_STUDY_AND_SERIES,\r\n      },\r\n    ];\r\n    const onSubmit = result => {\r\n      UIViewportDialogService.hide();\r\n      resolve(result);\r\n    };\r\n\r\n    UIViewportDialogService.show({\r\n      viewportIndex,\r\n      id: 'measurement-tracking-prompt-begin-tracking',\r\n      type: 'info',\r\n      message,\r\n      actions,\r\n      onSubmit,\r\n      onOutsideClick: () => {\r\n        UIViewportDialogService.hide();\r\n        resolve(RESPONSE.CANCEL);\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\nexport default promptUser;\r\n","const RESPONSE = {\r\n  NO_NEVER: -1,\r\n  CANCEL: 0,\r\n  CREATE_REPORT: 1,\r\n  ADD_SERIES: 2,\r\n  SET_STUDY_AND_SERIES: 3,\r\n  NO_NOT_FOR_SERIES: 4,\r\n};\r\n\r\nfunction promptUser({ servicesManager, extensionManager }, ctx, evt) {\r\n  const { UIViewportDialogService } = servicesManager.services;\r\n  const { viewportIndex, StudyInstanceUID, SeriesInstanceUID } = evt;\r\n\r\n  return new Promise(async function(resolve, reject) {\r\n    let promptResult = await _askShouldAddMeasurements(\r\n      UIViewportDialogService,\r\n      viewportIndex\r\n    );\r\n\r\n    if (promptResult === RESPONSE.CREATE_REPORT) {\r\n      promptResult = ctx.isDirty\r\n        ? await _askSaveDiscardOrCancel(UIViewportDialogService, viewportIndex)\r\n        : RESPONSE.SET_STUDY_AND_SERIES;\r\n    }\r\n\r\n    resolve({\r\n      userResponse: promptResult,\r\n      StudyInstanceUID,\r\n      SeriesInstanceUID,\r\n      viewportIndex,\r\n      isBackupSave: false,\r\n    });\r\n  });\r\n}\r\n\r\nfunction _askShouldAddMeasurements(UIViewportDialogService, viewportIndex) {\r\n  return new Promise(function(resolve, reject) {\r\n    const message =\r\n      'Do you want to add this measurement to the existing report?';\r\n    const actions = [\r\n      { type: 'cancel', text: 'Cancel', value: RESPONSE.CANCEL },\r\n      {\r\n        type: 'secondary',\r\n        text: 'Create new report',\r\n        value: RESPONSE.CREATE_REPORT,\r\n      },\r\n      {\r\n        type: 'primary',\r\n        text: 'Add to existing report',\r\n        value: RESPONSE.ADD_SERIES,\r\n      },\r\n    ];\r\n    const onSubmit = result => {\r\n      UIViewportDialogService.hide();\r\n      resolve(result);\r\n    };\r\n\r\n    UIViewportDialogService.show({\r\n      viewportIndex,\r\n      type: 'info',\r\n      message,\r\n      actions,\r\n      onSubmit,\r\n      onOutsideClick: () => {\r\n        UIViewportDialogService.hide();\r\n        resolve(RESPONSE.CANCEL);\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\nfunction _askSaveDiscardOrCancel(UIViewportDialogService, viewportIndex) {\r\n  return new Promise(function(resolve, reject) {\r\n    const message =\r\n      'You have existing tracked measurements. What would you like to do with your existing tracked measurements?';\r\n    const actions = [\r\n      { type: 'cancel', text: 'Cancel', value: RESPONSE.CANCEL },\r\n      {\r\n        type: 'secondary',\r\n        text: 'Save',\r\n        value: RESPONSE.CREATE_REPORT,\r\n      },\r\n      {\r\n        type: 'primary',\r\n        text: 'Discard',\r\n        value: RESPONSE.SET_STUDY_AND_SERIES,\r\n      },\r\n    ];\r\n    const onSubmit = result => {\r\n      UIViewportDialogService.hide();\r\n      resolve(result);\r\n    };\r\n\r\n    UIViewportDialogService.show({\r\n      viewportIndex,\r\n      type: 'warning',\r\n      message,\r\n      actions,\r\n      onSubmit,\r\n      onOutsideClick: () => {\r\n        UIViewportDialogService.hide();\r\n        resolve(RESPONSE.CANCEL);\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\nexport default promptUser;\r\n","const RESPONSE = {\r\n  NO_NEVER: -1,\r\n  CANCEL: 0,\r\n  CREATE_REPORT: 1,\r\n  ADD_SERIES: 2,\r\n  SET_STUDY_AND_SERIES: 3,\r\n  NO_NOT_FOR_SERIES: 4,\r\n};\r\n\r\nfunction promptUser({ servicesManager, extensionManager }, ctx, evt) {\r\n  const { UIViewportDialogService } = servicesManager.services;\r\n  const { viewportIndex, StudyInstanceUID, SeriesInstanceUID } = evt;\r\n\r\n  return new Promise(async function(resolve, reject) {\r\n    let promptResult = await _askTrackMeasurements(\r\n      UIViewportDialogService,\r\n      viewportIndex\r\n    );\r\n\r\n    if (promptResult === RESPONSE.SET_STUDY_AND_SERIES) {\r\n      promptResult = ctx.isDirty\r\n        ? await _askSaveDiscardOrCancel(UIViewportDialogService, viewportIndex)\r\n        : RESPONSE.SET_STUDY_AND_SERIES;\r\n    }\r\n\r\n    resolve({\r\n      userResponse: promptResult,\r\n      StudyInstanceUID,\r\n      SeriesInstanceUID,\r\n      viewportIndex,\r\n      isBackupSave: false,\r\n    });\r\n  });\r\n}\r\n\r\nfunction _askTrackMeasurements(UIViewportDialogService, viewportIndex) {\r\n  return new Promise(function(resolve, reject) {\r\n    const message = 'Track measurements for this series?';\r\n    const actions = [\r\n      { type: 'cancel', text: 'No', value: RESPONSE.CANCEL },\r\n      {\r\n        type: 'secondary',\r\n        text: 'No, do not ask again for this series',\r\n        value: RESPONSE.NO_NOT_FOR_SERIES,\r\n      },\r\n      {\r\n        type: 'primary',\r\n        text: 'Yes',\r\n        value: RESPONSE.SET_STUDY_AND_SERIES,\r\n      },\r\n    ];\r\n    const onSubmit = result => {\r\n      UIViewportDialogService.hide();\r\n      resolve(result);\r\n    };\r\n\r\n    UIViewportDialogService.show({\r\n      viewportIndex,\r\n      type: 'info',\r\n      message,\r\n      actions,\r\n      onSubmit,\r\n      onOutsideClick: () => {\r\n        UIViewportDialogService.hide();\r\n        resolve(RESPONSE.CANCEL);\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\nfunction _askSaveDiscardOrCancel(UIViewportDialogService, viewportIndex) {\r\n  return new Promise(function(resolve, reject) {\r\n    const message =\r\n      'Measurements cannot span across multiple studies. Do you want to save your tracked measurements?';\r\n    const actions = [\r\n      { type: 'cancel', text: 'Cancel', value: RESPONSE.CANCEL },\r\n      {\r\n        type: 'secondary',\r\n        text: 'No, discard previously tracked series & measurements',\r\n        value: RESPONSE.SET_STUDY_AND_SERIES,\r\n      },\r\n      {\r\n        type: 'primary',\r\n        text: 'Yes',\r\n        value: RESPONSE.CREATE_REPORT,\r\n      },\r\n    ];\r\n    const onSubmit = result => {\r\n      UIViewportDialogService.hide();\r\n      resolve(result);\r\n    };\r\n\r\n    UIViewportDialogService.show({\r\n      viewportIndex,\r\n      type: 'warning',\r\n      message,\r\n      actions,\r\n      onSubmit,\r\n      onOutsideClick: () => {\r\n        UIViewportDialogService.hide();\r\n        resolve(RESPONSE.CANCEL);\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\nexport default promptUser;\r\n","import React from 'react';\r\nimport { DICOMSR, DicomMetadataStore } from '@ohif/core';\r\n\r\n/**\r\n *\r\n * @param {*} servicesManager\r\n * @param {*} dataSource\r\n * @param {*} measurements\r\n * @param {*} options\r\n * @returns {string[]} displaySetInstanceUIDs\r\n */\r\nasync function createReportAsync(\r\n  servicesManager,\r\n  dataSource,\r\n  measurements,\r\n  options\r\n) {\r\n  const {\r\n    DisplaySetService,\r\n    UINotificationService,\r\n    UIDialogService,\r\n  } = servicesManager.services;\r\n  const loadingDialogId = UIDialogService.create({\r\n    showOverlay: true,\r\n    isDraggable: false,\r\n    centralize: true,\r\n    // TODO: Create a loading indicator component + zeplin design?\r\n    content: Loading,\r\n  });\r\n\r\n  try {\r\n    const naturalizedReport = await DICOMSR.storeMeasurements(\r\n      measurements,\r\n      dataSource,\r\n      ['ArrowAnnotate'],\r\n      options\r\n    );\r\n\r\n    // The \"Mode\" route listens for DicomMetadataStore changes\r\n    // When a new instance is added, it listens and\r\n    // automatically calls makeDisplaySets\r\n    DicomMetadataStore.addInstances([naturalizedReport], true);\r\n\r\n    const displaySetInstanceUID = DisplaySetService.getMostRecentDisplaySet();\r\n\r\n    UINotificationService.show({\r\n      title: 'Create Report',\r\n      message: 'Measurements saved successfully',\r\n      type: 'success',\r\n    });\r\n\r\n    return [displaySetInstanceUID];\r\n  } catch (error) {\r\n    UINotificationService.show({\r\n      title: 'Create Report',\r\n      message: error.message || 'Failed to store measurements',\r\n      type: 'error',\r\n    });\r\n  } finally {\r\n    UIDialogService.dismiss({ id: loadingDialogId });\r\n  }\r\n}\r\n\r\nfunction Loading() {\r\n  return <div className=\"text-primary-active\">Loading...</div>;\r\n}\r\n\r\nexport default createReportAsync;\r\n","const MIN_SR_SERIES_NUMBER = 4700;\r\n\r\nexport default function getNextSRSeriesNumber(DisplaySetService) {\r\n  const activeDisplaySets = DisplaySetService.getActiveDisplaySets();\r\n  const srDisplaySets = activeDisplaySets.filter(ds => ds.Modality === 'SR');\r\n  const srSeriesNumbers = srDisplaySets.map(ds => ds.SeriesNumber);\r\n  const maxSeriesNumber = Math.max(...srSeriesNumbers, MIN_SR_SERIES_NUMBER);\r\n\r\n  return maxSeriesNumber + 1;\r\n}\r\n","import createReportAsync from './../../_shared/createReportAsync.js';\r\nimport createReportDialogPrompt from '../../_shared/createReportDialogPrompt';\r\nimport getNextSRSeriesNumber from '../../_shared/getNextSRSeriesNumber';\r\nimport RESPONSE from '../../_shared/PROMPT_RESPONSES';\r\n\r\nfunction promptUser({ servicesManager, extensionManager }, ctx, evt) {\r\n  const {\r\n    UIDialogService,\r\n    MeasurementService,\r\n    DisplaySetService,\r\n  } = servicesManager.services;\r\n  const viewportIndex =\r\n    evt.viewportIndex === undefined\r\n      ? evt.data.viewportIndex\r\n      : evt.viewportIndex;\r\n  const isBackupSave =\r\n    evt.isBackupSave === undefined ? evt.data.isBackupSave : evt.isBackupSave;\r\n  const StudyInstanceUID = evt?.data?.StudyInstanceUID;\r\n  const SeriesInstanceUID = evt?.data?.SeriesInstanceUID;\r\n\r\n  const { trackedStudy, trackedSeries } = ctx;\r\n  let displaySetInstanceUIDs;\r\n\r\n  return new Promise(async function(resolve, reject) {\r\n    // TODO: Fallback if (UIDialogService) {\r\n    const promptResult = await createReportDialogPrompt(UIDialogService);\r\n\r\n    if (promptResult.action === RESPONSE.CREATE_REPORT) {\r\n      const dataSources = extensionManager.getDataSources();\r\n      const dataSource = dataSources[0];\r\n      const measurements = MeasurementService.getMeasurements();\r\n      const trackedMeasurements = measurements.filter(\r\n        m =>\r\n          trackedStudy === m.referenceStudyUID &&\r\n          trackedSeries.includes(m.referenceSeriesUID)\r\n      );\r\n\r\n      const SeriesDescription =\r\n        // isUndefinedOrEmpty\r\n        promptResult.value === undefined || promptResult.value === ''\r\n          ? 'Research Derived Series' // default\r\n          : promptResult.value; // provided value\r\n\r\n      const SeriesNumber = getNextSRSeriesNumber(DisplaySetService);\r\n\r\n      displaySetInstanceUIDs = await createReportAsync(\r\n        servicesManager,\r\n        dataSource,\r\n        trackedMeasurements,\r\n        {\r\n          SeriesDescription,\r\n          SeriesNumber,\r\n        }\r\n      );\r\n    } else if (promptResult.action === RESPONSE.CANCEL) {\r\n      // Do nothing\r\n    }\r\n\r\n    resolve({\r\n      userResponse: promptResult.action,\r\n      createdDisplaySetInstanceUIDs: displaySetInstanceUIDs,\r\n      StudyInstanceUID,\r\n      SeriesInstanceUID,\r\n      viewportIndex,\r\n      isBackupSave,\r\n    });\r\n  });\r\n}\r\n\r\nexport default promptUser;\r\n","export default function getCornerstoneToolStateToMeasurementSchema(\r\n  toolType,\r\n  MeasurementService,\r\n  DisplaySetService,\r\n  SOPInstanceUID,\r\n  FrameOfReferenceUID,\r\n  SeriesInstanceUID,\r\n  StudyInstanceUID\r\n) {\r\n  const _getValueTypeFromToolType = toolType => {\r\n    const {\r\n      POLYLINE,\r\n      ELLIPSE,\r\n      POINT,\r\n      BIDIRECTIONAL,\r\n    } = MeasurementService.VALUE_TYPES;\r\n\r\n    // TODO -> I get why this was attemped, but its not nearly flexible enough.\r\n    // A single measurement may have an ellipse + a bidirectional measurement, for instances.\r\n    // You can't define a bidirectional tool as a single type..\r\n    // OHIF-230\r\n    const TOOL_TYPE_TO_VALUE_TYPE = {\r\n      Length: POLYLINE,\r\n      EllipticalRoi: ELLIPSE,\r\n      Bidirectional: BIDIRECTIONAL,\r\n      ArrowAnnotate: POINT,\r\n    };\r\n\r\n    return TOOL_TYPE_TO_VALUE_TYPE[toolType];\r\n  };\r\n\r\n  switch (toolType) {\r\n    case 'Length':\r\n      return measurementData =>\r\n        Length(\r\n          measurementData,\r\n          SOPInstanceUID,\r\n          FrameOfReferenceUID,\r\n          SeriesInstanceUID,\r\n          StudyInstanceUID,\r\n          DisplaySetService,\r\n          _getValueTypeFromToolType\r\n        );\r\n    case 'Bidirectional':\r\n      return measurementData =>\r\n        Bidirectional(\r\n          measurementData,\r\n          SOPInstanceUID,\r\n          FrameOfReferenceUID,\r\n          SeriesInstanceUID,\r\n          StudyInstanceUID,\r\n          DisplaySetService,\r\n          _getValueTypeFromToolType\r\n        );\r\n    case 'EllipticalRoi':\r\n      return measurementData =>\r\n        EllipticalRoi(\r\n          measurementData,\r\n          SOPInstanceUID,\r\n          FrameOfReferenceUID,\r\n          SeriesInstanceUID,\r\n          StudyInstanceUID,\r\n          DisplaySetService,\r\n          _getValueTypeFromToolType\r\n        );\r\n    case 'ArrowAnnotate':\r\n      return measurementData =>\r\n        ArrowAnnotate(\r\n          measurementData,\r\n          SOPInstanceUID,\r\n          FrameOfReferenceUID,\r\n          SeriesInstanceUID,\r\n          StudyInstanceUID,\r\n          DisplaySetService,\r\n          _getValueTypeFromToolType\r\n        );\r\n  }\r\n}\r\n\r\nfunction Length(\r\n  measurementData,\r\n  SOPInstanceUID,\r\n  FrameOfReferenceUID,\r\n  SeriesInstanceUID,\r\n  StudyInstanceUID,\r\n  DisplaySetService,\r\n  _getValueTypeFromToolType\r\n) {\r\n  const tool = measurementData.toolType || measurementData.toolName;\r\n\r\n  const displaySetInstanceUID = _getDisplaySetInstanceUID(\r\n    DisplaySetService,\r\n    SeriesInstanceUID,\r\n    SOPInstanceUID\r\n  );\r\n\r\n  const { handles, label } = measurementData;\r\n\r\n  const points = [];\r\n  Object.keys(handles).map(handle => {\r\n    if (['start', 'end'].includes(handle)) {\r\n      let point = {};\r\n      if (handles[handle].x) point.x = handles[handle].x;\r\n      if (handles[handle].y) point.y = handles[handle].y;\r\n      points.push(point);\r\n    }\r\n  });\r\n\r\n  return {\r\n    id: measurementData.id,\r\n    SOPInstanceUID: SOPInstanceUID,\r\n    FrameOfReferenceUID,\r\n    referenceSeriesUID: SeriesInstanceUID,\r\n    referenceStudyUID: StudyInstanceUID,\r\n    displaySetInstanceUID,\r\n    description: measurementData.description,\r\n    unit: measurementData.unit,\r\n    length: measurementData.length,\r\n    type: _getValueTypeFromToolType(tool),\r\n    points,\r\n    label,\r\n  };\r\n}\r\n\r\nfunction Bidirectional(\r\n  measurementData,\r\n  SOPInstanceUID,\r\n  FrameOfReferenceUID,\r\n  SeriesInstanceUID,\r\n  StudyInstanceUID,\r\n  DisplaySetService,\r\n  _getValueTypeFromToolType\r\n) {\r\n  const tool = measurementData.toolType || measurementData.toolName;\r\n\r\n  const displaySetInstanceUID = _getDisplaySetInstanceUID(\r\n    DisplaySetService,\r\n    SeriesInstanceUID,\r\n    SOPInstanceUID\r\n  );\r\n\r\n  const { handles, label } = measurementData;\r\n\r\n  const longAxis = [handles.start, handles.end];\r\n  const shortAxis = [handles.perpendicularStart, handles.perpendicularEnd];\r\n\r\n  return {\r\n    id: measurementData.id,\r\n    SOPInstanceUID: SOPInstanceUID,\r\n    FrameOfReferenceUID,\r\n    referenceSeriesUID: SeriesInstanceUID,\r\n    referenceStudyUID: StudyInstanceUID,\r\n    displaySetInstanceUID,\r\n    description: measurementData.description,\r\n    unit: measurementData.unit,\r\n    shortestDiameter: measurementData.shortestDiameter,\r\n    longestDiameter: measurementData.longestDiameter,\r\n    type: _getValueTypeFromToolType(tool),\r\n    points: { longAxis, shortAxis },\r\n    label,\r\n  };\r\n}\r\n\r\nfunction EllipticalRoi(\r\n  measurementData,\r\n  SOPInstanceUID,\r\n  FrameOfReferenceUID,\r\n  SeriesInstanceUID,\r\n  StudyInstanceUID,\r\n  DisplaySetService,\r\n  _getValueTypeFromToolType\r\n) {\r\n  const tool = measurementData.toolType || measurementData.toolName;\r\n\r\n  const displaySetInstanceUID = _getDisplaySetInstanceUID(\r\n    DisplaySetService,\r\n    SeriesInstanceUID,\r\n    SOPInstanceUID\r\n  );\r\n  const { handles, label } = measurementData;\r\n  const { start, end } = handles;\r\n\r\n  const halfXLength = Math.abs(start.x - end.x) / 2;\r\n  const halfYLength = Math.abs(start.y - end.y) / 2;\r\n\r\n  const points = [];\r\n  const center = { x: (start.x + end.x) / 2, y: (start.y + end.y) / 2 };\r\n\r\n  // To store similar to SR.\r\n  if (halfXLength > halfYLength) {\r\n    // X-axis major\r\n    // Major axis\r\n    points.push({ x: center.x - halfXLength, y: center.y });\r\n    points.push({ x: center.x + halfXLength, y: center.y });\r\n    // Minor axis\r\n    points.push({ x: center.x, y: center.y - halfYLength });\r\n    points.push({ x: center.x, y: center.y + halfYLength });\r\n  } else {\r\n    // Y-axis major\r\n    // Major axis\r\n    points.push({ x: center.x, y: center.y - halfYLength });\r\n    points.push({ x: center.x, y: center.y + halfYLength });\r\n    // Minor axis\r\n    points.push({ x: center.x - halfXLength, y: center.y });\r\n    points.push({ x: center.x + halfXLength, y: center.y });\r\n  }\r\n\r\n  return {\r\n    id: measurementData.id,\r\n    SOPInstanceUID: SOPInstanceUID,\r\n    FrameOfReferenceUID,\r\n    referenceSeriesUID: SeriesInstanceUID,\r\n    referenceStudyUID: StudyInstanceUID,\r\n    displaySetInstanceUID,\r\n    description: measurementData.description,\r\n    unit: measurementData.unit,\r\n    area:\r\n      measurementData.cachedStats &&\r\n      measurementData.cachedStats\r\n        .area /* TODO: Add concept names instead (descriptor) */,\r\n    type: _getValueTypeFromToolType(tool),\r\n    points,\r\n    label,\r\n  };\r\n}\r\n\r\nfunction ArrowAnnotate(\r\n  measurementData,\r\n  SOPInstanceUID,\r\n  FrameOfReferenceUID,\r\n  SeriesInstanceUID,\r\n  StudyInstanceUID,\r\n  DisplaySetService,\r\n  _getValueTypeFromToolType\r\n) {\r\n  const tool = measurementData.toolType || measurementData.toolName;\r\n\r\n  const displaySetInstanceUID = _getDisplaySetInstanceUID(\r\n    DisplaySetService,\r\n    SeriesInstanceUID,\r\n    SOPInstanceUID\r\n  );\r\n\r\n  const { handles } = measurementData;\r\n\r\n  const points = [];\r\n  Object.keys(handles).map(handle => {\r\n    if (['start', 'end'].includes(handle)) {\r\n      let point = {};\r\n      if (handles[handle].x) point.x = handles[handle].x;\r\n      if (handles[handle].y) point.y = handles[handle].y;\r\n      points.push(point);\r\n    }\r\n  });\r\n\r\n  return {\r\n    id: measurementData.id,\r\n    SOPInstanceUID: SOPInstanceUID,\r\n    FrameOfReferenceUID,\r\n    referenceSeriesUID: SeriesInstanceUID,\r\n    referenceStudyUID: StudyInstanceUID,\r\n    displaySetInstanceUID,\r\n    label: measurementData.text,\r\n    description: measurementData.description,\r\n    unit: measurementData.unit,\r\n    text: measurementData.text,\r\n    type: _getValueTypeFromToolType(tool),\r\n    points,\r\n  };\r\n}\r\n\r\nfunction _getDisplaySetInstanceUID(\r\n  DisplaySetService,\r\n  SeriesInstanceUID,\r\n  SOPInstanceUID\r\n) {\r\n  const displaySet = DisplaySetService.getDisplaySetForSOPInstanceUID(\r\n    SOPInstanceUID,\r\n    SeriesInstanceUID\r\n  );\r\n\r\n  return displaySet.displaySetInstanceUID;\r\n}\r\n","import cornerstoneTools from 'cornerstone-tools';\r\nimport OHIF, { DicomMetadataStore } from '@ohif/core';\r\nimport getLabelFromDCMJSImportedToolData from './utils/getLabelFromDCMJSImportedToolData';\r\nimport getCornerstoneToolStateToMeasurementSchema from './getCornerstoneToolStateToMeasurementSchema';\r\nimport { adapters } from 'dcmjs';\r\n\r\nconst { guid } = OHIF.utils;\r\nconst globalImageIdSpecificToolStateManager =\r\n  cornerstoneTools.globalImageIdSpecificToolStateManager;\r\n\r\n/**\r\n *\r\n */\r\nexport default function _hydrateStructuredReport(\r\n  { servicesManager, extensionManager },\r\n  displaySetInstanceUID\r\n) {\r\n  const dataSource = extensionManager.getActiveDataSource()[0];\r\n  const { MeasurementService, DisplaySetService } = servicesManager.services;\r\n\r\n  const displaySet = DisplaySetService.getDisplaySetByUID(\r\n    displaySetInstanceUID\r\n  );\r\n\r\n  // TODO -> We should define a strict versioning somewhere.\r\n  const mappings = MeasurementService.getSourceMappings(\r\n    'CornerstoneTools',\r\n    '4'\r\n  );\r\n\r\n  if (!mappings || !mappings.length) {\r\n    throw new Error(\r\n      `Attempting to hydrate measurements service when no mappings present. This shouldn't be reached.`\r\n    );\r\n  }\r\n\r\n  const instance = DicomMetadataStore.getInstance(\r\n    displaySet.StudyInstanceUID,\r\n    displaySet.SeriesInstanceUID,\r\n    displaySet.SOPInstanceUID\r\n  );\r\n\r\n  const { MeasurementReport } = adapters.Cornerstone;\r\n\r\n  const sopInstanceUIDToImageId = {};\r\n\r\n  displaySet.measurements.forEach(measurement => {\r\n    const { ReferencedSOPInstanceUID, imageId } = measurement;\r\n    if (!sopInstanceUIDToImageId[ReferencedSOPInstanceUID]) {\r\n      sopInstanceUIDToImageId[ReferencedSOPInstanceUID] = imageId;\r\n    }\r\n  });\r\n\r\n  // Use dcmjs to generate toolState.\r\n  const storedMeasurementByToolType = MeasurementReport.generateToolState(\r\n    instance\r\n  );\r\n\r\n  // Filter what is found by DICOM SR to measurements we support.\r\n  const mappingDefinitions = mappings.map(m => m.definition);\r\n  const hydratableMeasurementsInSR = {};\r\n\r\n  Object.keys(storedMeasurementByToolType).forEach(key => {\r\n    if (mappingDefinitions.includes(key)) {\r\n      hydratableMeasurementsInSR[key] = storedMeasurementByToolType[key];\r\n    }\r\n  });\r\n\r\n  // Set the series touched as tracked.\r\n  const imageIds = [];\r\n\r\n  // TODO: notification if no hydratable?\r\n  Object.keys(hydratableMeasurementsInSR).forEach(toolType => {\r\n    const toolDataForToolType = hydratableMeasurementsInSR[toolType];\r\n\r\n    toolDataForToolType.forEach(data => {\r\n      // Add the measurement to toolState\r\n      const imageId = sopInstanceUIDToImageId[data.sopInstanceUid];\r\n\r\n      if (!imageIds.includes(imageId)) {\r\n        imageIds.push(imageId);\r\n      }\r\n    });\r\n  });\r\n\r\n  let targetStudyInstanceUID;\r\n  const SeriesInstanceUIDs = [];\r\n\r\n  for (let i = 0; i < imageIds.length; i++) {\r\n    const imageId = imageIds[i];\r\n    const { SeriesInstanceUID, StudyInstanceUID } = cornerstone.metaData.get(\r\n      'instance',\r\n      imageId\r\n    );\r\n\r\n    if (!SeriesInstanceUIDs.includes(SeriesInstanceUID)) {\r\n      SeriesInstanceUIDs.push(SeriesInstanceUID);\r\n    }\r\n\r\n    if (!targetStudyInstanceUID) {\r\n      targetStudyInstanceUID = StudyInstanceUID;\r\n    } else if (targetStudyInstanceUID !== StudyInstanceUID) {\r\n      console.warn(\r\n        'NO SUPPORT FOR SRs THAT HAVE MEASUREMENTS FROM MULTIPLE STUDIES.'\r\n      );\r\n    }\r\n  }\r\n\r\n  Object.keys(hydratableMeasurementsInSR).forEach(toolType => {\r\n    const toolDataForToolType = hydratableMeasurementsInSR[toolType];\r\n\r\n    toolDataForToolType.forEach(data => {\r\n      // Add the measurement to toolState\r\n      const imageId = sopInstanceUIDToImageId[data.sopInstanceUid];\r\n\r\n      data.id = guid();\r\n\r\n      const instance = cornerstone.metaData.get('instance', imageId);\r\n      const {\r\n        SOPInstanceUID,\r\n        FrameOfReferenceUID,\r\n        SeriesInstanceUID,\r\n        StudyInstanceUID,\r\n      } = instance;\r\n\r\n      // Let the measurement service know we added to toolState\r\n      const toMeasurementSchema = getCornerstoneToolStateToMeasurementSchema(\r\n        toolType,\r\n        MeasurementService,\r\n        DisplaySetService,\r\n        SOPInstanceUID,\r\n        FrameOfReferenceUID,\r\n        SeriesInstanceUID,\r\n        StudyInstanceUID\r\n      );\r\n\r\n      const source = MeasurementService.getSource('CornerstoneTools', '4');\r\n\r\n      data.label = getLabelFromDCMJSImportedToolData(data);\r\n\r\n      MeasurementService.addRawMeasurement(\r\n        source,\r\n        toolType,\r\n        data,\r\n        toMeasurementSchema,\r\n        dataSource\r\n      );\r\n\r\n      if (!imageIds.includes(imageId)) {\r\n        imageIds.push(imageId);\r\n      }\r\n    });\r\n  });\r\n\r\n  displaySet.isHydrated = true;\r\n\r\n  return {\r\n    StudyInstanceUID: targetStudyInstanceUID,\r\n    SeriesInstanceUIDs,\r\n  };\r\n}\r\n","/**\r\n * Extracts the label from the toolData imported from dcmjs. We need to do this\r\n * as dcmjs does not depeend on OHIF/the MeasurementService, it just produces data for cornestoneTools.\r\n * This optional data is available for the consumer to process if they wish to.\r\n * @param {object} toolData The tooldata relating to the\r\n *\r\n * @returns {string} The extracted label.\r\n */\r\nexport default function getLabelFromDCMJSImportedToolData(toolData) {\r\n  const { findingSites = [], finding } = toolData;\r\n\r\n  let freeTextLabel = findingSites.find(\r\n    fs => fs.CodeValue === 'CORNERSTONEFREETEXT'\r\n  );\r\n\r\n  if (freeTextLabel) {\r\n    return freeTextLabel.CodeMeaning;\r\n  }\r\n\r\n  if (finding && finding.CodeValue === 'CORNERSTONEFREETEXT') {\r\n    return finding.CodeMeaning;\r\n  }\r\n}\r\n","import hydrateStructuredReport from './_hydrateStructuredReport.js';\r\n\r\nconst RESPONSE = {\r\n  NO_NEVER: -1,\r\n  CANCEL: 0,\r\n  CREATE_REPORT: 1,\r\n  ADD_SERIES: 2,\r\n  SET_STUDY_AND_SERIES: 3,\r\n  NO_NOT_FOR_SERIES: 4,\r\n  HYDRATE_REPORT: 5,\r\n};\r\n\r\nfunction promptUser({ servicesManager, extensionManager }, ctx, evt) {\r\n  const { UIViewportDialogService, DisplaySetService } = servicesManager.services;\r\n  const { viewportIndex, displaySetInstanceUID } = evt;\r\n  const srDisplaySet = DisplaySetService.getDisplaySetByUID(displaySetInstanceUID)\r\n\r\n  return new Promise(async function(resolve, reject) {\r\n    const promptResult = await _askTrackMeasurements(\r\n      UIViewportDialogService,\r\n      viewportIndex\r\n    );\r\n\r\n    // Need to do action here... So we can set state...\r\n    let StudyInstanceUID, SeriesInstanceUIDs;\r\n\r\n    if (promptResult === RESPONSE.HYDRATE_REPORT) {\r\n      console.warn('!! HYDRATING STRUCTURED REPORT');\r\n      const hydrationResult = hydrateStructuredReport(\r\n        { servicesManager, extensionManager },\r\n        displaySetInstanceUID\r\n      );\r\n\r\n      StudyInstanceUID = hydrationResult.StudyInstanceUID;\r\n      SeriesInstanceUIDs = hydrationResult.SeriesInstanceUIDs;\r\n    }\r\n\r\n    resolve({\r\n      userResponse: promptResult,\r\n      displaySetInstanceUID: evt.displaySetInstanceUID,\r\n      srSeriesInstanceUID: srDisplaySet.SeriesInstanceUID,\r\n      viewportIndex,\r\n      StudyInstanceUID,\r\n      SeriesInstanceUIDs,\r\n    });\r\n  });\r\n}\r\n\r\nfunction _askTrackMeasurements(UIViewportDialogService, viewportIndex) {\r\n  return new Promise(function(resolve, reject) {\r\n    const message =\r\n      'Do you want to continue tracking measurements for this study?';\r\n    const actions = [\r\n      {\r\n        type: 'secondary',\r\n        text: 'No',\r\n        value: RESPONSE.CANCEL,\r\n      },\r\n      {\r\n        type: 'primary',\r\n        text: 'Yes',\r\n        value: RESPONSE.HYDRATE_REPORT,\r\n      },\r\n    ];\r\n    const onSubmit = result => {\r\n      UIViewportDialogService.hide();\r\n      resolve(result);\r\n    };\r\n\r\n    UIViewportDialogService.show({\r\n      viewportIndex,\r\n      type: 'info',\r\n      message,\r\n      actions,\r\n      onSubmit,\r\n      onOutsideClick: () => {\r\n        UIViewportDialogService.hide();\r\n        resolve(RESPONSE.CANCEL);\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\nexport default promptUser;\r\n","import React, { useCallback, useContext, useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Machine } from 'xstate';\r\nimport { useMachine } from '@xstate/react';\r\nimport { useViewportGrid } from '@ohif/ui';\r\nimport {\r\n  machineConfiguration,\r\n  defaultOptions,\r\n} from './measurementTrackingMachine';\r\nimport promptBeginTracking from './promptBeginTracking';\r\nimport promptTrackNewSeries from './promptTrackNewSeries';\r\nimport promptTrackNewStudy from './promptTrackNewStudy';\r\nimport promptSaveReport from './promptSaveReport';\r\nimport promptHydrateStructuredReport from './promptHydrateStructuredReport';\r\n\r\nconst TrackedMeasurementsContext = React.createContext();\r\nTrackedMeasurementsContext.displayName = 'TrackedMeasurementsContext';\r\nconst useTrackedMeasurements = () => useContext(TrackedMeasurementsContext);\r\n\r\nconst SR_SOPCLASSHANDLERID = \"org.ohif.dicom-sr.sopClassHandlerModule.dicom-sr\";\r\n\r\n/**\r\n *\r\n * @param {*} param0\r\n */\r\nfunction TrackedMeasurementsContextProvider(\r\n  { servicesManager, extensionManager }, // Bound by consumer\r\n  { children } // Component props\r\n) {\r\n  const [viewportGrid, viewportGridService] = useViewportGrid();\r\n  const { activeViewportIndex, viewports } = viewportGrid;\r\n\r\n  const machineOptions = Object.assign({}, defaultOptions);\r\n  machineOptions.actions = Object.assign({}, machineOptions.actions, {\r\n    jumpToFirstMeasurementInActiveViewport: (ctx, evt) => {\r\n      const { DisplaySetService, MeasurementService } = servicesManager.services;\r\n      const { trackedStudy, trackedSeries } = ctx;\r\n      const measurements = MeasurementService.getMeasurements();\r\n      const trackedMeasurements = measurements.filter(\r\n        m =>\r\n          trackedStudy === m.referenceStudyUID &&\r\n          trackedSeries.includes(m.referenceSeriesUID)\r\n      );\r\n\r\n      const id = trackedMeasurements[0].id;\r\n\r\n      MeasurementService.jumpToMeasurement(viewportGrid.activeViewportIndex, id);\r\n    },\r\n    showStructuredReportDisplaySetInActiveViewport: (ctx, evt) => {\r\n      if (evt.data.createdDisplaySetInstanceUIDs.length > 0) {\r\n        const StructuredReportDisplaySetInstanceUID =\r\n          evt.data.createdDisplaySetInstanceUIDs[0].displaySetInstanceUID;\r\n\r\n        viewportGridService.setDisplaysetForViewport({\r\n          viewportIndex: evt.data.viewportIndex,\r\n          displaySetInstanceUID: StructuredReportDisplaySetInstanceUID,\r\n        });\r\n      }\r\n    },\r\n    discardPreviouslyTrackedMeasurements: (ctx, evt) => {\r\n      const { MeasurementService } = servicesManager.services;\r\n      const measurements = MeasurementService.getMeasurements();\r\n      const filteredMeasurements = measurements.filter(ms =>\r\n        ctx.prevTrackedSeries.includes(ms.referenceSeriesUID)\r\n      );\r\n      const measurementIds = filteredMeasurements.map(fm => fm.id);\r\n\r\n      for (let i = 0; i < measurementIds.length; i++) {\r\n        MeasurementService.remove(measurementIds[i], 'app-source');\r\n      }\r\n    },\r\n    clearAllMeasurements: (ctx, evt) => {\r\n      const { MeasurementService } = servicesManager.services;\r\n      const measurements = MeasurementService.getMeasurements();\r\n      const measurementIds = measurements.map(fm => fm.id);\r\n\r\n      for (let i = 0; i < measurementIds.length; i++) {\r\n        MeasurementService.remove(measurementIds[i], 'app-source');\r\n      }\r\n    },\r\n  });\r\n  machineOptions.services = Object.assign({}, machineOptions.services, {\r\n    promptBeginTracking: promptBeginTracking.bind(null, {\r\n      servicesManager,\r\n      extensionManager,\r\n    }),\r\n    promptTrackNewSeries: promptTrackNewSeries.bind(null, {\r\n      servicesManager,\r\n      extensionManager,\r\n    }),\r\n    promptTrackNewStudy: promptTrackNewStudy.bind(null, {\r\n      servicesManager,\r\n      extensionManager,\r\n    }),\r\n    promptSaveReport: promptSaveReport.bind(null, {\r\n      servicesManager,\r\n      extensionManager,\r\n    }),\r\n    promptHydrateStructuredReport: promptHydrateStructuredReport.bind(null, {\r\n      servicesManager,\r\n      extensionManager\r\n    }),\r\n  });\r\n\r\n  // TODO: IMPROVE\r\n  // - Add measurement_updated to cornerstone; debounced? (ext side, or consumption?)\r\n  // - Friendlier transition/api in front of measurementTracking machine?\r\n  // - Blocked: viewport overlay shouldn't clip when resized\r\n  // TODO: PRIORITY\r\n  // - Fix \"ellipses\" series description dynamic truncate length\r\n  // - Fix viewport border resize\r\n  // - created/destroyed hooks for extensions (cornerstone measurement subscriptions in it's `init`)\r\n\r\n  const measurementTrackingMachine = Machine(\r\n    machineConfiguration,\r\n    machineOptions\r\n  );\r\n\r\n  const [\r\n    trackedMeasurements,\r\n    sendTrackedMeasurementsEvent,\r\n    trackedMeasurementsService,\r\n  ] = useMachine(measurementTrackingMachine);\r\n\r\n  // ~~ Listen for changes to ViewportGrid for potential SRs hung in panes when idle\r\n  useEffect(() => {\r\n    if (viewports.length > 0) {\r\n      const activeViewport = viewports[activeViewportIndex];\r\n\r\n      if (!activeViewport || !activeViewport.displaySetInstanceUID) {\r\n        return;\r\n      }\r\n\r\n      const { DisplaySetService } = servicesManager.services;\r\n      const displaySet = DisplaySetService.getDisplaySetByUID(\r\n        activeViewport.displaySetInstanceUID\r\n      );\r\n\r\n      // If this is an SR produced by our SR SOPClassHandler,\r\n      // and it hasn't been loaded yet, do that now so we\r\n      // can check if it can be rehydrated or not.\r\n      //\r\n      // Note: This happens:\r\n      // - If the viewport is not currently an OHIFCornerstoneSRViewport\r\n      // - If the displaySet has never been hung\r\n      //\r\n      // Otherwise, the displaySet will be loaded by the useEffect handler\r\n      // listening to displaySet changes inside OHIFCornerstoneSRViewport.\r\n      // The issue here is that this handler in TrackedMeasurementsContext\r\n      // ends up occurring before the Viewport is created, so the displaySet\r\n      // is not loaded yet, and isRehydratable is undefined unless we call load().\r\n      if (displaySet.SOPClassHandlerId === SR_SOPCLASSHANDLERID &&\r\n          !displaySet.isLoaded &&\r\n          displaySet.load) {\r\n        displaySet.load();\r\n      }\r\n\r\n      // Magic string\r\n      // load function added by our sopClassHandler module\r\n      if (\r\n        displaySet.SOPClassHandlerId === SR_SOPCLASSHANDLERID &&\r\n        displaySet.isRehydratable === true\r\n      ) {\r\n        console.log('sending event...', trackedMeasurements);\r\n        sendTrackedMeasurementsEvent('PROMPT_HYDRATE_SR', {\r\n          displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n          SeriesInstanceUID: displaySet.SeriesInstanceUID,\r\n          viewportIndex: activeViewportIndex,\r\n        });\r\n      }\r\n    }\r\n  }, [\r\n    activeViewportIndex,\r\n    sendTrackedMeasurementsEvent,\r\n    servicesManager.services,\r\n    viewports,\r\n  ]);\r\n\r\n  return (\r\n    <TrackedMeasurementsContext.Provider\r\n      value={[trackedMeasurements, sendTrackedMeasurementsEvent]}\r\n    >\r\n      {children}\r\n    </TrackedMeasurementsContext.Provider>\r\n  );\r\n}\r\n\r\nTrackedMeasurementsContextProvider.propTypes = {\r\n  children: PropTypes.oneOf([PropTypes.func, PropTypes.node]),\r\n  servicesManager: PropTypes.object.isRequired,\r\n  extensionManager: PropTypes.object.isRequired,\r\n};\r\n\r\nexport {\r\n  TrackedMeasurementsContext,\r\n  TrackedMeasurementsContextProvider,\r\n  useTrackedMeasurements,\r\n};\r\n","import {\r\n  TrackedMeasurementsContext,\r\n  TrackedMeasurementsContextProvider,\r\n  useTrackedMeasurements,\r\n} from './contexts';\r\n\r\nfunction getContextModule({ servicesManager, extensionManager }) {\r\n  const BoundTrackedMeasurementsContextProvider = TrackedMeasurementsContextProvider.bind(\r\n    null,\r\n    { servicesManager, extensionManager }\r\n  );\r\n\r\n  return [\r\n    {\r\n      name: 'TrackedMeasurementsContext',\r\n      context: TrackedMeasurementsContext,\r\n      provider: BoundTrackedMeasurementsContextProvider,\r\n    },\r\n  ];\r\n}\r\n\r\nexport { useTrackedMeasurements };\r\nexport default getContextModule;\r\n","import log from '../log';\r\nimport utils from '../utils';\r\n// import {\r\n//   retrieveMeasurementFromSR,\r\n//   stowSRFromMeasurements,\r\n// } from './handleStructuredReport';\r\nimport findMostRecentStructuredReport from './utils/findMostRecentStructuredReport';\r\nimport cornerstone from 'cornerstone-core';\r\nimport cornerstoneTools from 'cornerstone-tools';\r\nimport dcmjs from 'dcmjs';\r\n\r\nconst { MeasurementReport } = dcmjs.adapters.Cornerstone;\r\n\r\n/**\r\n *\r\n * @typedef serverType\r\n * @property {string} type - type of the server\r\n * @property {string} wadoRoot - server wado root url\r\n *\r\n */\r\n\r\n/**\r\n * Function to be registered into MeasurementAPI to retrieve measurements from DICOM Structured Reports\r\n *\r\n * @param {serverType} server\r\n * @returns {Promise} Should resolve with OHIF measurementData object\r\n */\r\n/*const retrieveMeasurements = server => {\r\n  log.info('[DICOMSR] retrieveMeasurements');\r\n\r\n  if (!server || server.type !== 'dicomWeb') {\r\n    log.error('[DICOMSR] DicomWeb server is required!');\r\n    return Promise.reject({});\r\n  }\r\n\r\n  const serverUrl = server.wadoRoot;\r\n  const studies = utils.studyMetadataManager.all();\r\n\r\n  const latestSeries = findMostRecentStructuredReport(studies);\r\n\r\n  if (!latestSeries) return Promise.resolve({});\r\n\r\n  return retrieveMeasurementFromSR(latestSeries, studies, serverUrl);\r\n};*/\r\n\r\n/**\r\n *\r\n * @param {object[]} measurementData An array of measurements from the measurements service\r\n * @param {string[]} additionalFindingTypes toolTypes that should be stored with labels as Findings\r\n * @param {object} options Naturalized DICOM JSON headers to merge into the displaySet.\r\n * as opposed to Finding Sites.\r\n * that you wish to serialize.\r\n */\r\nconst downloadReport = (\r\n  measurementData,\r\n  additionalFindingTypes,\r\n  options = {}\r\n) => {\r\n  const srDataset = generateReport(\r\n    measurementData,\r\n    additionalFindingTypes,\r\n    options\r\n  );\r\n  const reportBlob = dcmjs.data.datasetToBlob(srDataset);\r\n\r\n  //Create a URL for the binary.\r\n  var objectUrl = URL.createObjectURL(reportBlob);\r\n  window.location.assign(objectUrl);\r\n};\r\n\r\n/**\r\n *\r\n * @param {object[]} measurementData An array of measurements from the measurements service\r\n * that you wish to serialize.\r\n * @param {string[]} additionalFindingTypes toolTypes that should be stored with labels as Findings\r\n * @param {object} options Naturalized DICOM JSON headers to merge into the displaySet.\r\n *\r\n */\r\nconst generateReport = (\r\n  measurementData,\r\n  additionalFindingTypes,\r\n  options = {}\r\n) => {\r\n  const filteredToolState = _getFilteredCornerstoneToolState(\r\n    measurementData,\r\n    additionalFindingTypes\r\n  );\r\n  const report = MeasurementReport.generateReport(\r\n    filteredToolState,\r\n    cornerstone.metaData\r\n  );\r\n\r\n  const { dataset } = report;\r\n\r\n  // Add in top level series options\r\n  Object.assign(dataset, options);\r\n\r\n  return dataset;\r\n};\r\n\r\n/**\r\n *\r\n * @param {object[]} measurementData An array of measurements from the measurements service\r\n * that you wish to serialize.\r\n * @param {object} dataSource The dataSource that you wish to use to persist the data.\r\n * @param {string[]} additionalFindingTypes toolTypes that should be stored with labels as Findings\r\n * @param {object} options Naturalized DICOM JSON headers to merge into the displaySet.\r\n * @return {object} The naturalized report\r\n */\r\nconst storeMeasurements = async (\r\n  measurementData,\r\n  dataSource,\r\n  additionalFindingTypes,\r\n  options = {}\r\n) => {\r\n  // TODO -> Eventually use the measurements directly and not the dcmjs adapter,\r\n  // But it is good enough for now whilst we only have cornerstone as a datasource.\r\n  log.info('[DICOMSR] storeMeasurements');\r\n\r\n  if (!dataSource || !dataSource.store || !dataSource.store.dicom) {\r\n    log.error('[DICOMSR] datasource has no dataSource.store.dicom endpoint!');\r\n    return Promise.reject({});\r\n  }\r\n\r\n  try {\r\n    const naturalizedReport = generateReport(\r\n      measurementData,\r\n      additionalFindingTypes,\r\n      options\r\n    );\r\n    const { StudyInstanceUID } = naturalizedReport;\r\n\r\n    await dataSource.store.dicom(naturalizedReport);\r\n\r\n    if (StudyInstanceUID) {\r\n      dataSource.deleteStudyMetadataPromise(StudyInstanceUID);\r\n    }\r\n\r\n    return naturalizedReport;\r\n  } catch (error) {\r\n    console.warn(error);\r\n    log.error(\r\n      `[DICOMSR] Error while saving the measurements: ${error.message}`\r\n    );\r\n    throw new Error(error.message || 'Error while saving the measurements.');\r\n  }\r\n};\r\n\r\n// _getFilteredCornerstoneToolState\r\n// DIFFERENT IMPLEMENTATION HERE! What's up?\r\nfunction _getFilteredCornerstoneToolState(\r\n  measurementData,\r\n  additionalFindingTypes\r\n) {\r\n  const uidFilter = measurementData.map(md => md.id);\r\n\r\n  const globalToolState = cornerstoneTools.globalImageIdSpecificToolStateManager.saveToolState();\r\n  const filteredToolState = {};\r\n\r\n  function addToFilteredToolState(imageId, toolType, toolDataI) {\r\n    if (!filteredToolState[imageId]) {\r\n      filteredToolState[imageId] = {};\r\n    }\r\n\r\n    const imageIdSpecificToolState = filteredToolState[imageId];\r\n\r\n    if (!imageIdSpecificToolState[toolType]) {\r\n      imageIdSpecificToolState[toolType] = {\r\n        data: [],\r\n      };\r\n    }\r\n\r\n    const measurmentDataI = measurementData.find(md => md.id === toolDataI.id);\r\n    const toolData = imageIdSpecificToolState[toolType].data;\r\n\r\n    let finding;\r\n    const findingSites = [];\r\n\r\n    // NOTE -> Any kind of freetext value abuses the DICOM standard,\r\n    // As CodeValues should map 1:1 with CodeMeanings.\r\n    // Ideally we would actually use SNOMED codes for this.\r\n    if (measurmentDataI.label) {\r\n      if (additionalFindingTypes.includes(toolType)) {\r\n        finding = {\r\n          CodeValue: 'CORNERSTONEFREETEXT',\r\n          CodingSchemeDesignator: 'CST4',\r\n          CodeMeaning: measurmentDataI.label,\r\n        };\r\n      } else {\r\n        findingSites.push({\r\n          CodeValue: 'CORNERSTONEFREETEXT',\r\n          CodingSchemeDesignator: 'CST4',\r\n          CodeMeaning: measurmentDataI.label,\r\n        });\r\n      }\r\n    }\r\n\r\n    const measurement = Object.assign({}, toolDataI, {\r\n      finding,\r\n      findingSites,\r\n    });\r\n\r\n    toolData.push(measurement);\r\n  }\r\n\r\n  const uids = uidFilter.slice();\r\n  const imageIds = Object.keys(globalToolState);\r\n\r\n  for (let i = 0; i < imageIds.length; i++) {\r\n    const imageId = imageIds[i];\r\n    const imageIdSpecificToolState = globalToolState[imageId];\r\n\r\n    const toolTypes = Object.keys(imageIdSpecificToolState);\r\n\r\n    for (let j = 0; j < toolTypes.length; j++) {\r\n      const toolType = toolTypes[j];\r\n      const toolData = imageIdSpecificToolState[toolType].data;\r\n\r\n      if (toolData) {\r\n        for (let k = 0; k < toolData.length; k++) {\r\n          const toolDataK = toolData[k];\r\n          const uidIndex = uids.findIndex(uid => uid === toolDataK.id);\r\n\r\n          if (uidIndex !== -1) {\r\n            addToFilteredToolState(imageId, toolType, toolDataK);\r\n            uids.splice(uidIndex, 1);\r\n\r\n            if (!uids.length) {\r\n              return filteredToolState;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return filteredToolState;\r\n}\r\n\r\nexport { storeMeasurements, downloadReport };\r\n","import dcmjs from 'dcmjs';\r\n\r\n/**\r\n *  Checks if dcmjs has support to determined tool\r\n *\r\n * @param {string} toolName\r\n * @returns {boolean}\r\n */\r\nconst isToolSupported = toolName => {\r\n  const adapter = dcmjs.adapters.Cornerstone;\r\n  return !!adapter[toolName];\r\n};\r\n\r\nexport default isToolSupported;\r\n","import {\r\n  //retrieveMeasurements,\r\n  storeMeasurements,\r\n  downloadReport,\r\n} from './dataExchange';\r\nimport isToolSupported from './utils/isToolSupported';\r\n\r\nconst DICOMSR = {\r\n  //retrieveMeasurements,\r\n  storeMeasurements,\r\n  downloadReport,\r\n  isToolSupported,\r\n};\r\n\r\nexport default DICOMSR;\r\n","import getAttribute from './getAttribute.js';\r\nimport getAuthorizationHeader from './getAuthorizationHeader.js';\r\nimport getModalities from './getModalities.js';\r\nimport getName from './getName.js';\r\nimport getNumber from './getNumber.js';\r\nimport getString from './getString.js';\r\n\r\nconst DICOMWeb = {\r\n  getAttribute,\r\n  getAuthorizationHeader,\r\n  getModalities,\r\n  getName,\r\n  getNumber,\r\n  getString,\r\n};\r\n\r\nexport {\r\n  getAttribute,\r\n  getAuthorizationHeader,\r\n  getModalities,\r\n  getName,\r\n  getNumber,\r\n  getString,\r\n};\r\n\r\nexport default DICOMWeb;\r\n","/**\r\n * Returns the specified element as a dicom attribute group/element.\r\n *\r\n * @param element - The group/element of the element (e.g. '00280009')\r\n * @param [defaultValue] - The value to return if the element is not present\r\n * @returns {*}\r\n */\r\nexport default function getAttribute(element, defaultValue) {\r\n  if (!element) {\r\n    return defaultValue;\r\n  }\r\n  // Value is not present if the attribute has a zero length value\r\n  if (!element.Value) {\r\n    return defaultValue;\r\n  }\r\n  // Sanity check to make sure we have at least one entry in the array.\r\n  if (!element.Value.length) {\r\n    return defaultValue;\r\n  }\r\n\r\n  return convertToInt(element.Value);\r\n}\r\n\r\nfunction convertToInt(input) {\r\n  function padFour(input) {\r\n    const l = input.length;\r\n\r\n    if (l == 0) return '0000';\r\n    if (l == 1) return '000' + input;\r\n    if (l == 2) return '00' + input;\r\n    if (l == 3) return '0' + input;\r\n\r\n    return input;\r\n  }\r\n\r\n  let output = '';\r\n  for (let i = 0; i < input.length; i++) {\r\n    for (let j = 0; j < input[i].length; j++) {\r\n      output += padFour(input[i].charCodeAt(j).toString(16));\r\n    }\r\n  }\r\n\r\n  return parseInt(output, 16);\r\n}\r\n","import 'isomorphic-base64'\r\nimport user from '../user';\r\n\r\n/**\r\n * Returns the Authorization header as part of an Object.\r\n *\r\n * @export\r\n * @param {Object} [server={}]\r\n * @param {Object} [server.requestOptions]\r\n * @param {string|function} [server.requestOptions.auth]\r\n * @returns {Object} { Authorization }\r\n */\r\nexport default function getAuthorizationHeader({ requestOptions } = {}, user) {\r\n  const headers = {};\r\n\r\n  // Check for OHIF.user since this can also be run on the server\r\n  const accessToken = user && user.getAccessToken && user.getAccessToken();\r\n\r\n  // Auth for a specific server\r\n  if (requestOptions && requestOptions.auth) {\r\n    if (typeof requestOptions.auth === 'function') {\r\n      // Custom Auth Header\r\n      headers.Authorization = requestOptions.auth(requestOptions);\r\n    } else {\r\n      // HTTP Basic Auth (user:password)\r\n      headers.Authorization = `Basic ${btoa(requestOptions.auth)}`;\r\n    }\r\n  }\r\n  // Auth for the user's default\r\n  else if (accessToken) {\r\n    headers.Authorization = `Bearer ${accessToken}`;\r\n  }\r\n\r\n  return headers;\r\n}\r\n","export default function getModalities(Modality, ModalitiesInStudy) {\r\n  if (!Modality && !ModalitiesInStudy) {\r\n    return {};\r\n  }\r\n\r\n  const modalities = Modality || {\r\n    vr: 'CS',\r\n    Value: [],\r\n  };\r\n\r\n  if (ModalitiesInStudy) {\r\n    if (modalities.vr && modalities.vr === ModalitiesInStudy.vr) {\r\n      for (let i = 0; i < ModalitiesInStudy.Value.length; i++) {\r\n        const value = ModalitiesInStudy.Value[i];\r\n        if (modalities.Value.indexOf(value) === -1) {\r\n          modalities.Value.push(value);\r\n        }\r\n      }\r\n    } else {\r\n      return ModalitiesInStudy;\r\n    }\r\n  }\r\n\r\n  return modalities;\r\n}\r\n","/**\r\n * Returns the Alphabetic version of a PN\r\n *\r\n * @param element - The group/element of the element (e.g. '00200013')\r\n * @param [defaultValue] - The default value to return if the element is not found\r\n * @returns {*}\r\n */\r\nexport default function getName(element, defaultValue) {\r\n  if (!element) {\r\n    return defaultValue;\r\n  }\r\n  // Value is not present if the attribute has a zero length value\r\n  if (!element.Value) {\r\n    return defaultValue;\r\n  }\r\n  // Sanity check to make sure we have at least one entry in the array.\r\n  if (!element.Value.length) {\r\n    return defaultValue;\r\n  }\r\n  // Return the Alphabetic component group\r\n  if (element.Value[0].Alphabetic) {\r\n    return element.Value[0].Alphabetic;\r\n  }\r\n  // Orthanc does not return PN properly so this is a temporary workaround\r\n  return element.Value[0];\r\n}\r\n","/**\r\n * Returns the first string value as a Javascript Number\r\n * @param element - The group/element of the element (e.g. '00200013')\r\n * @param [defaultValue] - The default value to return if the element does not exist\r\n * @returns {*}\r\n */\r\nexport default function getNumber(element, defaultValue) {\r\n  if (!element) {\r\n    return defaultValue;\r\n  }\r\n  // Value is not present if the attribute has a zero length value\r\n  if (!element.Value) {\r\n    return defaultValue;\r\n  }\r\n  // Sanity check to make sure we have at least one entry in the array.\r\n  if (!element.Value.length) {\r\n    return defaultValue;\r\n  }\r\n\r\n  return parseFloat(element.Value[0]);\r\n}\r\n","/**\r\n * Returns the specified element as a string.  Multi-valued elements will be separated by a backslash\r\n *\r\n * @param element - The group/element of the element (e.g. '00200013')\r\n * @param [defaultValue] - The value to return if the element is not present\r\n * @returns {*}\r\n */\r\nexport default function getString(element, defaultValue) {\r\n  if (!element) {\r\n    return defaultValue;\r\n  }\r\n  // Value is not present if the attribute has a zero length value\r\n  if (!element.Value) {\r\n    return defaultValue;\r\n  }\r\n  // Sanity check to make sure we have at least one entry in the array.\r\n  if (!element.Value.length) {\r\n    return defaultValue;\r\n  }\r\n  // Join the array together separated by backslash\r\n  // NOTE: Orthanc does not correctly split values into an array so the join is a no-op\r\n  return element.Value.join('\\\\');\r\n}\r\n","import { DicomMetadataStore } from '../services/DicomMetadataStore';\r\n// TODO: Use above to inject so dependent datasources don't need to import or\r\n// depend on @ohif/core?\r\n\r\n/**\r\n * Factory function that creates a new \"Web API\" data source.\r\n * A \"Web API\" data source is any source that fetches data over\r\n * HTTP. This function serves as an \"adapter\" to wrap those calls\r\n * so that all \"Web API\" data sources have the same interface and can\r\n * be used interchangeably.\r\n *\r\n * It's worth noting that a single implementation of this interface\r\n * can define different underlying sources for \"read\" and \"write\" operations.\r\n */\r\nfunction create({\r\n  query,\r\n  retrieve,\r\n  store,\r\n  reject,\r\n  initialize,\r\n  retrieveSeriesMetadata,\r\n  deleteStudyMetadataPromise,\r\n  getImageIdsForDisplaySet,\r\n  getImageIdsForInstance,\r\n}) {\r\n  const defaultQuery = {\r\n    studies: {\r\n      /**\r\n       * @param {string} params.patientName\r\n       * @param {string} params.mrn\r\n       * @param {object} params.studyDate\r\n       * @param {string} params.description\r\n       * @param {string} params.modality\r\n       * @param {string} params.accession\r\n       * @param {string} params.sortBy\r\n       * @param {string} params.sortDirection -\r\n       * @param {number} params.page\r\n       * @param {number} params.resultsPerPage\r\n       */\r\n      mapParams: params => params,\r\n      requestResults: () => { },\r\n      processResults: results => results,\r\n    },\r\n    series: {},\r\n    instances: {},\r\n  };\r\n\r\n  const defaultRetrieve = {\r\n    series: {},\r\n  };\r\n\r\n  const defaultStore = {\r\n    dicom: async naturalizedDataset => {\r\n      throw new Error(\r\n        'store.dicom(naturalizedDicom, StudyInstanceUID) not implemented for dataSource.'\r\n      );\r\n    },\r\n  };\r\n\r\n  const defaultReject = {};\r\n  return {\r\n    query: query || defaultQuery,\r\n    retrieve: retrieve || defaultRetrieve,\r\n    reject: reject || defaultReject,\r\n    store: store || defaultStore,\r\n    initialize,\r\n    retrieveSeriesMetadata,\r\n    deleteStudyMetadataPromise,\r\n    getImageIdsForDisplaySet,\r\n    getImageIdsForInstance,\r\n  };\r\n}\r\n\r\nconst IWebApiDataSource = {\r\n  create,\r\n};\r\n\r\nexport default IWebApiDataSource;\r\n","import log from '../log.js';\r\n\r\n/**\r\n * The definition of a command\r\n *\r\n * @typedef {Object} CommandDefinition\r\n * @property {Function} commandFn - Command to call\r\n * @property {Object} options - Object of params to pass action\r\n */\r\n\r\n/**\r\n * The Commands Manager tracks named commands (or functions) that are scoped to\r\n * a context. When we attempt to run a command with a given name, we look for it\r\n * in our active contexts. If found, we run the command, passing in any application\r\n * or call specific data specified in the command's definition.\r\n *\r\n * NOTE: A more robust version of the CommandsManager lives in v1. If you're looking\r\n * to extend this class, please check it's source before adding new methods.\r\n */\r\nexport class CommandsManager {\r\n  constructor({ getActiveContexts } = {}) {\r\n    this.contexts = {};\r\n\r\n    if (!getActiveContexts) {\r\n      throw new Error(\r\n        'CommandsManager was instantiated without getActiveContexts()'\r\n      );\r\n    }\r\n\r\n    this._getActiveContexts = getActiveContexts;\r\n  }\r\n\r\n  /**\r\n   * Allows us to create commands \"per context\". An example would be the \"Cornerstone\"\r\n   * context having a `SaveImage` command, and the \"VTK\" context having a `SaveImage`\r\n   * command. The distinction of a context allows us to call the command in either\r\n   * context, and have faith that the correct command will be run.\r\n   *\r\n   * @method\r\n   * @param {string} contextName - Namespace for commands\r\n   * @returns {undefined}\r\n   */\r\n  createContext(contextName) {\r\n    if (!contextName) {\r\n      return;\r\n    }\r\n\r\n    if (this.contexts[contextName]) {\r\n      return this.clearContext(contextName);\r\n    }\r\n\r\n    this.contexts[contextName] = {};\r\n  }\r\n\r\n  /**\r\n   * Returns all command definitions for a given context\r\n   *\r\n   * @method\r\n   * @param {string} contextName - Namespace for commands\r\n   * @returns {Object} - the matched context\r\n   */\r\n  getContext(contextName) {\r\n    const context = this.contexts[contextName];\r\n\r\n    if (!context) {\r\n      return;\r\n    }\r\n\r\n    return context;\r\n  }\r\n\r\n  /**\r\n   * Clears all registered commands for a given context.\r\n   *\r\n   * @param {string} contextName - Namespace for commands\r\n   * @returns {undefined}\r\n   */\r\n  clearContext(contextName) {\r\n    if (!contextName) {\r\n      return;\r\n    }\r\n\r\n    this.contexts[contextName] = {};\r\n  }\r\n\r\n  /**\r\n   * Register a new command with the command manager. Scoped to a context, and\r\n   * with a definition to assist command callers w/ providing the necessary params\r\n   *\r\n   * @method\r\n   * @param {string} contextName - Namespace for command; often scoped to the extension that added it\r\n   * @param {string} commandName - Unique name identifying the command\r\n   * @param {CommandDefinition} definition - {@link CommandDefinition}\r\n   */\r\n  registerCommand(contextName, commandName, definition) {\r\n    if (typeof definition !== 'object') {\r\n      return;\r\n    }\r\n\r\n    const context = this.getContext(contextName);\r\n    if (!context) {\r\n      return;\r\n    }\r\n\r\n    context[commandName] = definition;\r\n  }\r\n\r\n  /**\r\n   * Finds a command with the provided name if it exists in the specified context,\r\n   * or a currently active context.\r\n   *\r\n   * @method\r\n   * @param {String} commandName - Command to find\r\n   * @param {String} [contextName] - Specific command to look in. Defaults to current activeContexts\r\n   */\r\n  getCommand = (commandName, contextName) => {\r\n    let contexts = [];\r\n\r\n    if (contextName) {\r\n      const context = this.getContext(contextName);\r\n      if (context) {\r\n        contexts.push(context);\r\n      }\r\n    } else {\r\n      const activeContexts = this._getActiveContexts();\r\n      activeContexts.forEach(activeContext => {\r\n        const context = this.getContext(activeContext);\r\n        if (context) {\r\n          contexts.push(context);\r\n        }\r\n      });\r\n    }\r\n\r\n    if (contexts.length === 0) {\r\n      return;\r\n    }\r\n\r\n    let foundCommand;\r\n    contexts.forEach(context => {\r\n      if (context[commandName]) {\r\n        foundCommand = context[commandName];\r\n      }\r\n    });\r\n\r\n    return foundCommand;\r\n  };\r\n\r\n  /**\r\n   *\r\n   * @method\r\n   * @param {String} commandName\r\n   * @param {Object} [options={}] - Extra options to pass the command. Like a mousedown event\r\n   * @param {String} [contextName]\r\n   */\r\n  runCommand(commandName, options = {}, contextName) {\r\n    const definition = this.getCommand(commandName, contextName);\r\n    if (!definition) {\r\n      log.warn(`Command \"${commandName}\" not found in current context`);\r\n      return;\r\n    }\r\n\r\n    const { commandFn } = definition;\r\n    const commandParams = Object.assign(\r\n      {},\r\n      definition.options, // \"Command configuration\"\r\n      options // \"Time of call\" info\r\n    );\r\n\r\n    if (typeof commandFn !== 'function') {\r\n      log.warn(`No commandFn was defined for command \"${commandName}\"`);\r\n      return;\r\n    } else {\r\n      return commandFn(commandParams);\r\n    }\r\n  }\r\n}\r\n\r\nexport default CommandsManager;\r\n","import objectHash from 'object-hash';\r\nimport log from './../log.js';\r\nimport { hotkeys } from '../utils';\r\n\r\n/**\r\n *\r\n *\r\n * @typedef {Object} HotkeyDefinition\r\n * @property {String} commandName - Command to call\r\n * @property {Object} commandOptions - Command options\r\n * @property {String} label - Display name for hotkey\r\n * @property {String[]} keys - Keys to bind; Follows Mousetrap.js binding syntax\r\n */\r\n\r\nexport class HotkeysManager {\r\n  constructor(commandsManager, servicesManager) {\r\n    this.hotkeyDefinitions = {};\r\n    this.hotkeyDefaults = [];\r\n    this.isEnabled = true;\r\n\r\n    if (!commandsManager) {\r\n      throw new Error(\r\n        'HotkeysManager instantiated without a commandsManager. Hotkeys will be unable to find and run commands.'\r\n      );\r\n    }\r\n\r\n    this._servicesManager = servicesManager;\r\n    this._commandsManager = commandsManager;\r\n  }\r\n\r\n  /**\r\n   * Exposes Mousetrap.js's `.record` method, added by the record plugin.\r\n   *\r\n   * @param {*} event\r\n   */\r\n  record(event) {\r\n    return hotkeys.record(event);\r\n  }\r\n\r\n  /**\r\n   * Disables all hotkeys. Hotkeys added while disabled will not listen for\r\n   * input.\r\n   */\r\n  disable() {\r\n    this.isEnabled = false;\r\n    hotkeys.pause();\r\n  }\r\n\r\n  /**\r\n   * Enables all hotkeys.\r\n   */\r\n  enable() {\r\n    this.isEnabled = true;\r\n    hotkeys.unpause();\r\n  }\r\n\r\n  /**\r\n   * Registers a list of hotkeydefinitions.\r\n   *\r\n   * @param {HotkeyDefinition[] | Object} [hotkeyDefinitions=[]] Contains hotkeys definitions\r\n   */\r\n  setHotkeys(hotkeyDefinitions = []) {\r\n    try {\r\n      const definitions = this.getValidDefinitions(hotkeyDefinitions);\r\n      definitions.forEach(definition => this.registerHotkeys(definition));\r\n      localStorage.setItem('hotkey-definitions', JSON.stringify(definitions));\r\n    } catch (error) {\r\n      const { UINotificationService } = this._servicesManager.services;\r\n      UINotificationService.show({\r\n        title: 'Hotkeys Manager',\r\n        message: 'Error while setting hotkeys',\r\n        type: 'error',\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set default hotkey bindings. These\r\n   * values are used in `this.restoreDefaultBindings`.\r\n   *\r\n   * @param {HotkeyDefinition[] | Object} [hotkeyDefinitions=[]] Contains hotkeys definitions\r\n   */\r\n  setDefaultHotKeys(hotkeyDefinitions = []) {\r\n    const definitions = this.getValidDefinitions(hotkeyDefinitions);\r\n    this.hotkeyDefaults = definitions;\r\n  }\r\n\r\n  /**\r\n   * Take hotkey definitions that can be an array or object and make sure that it\r\n   * returns an array of hotkeys\r\n   *\r\n   * @param {HotkeyDefinition[] | Object} [hotkeyDefinitions=[]] Contains hotkeys definitions\r\n   */\r\n  getValidDefinitions(hotkeyDefinitions) {\r\n    const definitions = Array.isArray(hotkeyDefinitions)\r\n      ? [...hotkeyDefinitions]\r\n      : this._parseToArrayLike(hotkeyDefinitions);\r\n\r\n    return definitions;\r\n  }\r\n\r\n  /**\r\n   * Take hotkey definitions that can be an array and make sure that it\r\n   * returns an object of hotkeys definitions\r\n   *\r\n   * @param {HotkeyDefinition[]} [hotkeyDefinitions=[]] Contains hotkeys definitions\r\n   * @returns {Object}\r\n   */\r\n  getValidHotkeyDefinitions(hotkeyDefinitions) {\r\n    const definitions = this.getValidDefinitions(hotkeyDefinitions);\r\n    const objectDefinitions = {};\r\n    definitions.forEach(definition => {\r\n      const { commandName, commandOptions } = definition;\r\n      const commandHash = objectHash({ commandName, commandOptions });\r\n      objectDefinitions[commandHash] = definition;\r\n    });\r\n    return objectDefinitions;\r\n  }\r\n\r\n  /**\r\n   * It parses given object containing hotkeyDefinition to array like.\r\n   * Each property of given object will be mapped to an object of an array. And its property name will be the value of a property named as commandName\r\n   *\r\n   * @param {HotkeyDefinition[] | Object} [hotkeyDefinitions={}] Contains hotkeys definitions\r\n   * @returns {HotkeyDefinition[]}\r\n   */\r\n  _parseToArrayLike(hotkeyDefinitionsObj = {}) {\r\n    const copy = { ...hotkeyDefinitionsObj };\r\n    return Object.entries(copy).map(entryValue =>\r\n      this._parseToHotKeyObj(entryValue[0], entryValue[1])\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Return HotkeyDefinition object like based on given property name and property value\r\n   * @param {string} propertyName property name of hotkey definition object\r\n   * @param {object} propertyValue property value of hotkey definition object\r\n   *\r\n   * @example\r\n   *\r\n   * const hotKeyObj = {hotKeyDefA: {keys:[],....}}\r\n   *\r\n   * const parsed = _parseToHotKeyObj(Object.keys(hotKeyDefA)[0], hotKeyObj[hotKeyDefA]);\r\n   *  {\r\n   *   commandName: hotKeyDefA,\r\n   *   keys: [],\r\n   *   ....\r\n   *  }\r\n   *\r\n   */\r\n  _parseToHotKeyObj(propertyName, propertyValue) {\r\n    return {\r\n      commandName: propertyName,\r\n      ...propertyValue,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * (unbinds and) binds the specified command to one or more key combinations.\r\n   * When a hotkey combination is triggered, the command name and active contexts\r\n   * are used to locate the correct command to call.\r\n   *\r\n   * @param {HotkeyDefinition} command\r\n   * @param {String} extension\r\n   * @returns {undefined}\r\n   */\r\n  registerHotkeys(\r\n    { commandName, commandOptions = {}, keys, label, isEditable } = {},\r\n    extension\r\n  ) {\r\n    if (!commandName) {\r\n      throw new Error(`No command was defined for hotkey \"${keys}\"`);\r\n    }\r\n\r\n    const commandHash = objectHash({ commandName, commandOptions });\r\n    const options = Object.keys(commandOptions).length\r\n      ? JSON.stringify(commandOptions)\r\n      : 'no';\r\n    const previouslyRegisteredDefinition = this.hotkeyDefinitions[commandHash];\r\n\r\n    if (previouslyRegisteredDefinition) {\r\n      const previouslyRegisteredKeys = previouslyRegisteredDefinition.keys;\r\n      this._unbindHotkeys(commandName, previouslyRegisteredKeys);\r\n      log.info(\r\n        `[hotkeys] Unbinding ${commandName} with ${options} options from ${previouslyRegisteredKeys}`\r\n      );\r\n    }\r\n\r\n    // Set definition & bind\r\n    this.hotkeyDefinitions[commandHash] = {\r\n      commandName,\r\n      commandOptions,\r\n      keys,\r\n      label,\r\n      isEditable,\r\n    };\r\n    this._bindHotkeys(commandName, commandOptions, keys);\r\n    log.info(\r\n      `[hotkeys] Binding ${commandName} with ${options} options to ${keys}`\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Uses most recent\r\n   *\r\n   * @returns {undefined}\r\n   */\r\n  restoreDefaultBindings() {\r\n    this.setHotkeys(this.hotkeyDefaults);\r\n  }\r\n\r\n  /**\r\n   *\r\n   */\r\n  destroy() {\r\n    this.hotkeyDefaults = [];\r\n    this.hotkeyDefinitions = {};\r\n    hotkeys.reset();\r\n  }\r\n\r\n  /**\r\n   * Binds one or more set of hotkey combinations for a given command\r\n   *\r\n   * @private\r\n   * @param {string} commandName - The name of the command to trigger when hotkeys are used\r\n   * @param {string[]} keys - One or more key combinations that should trigger command\r\n   * @returns {undefined}\r\n   */\r\n  _bindHotkeys(commandName, commandOptions = {}, keys) {\r\n    const isKeyDefined = keys === '' || keys === undefined;\r\n    if (isKeyDefined) {\r\n      return;\r\n    }\r\n\r\n    const isKeyArray = keys instanceof Array;\r\n    const combinedKeys = isKeyArray ? keys.join('+') : keys;\r\n\r\n    hotkeys.bind(combinedKeys, evt => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n      this._commandsManager.runCommand(commandName, { evt, ...commandOptions });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * unbinds one or more set of hotkey combinations for a given command\r\n   *\r\n   * @private\r\n   * @param {string} commandName - The name of the previously bound command\r\n   * @param {string[]} keys - One or more sets of previously bound keys\r\n   * @returns {undefined}\r\n   */\r\n  _unbindHotkeys(commandName, keys) {\r\n    const isKeyDefined = keys !== '' && keys !== undefined;\r\n    if (!isKeyDefined) {\r\n      return;\r\n    }\r\n\r\n    const isKeyArray = keys instanceof Array;\r\n    if (isKeyArray) {\r\n      const combinedKeys = keys.join('+');\r\n      this._unbindHotkeys(commandName, combinedKeys);\r\n      return;\r\n    }\r\n\r\n    hotkeys.unbind(keys);\r\n  }\r\n}\r\n\r\nexport default HotkeysManager;\r\n\r\n// Commands Contexts:\r\n\r\n// --> Name and Priority\r\n// GLOBAL: 0\r\n// VIEWER::CORNERSTONE: 1\r\n// VIEWER::VTK: 1\r\n","import guid from '../utils/guid.js';\r\nimport { Vector3 } from 'cornerstone-math';\r\n\r\nconst OBJECT = 'object';\r\n\r\n/**\r\n * This class defines an ImageSet object which will be used across the viewer. This object represents\r\n * a list of images that are associated by any arbitrary criteria being thus content agnostic. Besides the\r\n * main attributes (images and uid) it allows additional attributes to be appended to it (currently\r\n * indiscriminately, but this should be changed).\r\n */\r\nclass ImageSet {\r\n  constructor(images) {\r\n    if (Array.isArray(images) !== true) {\r\n      throw new Error('ImageSet expects an array of images');\r\n    }\r\n\r\n    // @property \"images\"\r\n    Object.defineProperty(this, 'images', {\r\n      enumerable: false,\r\n      configurable: false,\r\n      writable: false,\r\n      value: images,\r\n    });\r\n\r\n    // @property \"uid\"\r\n    Object.defineProperty(this, 'uid', {\r\n      enumerable: false,\r\n      configurable: false,\r\n      writable: false,\r\n      value: guid(), // Unique ID of the instance\r\n    });\r\n  }\r\n\r\n  getUID() {\r\n    return this.uid;\r\n  }\r\n\r\n  setAttribute(attribute, value) {\r\n    this[attribute] = value;\r\n  }\r\n\r\n  getAttribute(attribute) {\r\n    return this[attribute];\r\n  }\r\n\r\n  setAttributes(attributes) {\r\n    if (typeof attributes === OBJECT && attributes !== null) {\r\n      const imageSet = this,\r\n        hasOwn = Object.prototype.hasOwnProperty;\r\n      for (let attribute in attributes) {\r\n        if (hasOwn.call(attributes, attribute)) {\r\n          imageSet[attribute] = attributes[attribute];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  getImage(index) {\r\n    return this.images[index];\r\n  }\r\n\r\n  sortBy(sortingCallback) {\r\n    return this.images.sort(sortingCallback);\r\n  }\r\n\r\n  sortByImagePositionPatient() {\r\n    const images = this.images;\r\n    const referenceImagePositionPatient = _getImagePositionPatient(images[0]);\r\n\r\n    const refIppVec = new Vector3(\r\n      referenceImagePositionPatient[0],\r\n      referenceImagePositionPatient[1],\r\n      referenceImagePositionPatient[2]\r\n    );\r\n\r\n    const ImageOrientationPatient = _getImageOrientationPatient(images[0]);\r\n\r\n    const scanAxisNormal = new Vector3(\r\n      ImageOrientationPatient[0],\r\n      ImageOrientationPatient[1],\r\n      ImageOrientationPatient[2]\r\n    ).cross(\r\n      new Vector3(\r\n        ImageOrientationPatient[3],\r\n        ImageOrientationPatient[4],\r\n        ImageOrientationPatient[5]\r\n      )\r\n    );\r\n\r\n    const distanceImagePairs = images.map(function(image) {\r\n      const ippVec = new Vector3(..._getImagePositionPatient(image));\r\n      const positionVector = refIppVec.clone().sub(ippVec);\r\n      const distance = positionVector.dot(scanAxisNormal);\r\n\r\n      return {\r\n        distance,\r\n        image,\r\n      };\r\n    });\r\n\r\n    distanceImagePairs.sort(function(a, b) {\r\n      return b.distance - a.distance;\r\n    });\r\n\r\n    const sortedImages = distanceImagePairs.map(a => a.image);\r\n\r\n    images.sort(function(a, b) {\r\n      return sortedImages.indexOf(a) - sortedImages.indexOf(b);\r\n    });\r\n  }\r\n}\r\n\r\nfunction _getImagePositionPatient(image) {\r\n  return image.getData().metadata.ImagePositionPatient;\r\n}\r\n\r\nfunction _getImageOrientationPatient(image) {\r\n  return image.getData().metadata.ImageOrientationPatient;\r\n}\r\n\r\nexport default ImageSet;\r\n","import queryString from 'query-string';\r\nimport dicomParser from 'dicom-parser';\r\nimport getPixelSpacingInformation from '../utils/metadataProvider/getPixelSpacingInformation';\r\nimport DicomMetadataStore from '../services/DicomMetadataStore';\r\n\r\nclass MetadataProvider {\r\n  constructor() {\r\n    // Define the main \"metadataLookup\" private property as an immutable property.\r\n    Object.defineProperty(this, 'studies', {\r\n      configurable: false,\r\n      enumerable: false,\r\n      writable: false,\r\n      value: new Map(),\r\n    });\r\n    Object.defineProperty(this, 'imageIdToUIDs', {\r\n      configurable: false,\r\n      enumerable: false,\r\n      writable: false,\r\n      value: new Map(),\r\n    });\r\n  }\r\n\r\n  /*async addInstance(dicomJSONDatasetOrP10ArrayBuffer, options = {}) {\r\n    let dicomJSONDataset;\r\n\r\n    // If Arraybuffer, parse to DICOMJSON before naturalizing.\r\n    if (dicomJSONDatasetOrP10ArrayBuffer instanceof ArrayBuffer) {\r\n      const dicomData = DicomMessage.readFile(dicomJSONDatasetOrP10ArrayBuffer);\r\n\r\n      dicomJSONDataset = dicomData.dict;\r\n    } else {\r\n      dicomJSONDataset = dicomJSONDatasetOrP10ArrayBuffer;\r\n    }\r\n\r\n    // Check if dataset is already naturalized.\r\n\r\n    let naturalizedDataset;\r\n\r\n    if (dicomJSONDataset['SeriesInstanceUID'] === undefined) {\r\n      naturalizedDataset = dcmjs.data.DicomMetaDictionary.naturalizeDataset(\r\n        dicomJSONDataset\r\n      );\r\n    } else {\r\n      naturalizedDataset = dicomJSONDataset;\r\n    }\r\n\r\n    const {\r\n      StudyInstanceUID,\r\n      SeriesInstanceUID,\r\n      SOPInstanceUID,\r\n    } = naturalizedDataset;\r\n\r\n    const study = this._getAndCacheStudy(StudyInstanceUID);\r\n    const series = this._getAndCacheSeriesFromStudy(study, SeriesInstanceUID);\r\n    const instance = this._getAndCacheInstanceFromStudy(series, SOPInstanceUID);\r\n\r\n    Object.assign(instance, naturalizedDataset);\r\n\r\n    await this._checkBulkDataAndInlineBinaries(instance, options.server);\r\n\r\n    return instance;\r\n  }*/\r\n\r\n  addImageIdToUIDs(imageId, uids) {\r\n    // This method is a fallback for when you don't have WADO-URI or WADO-RS.\r\n    // You can add instances fetched by any method by calling addInstance, and hook an imageId to point at it here.\r\n    // An example would be dicom hosted at some random site.\r\n\r\n    this.imageIdToUIDs.set(imageId, uids);\r\n  }\r\n\r\n  // _getAndCacheStudy(StudyInstanceUID) {\r\n  //   const studies = this.studies;\r\n\r\n  //   let study = studies.get(StudyInstanceUID);\r\n\r\n  //   if (!study) {\r\n  //     study = { series: new Map() };\r\n  //     studies.set(StudyInstanceUID, study);\r\n  //   }\r\n\r\n  //   return study;\r\n  // }\r\n  // _getAndCacheSeriesFromStudy(study, SeriesInstanceUID) {\r\n  //   let series = study.series.get(SeriesInstanceUID);\r\n\r\n  //   if (!series) {\r\n  //     series = { instances: new Map() };\r\n  //     study.series.set(SeriesInstanceUID, series);\r\n  //   }\r\n\r\n  //   return series;\r\n  // }\r\n\r\n  // _getAndCacheInstanceFromStudy(series, SOPInstanceUID) {\r\n  //   let instance = series.instances.get(SOPInstanceUID);\r\n\r\n  //   if (!instance) {\r\n  //     instance = {};\r\n  //     series.instances.set(SOPInstanceUID, instance);\r\n  //   }\r\n\r\n  //   return instance;\r\n  // }\r\n\r\n  _getInstance(imageId) {\r\n    const uids = this._getUIDsFromImageID(imageId);\r\n\r\n    if (!uids) {\r\n      return;\r\n    }\r\n\r\n    const { StudyInstanceUID, SeriesInstanceUID, SOPInstanceUID } = uids;\r\n\r\n    return DicomMetadataStore.getInstance(\r\n      StudyInstanceUID,\r\n      SeriesInstanceUID,\r\n      SOPInstanceUID\r\n    );\r\n  }\r\n\r\n  get(query, imageId, options = { fallback: false }) {\r\n    const instance = this._getInstance(imageId);\r\n\r\n    if (query === INSTANCE) {\r\n      return instance;\r\n    }\r\n\r\n    return this.getTagFromInstance(query, instance, options);\r\n  }\r\n\r\n  getTag(query, imageId, options) {\r\n    return this.get(query, imageId, options);\r\n  }\r\n\r\n  getInstance(imageId) {\r\n    return this.get(INSTANCE, imageId);\r\n  }\r\n\r\n  getTagFromInstance(\r\n    naturalizedTagOrWADOImageLoaderTag,\r\n    instance,\r\n    options = { fallback: false }\r\n  ) {\r\n    if (!instance) {\r\n      return;\r\n    }\r\n\r\n    // If its a naturalized dcmjs tag present on the instance, return.\r\n    if (instance[naturalizedTagOrWADOImageLoaderTag]) {\r\n      return instance[naturalizedTagOrWADOImageLoaderTag];\r\n    }\r\n\r\n    // Maybe its a legacy CornerstoneWADOImageLoader tag then:\r\n    return this._getCornerstoneWADOImageLoaderTag(\r\n      naturalizedTagOrWADOImageLoaderTag,\r\n      instance\r\n    );\r\n  }\r\n\r\n  _getCornerstoneWADOImageLoaderTag(wadoImageLoaderTag, instance) {\r\n    let metadata;\r\n\r\n    switch (wadoImageLoaderTag) {\r\n      case WADO_IMAGE_LOADER_TAGS.GENERAL_SERIES_MODULE:\r\n        const { SeriesDate, SeriesTime } = instance;\r\n\r\n        let seriesDate;\r\n        let seriesTime;\r\n\r\n        if (SeriesDate) {\r\n          seriesDate = dicomParser.parseDA(SeriesDate);\r\n        }\r\n\r\n        if (SeriesTime) {\r\n          seriesTime = dicomParser.parseTM(SeriesTime);\r\n        }\r\n\r\n        metadata = {\r\n          modality: instance.Modality,\r\n          seriesInstanceUID: instance.SeriesInstanceUID,\r\n          seriesNumber: validNumber(instance.SeriesNumber),\r\n          studyInstanceUID: instance.StudyInstanceUID,\r\n          seriesDate,\r\n          seriesTime,\r\n        };\r\n        break;\r\n      case WADO_IMAGE_LOADER_TAGS.PATIENT_STUDY_MODULE:\r\n        metadata = {\r\n          patientAge: validNumber(instance.PatientAge),\r\n          patientSize: validNumber(instance.PatientSize),\r\n          patientWeight: validNumber(instance.PatientWeight),\r\n        };\r\n        break;\r\n      case WADO_IMAGE_LOADER_TAGS.IMAGE_PLANE_MODULE:\r\n        const { ImageOrientationPatient } = instance;\r\n\r\n        // Fallback for DX images.\r\n        // TODO: We should use the rest of the results of this function\r\n        // to update the UI somehow\r\n        const { PixelSpacing } = getPixelSpacingInformation(instance);\r\n\r\n        let rowPixelSpacing;\r\n        let columnPixelSpacing;\r\n\r\n        let rowCosines;\r\n        let columnCosines;\r\n\r\n        if (PixelSpacing) {\r\n          rowPixelSpacing = PixelSpacing[0];\r\n          columnPixelSpacing = PixelSpacing[1];\r\n        }\r\n\r\n        if (ImageOrientationPatient) {\r\n          rowCosines = ImageOrientationPatient.slice(0, 3);\r\n          columnCosines = ImageOrientationPatient.slice(3, 6);\r\n        }\r\n\r\n        metadata = {\r\n          frameOfReferenceUID: instance.FrameOfReferenceUID,\r\n          rows: validNumber(instance.Rows),\r\n          columns: validNumber(instance.Columns),\r\n          imageOrientationPatient: validNumber(ImageOrientationPatient),\r\n          rowCosines: validNumber(rowCosines),\r\n          columnCosines: validNumber(columnCosines),\r\n          imagePositionPatient: validNumber(instance.ImagePositionPatient),\r\n          sliceThickness: validNumber(instance.SliceThickness),\r\n          sliceLocation: validNumber(instance.SliceLocation),\r\n          pixelSpacing: validNumber(PixelSpacing),\r\n          rowPixelSpacing: validNumber(rowPixelSpacing),\r\n          columnPixelSpacing: validNumber(columnPixelSpacing),\r\n        };\r\n        break;\r\n      case WADO_IMAGE_LOADER_TAGS.IMAGE_PIXEL_MODULE:\r\n        metadata = {\r\n          samplesPerPixel: validNumber(instance.SamplesPerPixel),\r\n          photometricInterpretation: validNumber(\r\n            instance.PhotometricInterpretation\r\n          ),\r\n          rows: validNumber(instance.Rows),\r\n          columns: validNumber(instance.Columns),\r\n          bitsAllocated: validNumber(instance.BitsAllocated),\r\n          bitsStored: validNumber(instance.BitsStored),\r\n          highBit: validNumber(instance.HighBit),\r\n          pixelRepresentation: validNumber(instance.PixelRepresentation),\r\n          planarConfiguration: validNumber(instance.PlanarConfiguration),\r\n          pixelAspectRatio: validNumber(instance.PixelAspectRatio),\r\n          smallestPixelValue: validNumber(instance.SmallestPixelValue),\r\n          largestPixelValue: validNumber(instance.LargestPixelValue),\r\n          redPaletteColorLookupTableDescriptor: validNumber(\r\n            instance.RedPaletteColorLookupTableDescriptor\r\n          ),\r\n          greenPaletteColorLookupTableDescriptor: validNumber(\r\n            instance.GreenPaletteColorLookupTableDescriptor\r\n          ),\r\n          bluePaletteColorLookupTableDescriptor: validNumber(\r\n            instance.BluePaletteColorLookupTableDescriptor\r\n          ),\r\n          redPaletteColorLookupTableData: validNumber(\r\n            instance.RedPaletteColorLookupTableData\r\n          ),\r\n          greenPaletteColorLookupTableData: validNumber(\r\n            instance.GreenPaletteColorLookupTableData\r\n          ),\r\n          bluePaletteColorLookupTableData: validNumber(\r\n            instance.BluePaletteColorLookupTableData\r\n          ),\r\n        };\r\n\r\n        break;\r\n      case WADO_IMAGE_LOADER_TAGS.VOI_LUT_MODULE:\r\n        const { WindowCenter, WindowWidth } = instance;\r\n        if (WindowCenter === undefined || WindowWidth === undefined) {\r\n          return;\r\n        }\r\n        const windowCenter = Array.isArray(WindowCenter)\r\n          ? WindowCenter\r\n          : [WindowCenter];\r\n        const windowWidth = Array.isArray(WindowWidth)\r\n          ? WindowWidth\r\n          : [WindowWidth];\r\n\r\n        metadata = {\r\n          windowCenter: validNumber(windowCenter),\r\n          windowWidth: validNumber(windowWidth),\r\n        };\r\n\r\n        break;\r\n      case WADO_IMAGE_LOADER_TAGS.MODALITY_LUT_MODULE:\r\n        const { RescaleIntercept, RescaleSlope } = instance;\r\n        if (RescaleIntercept === undefined || RescaleSlope === undefined) {\r\n          return;\r\n        }\r\n\r\n        metadata = {\r\n          rescaleIntercept: validNumber(instance.RescaleIntercept),\r\n          rescaleSlope: validNumber(instance.RescaleSlope),\r\n          rescaleType: instance.RescaleType,\r\n        };\r\n        break;\r\n      case WADO_IMAGE_LOADER_TAGS.SOP_COMMON_MODULE:\r\n        metadata = {\r\n          sopClassUID: instance.SOPClassUID,\r\n          sopInstanceUID: instance.SOPInstanceUID,\r\n        };\r\n        break;\r\n      case WADO_IMAGE_LOADER_TAGS.PET_ISOTOPE_MODULE:\r\n        const { RadiopharmaceuticalInformationSequence } = instance;\r\n\r\n        if (RadiopharmaceuticalInformationSequence) {\r\n          const RadiopharmaceuticalInformation = Array.isArray(\r\n            RadiopharmaceuticalInformationSequence\r\n          )\r\n            ? RadiopharmaceuticalInformationSequence[0]\r\n            : RadiopharmaceuticalInformationSequence;\r\n\r\n          const {\r\n            RadiopharmaceuticalStartTime,\r\n            RadionuclideTotalDose,\r\n            RadionuclideHalfLife,\r\n          } = RadiopharmaceuticalInformation;\r\n\r\n          const radiopharmaceuticalInfo = {\r\n            radiopharmaceuticalStartTime: dicomParser.parseTM(\r\n              RadiopharmaceuticalStartTime\r\n            ),\r\n            radionuclideTotalDose: RadionuclideTotalDose,\r\n            radionuclideHalfLife: RadionuclideHalfLife,\r\n          };\r\n          metadata = {\r\n            radiopharmaceuticalInfo,\r\n          };\r\n        }\r\n\r\n        break;\r\n      case WADO_IMAGE_LOADER_TAGS.OVERLAY_PLANE_MODULE:\r\n        const overlays = [];\r\n\r\n        for (\r\n          let overlayGroup = 0x00;\r\n          overlayGroup <= 0x1e;\r\n          overlayGroup += 0x02\r\n        ) {\r\n          let groupStr = `60${overlayGroup.toString(16)}`;\r\n\r\n          if (groupStr.length === 3) {\r\n            groupStr = `600${overlayGroup.toString(16)}`;\r\n          }\r\n\r\n          const OverlayDataTag = `${groupStr}3000`;\r\n          const OverlayData = instance[OverlayDataTag];\r\n\r\n          if (!OverlayData) {\r\n            continue;\r\n          }\r\n\r\n          const OverlayRowsTag = `${groupStr}0010`;\r\n          const OverlayColumnsTag = `${groupStr}0011`;\r\n          const OverlayType = `${groupStr}0040`;\r\n          const OverlayOriginTag = `${groupStr}0050`;\r\n          const OverlayDescriptionTag = `${groupStr}0022`;\r\n          const OverlayLabelTag = `${groupStr}1500`;\r\n          const ROIAreaTag = `${groupStr}1301`;\r\n          const ROIMeanTag = `${groupStr}1302`;\r\n          const ROIStandardDeviationTag = `${groupStr}1303`;\r\n          const OverlayOrigin = instance[OverlayOriginTag];\r\n\r\n          const overlay = {\r\n            rows: instance[OverlayRowsTag],\r\n            columns: instance[OverlayColumnsTag],\r\n            type: instance[OverlayType],\r\n            x: OverlayOrigin[0],\r\n            y: OverlayOrigin[1],\r\n            pixelData: OverlayData,\r\n            description: instance[OverlayDescriptionTag],\r\n            label: instance[OverlayLabelTag],\r\n            roiArea: instance[ROIAreaTag],\r\n            roiMean: instance[ROIMeanTag],\r\n            roiStandardDeviation: instance[ROIStandardDeviationTag],\r\n          };\r\n\r\n          overlays.push(overlay);\r\n        }\r\n\r\n        metadata = {\r\n          overlays,\r\n        };\r\n\r\n        break;\r\n\r\n      case WADO_IMAGE_LOADER_TAGS.PATIENT_MODULE:\r\n        const { PatientName } = instance;\r\n\r\n        let patientName;\r\n        if (PatientName) {\r\n          patientName = PatientName.Alphabetic;\r\n        }\r\n\r\n        metadata = {\r\n          patientName,\r\n          patientId: instance.PatientID,\r\n        };\r\n\r\n        break;\r\n\r\n      case WADO_IMAGE_LOADER_TAGS.GENERAL_IMAGE_MODULE:\r\n        metadata = {\r\n          sopInstanceUid: instance.SOPInstanceUID,\r\n          instanceNumber: validNumber(instance.InstanceNumber),\r\n          lossyImageCompression: instance.LossyImageCompression,\r\n          lossyImageCompressionRatio: instance.LossyImageCompressionRatio,\r\n          lossyImageCompressionMethod: instance.LossyImageCompressionMethod,\r\n        };\r\n\r\n        break;\r\n      case WADO_IMAGE_LOADER_TAGS.GENERAL_STUDY_MODULE:\r\n        metadata = {\r\n          studyDescription: instance.StudyDescription,\r\n          studyDate: instance.StudyDate,\r\n          studyTime: instance.StudyTime,\r\n          accessionNumber: instance.AccessionNumber,\r\n        };\r\n\r\n        break;\r\n      case WADO_IMAGE_LOADER_TAGS.CINE_MODULE:\r\n        metadata = {\r\n          frameTime: instance.FrameTime,\r\n        };\r\n\r\n        break;\r\n      default:\r\n        return;\r\n    }\r\n\r\n    return metadata;\r\n  }\r\n\r\n  _getUIDsFromImageID(imageId) {\r\n    if (imageId.includes('wadors:')) {\r\n      const strippedImageId = imageId.split('/studies/')[1];\r\n      const splitImageId = strippedImageId.split('/');\r\n\r\n      return {\r\n        StudyInstanceUID: splitImageId[0], // Note: splitImageId[1] === 'series'\r\n        SeriesInstanceUID: splitImageId[2], // Note: splitImageId[3] === 'instances'\r\n        SOPInstanceUID: splitImageId[4],\r\n      };\r\n    } else if (imageId.includes('?requestType=WADO')) {\r\n      const qs = queryString.parse(imageId);\r\n\r\n      return {\r\n        StudyInstanceUID: qs.studyUID,\r\n        SeriesInstanceUID: qs.seriesUID,\r\n        SOPInstanceUID: qs.objectUID,\r\n      };\r\n    }\r\n\r\n    // Maybe its a non-standard imageId\r\n    return this.imageIdToUIDs.get(imageId);\r\n  }\r\n}\r\n\r\nconst metadataProvider = new MetadataProvider();\r\n\r\n/**\r\n * Returns the values as an array of javascript numbers\r\n *\r\n * @param element - The javascript object for the specified element in the metadata\r\n * @returns {*}\r\n */\r\nconst validNumber = val => {\r\n  if (Array.isArray(val)) {\r\n    return val.map(v => (v !== undefined ? Number(v) : v));\r\n  } else {\r\n    return val !== undefined ? Number(val) : val;\r\n  }\r\n};\r\n\r\nexport default metadataProvider;\r\n\r\nconst WADO_IMAGE_LOADER_TAGS = {\r\n  // CornerstoneWADOImageLoader specific\r\n  GENERAL_SERIES_MODULE: 'generalSeriesModule',\r\n  PATIENT_STUDY_MODULE: 'patientStudyModule',\r\n  IMAGE_PLANE_MODULE: 'imagePlaneModule',\r\n  IMAGE_PIXEL_MODULE: 'imagePixelModule',\r\n  VOI_LUT_MODULE: 'voiLutModule',\r\n  MODALITY_LUT_MODULE: 'modalityLutModule',\r\n  SOP_COMMON_MODULE: 'sopCommonModule',\r\n  PET_ISOTOPE_MODULE: 'petIsotopeModule',\r\n  OVERLAY_PLANE_MODULE: 'overlayPlaneModule',\r\n\r\n  // react-cornerstone-viewport specifc\r\n  PATIENT_MODULE: 'patientModule',\r\n  GENERAL_IMAGE_MODULE: 'generalImageModule',\r\n  GENERAL_STUDY_MODULE: 'generalStudyModule',\r\n  CINE_MODULE: 'cineModule',\r\n};\r\n\r\nconst INSTANCE = 'instance';\r\n","import log from '../../log';\r\n\r\nexport default function getPixelSpacingInformation(instance) {\r\n  // See http://gdcm.sourceforge.net/wiki/index.php/Imager_Pixel_Spacing\r\n\r\n  // TODO: Add manual calibration\r\n\r\n  // TODO: Use ENUMS from dcmjs\r\n  const projectionRadiographSOPClassUIDs = [\r\n    '1.2.840.10008.5.1.4.1.1.1', //\tCR Image Storage\r\n    '1.2.840.10008.5.1.4.1.1.1.1', //\tDigital X-Ray Image Storage – for Presentation\r\n    '1.2.840.10008.5.1.4.1.1.1.1.1', //\tDigital X-Ray Image Storage – for Processing\r\n    '1.2.840.10008.5.1.4.1.1.1.2', //\tDigital Mammography X-Ray Image Storage – for Presentation\r\n    '1.2.840.10008.5.1.4.1.1.1.2.1', //\tDigital Mammography X-Ray Image Storage – for Processing\r\n    '1.2.840.10008.5.1.4.1.1.1.3', //\tDigital Intra – oral X-Ray Image Storage – for Presentation\r\n    '1.2.840.10008.5.1.4.1.1.1.3.1', //\tDigital Intra – oral X-Ray Image Storage – for Processing\r\n    '1.2.840.10008.5.1.4.1.1.12.1', //\tX-Ray Angiographic Image Storage\r\n    '1.2.840.10008.5.1.4.1.1.12.1.1', //\tEnhanced XA Image Storage\r\n    '1.2.840.10008.5.1.4.1.1.12.2', //\tX-Ray Radiofluoroscopic Image Storage\r\n    '1.2.840.10008.5.1.4.1.1.12.2.1', //\tEnhanced XRF Image Storage\r\n    '1.2.840.10008.5.1.4.1.1.12.3', // X-Ray Angiographic Bi-plane Image Storage\tRetired\r\n  ];\r\n\r\n  const {\r\n    PixelSpacing,\r\n    ImagerPixelSpacing,\r\n    SOPClassUID,\r\n    PixelSpacingCalibrationType,\r\n    PixelSpacingCalibrationDescription,\r\n    EstimatedRadiographicMagnificationFactor,\r\n    SequenceOfUltrasoundRegions,\r\n  } = instance;\r\n  const isProjection = projectionRadiographSOPClassUIDs.includes(SOPClassUID);\r\n\r\n  const TYPES = {\r\n    NOT_APPLICABLE: 'NOT_APPLICABLE',\r\n    UNKNOWN: 'UNKNOWN',\r\n    CALIBRATED: 'CALIBRATED',\r\n    DETECTOR: 'DETECTOR',\r\n  };\r\n\r\n  if (isProjection && !ImagerPixelSpacing) {\r\n    // If only Pixel Spacing is present, and this is a projection radiograph,\r\n    // PixelSpacing should be used, but the user should be informed that\r\n    // what it means is unknown\r\n    return {\r\n      PixelSpacing,\r\n      type: TYPES.UNKNOWN,\r\n      isProjection,\r\n    };\r\n  } else if (\r\n    PixelSpacing &&\r\n    ImagerPixelSpacing &&\r\n    PixelSpacing === ImagerPixelSpacing\r\n  ) {\r\n    // If Imager Pixel Spacing and Pixel Spacing are present and they have the same values,\r\n    // then the user should be informed that the measurements are at the detector plane\r\n    return {\r\n      PixelSpacing,\r\n      type: TYPES.DETECTOR,\r\n      isProjection,\r\n    };\r\n  } else if (\r\n    PixelSpacing &&\r\n    ImagerPixelSpacing &&\r\n    PixelSpacing !== ImagerPixelSpacing\r\n  ) {\r\n    // If Imager Pixel Spacing and Pixel Spacing are present and they have different values,\r\n    // then the user should be informed that these are \"calibrated\"\r\n    // (in some unknown manner if Pixel Spacing Calibration Type and/or\r\n    // Pixel Spacing Calibration Description are absent)\r\n    return {\r\n      PixelSpacing,\r\n      type: TYPES.CALIBRATED,\r\n      isProjection,\r\n      PixelSpacingCalibrationType,\r\n      PixelSpacingCalibrationDescription,\r\n    };\r\n  } else if (!PixelSpacing && ImagerPixelSpacing) {\r\n    let CorrectedImagerPixelSpacing = ImagerPixelSpacing;\r\n    if (EstimatedRadiographicMagnificationFactor) {\r\n      // Note that in IHE Mammo profile compliant displays, the value of Imager Pixel Spacing is required to be corrected by\r\n      // Estimated Radiographic Magnification Factor and the user informed of that.\r\n      // TODO: should this correction be done before all of this logic?\r\n      CorrectedImagerPixelSpacing = ImagerPixelSpacing.map(\r\n        pixelSpacing => pixelSpacing / EstimatedRadiographicMagnificationFactor\r\n      );\r\n    } else {\r\n      log.info(\r\n        'EstimatedRadiographicMagnificationFactor was not present. Unable to correct ImagerPixelSpacing.'\r\n      );\r\n    }\r\n\r\n    return {\r\n      PixelSpacing: CorrectedImagerPixelSpacing,\r\n      isProjection,\r\n    };\r\n  } else if (\r\n    SequenceOfUltrasoundRegions &&\r\n    typeof SequenceOfUltrasoundRegions === 'object'\r\n  ) {\r\n    const { PhysicalDeltaX, PhysicalDeltaY } = SequenceOfUltrasoundRegions;\r\n    const USPixelSpacing = [PhysicalDeltaX * 10, PhysicalDeltaY * 10];\r\n\r\n    return {\r\n      PixelSpacing: USPixelSpacing,\r\n    };\r\n  } else if (\r\n    SequenceOfUltrasoundRegions &&\r\n    Array.isArray(SequenceOfUltrasoundRegions) &&\r\n    SequenceOfUltrasoundRegions.length > 1\r\n  ) {\r\n    log.warn(\r\n      'Sequence of Ultrasound Regions > one entry. This is not yet implemented, all measurements will be shown in pixels.'\r\n    );\r\n  } else if (isProjection === false && !ImagerPixelSpacing) {\r\n    // If only Pixel Spacing is present, and this is not a projection radiograph,\r\n    // we can stop here\r\n    return {\r\n      PixelSpacing,\r\n      type: TYPES.NOT_APPLICABLE,\r\n      isProjection,\r\n    };\r\n  }\r\n\r\n  log.info(\r\n    'Unknown combination of PixelSpacing and ImagerPixelSpacing identified. Unable to determine spacing.'\r\n  );\r\n}\r\n","import CommandsManager from './CommandsManager.js';\r\nimport HotkeysManager from './HotkeysManager.js';\r\nimport ImageSet from './ImageSet';\r\nimport MetadataProvider from './MetadataProvider';\r\n\r\nexport {\r\n  MetadataProvider,\r\n  CommandsManager,\r\n  HotkeysManager,\r\n  ImageSet,\r\n};\r\n\r\nconst classes = {\r\n  MetadataProvider,\r\n  CommandsManager,\r\n  HotkeysManager,\r\n  ImageSet,\r\n};\r\n\r\nexport default classes;\r\n","export default {\r\n  1: { description: 'Soft tissue', window: '400', level: '40' },\r\n  2: { description: 'Lung', window: '1500', level: '-600' },\r\n  3: { description: 'Liver', window: '150', level: '90' },\r\n  4: { description: 'Bone', window: '80', level: '40' },\r\n  5: { description: 'Brain', window: '2500', level: '480' },\r\n  6: { description: 'Trest', window: '1', level: '1' },\r\n  7: { description: 'Empty1', window: 'Empty1', level: 'Empty1' },\r\n  8: { description: 'Empty2', window: 'Empty2', level: 'Empty2' },\r\n  9: { description: 'Empty3', window: 'Empty3', level: 'Empty3' },\r\n  10: { description: 'Empty4', window: 'Empty4', level: 'Empty4' },\r\n};\r\n","import hotkeyBindings from './hotkeyBindings';\r\nimport windowLevelPresets from './windowLevelPresets';\r\nexport { hotkeyBindings, windowLevelPresets };\r\nexport default { hotkeyBindings, windowLevelPresets };\r\n","import windowLevelPresets from './windowLevelPresets';\r\n\r\n/*\r\n * Supported Keys: https://craig.is/killing/mice\r\n */\r\nexport default [\r\n  { commandName: 'setToolActive', commandOptions: { toolName: 'Zoom' }, label: 'Zoom', keys: ['z'], isEditable: true },\r\n  { commandName: 'scaleUpViewport', label: 'Zoom In', keys: ['+'], isEditable: true },\r\n  { commandName: 'scaleDownViewport', label: 'Zoom Out', keys: ['-'], isEditable: true },\r\n  { commandName: 'fitViewportToWindow', label: 'Zoom to Fit', keys: ['='], isEditable: true },\r\n  { commandName: 'rotateViewportCW', label: 'Rotate Right', keys: ['r'], isEditable: true },\r\n  { commandName: 'rotateViewportCCW', label: 'Rotate Left', keys: ['l'], isEditable: true },\r\n  {\r\n    commandName: 'flipViewportVertical',\r\n    label: 'Flip Horizontally',\r\n    keys: ['h'],\r\n    isEditable: true,\r\n  },\r\n  {\r\n    commandName: 'flipViewportHorizontal',\r\n    label: 'Flip Vertically',\r\n    keys: ['v'],\r\n    isEditable: true,\r\n  },\r\n  {\r\n    commandName: 'toggleCine',\r\n    label: 'Cine',\r\n    keys: ['c'],\r\n  },\r\n  {\r\n    commandName: 'invertViewport',\r\n    label: 'Invert',\r\n    keys: ['i'],\r\n    isEditable: true,\r\n  },\r\n  {\r\n    commandName: 'incrementActiveViewport',\r\n    label: 'Next Image Viewport',\r\n    keys: ['right'],\r\n    isEditable: true,\r\n  },\r\n  {\r\n    commandName: 'decrementActiveViewport',\r\n    label: 'Previous Image Viewport',\r\n    keys: ['left'],\r\n    isEditable: true,\r\n  },\r\n  {\r\n    commandName: 'nextViewportDisplaySet',\r\n    label: 'Next Series',\r\n    keys: ['pageup'],\r\n    isEditable: true,\r\n  },\r\n  {\r\n    commandName: 'previousViewportDisplaySet',\r\n    label: 'Previous Series',\r\n    keys: ['pagedown'],\r\n    isEditable: true,\r\n  },\r\n  { commandName: 'nextImage', label: 'Next Image', keys: ['down'], isEditable: true },\r\n  { commandName: 'previousImage', label: 'Previous Image', keys: ['up'], isEditable: true },\r\n  { commandName: 'firstImage', label: 'First Image', keys: ['home'], isEditable: true },\r\n  { commandName: 'lastImage', label: 'Last Image', keys: ['end'], isEditable: true },\r\n  { commandName: 'resetViewport', label: 'Reset', keys: ['space'], isEditable: true },\r\n  {\r\n    commandName: 'cancelMeasurement',\r\n    label: 'Cancel Cornerstone Measurement',\r\n    keys: ['esc'],\r\n  },\r\n  {\r\n    commandName: 'setWindowLevel',\r\n    commandOptions: windowLevelPresets[1],\r\n    label: 'W/L Preset 1',\r\n    keys: ['1'],\r\n  },\r\n  {\r\n    commandName: 'setWindowLevel',\r\n    commandOptions: windowLevelPresets[2],\r\n    label: 'W/L Preset 2',\r\n    keys: ['2'],\r\n  },\r\n  {\r\n    commandName: 'setWindowLevel',\r\n    commandOptions: windowLevelPresets[3],\r\n    label: 'W/L Preset 3',\r\n    keys: ['3'],\r\n  },\r\n  {\r\n    commandName: 'setWindowLevel',\r\n    commandOptions: windowLevelPresets[4],\r\n    label: 'W/L Preset 4',\r\n    keys: ['4'],\r\n  },\r\n  {\r\n    commandName: 'setWindowLevel',\r\n    commandOptions: windowLevelPresets[5],\r\n    label: 'W/L Preset 5',\r\n    keys: ['5'],\r\n  },\r\n  {\r\n    commandName: 'setWindowLevel',\r\n    commandOptions: windowLevelPresets[6],\r\n    label: 'W/L Preset 6',\r\n    keys: ['6'],\r\n  },\r\n  {\r\n    commandName: 'setWindowLevel',\r\n    commandOptions: windowLevelPresets[7],\r\n    label: 'W/L Preset 7',\r\n    keys: ['7'],\r\n  },\r\n  {\r\n    commandName: 'setWindowLevel',\r\n    commandOptions: windowLevelPresets[8],\r\n    label: 'W/L Preset 8',\r\n    keys: ['8'],\r\n  },\r\n  {\r\n    commandName: 'setWindowLevel',\r\n    commandOptions: windowLevelPresets[9],\r\n    label: 'W/L Preset 9',\r\n    keys: ['9'],\r\n  },\r\n];\r\n","// These should be overridden by the implementation\r\nconst errorHandler = {\r\n  getHTTPErrorHandler: () => null,\r\n};\r\n\r\nexport default errorHandler;\r\n","import MODULE_TYPES from './MODULE_TYPES.js';\r\nimport log from './../log.js';\r\n\r\nexport default class ExtensionManager {\r\n  constructor({\r\n    commandsManager,\r\n    servicesManager,\r\n    hotkeysManager,\r\n    appConfig = {},\r\n  }) {\r\n    this.modules = {};\r\n    this.registeredExtensionIds = [];\r\n    this.moduleTypeNames = Object.values(MODULE_TYPES);\r\n    //\r\n    this._commandsManager = commandsManager;\r\n    this._servicesManager = servicesManager;\r\n    this._hotkeysManager = hotkeysManager;\r\n    this._appConfig = appConfig;\r\n\r\n    this.modulesMap = {};\r\n    this.moduleTypeNames.forEach(moduleType => {\r\n      this.modules[moduleType] = [];\r\n    });\r\n    this._extensionLifeCycleHooks = { onModeEnter: {}, onModeExit: {} };\r\n    this.dataSourceMap = {};\r\n    this.defaultDataSourceName = appConfig.defaultDataSourceName;\r\n    this.activeDataSource = undefined;\r\n  }\r\n\r\n  setActiveDataSource(dataSourceName) {\r\n    this.activeDataSource = dataSourceName;\r\n  }\r\n\r\n  onModeEnter() {\r\n    const {\r\n      registeredExtensionIds,\r\n      _servicesManager,\r\n      _commandsManager,\r\n      _hotkeysManager,\r\n      _extensionLifeCycleHooks,\r\n    } = this;\r\n\r\n    const {\r\n      MeasurementService,\r\n      ViewportGridService,\r\n      HangingProtocolService,\r\n    } = _servicesManager.services;\r\n\r\n    MeasurementService.clearMeasurements();\r\n    ViewportGridService.reset();\r\n    HangingProtocolService.reset();\r\n\r\n    registeredExtensionIds.forEach(extensionId => {\r\n      const onModeEnter = _extensionLifeCycleHooks.onModeEnter[extensionId];\r\n\r\n      if (typeof onModeEnter === 'function') {\r\n        onModeEnter({\r\n          servicesManager: _servicesManager,\r\n          commandsManager: _commandsManager,\r\n          hotkeysManager: _hotkeysManager,\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  onModeExit() {\r\n    const {\r\n      registeredExtensionIds,\r\n      _servicesManager,\r\n      _commandsManager,\r\n      _extensionLifeCycleHooks,\r\n    } = this;\r\n\r\n    const {\r\n      MeasurementService,\r\n      ViewportGridService,\r\n      HangingProtocolService,\r\n    } = _servicesManager.services;\r\n\r\n    MeasurementService.clearMeasurements();\r\n    ViewportGridService.reset();\r\n    HangingProtocolService.reset();\r\n\r\n    registeredExtensionIds.forEach(extensionId => {\r\n      const onModeExit = _extensionLifeCycleHooks.onModeExit[extensionId];\r\n\r\n      if (typeof onModeExit === 'function') {\r\n        onModeExit({\r\n          servicesManager: _servicesManager,\r\n          commandsManager: _commandsManager,\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * An array of extensions, or an array of arrays that contains extension\r\n   * configuration pairs.\r\n   *\r\n   * @param {Object[]} extensions - Array of extensions\r\n   */\r\n  registerExtensions = (extensions, dataSources = []) => {\r\n    extensions.forEach(extension => {\r\n      const hasConfiguration = Array.isArray(extension);\r\n\r\n      if (hasConfiguration) {\r\n        const [ohifExtension, configuration] = extension;\r\n        this.registerExtension(ohifExtension, configuration, dataSources);\r\n      } else {\r\n        this.registerExtension(extension, {}, dataSources);\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   *\r\n   * TODO: Id Management: SopClassHandlers currently refer to viewport module by id; setting the extension id as viewport module id is a workaround for now\r\n   * @param {Object} extension\r\n   * @param {Object} configuration\r\n   */\r\n  registerExtension = (extension, configuration = {}, dataSources = []) => {\r\n    if (!extension) {\r\n      throw new Error('Attempting to register a null/undefined extension.');\r\n    }\r\n\r\n    let extensionId = extension.id;\r\n\r\n    if (!extensionId) {\r\n      // Note: Mode framework cannot function without IDs.\r\n      log.warn(extension);\r\n      throw new Error(`Extension ID not set`);\r\n    }\r\n\r\n    if (this.registeredExtensionIds.includes(extensionId)) {\r\n      log.warn(\r\n        `Extension ID ${extensionId} has already been registered. Exiting before duplicating modules.`\r\n      );\r\n      return;\r\n    }\r\n\r\n    // preRegistrationHook\r\n    if (extension.preRegistration) {\r\n      extension.preRegistration({\r\n        servicesManager: this._servicesManager,\r\n        commandsManager: this._commandsManager,\r\n        hotkeysManager: this._hotkeysManager,\r\n        appConfig: this._appConfig,\r\n        configuration,\r\n      });\r\n    }\r\n\r\n    if (extension.onModeEnter) {\r\n      this._extensionLifeCycleHooks.onModeEnter[extensionId] =\r\n        extension.onModeEnter;\r\n    }\r\n\r\n    if (extension.onModeExit) {\r\n      this._extensionLifeCycleHooks.onModeExit[extensionId] =\r\n        extension.onModeExit;\r\n    }\r\n\r\n    // Register Modules\r\n    this.moduleTypeNames.forEach(moduleType => {\r\n      const extensionModule = this._getExtensionModule(\r\n        moduleType,\r\n        extension,\r\n        extensionId,\r\n        configuration\r\n      );\r\n\r\n      if (extensionModule) {\r\n        switch (moduleType) {\r\n          case MODULE_TYPES.COMMANDS:\r\n            this._initCommandsModule(extensionModule);\r\n            break;\r\n          case MODULE_TYPES.DATA_SOURCE:\r\n            this._initDataSourcesModule(\r\n              extensionModule,\r\n              extensionId,\r\n              dataSources\r\n            );\r\n            break;\r\n          case MODULE_TYPES.TOOLBAR:\r\n          case MODULE_TYPES.VIEWPORT:\r\n          case MODULE_TYPES.PANEL:\r\n          case MODULE_TYPES.SOP_CLASS_HANDLER:\r\n          case MODULE_TYPES.CONTEXT:\r\n          case MODULE_TYPES.LAYOUT_TEMPLATE:\r\n          case MODULE_TYPES.HANGING_PROTOCOL:\r\n            // Default for most extension points,\r\n            // Just adds each entry ready for consumption by mode.\r\n            extensionModule.forEach(element => {\r\n              this.modulesMap[\r\n                `${extensionId}.${moduleType}.${element.name}`\r\n              ] = element;\r\n            });\r\n            break;\r\n          default:\r\n            throw new Error(`Module type invalid: ${moduleType}`);\r\n        }\r\n\r\n        this.modules[moduleType].push({\r\n          extensionId,\r\n          module: extensionModule,\r\n        });\r\n      }\r\n    });\r\n\r\n    // Track extension registration\r\n    this.registeredExtensionIds.push(extensionId);\r\n  };\r\n\r\n  getModuleEntry = stringEntry => {\r\n    return this.modulesMap[stringEntry];\r\n  };\r\n\r\n  getDataSources = dataSourceName => {\r\n    if (dataSourceName === undefined) {\r\n      // Default to the activeDataSource\r\n      dataSourceName = this.activeDataSource;\r\n    }\r\n\r\n    // Note: this currently uses the data source name, which feels weird...\r\n    return this.dataSourceMap[dataSourceName];\r\n  };\r\n\r\n  getActiveDataSource = () => {\r\n    return this.dataSourceMap[this.activeDataSource];\r\n  };\r\n\r\n  getDataSource = () => {\r\n    return this.dataSourceMap[this.activeDataSource];\r\n  };\r\n\r\n  /**\r\n   * @private\r\n   * @param {string} moduleType\r\n   * @param {Object} extension\r\n   * @param {string} extensionId - Used for logging warnings\r\n   */\r\n  _getExtensionModule = (moduleType, extension, extensionId, configuration) => {\r\n    const getModuleFnName = 'get' + _capitalizeFirstCharacter(moduleType);\r\n    const getModuleFn = extension[getModuleFnName];\r\n\r\n    if (!getModuleFn) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const extensionModule = getModuleFn({\r\n        appConfig: this._appConfig,\r\n        commandsManager: this._commandsManager,\r\n        servicesManager: this._servicesManager,\r\n        hotkeysManager: this._hotkeysManager,\r\n        extensionManager: this,\r\n        configuration,\r\n      });\r\n\r\n      if (!extensionModule) {\r\n        log.warn(\r\n          `Null or undefined returned when registering the ${getModuleFnName} module for the ${extensionId} extension`\r\n        );\r\n      }\r\n\r\n      return extensionModule;\r\n    } catch (ex) {\r\n      throw new Error(\r\n        `Exception thrown while trying to call ${getModuleFnName} for the ${extensionId} extension`\r\n      );\r\n    }\r\n  };\r\n\r\n  _initDataSourcesModule(extensionModule, extensionId, dataSources = []) {\r\n    const { UserAuthenticationService } = this._servicesManager.services;\r\n\r\n    extensionModule.forEach(element => {\r\n      const namespace = `${extensionId}.${MODULE_TYPES.DATA_SOURCE}.${element.name}`;\r\n\r\n      dataSources.forEach(dataSource => {\r\n        if (dataSource.namespace === namespace) {\r\n          const dataSourceInstance = element.createDataSource(\r\n            dataSource.configuration,\r\n            UserAuthenticationService\r\n          );\r\n\r\n          if (this.dataSourceMap[dataSource.sourceName]) {\r\n            this.dataSourceMap[dataSource.sourceName].push(dataSourceInstance);\r\n          } else {\r\n            this.dataSourceMap[dataSource.sourceName] = [dataSourceInstance];\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    extensionModule.forEach(element => {\r\n      this.modulesMap[\r\n        `${extensionId}.${MODULE_TYPES.DATA_SOURCE}.${element.name}`\r\n      ] = element;\r\n    });\r\n  }\r\n\r\n  _initHangingProtocolModule(extensionModule, extensionId) {\r\n    extensionModule.forEach(element => {\r\n      this.modulesMap[\r\n        `${extensionId}.${MODULE_TYPES.HANGING_PROTOCOL}.${element.name}`\r\n      ] = element;\r\n    });\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @private\r\n   * @param {Object[]} commandDefinitions\r\n   */\r\n  _initCommandsModule = extensionModule => {\r\n    let { definitions, defaultContext } = extensionModule;\r\n    if (!definitions || Object.keys(definitions).length === 0) {\r\n      log.warn('Commands Module contains no command definitions');\r\n      return;\r\n    }\r\n\r\n    defaultContext = defaultContext || 'VIEWER';\r\n\r\n    if (!this._commandsManager.getContext(defaultContext)) {\r\n      this._commandsManager.createContext(defaultContext);\r\n    }\r\n\r\n    Object.keys(definitions).forEach(commandName => {\r\n      const commandDefinition = definitions[commandName];\r\n      const commandHasContextThatDoesNotExist =\r\n        commandDefinition.context &&\r\n        !this._commandsManager.getContext(commandDefinition.context);\r\n\r\n      if (commandHasContextThatDoesNotExist) {\r\n        this._commandsManager.createContext(commandDefinition.context);\r\n      }\r\n\r\n      this._commandsManager.registerCommand(\r\n        commandDefinition.context || defaultContext,\r\n        commandName,\r\n        commandDefinition\r\n      );\r\n    });\r\n  };\r\n}\r\n\r\n/**\r\n * @private\r\n * @param {string} lower\r\n */\r\nfunction _capitalizeFirstCharacter(lower) {\r\n  return lower.charAt(0).toUpperCase() + lower.substr(1);\r\n}\r\n","export default {\r\n  COMMANDS: 'commandsModule',\r\n  DATA_SOURCE: 'dataSourcesModule',\r\n  PANEL: 'panelModule',\r\n  SOP_CLASS_HANDLER: 'sopClassHandlerModule',\r\n  TOOLBAR: 'toolbarModule',\r\n  VIEWPORT: 'viewportModule',\r\n  CONTEXT: 'contextModule',\r\n  LAYOUT_TEMPLATE: 'layoutTemplateModule',\r\n  HANGING_PROTOCOL: 'hangingProtocolModule',\r\n};\r\n","// Transforms a shallow object with keys separated by \".\" into a nested object\r\nfunction getNestedObject(shallowObject) {\r\n  const nestedObject = {};\r\n  for (let key in shallowObject) {\r\n    if (!shallowObject.hasOwnProperty(key)) continue;\r\n    const value = shallowObject[key];\r\n    const propertyArray = key.split('.');\r\n    let currentObject = nestedObject;\r\n    while (propertyArray.length) {\r\n      const currentProperty = propertyArray.shift();\r\n      if (!propertyArray.length) {\r\n        currentObject[currentProperty] = value;\r\n      } else {\r\n        if (!currentObject[currentProperty]) {\r\n          currentObject[currentProperty] = {};\r\n        }\r\n\r\n        currentObject = currentObject[currentProperty];\r\n      }\r\n    }\r\n  }\r\n\r\n  return nestedObject;\r\n}\r\n\r\n// Transforms a nested object into a shallowObject merging its keys with \".\" character\r\nfunction getShallowObject(nestedObject) {\r\n  const shallowObject = {};\r\n  const putValues = (baseKey, nestedObject, resultObject) => {\r\n    for (let key in nestedObject) {\r\n      if (!nestedObject.hasOwnProperty(key)) continue;\r\n      let currentKey = baseKey ? `${baseKey}.${key}` : key;\r\n      const currentValue = nestedObject[key];\r\n      if (typeof currentValue === 'object') {\r\n        if (currentValue instanceof Array) {\r\n          currentKey += '[]';\r\n        }\r\n\r\n        putValues(currentKey, currentValue, resultObject);\r\n      } else {\r\n        resultObject[currentKey] = currentValue;\r\n      }\r\n    }\r\n  };\r\n\r\n  putValues('', nestedObject, shallowObject);\r\n  return shallowObject;\r\n}\r\n\r\nconst object = {\r\n  getNestedObject,\r\n  getShallowObject,\r\n};\r\n\r\nexport default object;\r\n","function isObject(subject) {\r\n  return (\r\n    subject instanceof Object ||\r\n    (typeof subject === 'object' && subject !== null)\r\n  );\r\n}\r\n\r\nfunction isString(subject) {\r\n  return typeof subject === 'string';\r\n}\r\n\r\n// Search for some string inside any object or array\r\nfunction search(object, query, property = null, result = []) {\r\n  // Create the search pattern\r\n  const pattern = new RegExp(query.trim(), 'i');\r\n\r\n  Object.keys(object).forEach(key => {\r\n    const item = object[key];\r\n\r\n    // Stop here if item is empty\r\n    if (!item) {\r\n      return;\r\n    }\r\n\r\n    // Get the value to be compared\r\n    const value = isString(property) ? item[property] : item;\r\n\r\n    // Check if the value match the pattern\r\n    if (isString(value) && pattern.test(value)) {\r\n      // Add the current item to the result\r\n      result.push(item);\r\n    }\r\n\r\n    if (isObject(item)) {\r\n      // Search recursively the item if the current item is an object\r\n      search(item, query, property, result);\r\n    }\r\n  });\r\n\r\n  // Return the found items\r\n  return result;\r\n}\r\n\r\n// Encode any string into a safe format for HTML id attribute\r\nfunction encodeId(input) {\r\n  const string = input && input.toString ? input.toString() : input;\r\n\r\n  // Return an underscore if the given string is empty or if it's not a string\r\n  if (string === '' || typeof string !== 'string') {\r\n    return '_';\r\n  }\r\n\r\n  // Create a converter to replace non accepted chars\r\n  const converter = match => '_' + match[0].charCodeAt(0).toString(16) + '_';\r\n\r\n  // Encode the given string and return it\r\n  return string.replace(/[^a-zA-Z0-9-]/g, converter);\r\n}\r\n\r\nconst string = {\r\n  search,\r\n  encodeId,\r\n};\r\n\r\nexport default string;\r\n","// These should be overridden by the implementation\r\nlet user = {\r\n  userLoggedIn: () => false,\r\n  getUserId: () => null,\r\n  getName: () => null,\r\n  getAccessToken: () => null,\r\n  login: () => new Promise((resolve, reject) => reject()),\r\n  logout: () => new Promise((resolve, reject) => reject()),\r\n  getData: key => null,\r\n  setData: (key, value) => null,\r\n};\r\n\r\nexport default user;\r\n","import { ExtensionManager, MODULE_TYPES } from './extensions';\r\nimport { ServicesManager } from './services';\r\nimport classes, { CommandsManager, HotkeysManager } from './classes/';\r\n\r\nimport DICOMWeb from './DICOMWeb';\r\nimport DICOMSR from './DICOMSR';\r\nimport errorHandler from './errorHandler.js';\r\nimport log from './log.js';\r\nimport object from './object.js';\r\nimport string from './string.js';\r\nimport user from './user.js';\r\nimport utils from './utils/';\r\nimport defaults from './defaults';\r\n\r\nimport {\r\n  CineService,\r\n  UIDialogService,\r\n  UIModalService,\r\n  UINotificationService,\r\n  UIViewportDialogService,\r\n  //\r\n  DicomMetadataStore,\r\n  DisplaySetService,\r\n  ToolBarService,\r\n  MeasurementService,\r\n  ViewportGridService,\r\n  HangingProtocolService,\r\n  pubSubServiceInterface,\r\n  UserAuthenticationService,\r\n} from './services';\r\n\r\nimport IWebApiDataSource from './DataSources/IWebApiDataSource';\r\n\r\nconst hotkeys = {\r\n  ...utils.hotkeys,\r\n  defaults: { hotkeyBindings: defaults.hotkeyBindings },\r\n};\r\n\r\nconst OHIF = {\r\n  MODULE_TYPES,\r\n  //\r\n  CommandsManager,\r\n  ExtensionManager,\r\n  HotkeysManager,\r\n  ServicesManager,\r\n  //\r\n  defaults,\r\n  utils,\r\n  hotkeys,\r\n  classes,\r\n  string,\r\n  user,\r\n  errorHandler,\r\n  object,\r\n  log,\r\n  DICOMWeb,\r\n  DICOMSR,\r\n  viewer: {},\r\n  //\r\n  CineService,\r\n  UIDialogService,\r\n  UIModalService,\r\n  UINotificationService,\r\n  UIViewportDialogService,\r\n  DisplaySetService,\r\n  MeasurementService,\r\n  ToolBarService, // TODO: TYPO\r\n  ViewportGridService,\r\n  HangingProtocolService,\r\n  UserAuthenticationService,\r\n  IWebApiDataSource,\r\n  DicomMetadataStore,\r\n  pubSubServiceInterface,\r\n};\r\n\r\nexport {\r\n  MODULE_TYPES,\r\n  //\r\n  CommandsManager,\r\n  ExtensionManager,\r\n  HotkeysManager,\r\n  ServicesManager,\r\n  //\r\n  defaults,\r\n  utils,\r\n  hotkeys,\r\n  classes,\r\n  string,\r\n  user,\r\n  errorHandler,\r\n  object,\r\n  log,\r\n  DICOMWeb,\r\n  DICOMSR,\r\n  //\r\n  CineService,\r\n  UIDialogService,\r\n  UIModalService,\r\n  UINotificationService,\r\n  UIViewportDialogService,\r\n  DisplaySetService,\r\n  MeasurementService,\r\n  ToolBarService,\r\n  ViewportGridService,\r\n  HangingProtocolService,\r\n  UserAuthenticationService,\r\n  IWebApiDataSource,\r\n  DicomMetadataStore,\r\n  pubSubServiceInterface,\r\n};\r\n\r\nexport { OHIF };\r\n\r\nexport default OHIF;\r\n","const log = {\r\n  error: console.error,\r\n  warn: console.warn,\r\n  info: console.log,\r\n  trace: console.trace,\r\n  debug: console.debug,\r\n  time: console.time,\r\n  timeEnd: console.timeEnd,\r\n};\r\n\r\nexport default log;\r\n","const name = 'CineService';\r\n\r\nconst publicAPI = {\r\n  name,\r\n  getState: _getState,\r\n  setCine: _setCine,\r\n  setIsCineEnabled: _setIsCineEnabled,\r\n  setServiceImplementation,\r\n};\r\n\r\nconst serviceImplementation = {\r\n  _getState: () => console.warn('getState() NOT IMPLEMENTED'),\r\n  _setCine: () =>\r\n    console.warn('setCine() NOT IMPLEMENTED'),\r\n  _setIsCineEnabled: () =>\r\n    console.warn('setIsCineEnabled() NOT IMPLEMENTED'),\r\n};\r\n\r\nfunction _getState() {\r\n  return serviceImplementation._getState();\r\n}\r\n\r\nfunction _setCine({ id, frameRate, isPlaying }) {\r\n  return serviceImplementation._setCine({ id, frameRate, isPlaying });\r\n}\r\n\r\nfunction _setIsCineEnabled(isCineEnabled) {\r\n  return serviceImplementation._setIsCineEnabled(isCineEnabled);\r\n}\r\n\r\nfunction setServiceImplementation({\r\n  getState: getStateImplementation,\r\n  setCine: setCineImplementation,\r\n  setIsCineEnabled: setIsCineEnabledImplementation,\r\n}) {\r\n  if (getStateImplementation) {\r\n    serviceImplementation._getState = getStateImplementation;\r\n  }\r\n  if (setCineImplementation) {\r\n    serviceImplementation._setCine = setCineImplementation;\r\n  }\r\n  if (setIsCineEnabledImplementation) {\r\n    serviceImplementation._setIsCineEnabled = setIsCineEnabledImplementation;\r\n  }\r\n}\r\n\r\nexport default {\r\n  name,\r\n  create: ({ configuration = {} }) => {\r\n    return publicAPI;\r\n  },\r\n};\r\n","import CineService from './CineService';\r\nexport default CineService;\r\n","function createSeriesMetadata(instances) {\r\n  const { SeriesInstanceUID } = instances[0];\r\n\r\n  return {\r\n    SeriesInstanceUID,\r\n    instances,\r\n  };\r\n}\r\n\r\nexport default createSeriesMetadata;\r\n","import createSeriesMetadata from './createSeriesMetadata';\r\n\r\nfunction createStudyMetadata(StudyInstanceUID) {\r\n  return {\r\n    StudyInstanceUID,\r\n    isLoaded: false,\r\n    series: [],\r\n    /**\r\n     *\r\n     * @param {object} instance\r\n     * @returns {bool} true if series were added; false if series already exist\r\n     */\r\n    addInstanceToSeries: function (instance) {\r\n      const { SeriesInstanceUID } = instance;\r\n      const existingSeries = this.series.find(\r\n        s => s.SeriesInstanceUID === SeriesInstanceUID\r\n      );\r\n\r\n      if (existingSeries) {\r\n        existingSeries.instances.push(instance);\r\n      } else {\r\n        const series = createSeriesMetadata([instance]);\r\n        this.series.push(series);\r\n      }\r\n    },\r\n    /**\r\n     *\r\n     * @param {object[]} instances\r\n     * @param {string} instances[].SeriesInstanceUID\r\n     * @returns {bool} true if series were added; false if series already exist\r\n     */\r\n    addInstancesToSeries: function (instances) {\r\n      const { SeriesInstanceUID } = instances[0];\r\n      const existingSeries = this.series.find(\r\n        s => s.SeriesInstanceUID === SeriesInstanceUID\r\n      );\r\n\r\n      if (existingSeries) {\r\n        existingSeries.instances.push(...instances);\r\n      } else {\r\n        const series = createSeriesMetadata(instances);\r\n        this.series.push(series);\r\n      }\r\n    },\r\n\r\n    setSeriesMetadata: function (SeriesInstanceUID, seriesMetadata) {\r\n      let existingSeries = this.series.find(\r\n        s => s.SeriesInstanceUID === SeriesInstanceUID\r\n      );\r\n\r\n      if (existingSeries) {\r\n        existingSeries = Object.assign(existingSeries, seriesMetadata);\r\n      } else {\r\n        this.series.push(Object.assign({ instances: [] }, seriesMetadata));\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nexport default createStudyMetadata;\r\n","const EVENTS = {\r\n  STUDY_ADDED: 'event::dicomMetadataStore:studyAdded',\r\n  INSTANCES_ADDED: 'event::dicomMetadataStore:instancesAdded',\r\n  SERIES_ADDED: 'event::dicomMetadataStore:seriesAdded',\r\n};\r\n\r\nexport default EVENTS;\r\n","import dcmjs from 'dcmjs'\r\n\r\nimport pubSubServiceInterface from '../_shared/pubSubServiceInterface';\r\nimport createStudyMetadata from './createStudyMetadata';\r\nimport EVENTS from './EVENTS';\r\n\r\nconst _model = {\r\n  studies: [],\r\n  //   studies: [{\r\n  //     seriesLists: [\r\n  //         {\r\n  //         // Series in study from dicom web server 1 (or different backend 1)\r\n  //             series: [{\r\n  //                 instances: [{\r\n  //                     ...instanceMetadata // Naturalized DICOM.\r\n  //                 }],\r\n  //                 ...seriesMetadata\r\n  //             }],\r\n  //             clientName\r\n  //         },\r\n  //         {\r\n  //         // Series in study from dicom web server 2 (or different backend 2)\r\n  //         },\r\n  //     ],\r\n  //     ...studyMetadata,\r\n  // }]\r\n};\r\n\r\nfunction _getStudyInstanceUIDs() {\r\n  return _model.studies.map(aStudy => aStudy.StudyInstanceUID)\r\n}\r\n\r\nfunction _getStudy(StudyInstanceUID) {\r\n  return _model.studies.find(\r\n    aStudy => aStudy.StudyInstanceUID === StudyInstanceUID\r\n  );\r\n}\r\n\r\nfunction _getSeries(StudyInstanceUID, SeriesInstanceUID) {\r\n  const study = _getStudy(StudyInstanceUID);\r\n\r\n  if (!study) {\r\n    return;\r\n  }\r\n\r\n  return study.series.find(\r\n    aSeries => aSeries.SeriesInstanceUID === SeriesInstanceUID\r\n  );\r\n}\r\n\r\nfunction _getInstance(StudyInstanceUID, SeriesInstanceUID, SOPInstanceUID) {\r\n  const series = _getSeries(StudyInstanceUID, SeriesInstanceUID);\r\n\r\n  if (!series) {\r\n    return;\r\n  }\r\n\r\n  return series.instances.find(\r\n    instance => instance.SOPInstanceUID === SOPInstanceUID\r\n  );\r\n}\r\n\r\nfunction _getInstanceFromImageId(imageId) {\r\n  for (let study of _model.studies) {\r\n    for (let series of study.series) {\r\n      for (let instance of series.instances) {\r\n        if (instance.imageId === imageId) {\r\n          return instance;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst BaseImplementation = {\r\n  EVENTS,\r\n  listeners: {},\r\n  addInstance(dicomJSONDatasetOrP10ArrayBuffer) {\r\n    let dicomJSONDataset;\r\n\r\n    // If Arraybuffer, parse to DICOMJSON before naturalizing.\r\n    if (dicomJSONDatasetOrP10ArrayBuffer instanceof ArrayBuffer) {\r\n      const dicomData = dcmjs.data.DicomMessage.readFile(dicomJSONDatasetOrP10ArrayBuffer);\r\n\r\n      dicomJSONDataset = dicomData.dict;\r\n    } else {\r\n      dicomJSONDataset = dicomJSONDatasetOrP10ArrayBuffer;\r\n    }\r\n\r\n    let naturalizedDataset;\r\n\r\n    if (dicomJSONDataset['SeriesInstanceUID'] === undefined) {\r\n      naturalizedDataset = dcmjs.data.DicomMetaDictionary.naturalizeDataset(\r\n        dicomJSONDataset\r\n      );\r\n    } else {\r\n      naturalizedDataset = dicomJSONDataset;\r\n    }\r\n\r\n    const { StudyInstanceUID } = naturalizedDataset;\r\n\r\n    let study = _model.studies.find(\r\n      study => study.StudyInstanceUID === StudyInstanceUID\r\n    );\r\n\r\n    if (!study) {\r\n      _model.studies.push(createStudyMetadata(StudyInstanceUID));\r\n      study = _model.studies[_model.studies.length - 1];\r\n    }\r\n\r\n    study.addInstanceToSeries(naturalizedDataset);\r\n  },\r\n  addInstances(instances, madeInClient = false) {\r\n    const { StudyInstanceUID, SeriesInstanceUID } = instances[0];\r\n\r\n    let study = _model.studies.find(\r\n      study => study.StudyInstanceUID === StudyInstanceUID\r\n    );\r\n\r\n    if (!study) {\r\n      _model.studies.push(createStudyMetadata(StudyInstanceUID));\r\n\r\n      study = _model.studies[_model.studies.length - 1];\r\n    }\r\n\r\n    study.addInstancesToSeries(instances);\r\n\r\n    // Broadcast an event even if we used cached data.\r\n    // This is because the mode needs to listen to instances that are added to build up its active displaySets.\r\n    // It will see there are cached displaySets and end early if this Series has already been fired in this\r\n    // Mode session for some reason.\r\n    this._broadcastEvent(EVENTS.INSTANCES_ADDED, {\r\n      StudyInstanceUID,\r\n      SeriesInstanceUID,\r\n      madeInClient,\r\n    });\r\n  },\r\n  addSeriesMetadata(seriesSummaryMetadata, madeInClient = false) {\r\n    const { StudyInstanceUID } = seriesSummaryMetadata[0];\r\n    let study = _getStudy(StudyInstanceUID);\r\n    if (!study) {\r\n      study = createStudyMetadata(StudyInstanceUID);\r\n      _model.studies.push(study);\r\n    }\r\n\r\n    seriesSummaryMetadata.forEach(series => {\r\n      const { SeriesInstanceUID } = series;\r\n\r\n      study.setSeriesMetadata(SeriesInstanceUID, series);\r\n    });\r\n\r\n    this._broadcastEvent(EVENTS.SERIES_ADDED, {\r\n      StudyInstanceUID,\r\n      madeInClient,\r\n    });\r\n  },\r\n  addStudy(study) {\r\n    const { StudyInstanceUID } = study;\r\n\r\n    let existingStudy = _model.studies.find(\r\n      study => study.StudyInstanceUID === StudyInstanceUID\r\n    );\r\n\r\n    if (!existingStudy) {\r\n      const newStudy = createStudyMetadata(StudyInstanceUID);\r\n\r\n      newStudy.PatientID = study.PatientID;\r\n      newStudy.PatientName = study.PatientName;\r\n      newStudy.StudyDate = study.StudyDate;\r\n      newStudy.ModalitiesInStudy = study.ModalitiesInStudy;\r\n      newStudy.StudyDescription = study.StudyDescription;\r\n      newStudy.AccessionNumber = study.AccessionNumber;\r\n      newStudy.NumInstances = study.NumInstances; // todo: Correct naming?\r\n\r\n      _model.studies.push(newStudy);\r\n    }\r\n  },\r\n  getStudyInstanceUIDs: _getStudyInstanceUIDs,\r\n  getStudy: _getStudy,\r\n  getSeries: _getSeries,\r\n  getInstance: _getInstance,\r\n  getInstanceFromImageId: _getInstanceFromImageId,\r\n};\r\n\r\nconst DicomMetadataStore = Object.assign(\r\n  {},\r\n  BaseImplementation,\r\n  pubSubServiceInterface\r\n);\r\n\r\n\r\nexport { DicomMetadataStore };\r\nexport default DicomMetadataStore;\r\n","import DicomMetadataStore from './DicomMetadataStore';\r\n\r\nexport { DicomMetadataStore };\r\nexport default DicomMetadataStore;\r\n","const EVENTS = {\r\n  DISPLAY_SETS_ADDED: 'event::displaySetService:displaySetsAdded',\r\n  DISPLAY_SETS_CHANGED: 'event::displaySetService:displaySetsChanged',\r\n  DISPLAY_SETS_REMOVED: 'event::displaySetService:displaySetsRemoved',\r\n};\r\n\r\nexport default EVENTS;\r\n","import pubSubServiceInterface from '../_shared/pubSubServiceInterface';\r\nimport EVENTS from './EVENTS';\r\n\r\nconst displaySetCache = [];\r\n\r\nexport default class DisplaySetService {\r\n  constructor() {\r\n    this.activeDisplaySets = [];\r\n    this.listeners = {};\r\n    this.EVENTS = EVENTS;\r\n\r\n    Object.assign(this, pubSubServiceInterface);\r\n  }\r\n\r\n  init(extensionManager, SOPClassHandlerIds) {\r\n    this.extensionManager = extensionManager;\r\n    this.SOPClassHandlerIds = SOPClassHandlerIds;\r\n    this.activeDisplaySets = [];\r\n  }\r\n\r\n  _addDisplaySetsToCache(displaySets) {\r\n    displaySets.forEach(displaySet => {\r\n      displaySetCache.push(displaySet);\r\n    });\r\n  }\r\n\r\n  _addActiveDisplaySets(displaySets) {\r\n    const activeDisplaySets = this.activeDisplaySets;\r\n\r\n    displaySets.forEach(displaySet => {\r\n      activeDisplaySets.push(displaySet);\r\n    });\r\n  }\r\n\r\n  getDisplaySetCache() {\r\n    return displaySetCache;\r\n  }\r\n\r\n  getMostRecentDisplaySet() {\r\n    return this.activeDisplaySets[this.activeDisplaySets.length - 1];\r\n  }\r\n\r\n  getActiveDisplaySets() {\r\n    return this.activeDisplaySets;\r\n  }\r\n\r\n  getDisplaySetsForSeries = SeriesInstanceUID => {\r\n    return displaySetCache.filter(\r\n      displaySet => displaySet.SeriesInstanceUID === SeriesInstanceUID\r\n    );\r\n  };\r\n\r\n  getDisplaySetForSOPInstanceUID(SOPInstanceUID, SeriesInstanceUID) {\r\n    const displaySets = SeriesInstanceUID\r\n      ? this.getDisplaySetsForSeries(SeriesInstanceUID)\r\n      : this.getDisplaySetCache();\r\n\r\n    const displaySet = displaySets.find(ds => {\r\n      return (\r\n        ds.images && ds.images.some(i => i.SOPInstanceUID === SOPInstanceUID)\r\n      );\r\n    });\r\n\r\n    return displaySet;\r\n  }\r\n\r\n  deleteDisplaySet(displaySetInstanceUID) {\r\n    const { activeDisplaySets } = this;\r\n\r\n    const displaySetCacheIndex = displaySetCache.findIndex(\r\n      ds => ds.displaySetInstanceUID === displaySetInstanceUID\r\n    );\r\n\r\n    const activeDisplaySetsIndex = activeDisplaySets.findIndex(\r\n      ds => ds.displaySetInstanceUID === displaySetInstanceUID\r\n    );\r\n\r\n    displaySetCache.splice(displaySetCacheIndex, 1);\r\n    activeDisplaySets.splice(activeDisplaySetsIndex, 1);\r\n\r\n    this._broadcastEvent(EVENTS.DISPLAY_SETS_CHANGED, this.activeDisplaySets);\r\n    this._broadcastEvent(EVENTS.DISPLAY_SETS_REMOVED, {\r\n      displaySetInstanceUIDs: [displaySetInstanceUID],\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {string} displaySetInstanceUID\r\n   * @returns {object} displaySet\r\n   */\r\n  getDisplaySetByUID = displaySetInstanceUid =>\r\n    displaySetCache.find(\r\n      displaySet => displaySet.displaySetInstanceUID === displaySetInstanceUid\r\n    );\r\n\r\n  /**\r\n   *\r\n   * @param {*} input\r\n   * @param {*} param1: settings: initialViewportSettings by HP or callbacks after rendering\r\n   * @returns {string[]} - added displaySetInstanceUIDs\r\n   */\r\n  makeDisplaySets = (\r\n    input,\r\n    { batch = false, madeInClient = false, settings = {} } = {}\r\n  ) => {\r\n    if (!input || !input.length) {\r\n      throw new Error('No instances were provided.');\r\n    }\r\n\r\n    if (batch && !input[0].length) {\r\n      throw new Error(\r\n        'Batch displaySet creation does not contain array of array of instances.'\r\n      );\r\n    }\r\n\r\n    // If array of instances => One instance.\r\n    let displaySetsAdded = [];\r\n\r\n    if (batch) {\r\n      for (let i = 0; i < input.length; i++) {\r\n        const instances = input[i];\r\n        const displaySets = this.makeDisplaySetForInstances(\r\n          instances,\r\n          settings\r\n        );\r\n\r\n        displaySetsAdded = [...displaySetsAdded, displaySets];\r\n      }\r\n    } else {\r\n      const displaySets = this.makeDisplaySetForInstances(input, settings);\r\n\r\n      displaySetsAdded = displaySets;\r\n    }\r\n\r\n    const options = {};\r\n\r\n    if (madeInClient) {\r\n      options.madeInClient = true;\r\n    }\r\n\r\n    // TODO: This is tricky. How do we know we're not resetting to the same/existing DSs?\r\n    // TODO: This is likely run anytime we touch DicomMetadataStore. How do we prevent uneccessary broadcasts?\r\n    if (displaySetsAdded && displaySetsAdded.length) {\r\n      this._broadcastEvent(EVENTS.DISPLAY_SETS_CHANGED, this.activeDisplaySets);\r\n      this._broadcastEvent(EVENTS.DISPLAY_SETS_ADDED, {\r\n        displaySetsAdded,\r\n        options,\r\n      });\r\n\r\n      return displaySetsAdded;\r\n    }\r\n  };\r\n\r\n  makeDisplaySetForInstances(instances, settings) {\r\n    const instance = instances[0];\r\n\r\n    const existingDisplaySets =\r\n      this.getDisplaySetsForSeries(instance.SeriesInstanceUID) || [];\r\n\r\n    const SOPClassHandlerIds = this.SOPClassHandlerIds;\r\n\r\n    for (let i = 0; i < SOPClassHandlerIds.length; i++) {\r\n      const SOPClassHandlerId = SOPClassHandlerIds[i];\r\n      const handler = this.extensionManager.getModuleEntry(SOPClassHandlerId);\r\n\r\n      if (handler.sopClassUids.includes(instance.SOPClassUID)) {\r\n        // Check if displaySets are already created using this SeriesInstanceUID/SOPClassHandler pair.\r\n        let displaySets = existingDisplaySets.filter(\r\n          displaySet => displaySet.SOPClassHandlerId === SOPClassHandlerId\r\n        );\r\n\r\n        if (displaySets.length) {\r\n          this._addActiveDisplaySets(displaySets);\r\n        } else {\r\n          displaySets = handler.getDisplaySetsFromSeries(instances);\r\n\r\n          // applying hp-defined viewport settings to the displaysets\r\n          displaySets.forEach(ds => {\r\n            Object.keys(settings).forEach(key => {\r\n              ds[key] = settings[key];\r\n            });\r\n          });\r\n\r\n          this._addDisplaySetsToCache(displaySets);\r\n          this._addActiveDisplaySets(displaySets);\r\n        }\r\n\r\n        return displaySets;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import DisplaySetService from './DisplaySetService';\r\n\r\nexport default {\r\n  name: 'DisplaySetService',\r\n  create: ({ configuration = {} }) => {\r\n    return new DisplaySetService();\r\n  },\r\n};\r\n","import validate from 'validate.js';\r\n\r\nvalidate.validators.equals = function (value, options, key, attributes) {\r\n  if (options && value !== options.value) {\r\n    return key + 'must equal ' + options.value;\r\n  }\r\n};\r\n\r\nvalidate.validators.doesNotEqual = function (value, options, key) {\r\n  if (options && value === options.value) {\r\n    return key + 'cannot equal ' + options.value;\r\n  }\r\n};\r\n\r\nvalidate.validators.contains = function (value, options, key) {\r\n  if (options && value.indexOf && value.indexOf(options.value) === -1) {\r\n    return key + 'must contain ' + options.value;\r\n  }\r\n};\r\n\r\nvalidate.validators.doesNotContain = function (value, options, key) {\r\n  if (options && value.indexOf && value.indexOf(options.value) !== -1) {\r\n    return key + 'cannot contain ' + options.value;\r\n  }\r\n};\r\n\r\nvalidate.validators.startsWith = function (value, options, key) {\r\n  if (options && value.startsWith && !value.startsWith(options.value)) {\r\n    return key + 'must start with ' + options.value;\r\n  }\r\n};\r\n\r\nvalidate.validators.endsWith = function (value, options, key) {\r\n  if (options && value.endsWith && !value.endsWith(options.value)) {\r\n    return key + 'must end with ' + options.value;\r\n  }\r\n};\r\n\r\nexport default validate;\r\n","import validate from './lib/validator';\r\n\r\n\r\n/**\r\n * Match a Metadata instance against rules using Validate.js for validation.\r\n * @param  {InstanceMetadata} metadataInstance Metadata instance object\r\n * @param  {Array} rules Array of MatchingRules instances (StudyMatchingRule|SeriesMatchingRule|ImageMatchingRule) for the match\r\n * @return {Object}      Matching Object with score and details (which rule passed or failed)\r\n */\r\nconst match = (metadataInstance, rules, customAttributeRetrievalCallbacks) => {\r\n  const options = {\r\n    format: 'grouped',\r\n  };\r\n\r\n  const details = {\r\n    passed: [],\r\n    failed: [],\r\n  };\r\n\r\n  let requiredFailed = false;\r\n  let score = 0;\r\n\r\n  rules.forEach(rule => {\r\n    const attribute = rule.attribute;\r\n\r\n    // Do not use the custom attribute from the metadataInstance since it is subject to change\r\n    if (customAttributeRetrievalCallbacks.hasOwnProperty(attribute)) {\r\n      const customAttribute = customAttributeRetrievalCallbacks[attribute];\r\n      metadataInstance[attribute] = customAttribute.callback(metadataInstance);\r\n    }\r\n\r\n    // Format the constraint as required by Validate.js\r\n    const testConstraint = {\r\n      [attribute]: rule.constraint,\r\n    };\r\n\r\n    // Create a single attribute object to be validated, since metadataInstance is an\r\n    // instance of Metadata (StudyMetadata, SeriesMetadata or InstanceMetadata)\r\n    const attributeValue = metadataInstance[attribute];\r\n    const attributeMap = {\r\n      [attribute]: attributeValue,\r\n    };\r\n\r\n    // Use Validate.js to evaluate the constraints on the specified metadataInstance\r\n    let errorMessages;\r\n    try {\r\n      errorMessages = validate(attributeMap, testConstraint, [options]);\r\n    } catch (e) {\r\n      errorMessages = ['Something went wrong during validation.', e];\r\n    }\r\n\r\n    if (!errorMessages) {\r\n      // If no errorMessages were returned, then validation passed.\r\n\r\n      // Add the rule's weight to the total score\r\n      score += parseInt(rule.weight, 10);\r\n\r\n      // Log that this rule passed in the matching details object\r\n      details.passed.push({\r\n        rule,\r\n      });\r\n    } else {\r\n      // If errorMessages were present, then validation failed\r\n\r\n      // If the rule that failed validation was Required, then\r\n      // mark that a required Rule has failed\r\n      if (rule.required) {\r\n        requiredFailed = true;\r\n      }\r\n\r\n      // Log that this rule failed in the matching details object\r\n      // and include any error messages\r\n      details.failed.push({\r\n        rule,\r\n        errorMessages,\r\n      });\r\n    }\r\n  });\r\n\r\n  // If a required Rule has failed Validation, set the matching score to zero\r\n  if (requiredFailed) {\r\n    score = 0;\r\n  }\r\n\r\n  return {\r\n    score,\r\n    details,\r\n    requiredFailed,\r\n  };\r\n};\r\n\r\nconst HPMatcher = {\r\n  match,\r\n};\r\n\r\nexport { HPMatcher };\r\n","import { HPMatcher } from './HPMatcher.js';\r\nimport { sortByScore } from './lib/sortByScore';\r\n\r\nconst deafultProtocol = {\r\n  id: 'defaultProtocol',\r\n  locked: true,\r\n  hasUpdatedPriorsInformation: false,\r\n  name: 'Default',\r\n  createdDate: '2021-02-23T19:22:08.894Z',\r\n  modifiedDate: '2021-02-23T19:22:08.894Z',\r\n  availableTo: {},\r\n  editableBy: {},\r\n  protocolMatchingRules: [],\r\n  stages: [\r\n    {\r\n      id: 'nwzau7jDkEkL8djfr',\r\n      name: 'oneByOne',\r\n      viewportStructure: {\r\n        type: 'grid',\r\n        properties: {\r\n          rows: 1,\r\n          columns: 1,\r\n        },\r\n      },\r\n      viewports: [\r\n        {\r\n          viewportSettings: [],\r\n          imageMatchingRules: [],\r\n          seriesMatchingRules: [],\r\n          studyMatchingRules: [],\r\n        },\r\n      ],\r\n      createdDate: '2021-02-23T19:22:08.894Z',\r\n    },\r\n  ],\r\n  numberOfPriorsReferenced: -1,\r\n};\r\n\r\nexport default class ProtocolEngine {\r\n  constructor(protocols, customAttributeRetrievalCallbacks) {\r\n    this.protocols = protocols;\r\n    this.customAttributeRetrievalCallbacks = customAttributeRetrievalCallbacks;\r\n    this.matchedProtocols = new Map();\r\n    this.matchedProtocolScores = {};\r\n    this.study = undefined;\r\n  }\r\n\r\n  run(studyMetaData) {\r\n    this.study = studyMetaData;\r\n    return this.getBestProtocolMatch();\r\n  }\r\n\r\n  // /**\r\n  // * Resets the ProtocolEngine to the best match\r\n  // */\r\n  // reset() {\r\n  //   const protocol = this.getBestProtocolMatch();\r\n\r\n  //   this.setHangingProtocol(protocol);\r\n  // }\r\n\r\n  /**\r\n   * Return the best matched Protocol to the current study or set of studies\r\n   * @returns {*}\r\n   */\r\n  getBestProtocolMatch() {\r\n    // Run the matching to populate matchedProtocols Set and Map\r\n    this.updateProtocolMatches();\r\n\r\n    // Retrieve the highest scoring Protocol\r\n    const bestMatch = this._getHighestScoringProtocol();\r\n\r\n    console.log('ProtocolEngine::getBestProtocolMatch bestMatch', bestMatch);\r\n\r\n    return bestMatch;\r\n  }\r\n\r\n  /**\r\n   * Populates the MatchedProtocols Collection by running the matching procedure\r\n   */\r\n  updateProtocolMatches() {\r\n    console.log('ProtocolEngine::updateProtocolMatches');\r\n\r\n    // Clear all data currently in matchedProtocols\r\n    this._clearMatchedProtocols();\r\n\r\n    // TODO: handle more than one study\r\n    const study = this.study;\r\n    const matched = this.findMatchByStudy(study);\r\n\r\n    // For each matched protocol, check if it is already in MatchedProtocols\r\n    matched.forEach(matchedDetail => {\r\n      const protocol = matchedDetail.protocol;\r\n      if (!protocol) {\r\n        return;\r\n      }\r\n\r\n      // If it is not already in the MatchedProtocols Collection, insert it with its score\r\n      if (!this.matchedProtocols.has(protocol.id)) {\r\n        console.log(\r\n          'ProtocolEngine::updateProtocolMatches inserting protocol match',\r\n          matchedDetail\r\n        );\r\n        this.matchedProtocols.set(protocol.id, protocol);\r\n        this.matchedProtocolScores[protocol.id] = matchedDetail.score;\r\n      }\r\n    });\r\n  }\r\n\r\n  findMatch(metaData, rules) {\r\n    return HPMatcher.match(\r\n      metaData,\r\n      rules,\r\n      this.customAttributeRetrievalCallbacks\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Finds the best protocols from Protocol Store, matching each protocol matching rules\r\n   * with the given study. The best protocol are orded by score and returned in an array\r\n   * @param  {Object} study StudyMetadata instance object\r\n   * @return {Array}       Array of match objects or an empty array if no match was found\r\n   *                       Each match object has the score of the matching and the matched\r\n   *                       protocol\r\n   */\r\n  findMatchByStudy(study) {\r\n    const matched = [];\r\n\r\n    this.protocols.forEach(protocol => {\r\n      // Clone the protocol's protocolMatchingRules array\r\n      // We clone it so that we don't accidentally add the\r\n      // numberOfPriorsReferenced rule to the Protocol itself.\r\n      let rules = protocol.protocolMatchingRules.slice();\r\n      if (!rules) {\r\n        return;\r\n      }\r\n\r\n      // Run the matcher and get matching details\r\n      const matchedDetails = this.findMatch(study, rules);\r\n      const score = matchedDetails.score;\r\n\r\n      // The protocol matched some rule, add it to the matched list\r\n      if (score > 0) {\r\n        matched.push({\r\n          score,\r\n          protocol,\r\n        });\r\n      }\r\n    });\r\n\r\n    // If no matches were found, select the default protocol\r\n    if (!matched.length) {\r\n      return [\r\n        {\r\n          score: 1,\r\n          protocol: deafultProtocol,\r\n        },\r\n      ];\r\n    }\r\n\r\n    // Sort the matched list by score\r\n    sortByScore(matched);\r\n\r\n    console.log('ProtocolEngine::findMatchByStudy matched', matched);\r\n\r\n    return matched;\r\n  }\r\n\r\n  _clearMatchedProtocols() {\r\n    this.matchedProtocols.clear();\r\n    this.matchedProtocolScores = {};\r\n  }\r\n\r\n  _largestKeyByValue(obj) {\r\n    return Object.keys(obj).reduce((a, b) => (obj[a] > obj[b] ? a : b));\r\n  }\r\n\r\n  _getHighestScoringProtocol() {\r\n    if (!Object.keys(this.matchedProtocolScores).length) {\r\n      return;\r\n    }\r\n    const highestScoringProtocolId = this._largestKeyByValue(\r\n      this.matchedProtocolScores\r\n    );\r\n    return this.matchedProtocols.get(highestScoringProtocolId);\r\n  }\r\n}\r\n\r\n/**\r\n * Resets the ProtocolEngine to the best match\r\n */\r\n\r\n/**\r\n * Retrieves the current Stage from the current Protocol and stage index\r\n *\r\n * @returns {*} The Stage model for the currently displayed Stage\r\n */\r\n// getCurrentStageModel() {\r\n//   return this.protocol.stages[this.stage];\r\n// }\r\n\r\n// /**\r\n//  * Get the number of prior studies supplied in the priorStudies map property.\r\n//  *\r\n//  * @param {String} studyObjectID The study object ID of the study whose priors are needed\r\n//  * @returns {number} The number of available prior studies with the same PatientID\r\n//  */\r\n// getNumberOfAvailablePriors(studyObjectID) {\r\n//   return this.getAvailableStudyPriors(studyObjectID).length;\r\n// }\r\n\r\n// /**\r\n//  * Get the array of prior studies from a specific study.\r\n//  *\r\n//  * @param {String} studyObjectID The study object ID of the study whose priors are needed\r\n//  * @returns {Array} The array of available priors or an empty array\r\n//  */\r\n// getAvailableStudyPriors(studyObjectID) {\r\n//   const priors = this.priorStudies.get(studyObjectID);\r\n\r\n//   return priors instanceof Array ? priors : [];\r\n// }\r\n\r\n// // Match images given a list of Studies and a Viewport's image matching reqs\r\n// matchImages(viewport, viewportIndex) {\r\n//   log.trace('ProtocolEngine::matchImages');\r\n\r\n//   const {\r\n//     studyMatchingRules,\r\n//     seriesMatchingRules,\r\n//     imageMatchingRules: instanceMatchingRules,\r\n//   } = viewport;\r\n\r\n//   const matchingScores = [];\r\n//   const currentStudy = this.studies[0]; // @TODO: Should this be: this.studies[this.currentStudy] ???\r\n//   const firstInstance = currentStudy.getFirstInstance();\r\n\r\n//   let highestStudyMatchingScore = 0;\r\n//   let highestSeriesMatchingScore = 0;\r\n\r\n//   // Set custom attribute for study metadata and it's first instance\r\n//   currentStudy.setCustomAttribute(ABSTRACT_PRIOR_VALUE, 0);\r\n//   if (firstInstance instanceof InstanceMetadata) {\r\n//     firstInstance.setCustomAttribute(ABSTRACT_PRIOR_VALUE, 0);\r\n//   }\r\n\r\n//   // Only used if study matching rules has abstract prior values defined...\r\n//   let priorStudies;\r\n\r\n//   studyMatchingRules.forEach(rule => {\r\n//     if (rule.attribute === ABSTRACT_PRIOR_VALUE) {\r\n//       const validatorType = Object.keys(rule.constraint)[0];\r\n//       const validator = Object.keys(rule.constraint[validatorType])[0];\r\n\r\n//       let abstractPriorValue = rule.constraint[validatorType][validator];\r\n//       abstractPriorValue = parseInt(abstractPriorValue, 10);\r\n//       // TODO: Restrict or clarify validators for abstractPriorValue?\r\n\r\n//       // No need to call it more than once...\r\n//       if (!priorStudies) {\r\n//         priorStudies = this.getAvailableStudyPriors(\r\n//           currentStudy.getObjectID()\r\n//         );\r\n//       }\r\n\r\n//       // TODO: Revisit this later: What about two studies with the same\r\n//       // study date?\r\n\r\n//       let priorStudy;\r\n//       if (abstractPriorValue === -1) {\r\n//         priorStudy = priorStudies[priorStudies.length - 1];\r\n//       } else {\r\n//         const studyIndex = Math.max(abstractPriorValue - 1, 0);\r\n//         priorStudy = priorStudies[studyIndex];\r\n//       }\r\n\r\n//       // Invalid data\r\n//       if (!priorStudy instanceof StudyMetadata) {\r\n//         return;\r\n//       }\r\n\r\n//       const priorStudyObjectID = priorStudy.getObjectID();\r\n\r\n//       // Check if study metadata is already in studies list\r\n//       if (\r\n//         this.studies.find(study => study.getObjectID() === priorStudyObjectID)\r\n//       ) {\r\n//         return;\r\n//       }\r\n\r\n//       // Get study metadata if necessary and load study in the viewer (each viewer should provide it's own load study method)\r\n//       this.studyMetadataSource.loadStudy(priorStudy).then(\r\n//         studyMetadata => {\r\n//           // Set the custom attribute abstractPriorValue for the study metadata\r\n//           studyMetadata.setCustomAttribute(\r\n//             ABSTRACT_PRIOR_VALUE,\r\n//             abstractPriorValue\r\n//           );\r\n\r\n//           // Also add custom attribute\r\n//           const firstInstance = studyMetadata.getFirstInstance();\r\n//           if (firstInstance instanceof InstanceMetadata) {\r\n//             firstInstance.setCustomAttribute(\r\n//               ABSTRACT_PRIOR_VALUE,\r\n//               abstractPriorValue\r\n//             );\r\n//           }\r\n\r\n//           // Insert the new study metadata\r\n//           this.studies.push(studyMetadata);\r\n\r\n//           // Update the viewport to refresh layout manager with new study\r\n//           this.updateViewports(viewportIndex);\r\n//         },\r\n//         error => {\r\n//           log.warn(error);\r\n//           throw new OHIFError(\r\n//             `ProtocolEngine::matchImages could not get study metadata for the Study with the following ObjectID: ${priorStudyObjectID}`\r\n//           );\r\n//         }\r\n//       );\r\n//     }\r\n//     // TODO: Add relative Date / time\r\n//   });\r\n\r\n//   this.studies.forEach(study => {\r\n//     const studyMatchDetails = HPMatcher.match(\r\n//       study.getFirstInstance(),\r\n//       studyMatchingRules\r\n//     );\r\n\r\n//     // Prevent bestMatch from being updated if the matchDetails' required attribute check has failed\r\n//     if (\r\n//       studyMatchDetails.requiredFailed === true ||\r\n//       studyMatchDetails.score < highestStudyMatchingScore\r\n//     ) {\r\n//       return;\r\n//     }\r\n\r\n//     highestStudyMatchingScore = studyMatchDetails.score;\r\n\r\n//     study.forEachSeries(series => {\r\n//       const seriesMatchDetails = HPMatcher.match(\r\n//         series.getFirstInstance(),\r\n//         seriesMatchingRules\r\n//       );\r\n\r\n//       // Prevent bestMatch from being updated if the matchDetails' required attribute check has failed\r\n//       if (\r\n//         seriesMatchDetails.requiredFailed === true ||\r\n//         seriesMatchDetails.score < highestSeriesMatchingScore\r\n//       ) {\r\n//         return;\r\n//       }\r\n\r\n//       highestSeriesMatchingScore = seriesMatchDetails.score;\r\n\r\n//       series.forEachInstance((instance, index) => {\r\n//         // This tests to make sure there is actually image data in this instance\r\n//         // TODO: Change this when we add PDF and MPEG support\r\n//         // See https://ohiforg.atlassian.net/browse/LT-227\r\n//         if (\r\n//           !isImage(instance.getTagValue('SOPClassUID')) &&\r\n//           !instance.getTagValue('Rows')\r\n//         ) {\r\n//           return;\r\n//         }\r\n\r\n//         const instanceMatchDetails = HPMatcher.match(\r\n//           instance,\r\n//           instanceMatchingRules\r\n//         );\r\n\r\n//         // Prevent bestMatch from being updated if the matchDetails' required attribute check has failed\r\n//         if (instanceMatchDetails.requiredFailed === true) {\r\n//           return;\r\n//         }\r\n\r\n//         const matchDetails = {\r\n//           passed: [],\r\n//           failed: [],\r\n//         };\r\n\r\n//         matchDetails.passed = matchDetails.passed.concat(\r\n//           instanceMatchDetails.details.passed\r\n//         );\r\n//         matchDetails.passed = matchDetails.passed.concat(\r\n//           seriesMatchDetails.details.passed\r\n//         );\r\n//         matchDetails.passed = matchDetails.passed.concat(\r\n//           studyMatchDetails.details.passed\r\n//         );\r\n\r\n//         matchDetails.failed = matchDetails.failed.concat(\r\n//           instanceMatchDetails.details.failed\r\n//         );\r\n//         matchDetails.failed = matchDetails.failed.concat(\r\n//           seriesMatchDetails.details.failed\r\n//         );\r\n//         matchDetails.failed = matchDetails.failed.concat(\r\n//           studyMatchDetails.details.failed\r\n//         );\r\n\r\n//         const totalMatchScore =\r\n//           instanceMatchDetails.score +\r\n//           seriesMatchDetails.score +\r\n//           studyMatchDetails.score;\r\n//         const currentSOPInstanceUID = instance.getSOPInstanceUID();\r\n\r\n//         const imageDetails = {\r\n//           StudyInstanceUID: study.getStudyInstanceUID(),\r\n//           SeriesInstanceUID: series.getSeriesInstanceUID(),\r\n//           SOPInstanceUID: currentSOPInstanceUID,\r\n//           currentImageIdIndex: index,\r\n//           matchingScore: totalMatchScore,\r\n//           matchDetails: matchDetails,\r\n//           sortingInfo: {\r\n//             score: totalMatchScore,\r\n//             study:\r\n//               instance.getTagValue('StudyDate') +\r\n//               instance.getTagValue('StudyTime'),\r\n//             series: parseInt(instance.getTagValue('SeriesNumber')), // TODO: change for seriesDateTime\r\n//             instance: parseInt(instance.getTagValue('InstanceNumber')), // TODO: change for acquisitionTime\r\n//           },\r\n//         };\r\n\r\n//         // Find the displaySet\r\n//         const displaySet = study.findDisplaySet(displaySet =>\r\n//           displaySet.images.find(\r\n//             image => image.getSOPInstanceUID() === currentSOPInstanceUID\r\n//           )\r\n//         );\r\n\r\n//         // If the instance was found, set the displaySet ID\r\n//         if (displaySet) {\r\n//           imageDetails.displaySetInstanceUID = displaySet.getUID();\r\n//           imageDetails.imageId = instance.getImageId();\r\n//         }\r\n\r\n//         matchingScores.push(imageDetails);\r\n//       });\r\n//     });\r\n//   });\r\n\r\n//   // Sort the matchingScores\r\n//   const sortingFunction = sortBy(\r\n//     {\r\n//       name: 'score',\r\n//       reverse: true,\r\n//     },\r\n//     {\r\n//       name: 'study',\r\n//       reverse: true,\r\n//     },\r\n//     {\r\n//       name: 'instance',\r\n//     },\r\n//     {\r\n//       name: 'series',\r\n//     }\r\n//   );\r\n//   matchingScores.sort((a, b) =>\r\n//     sortingFunction(a.sortingInfo, b.sortingInfo)\r\n//   );\r\n\r\n//   const bestMatch = matchingScores[0];\r\n\r\n//   log.trace('ProtocolEngine::matchImages bestMatch', bestMatch);\r\n\r\n//   return {\r\n//     bestMatch,\r\n//     matchingScores,\r\n//   };\r\n// }\r\n\r\n/**\r\n * Sets the current layout\r\n *\r\n * @param {number} numRows\r\n * @param {number} numColumns\r\n */\r\n// setLayout(numRows, numColumns) {\r\n//   if (numRows < 1 && numColumns < 1) {\r\n//     log.error(`Invalid layout ${numRows} x ${numColumns}`);\r\n//     return;\r\n//   }\r\n\r\n//   if (typeof this.options.setLayout !== 'function') {\r\n//     log.error('Hanging Protocol Engine setLayout callback is not defined');\r\n//     return;\r\n//   }\r\n\r\n//   let viewports = [];\r\n//   const numViewports = numRows * numColumns;\r\n\r\n//   for (let i = 0; i < numViewports; i++) {\r\n//     viewports.push({});\r\n//   }\r\n\r\n//   this.options.setLayout({ numRows, numColumns, viewports });\r\n// }\r\n\r\n// /**\r\n//  * Rerenders viewports that are part of the current layout manager\r\n//  * using the matching rules internal to each viewport.\r\n//  *\r\n//  * If this function is provided the index of a viewport, only the specified viewport\r\n//  * is rerendered.\r\n//  *\r\n//  * @param viewportIndex\r\n//  */\r\n// updateViewports(viewportIndex) {\r\n//   log.trace(\r\n//     `ProtocolEngine::updateViewports viewportIndex: ${viewportIndex}`\r\n//   );\r\n\r\n//   // Make sure we have an active protocol with a non-empty array of display sets\r\n//   if (!this.getNumProtocolStages()) {\r\n//     return;\r\n//   }\r\n\r\n//   // Retrieve the current stage\r\n//   const stageModel = this.getCurrentStageModel();\r\n\r\n//   // If the current stage does not fulfill the requirements to be displayed,\r\n//   // stop here.\r\n//   if (\r\n//     !stageModel ||\r\n//     !stageModel.viewportStructure ||\r\n//     !stageModel.viewports ||\r\n//     !stageModel.viewports.length\r\n//   ) {\r\n//     return;\r\n//   }\r\n\r\n//   // Retrieve the layoutTemplate associated with the current display set's viewport structure\r\n//   // If no such template name exists, stop here.\r\n//   const layoutTemplateName = stageModel.viewportStructure.getLayoutTemplateName();\r\n//   if (!layoutTemplateName) {\r\n//     return;\r\n//   }\r\n\r\n//   // Retrieve the properties associated with the current display set's viewport structure template\r\n//   // If no such layout properties exist, stop here.\r\n//   const layoutProps = stageModel.viewportStructure.properties;\r\n//   if (!layoutProps) {\r\n//     return;\r\n//   }\r\n\r\n//   // Create an empty array to store the output viewportData\r\n//   const viewportData = [];\r\n\r\n//   // Empty the matchDetails associated with the ProtocolEngine.\r\n//   // This will be used to store the pass/fail details and score\r\n//   // for each of the viewport matching procedures\r\n//   this.matchDetails = [];\r\n\r\n//   // Loop through each viewport\r\n//   stageModel.viewports.forEach((viewport, viewportIndex) => {\r\n//     const details = this.matchImages(viewport, viewportIndex);\r\n\r\n//     this.matchDetails[viewportIndex] = details;\r\n\r\n//     // Convert any YES/NO values into true/false for Cornerstone\r\n//     const cornerstoneViewportParams = {};\r\n\r\n//     // Cache viewportSettings keys\r\n//     const viewportSettingsKeys = Object.keys(viewport.viewportSettings);\r\n\r\n//     viewportSettingsKeys.forEach(key => {\r\n//       let value = viewport.viewportSettings[key];\r\n//       if (value === 'YES') {\r\n//         value = true;\r\n//       } else if (value === 'NO') {\r\n//         value = false;\r\n//       }\r\n\r\n//       cornerstoneViewportParams[key] = value;\r\n//     });\r\n\r\n//     // imageViewerViewports occasionally needs relevant layout data in order to set\r\n//     // the element style of the viewport in question\r\n//     const currentViewportData = {\r\n//       viewportIndex,\r\n//       viewport: cornerstoneViewportParams,\r\n//       ...layoutProps,\r\n//     };\r\n\r\n//     const customSettings = [];\r\n//     viewportSettingsKeys.forEach(id => {\r\n//       const setting = CustomViewportSettings[id];\r\n//       if (!setting) {\r\n//         return;\r\n//       }\r\n\r\n//       customSettings.push({\r\n//         id: id,\r\n//         value: viewport.viewportSettings[id],\r\n//       });\r\n//     });\r\n\r\n//     currentViewportData.renderedCallback = element => {\r\n//       //console.log('renderedCallback for ' + element.id);\r\n//       customSettings.forEach(customSetting => {\r\n//         log.trace(\r\n//           `ProtocolEngine::currentViewportData.renderedCallback Applying custom setting: ${customSetting.id}`\r\n//         );\r\n//         log.trace(\r\n//           `ProtocolEngine::currentViewportData.renderedCallback with value: ${customSetting.value}`\r\n//         );\r\n\r\n//         const setting = CustomViewportSettings[customSetting.id];\r\n//         setting.callback(element, customSetting.value);\r\n//       });\r\n//     };\r\n\r\n//     let currentMatch = details.bestMatch;\r\n//     let currentPosition = 1;\r\n//     const scoresLength = details.matchingScores.length;\r\n//     while (\r\n//       currentPosition < scoresLength &&\r\n//       viewportData.find(a => a.imageId === currentMatch.imageId)\r\n//     ) {\r\n//       currentMatch = details.matchingScores[currentPosition];\r\n//       currentPosition++;\r\n//     }\r\n\r\n//     if (currentMatch && currentMatch.imageId) {\r\n//       currentViewportData.StudyInstanceUID = currentMatch.StudyInstanceUID;\r\n//       currentViewportData.SeriesInstanceUID = currentMatch.SeriesInstanceUID;\r\n//       currentViewportData.SOPInstanceUID = currentMatch.SOPInstanceUID;\r\n//       currentViewportData.currentImageIdIndex =\r\n//         currentMatch.currentImageIdIndex;\r\n//       currentViewportData.displaySetInstanceUID =\r\n//         currentMatch.displaySetInstanceUID;\r\n//       currentViewportData.imageId = currentMatch.imageId;\r\n//     }\r\n\r\n//     // @TODO Why should we throw an exception when a best match is not found? This was aborting the whole process.\r\n//     // if (!currentViewportData.displaySetInstanceUID) {\r\n//     //     throw new OHIFError('ProtocolEngine::updateViewports No matching display set found?');\r\n//     // }\r\n\r\n//     viewportData.push(currentViewportData);\r\n//   });\r\n\r\n//   this.setLayout(layoutProps.Rows, layoutProps.Columns);\r\n\r\n//   if (typeof this.options.setViewportSpecificData !== 'function') {\r\n//     log.error(\r\n//       'Hanging Protocol Engine setViewportSpecificData callback is not defined'\r\n//     );\r\n//     return;\r\n//   }\r\n\r\n//   // If viewportIndex is defined, then update only that viewport\r\n//   if (viewportIndex !== undefined && viewportData[viewportIndex]) {\r\n//     this.options.setViewportSpecificData(\r\n//       viewportIndex,\r\n//       viewportData[viewportIndex]\r\n//     );\r\n//     return;\r\n//   }\r\n\r\n//   // Update all viewports\r\n//   viewportData.forEach(viewportSpecificData => {\r\n//     this.options.setViewportSpecificData(\r\n//       viewportSpecificData.viewportIndex,\r\n//       viewportSpecificData\r\n//     );\r\n//   });\r\n// }\r\n\r\n// /**\r\n//  * Sets the current Hanging Protocol to the specified Protocol\r\n//  * An optional argument can also be used to prevent the updating of the Viewports\r\n//  *\r\n//  * @param newProtocol\r\n//  * @param updateViewports\r\n//  */\r\n// setHangingProtocol(newProtocol, updateViewports = true) {\r\n//   log.trace('ProtocolEngine::setHangingProtocol newProtocol', newProtocol);\r\n//   log.trace(\r\n//     `ProtocolEngine::setHangingProtocol updateViewports = ${updateViewports}`\r\n//   );\r\n\r\n//   // Reset the array of newStageIds\r\n//   this.newStageIds = [];\r\n\r\n//   if (Protocol.prototype.isPrototypeOf(newProtocol)) {\r\n//     this.protocol = newProtocol;\r\n//   } else {\r\n//     this.protocol = new Protocol();\r\n//     this.protocol.fromObject(newProtocol);\r\n//   }\r\n\r\n//   this.stage = 0;\r\n\r\n//   // Update viewports by default\r\n//   if (updateViewports) {\r\n//     this.updateViewports();\r\n//   }\r\n// }\r\n\r\n// /**\r\n//  * Check if the next stage is available\r\n//  * @return {Boolean} True if next stage is available or false otherwise\r\n//  */\r\n// isNextStageAvailable() {\r\n//   const numberOfStages = this.getNumProtocolStages();\r\n\r\n//   return this.stage + 1 < numberOfStages;\r\n// }\r\n\r\n// /**\r\n//  * Check if the previous stage is available\r\n//  * @return {Boolean} True if previous stage is available or false otherwise\r\n//  */\r\n// isPreviousStageAvailable() {\r\n//   return this.stage - 1 >= 0;\r\n// }\r\n\r\n// /**\r\n//  * Changes the current stage to a new stage index in the display set sequence.\r\n//  * It checks if the next stage exists.\r\n//  *\r\n//  * @param {Integer} stageAction An integer value specifying wheater next (1) or previous (-1) stage\r\n//  * @return {Boolean} True if new stage has set or false, otherwise\r\n//  */\r\n// setCurrentProtocolStage(stageAction) {\r\n//   // Check if previous or next stage is available\r\n//   if (stageAction === -1 && !this.isPreviousStageAvailable()) {\r\n//     return false;\r\n//   } else if (stageAction === 1 && !this.isNextStageAvailable()) {\r\n//     return false;\r\n//   }\r\n\r\n//   // Sets the new stage\r\n//   this.stage += stageAction;\r\n\r\n//   // Log the new stage\r\n//   log.trace(`ProtocolEngine::setCurrentProtocolStage stage = ${this.stage}`);\r\n\r\n//   // Since stage has changed, we need to update the viewports\r\n//   // and redo matchings\r\n//   this.updateViewports();\r\n\r\n//   // Everything went well\r\n//   return true;\r\n// }\r\n\r\n// /**\r\n//  * Retrieves the number of Stages in the current Protocol or\r\n//  * undefined if no protocol or stages are set\r\n//  */\r\n// getNumProtocolStages() {\r\n//   if (\r\n//     !this.protocol ||\r\n//     !this.protocol.stages ||\r\n//     !this.protocol.stages.length\r\n//   ) {\r\n//     return;\r\n//   }\r\n\r\n//   return this.protocol.stages.length;\r\n// }\r\n\r\n// /**\r\n//  * Switches to the next protocol stage in the display set sequence\r\n//  */\r\n// nextProtocolStage() {\r\n//   log.trace('ProtocolEngine::nextProtocolStage');\r\n\r\n//   if (!this.setCurrentProtocolStage(1)) {\r\n//     log.trace('ProtocolEngine::nextProtocolStage failed');\r\n//   }\r\n// }\r\n\r\n// /**\r\n//  * Switches to the previous protocol stage in the display set sequence\r\n//  */\r\n// previousProtocolStage() {\r\n//   log.trace('ProtocolEngine::previousProtocolStage');\r\n\r\n//   if (!this.setCurrentProtocolStage(-1)) {\r\n//     log.trace('ProtocolEngine::previousProtocolStage failed');\r\n//   }\r\n// }\r\n// }\r\n","// Sorts an array by score\r\nconst sortByScore = arr => {\r\n  arr.sort((a, b) => {\r\n    return b.score - a.score;\r\n  });\r\n};\r\n\r\nexport { sortByScore };\r\n","import cloneDeep from 'lodash.clonedeep';\r\nimport pubSubServiceInterface from '../_shared/pubSubServiceInterface';\r\nimport sortBy from '../../utils/sortBy.js';\r\nimport ProtocolEngine from './ProtocolEngine';\r\n\r\nconst EVENTS = {\r\n  STAGE_CHANGE: 'event::hanging_protocol_stage_change',\r\n  NEW_LAYOUT: 'event::hanging_protocol_new_layout',\r\n};\r\n\r\nconst VIEWPORT_SETTING_TYPES = {\r\n  PROPS: 'props',\r\n  VIEWPORT: 'viewport',\r\n};\r\n\r\nclass HangingProtocolService {\r\n  constructor(commandsManager) {\r\n    this._commandsManager = commandsManager;\r\n    this.protocols = [];\r\n    this.ProtocolEngine = undefined;\r\n    this.protocol = undefined;\r\n    this.stage = undefined;\r\n    this.matchDetails = [];\r\n    this.hpAlreadyApplied = [];\r\n    this.studies = [];\r\n    this.customViewportSettings = [];\r\n    this.customAttributeRetrievalCallbacks = {};\r\n    this.listeners = {};\r\n    Object.defineProperty(this, 'EVENTS', {\r\n      value: EVENTS,\r\n      writable: false,\r\n      enumerable: true,\r\n      configurable: false,\r\n    });\r\n    Object.assign(this, pubSubServiceInterface);\r\n  }\r\n\r\n  reset() {\r\n    this.studies = [];\r\n    this.protocols = [];\r\n    this.hpAlreadyApplied = [];\r\n    this.matchDetails = [];\r\n    // this.ProtocolEngine.reset()\r\n  }\r\n\r\n  getState() {\r\n    return [this.matchDetails, this.hpAlreadyApplied];\r\n  }\r\n\r\n  getProtocols() {\r\n    return this.protocols;\r\n  }\r\n\r\n  addProtocols(protocols) {\r\n    protocols.forEach(protocol => {\r\n      if (this.protocols.indexOf(protocol) === -1) {\r\n        this.protocols.push(protocol);\r\n      }\r\n    });\r\n  }\r\n\r\n  run(studyMetaData, protocol) {\r\n    if (!this.studies.includes(studyMetaData)) {\r\n      this.studies.push(studyMetaData);\r\n    }\r\n    // copy here so we don't mutate it\r\n    const metaData = Object.assign({}, studyMetaData);\r\n\r\n    this.ProtocolEngine = new ProtocolEngine(\r\n      this.protocols,\r\n      this.customAttributeRetrievalCallbacks\r\n    );\r\n\r\n    // if there is no pre-defined protocol\r\n    if (!protocol || protocol.id === undefined) {\r\n      const matchedProtocol = this.ProtocolEngine.run(metaData);\r\n      this._setProtocol(matchedProtocol);\r\n      return;\r\n    }\r\n\r\n    this._setProtocol(protocol);\r\n  }\r\n\r\n  setHangingProtocolAppliedForViewport(i) {\r\n    this.hpAlreadyApplied[i] = true;\r\n  }\r\n\r\n  /**\r\n   * Adds a custom setting that can be chosen in the HangingProtocol UI and applied to a Viewport\r\n   *\r\n   * @param settingId The ID used to refer to the setting (e.g. 'displayCADMarkers')\r\n   * @param settingName The name of the setting to be displayed (e.g. 'Display CAD Markers')\r\n   * @param options\r\n   * @param callback A function to be run after a viewport is rendered with a series\r\n   */\r\n  addCustomViewportSetting(...params) {\r\n    this.customViewportSettings.push(...params);\r\n  }\r\n\r\n  /**\r\n   * Adds a custom attribute to be used in the HangingProtocol UI and matching rules, including a\r\n   * callback that will be used to calculate the attribute value.\r\n   *\r\n   * @param attributeId The ID used to refer to the attribute (e.g. 'timepointType')\r\n   * @param attributeName The name of the attribute to be displayed (e.g. 'Timepoint Type')\r\n   * @param callback The function used to calculate the attribute value from the other attributes at its level (e.g. study/series/image)\r\n   */\r\n  addCustomAttribute(attributeId, attributeName, callback) {\r\n    this.customAttributeRetrievalCallbacks[attributeId] = {\r\n      name: attributeName,\r\n      callback: callback,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Switches to the next protocol stage in the display set sequence\r\n   */\r\n  nextProtocolStage() {\r\n    console.log('ProtocolEngine::nextProtocolStage');\r\n\r\n    if (!this._setCurrentProtocolStage(1)) {\r\n      console.log('ProtocolEngine::nextProtocolStage failed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Switches to the previous protocol stage in the display set sequence\r\n   */\r\n  previousProtocolStage() {\r\n    console.log('ProtocolEngine::previousProtocolStage');\r\n\r\n    if (!this._setCurrentProtocolStage(-1)) {\r\n      console.log('ProtocolEngine::previousProtocolStage failed');\r\n    }\r\n  }\r\n\r\n  _setProtocol(protocol) {\r\n    // TODO: Add proper Protocol class to validate the protocols\r\n    // which are entered manually\r\n    this.stage = 0;\r\n    this.protocol = protocol;\r\n    this._updateViewports(protocol);\r\n  }\r\n\r\n  /**\r\n   * Retrieves the number of Stages in the current Protocol or\r\n   * undefined if no protocol or stages are set\r\n   */\r\n  _getNumProtocolStages() {\r\n    if (\r\n      !this.protocol ||\r\n      !this.protocol.stages ||\r\n      !this.protocol.stages.length\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    return this.protocol.stages.length;\r\n  }\r\n\r\n  /**\r\n   * Retrieves the current Stage from the current Protocol and stage index\r\n   *\r\n   * @returns {*} The Stage model for the currently displayed Stage\r\n   */\r\n  _getCurrentStageModel() {\r\n    return this.protocol.stages[this.stage];\r\n  }\r\n\r\n  _updateViewports() {\r\n    // Make sure we have an active protocol with a non-empty array of display sets\r\n    if (!this._getNumProtocolStages()) {\r\n      return;\r\n    }\r\n\r\n    // Retrieve the current stage\r\n    const stageModel = this._getCurrentStageModel();\r\n\r\n    // If the current stage does not fulfill the requirements to be displayed,\r\n    // stop here.\r\n    if (\r\n      !stageModel ||\r\n      !stageModel.viewportStructure ||\r\n      !stageModel.viewports ||\r\n      !stageModel.viewports.length\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // Retrieve the layoutTemplate associated with the current display set's viewport structure\r\n    // If no such template name exists, stop here.\r\n    // const layoutTemplateName = stageModel.viewportStructure.getLayoutTemplateName();\r\n    const layoutTemplateName = 'gridLayout';\r\n    if (!layoutTemplateName) {\r\n      return;\r\n    }\r\n\r\n    // Retrieve the properties associated with the current display set's viewport structure template\r\n    // If no such layout properties exist, stop here.\r\n    const layoutProps = stageModel.viewportStructure.properties;\r\n    if (!layoutProps) {\r\n      return;\r\n    }\r\n\r\n    const { columns: numCols, rows: numRows } = layoutProps;\r\n    this._broadcastChange(this.EVENTS.NEW_LAYOUT, {\r\n      numRows,\r\n      numCols,\r\n    });\r\n\r\n    // Empty the matchDetails associated with the ProtocolEngine.\r\n    // This will be used to store the pass/fail details and score\r\n    // for each of the viewport matching procedures\r\n\r\n    // Loop through each viewport\r\n    stageModel.viewports.forEach((viewport, viewportIndex) => {\r\n      this.hpAlreadyApplied.push(false);\r\n      const details = this._matchImages(viewport);\r\n\r\n      let currentMatch = details.bestMatch;\r\n\r\n      const currentViewportData = {\r\n        viewportIndex,\r\n        SeriesInstanceUID: currentMatch && currentMatch.SeriesInstanceUID,\r\n      };\r\n\r\n      // Viewport Settings\r\n      //\r\n      // protocol defined callback\r\n      const protocolCallbacks = viewport.viewportSettings.filter(\r\n        setting => setting.type === VIEWPORT_SETTING_TYPES.PROPS\r\n      );\r\n      // manually added callback\r\n      const customCallbacks = this.customViewportSettings.filter(\r\n        setting => setting.type === VIEWPORT_SETTING_TYPES.PROPS\r\n      );\r\n      const callbacks = protocolCallbacks.concat(customCallbacks);\r\n\r\n      // if we have callbacks to applied at the app level or at the HP level\r\n      if (callbacks.length) {\r\n        currentViewportData.renderedCallback = (element, ToolBarService) => {\r\n          callbacks.forEach(setting => {\r\n            const { commandName, options } = setting;\r\n            options.viewportIndex = viewportIndex;\r\n            options.element = element;\r\n            // Toolbar service to handle tool activation\r\n            if (commandName === 'setToolActive') {\r\n              ToolBarService.recordInteraction(options);\r\n              return;\r\n            }\r\n            // other commands\r\n            this._commandsManager.runCommand(commandName, options);\r\n          });\r\n        };\r\n      }\r\n\r\n      // initial viewport settings defined by protocol\r\n      const protocolInitialViewport = viewport.viewportSettings.filter(\r\n        setting => setting.type === VIEWPORT_SETTING_TYPES.VIEWPORT\r\n      );\r\n      // custom added initial viewport settings\r\n      const customInitialViewport = this.customViewportSettings.filter(\r\n        setting => setting.type === VIEWPORT_SETTING_TYPES.VIEWPORT\r\n      );\r\n      // TODO: conflict might happen between protocol and custom viewport settings\r\n      const viewportSettings = protocolInitialViewport.concat(\r\n        customInitialViewport\r\n      );\r\n\r\n      if (viewportSettings.length) {\r\n        const initialViewport = {};\r\n        viewportSettings.forEach(setting => {\r\n          const { options } = setting;\r\n          if (!options) return;\r\n          // Do not manipulate the hp settings\r\n          const viewportOptions = cloneDeep(options);\r\n          Object.entries(viewportOptions).forEach(([key, value]) => {\r\n            initialViewport[key] = value;\r\n          });\r\n        });\r\n        currentViewportData.initialViewport = initialViewport;\r\n      }\r\n\r\n      this.matchDetails[viewportIndex] = currentViewportData;\r\n    });\r\n  }\r\n\r\n  // Match images given a list of Studies and a Viewport's image matching reqs\r\n  _matchImages(viewport) {\r\n    console.log('ProtocolEngine::matchImages');\r\n\r\n    // TODO: matching is applied on study and series level, instance\r\n    // level matching needs to be added in future\r\n\r\n    const { studyMatchingRules, seriesMatchingRules } = viewport;\r\n\r\n    const matchingScores = [];\r\n    let highestStudyMatchingScore = 0;\r\n    let highestSeriesMatchingScore = 0;\r\n\r\n    this.studies.forEach(study => {\r\n      const studyMatchDetails = this.ProtocolEngine.findMatch(\r\n        study,\r\n        studyMatchingRules\r\n      );\r\n\r\n      // Prevent bestMatch from being updated if the matchDetails' required attribute check has failed\r\n      if (\r\n        studyMatchDetails.requiredFailed === true ||\r\n        studyMatchDetails.score < highestStudyMatchingScore\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      highestStudyMatchingScore = studyMatchDetails.score;\r\n\r\n      study.series.forEach(aSeries => {\r\n        const seriesMatchDetails = this.ProtocolEngine.findMatch(\r\n          aSeries,\r\n          seriesMatchingRules\r\n        );\r\n\r\n        // Prevent bestMatch from being updated if the matchDetails' required attribute check has failed\r\n        if (\r\n          seriesMatchDetails.requiredFailed === true ||\r\n          seriesMatchDetails.score < highestSeriesMatchingScore\r\n        ) {\r\n          return;\r\n        }\r\n\r\n        highestSeriesMatchingScore = seriesMatchDetails.score;\r\n\r\n        const matchDetails = {\r\n          passed: [],\r\n          failed: [],\r\n        };\r\n\r\n        matchDetails.passed = matchDetails.passed.concat(\r\n          seriesMatchDetails.details.passed\r\n        );\r\n        matchDetails.passed = matchDetails.passed.concat(\r\n          studyMatchDetails.details.passed\r\n        );\r\n\r\n        matchDetails.failed = matchDetails.failed.concat(\r\n          seriesMatchDetails.details.failed\r\n        );\r\n        matchDetails.failed = matchDetails.failed.concat(\r\n          studyMatchDetails.details.failed\r\n        );\r\n\r\n        const totalMatchScore =\r\n          seriesMatchDetails.score + studyMatchDetails.score;\r\n\r\n        const imageDetails = {\r\n          StudyInstanceUID: study.StudyInstanceUID,\r\n          SeriesInstanceUID: aSeries.SeriesInstanceUID,\r\n          matchingScore: totalMatchScore,\r\n          matchDetails: matchDetails,\r\n          sortingInfo: {\r\n            score: totalMatchScore,\r\n            study: study.StudyInstanceUID,\r\n            series: parseInt(aSeries.SeriesNumber),\r\n          },\r\n        };\r\n\r\n        matchingScores.push(imageDetails);\r\n      });\r\n    });\r\n\r\n    // Sort the matchingScores\r\n    const sortingFunction = sortBy(\r\n      {\r\n        name: 'score',\r\n        reverse: true,\r\n      },\r\n      {\r\n        name: 'study',\r\n        reverse: true,\r\n      },\r\n      {\r\n        name: 'series',\r\n      }\r\n    );\r\n    matchingScores.sort((a, b) =>\r\n      sortingFunction(a.sortingInfo, b.sortingInfo)\r\n    );\r\n\r\n    const bestMatch = matchingScores[0];\r\n\r\n    console.log('ProtocolEngine::matchImages bestMatch', bestMatch);\r\n\r\n    return {\r\n      bestMatch,\r\n      matchingScores,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Check if the next stage is available\r\n   * @return {Boolean} True if next stage is available or false otherwise\r\n   */\r\n  _isNextStageAvailable() {\r\n    const numberOfStages = this._getNumProtocolStages();\r\n\r\n    return this.stage + 1 < numberOfStages;\r\n  }\r\n\r\n  /**\r\n   * Check if the previous stage is available\r\n   * @return {Boolean} True if previous stage is available or false otherwise\r\n   */\r\n  _isPreviousStageAvailable() {\r\n    return this.stage - 1 >= 0;\r\n  }\r\n\r\n  /**\r\n   * Changes the current stage to a new stage index in the display set sequence.\r\n   * It checks if the next stage exists.\r\n   *\r\n   * @param {Integer} stageAction An integer value specifying wheater next (1) or previous (-1) stage\r\n   * @return {Boolean} True if new stage has set or false, otherwise\r\n   */\r\n  _setCurrentProtocolStage(stageAction) {\r\n    //reseting the applied protocols\r\n    this.hpAlreadyApplied = [];\r\n    // Check if previous or next stage is available\r\n    if (stageAction === -1 && !this._isPreviousStageAvailable()) {\r\n      return false;\r\n    } else if (stageAction === 1 && !this._isNextStageAvailable()) {\r\n      return false;\r\n    }\r\n\r\n    // Sets the new stage\r\n    this.stage += stageAction;\r\n\r\n    // Log the new stage\r\n    console.log(\r\n      `ProtocolEngine::setCurrentProtocolStage stage = ${this.stage}`\r\n    );\r\n\r\n    // Since stage has changed, we need to update the viewports\r\n    // and redo matchings\r\n    this._updateViewports();\r\n\r\n    // Everything went well\r\n    this._broadcastChange(this.EVENTS.STAGE_CHANGE, {\r\n      matchDetails: this.matchDetails,\r\n      hpAlreadyApplied: this.hpAlreadyApplied,\r\n    });\r\n    return true;\r\n  }\r\n  /**\r\n   * Broadcasts hanging protocols changes.\r\n   *\r\n   * @param {string} eventName The event name.add\r\n   * @param {object} eventData.source The measurement source.\r\n   * @param {object} eventData.measurement The measurement.\r\n   * @param {boolean} eventData.notYetUpdatedAtSource True if the measurement was edited\r\n   *      within the measurement service and the source needs to update.\r\n   * @return void\r\n   */\r\n  _broadcastChange(eventName, eventData) {\r\n    const hasListeners = Object.keys(this.listeners).length > 0;\r\n    const hasCallbacks = Array.isArray(this.listeners[eventName]);\r\n\r\n    if (hasListeners && hasCallbacks) {\r\n      this.listeners[eventName].forEach(listener => {\r\n        listener.callback(eventData);\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport default HangingProtocolService;\r\nexport { EVENTS };\r\n","import HangingProtocolService from './HangingProtocolService';\r\n\r\nexport default {\r\n  name: 'HangingProtocolService',\r\n  create: ({ configuration = {}, commandsManager }) => {\r\n    return new HangingProtocolService(commandsManager);\r\n  },\r\n};\r\n","import log from '../../log';\r\nimport guid from '../../utils/guid';\r\nimport pubSubServiceInterface from '../_shared/pubSubServiceInterface';\r\n\r\n/**\r\n * Measurement source schema\r\n *\r\n * @typedef {Object} MeasurementSource\r\n * @property {number} id -\r\n * @property {string} name -\r\n * @property {string} version -\r\n */\r\n\r\n/**\r\n * Measurement schema\r\n *\r\n * @typedef {Object} Measurement\r\n * @property {number} id -\r\n * @property {string} SOPInstanceUID -\r\n * @property {string} FrameOfReferenceUID -\r\n * @property {string} referenceSeriesUID -\r\n * @property {string} label -\r\n * @property {string} description -\r\n * @property {string} type -\r\n * @property {string} unit -\r\n * @property {number} area -\r\n * @property {Array} points -\r\n * @property {MeasurementSource} source -\r\n */\r\n\r\n/* Measurement schema keys for object validation. */\r\nconst MEASUREMENT_SCHEMA_KEYS = [\r\n  'id',\r\n  'SOPInstanceUID',\r\n  'FrameOfReferenceUID',\r\n  'referenceStudyUID',\r\n  'referenceSeriesUID',\r\n  'label',\r\n  'description',\r\n  'type',\r\n  'unit',\r\n  'area', // TODO: Add concept names instead (descriptor)\r\n  'mean',\r\n  'stdDev',\r\n  'length',\r\n  'shortestDiameter',\r\n  'longestDiameter',\r\n  'text', // NOTE: There is nothing like this in SR.\r\n  'points',\r\n  'source',\r\n];\r\n\r\nconst EVENTS = {\r\n  MEASUREMENT_UPDATED: 'event::measurement_updated',\r\n  INTERNAL_MEASUREMENT_UPDATED: 'event:internal_measurement_updated',\r\n  MEASUREMENT_ADDED: 'event::measurement_added',\r\n  RAW_MEASUREMENT_ADDED: 'event::raw_measurement_added',\r\n  MEASUREMENT_REMOVED: 'event::measurement_removed',\r\n  MEASUREMENTS_CLEARED: 'event::measurements_cleared',\r\n  JUMP_TO_MEASUREMENT: 'event:jump_to_measurement',\r\n};\r\n\r\nconst VALUE_TYPES = {\r\n  POLYLINE: 'value_type::polyline',\r\n  POINT: 'value_type::point',\r\n  BIDIRECTIONAL: 'value_type::shortAxisLongAxis', // TODO -> Discuss with Danny. => just using SCOORD values isn't enough here.\r\n  ELLIPSE: 'value_type::ellipse',\r\n  MULTIPOINT: 'value_type::multipoint',\r\n  CIRCLE: 'value_type::circle',\r\n};\r\n\r\nclass MeasurementService {\r\n  constructor() {\r\n    this.sources = {};\r\n    this.mappings = {};\r\n    this.measurements = {};\r\n    this.listeners = {};\r\n    this._jumpToMeasurementCache = {};\r\n    Object.defineProperty(this, 'EVENTS', {\r\n      value: EVENTS,\r\n      writable: false,\r\n      enumerable: true,\r\n      configurable: false,\r\n    });\r\n    Object.defineProperty(this, 'VALUE_TYPES', {\r\n      value: VALUE_TYPES,\r\n      writable: false,\r\n      enumerable: true,\r\n      configurable: false,\r\n    });\r\n\r\n    Object.assign(this, pubSubServiceInterface);\r\n  }\r\n\r\n  /**\r\n   * Get all measurements.\r\n   *\r\n   * @return {Measurement[]} Array of measurements\r\n   */\r\n  getMeasurements() {\r\n    const measurements = this._arrayOfObjects(this.measurements);\r\n    return (\r\n      measurements &&\r\n      measurements.map(m => this.measurements[Object.keys(m)[0]])\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get specific measurement by its id.\r\n   *\r\n   * @param {string} id Id of the measurement\r\n   * @return {Measurement} Measurement instance\r\n   */\r\n  getMeasurement(id) {\r\n    let measurement = null;\r\n    const measurements = this.measurements[id];\r\n\r\n    if (measurements && Object.keys(measurements).length > 0) {\r\n      measurement = this.measurements[id];\r\n    }\r\n\r\n    return measurement;\r\n  }\r\n\r\n  /**\r\n   * Create a new source.\r\n   *\r\n   * @param {string} name Name of the source\r\n   * @param {string} version Source name\r\n   * @return {MeasurementSource} Measurement source instance\r\n   */\r\n  createSource(name, version) {\r\n    if (!name) {\r\n      throw new Error('Source name not provided.');\r\n    }\r\n\r\n    if (!version) {\r\n      throw new Error('Source version not provided.');\r\n    }\r\n\r\n    const id = guid();\r\n    const source = {\r\n      id,\r\n      name,\r\n      version,\r\n    };\r\n    source.addOrUpdate = (definition, measurement) => {\r\n      return this.addOrUpdate(source, definition, measurement);\r\n    };\r\n    source.remove = id => {\r\n      return this.remove(id, source);\r\n    };\r\n    source.getAnnotation = (definition, measurementId) => {\r\n      return this.getAnnotation(source, definition, measurementId);\r\n    };\r\n\r\n    log.info(`New '${name}@${version}' source added.`);\r\n    this.sources[id] = source;\r\n\r\n    return source;\r\n  }\r\n\r\n  getSource(name, version) {\r\n    const { sources } = this;\r\n    const id = this._getSourceId(name, version);\r\n\r\n    return sources[id];\r\n  }\r\n\r\n  getSourceMappings(name, version) {\r\n    const { mappings } = this;\r\n    const id = this._getSourceId(name, version);\r\n\r\n    return mappings[id];\r\n  }\r\n\r\n  _getSourceId(name, version) {\r\n    const { sources } = this;\r\n\r\n    const sourceId = Object.keys(sources).find(sourceId => {\r\n      const source = sources[sourceId];\r\n\r\n      return source.name === name && source.version === version;\r\n    });\r\n\r\n    return sourceId;\r\n  }\r\n\r\n  /**\r\n   * Add a new measurement matching criteria along with mapping functions.\r\n   *\r\n   * @param {MeasurementSource} source Measurement source instance\r\n   * @param {string} definition Definition of the measurement (Annotation Type)\r\n   * @param {MatchingCriteria} matchingCriteria The matching criteria\r\n   * @param {Function} toSourceSchema Mapping function to source schema\r\n   * @param {Function} toMeasurementSchema Mapping function to measurement schema\r\n   * @return void\r\n   */\r\n  addMapping(\r\n    source,\r\n    definition,\r\n    matchingCriteria,\r\n    toSourceSchema,\r\n    toMeasurementSchema\r\n  ) {\r\n    if (!this._isValidSource(source)) {\r\n      throw new Error('Invalid source.');\r\n    }\r\n\r\n    if (!matchingCriteria) {\r\n      throw new Error('Matching criteria not provided.');\r\n    }\r\n\r\n    if (!definition) {\r\n      throw new Error('Definition not provided.');\r\n    }\r\n\r\n    if (!toSourceSchema) {\r\n      throw new Error('Mapping function to source schema not provided.');\r\n    }\r\n\r\n    if (!toMeasurementSchema) {\r\n      throw new Error('Measurement mapping function not provided.');\r\n    }\r\n\r\n    const mapping = {\r\n      matchingCriteria,\r\n      definition,\r\n      toSourceSchema,\r\n      toMeasurementSchema,\r\n    };\r\n\r\n    if (Array.isArray(this.mappings[source.id])) {\r\n      this.mappings[source.id].push(mapping);\r\n    } else {\r\n      this.mappings[source.id] = [mapping];\r\n    }\r\n\r\n    log.info(\r\n      `New measurement mapping added to source '${this._getSourceInfo(\r\n        source\r\n      )}'.`\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get annotation for specific source.\r\n   *\r\n   * @param {MeasurementSource} source Measurement source instance\r\n   * @param {string} definition The source definition\r\n   * @param {string} measurementId The measurement service measurement id\r\n   * @return {Object} Source measurement schema\r\n   */\r\n  getAnnotation(source, definition, measurementId) {\r\n    if (!this._isValidSource(source)) {\r\n      log.warn('Invalid source. Exiting early.');\r\n      return;\r\n    }\r\n\r\n    if (!definition) {\r\n      log.warn('No source definition provided. Exiting early.');\r\n      return;\r\n    }\r\n\r\n    const mapping = this._getMappingByMeasurementSource(\r\n      measurementId,\r\n      definition\r\n    );\r\n    const measurement = this.getMeasurement(measurementId);\r\n    if (mapping) return mapping.toSourceSchema(measurement, definition);\r\n\r\n    const matchingMapping = this._getMatchingMapping(\r\n      source,\r\n      definition,\r\n      measurement\r\n    );\r\n\r\n    if (matchingMapping) {\r\n      log.info('Matching mapping found:', matchingMapping);\r\n      const { toSourceSchema, definition } = matchingMapping;\r\n      return toSourceSchema(measurement, definition);\r\n    }\r\n  }\r\n\r\n  update(id, measurement, notYetUpdatedAtSource = false) {\r\n    if (this.measurements[id]) {\r\n      const updatedMeasurement = {\r\n        ...measurement,\r\n        modifiedTimestamp: Math.floor(Date.now() / 1000),\r\n      };\r\n\r\n      log.info(\r\n        `Updating internal measurement representation...`,\r\n        updatedMeasurement\r\n      );\r\n\r\n      this.measurements[id] = updatedMeasurement;\r\n\r\n      this._broadcastEvent(\r\n        // Add an internal flag to say the measurement has not yet been updated at source.\r\n        this.EVENTS.MEASUREMENT_UPDATED,\r\n        {\r\n          source: measurement.source,\r\n          measurement: updatedMeasurement,\r\n          notYetUpdatedAtSource,\r\n        }\r\n      );\r\n\r\n      return updatedMeasurement.id;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a raw measurement into a source so that it may be\r\n   * Converted to/from annotation in the same way. E.g. import serialized data\r\n   * Of the same form as the measurement source.\r\n   * @param {MeasurementSource} source The measurement source instance.\r\n   * @param {string} definition The source definition you want to add the measurement to.\r\n   * @param {object} data The data you wish to add to the source.\r\n   * @param {function} toMeasurementSchema A function to get the `data` into the same shape as the source definition.\r\n   */\r\n  addRawMeasurement(\r\n    source,\r\n    definition,\r\n    data,\r\n    toMeasurementSchema,\r\n    dataSource = {}\r\n  ) {\r\n    if (!this._isValidSource(source)) {\r\n      log.warn('Invalid source. Exiting early.');\r\n      return;\r\n    }\r\n\r\n    const sourceInfo = this._getSourceInfo(source);\r\n\r\n    if (!definition) {\r\n      log.warn('No source definition provided. Exiting early.');\r\n      return;\r\n    }\r\n\r\n    if (!this._sourceHasMappings(source)) {\r\n      log.warn(\r\n        `No measurement mappings found for '${sourceInfo}' source. Exiting early.`\r\n      );\r\n      return;\r\n    }\r\n\r\n    let measurement = {};\r\n    try {\r\n      /* Convert measurement */\r\n      measurement = toMeasurementSchema(data);\r\n      /* Assign measurement source instance */\r\n      measurement.source = source;\r\n    } catch (error) {\r\n      log.warn(\r\n        `Failed to map '${sourceInfo}' measurement for definition ${definition}:`,\r\n        error.message\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (!this._isValidMeasurement(measurement)) {\r\n      log.warn(\r\n        `Attempting to add or update a invalid measurement provided by '${sourceInfo}'. Exiting early.`\r\n      );\r\n      return;\r\n    }\r\n\r\n    let internalId = data.id;\r\n    if (!internalId) {\r\n      internalId = guid();\r\n      log.warn(`Measurement ID not found. Generating UID: ${internalId}`);\r\n    }\r\n\r\n    const newMeasurement = {\r\n      ...measurement,\r\n      modifiedTimestamp: Math.floor(Date.now() / 1000),\r\n      id: internalId,\r\n    };\r\n\r\n    if (this.measurements[internalId]) {\r\n      log.info(\r\n        `Measurement already defined. Updating measurement.`,\r\n        newMeasurement\r\n      );\r\n      this.measurements[internalId] = newMeasurement;\r\n      this._broadcastEvent(this.EVENTS.MEASUREMENT_UPDATED, {\r\n        source,\r\n        measurement: newMeasurement,\r\n      });\r\n    } else {\r\n      log.info(`Measurement added.`, newMeasurement);\r\n      this.measurements[internalId] = newMeasurement;\r\n      this._broadcastEvent(this.EVENTS.RAW_MEASUREMENT_ADDED, {\r\n        source,\r\n        measurement: newMeasurement,\r\n        data,\r\n        dataSource,\r\n      });\r\n    }\r\n\r\n    return newMeasurement.id;\r\n  }\r\n\r\n  /**\r\n   * Adds or update persisted measurements.\r\n   *\r\n   * @param {MeasurementSource} source The measurement source instance\r\n   * @param {string} definition The source definition\r\n   * @param {Measurement} measurement The source measurement\r\n   * @return {string} A measurement id\r\n   */\r\n  addOrUpdate(source, definition, sourceMeasurement) {\r\n    if (!this._isValidSource(source)) {\r\n      throw new Error('Invalid source.');\r\n    }\r\n\r\n    if (!definition) {\r\n      throw new Error('No source definition provided.');\r\n    }\r\n\r\n    const sourceInfo = this._getSourceInfo(source);\r\n\r\n    if (!this._sourceHasMappings(source)) {\r\n      throw new Error(\r\n        `No measurement mappings found for '${sourceInfo}' source. Exiting early.`\r\n      );\r\n    }\r\n\r\n    let measurement = {};\r\n    try {\r\n      const sourceMappings = this.mappings[source.id];\r\n      const { toMeasurementSchema } = sourceMappings.find(\r\n        mapping => mapping.definition === definition\r\n      );\r\n\r\n      /* Convert measurement */\r\n      measurement = toMeasurementSchema(sourceMeasurement);\r\n\r\n      /* Assign measurement source instance */\r\n      measurement.source = source;\r\n    } catch (error) {\r\n      throw new Error(\r\n        `Failed to map '${sourceInfo}' measurement for definition ${definition}:`,\r\n        error.message\r\n      );\r\n    }\r\n\r\n    if (!this._isValidMeasurement(measurement)) {\r\n      throw new Error(\r\n        `Attempting to add or update a invalid measurement provided by '${sourceInfo}'. Exiting early.`\r\n      );\r\n    }\r\n\r\n    let internalId = sourceMeasurement.id;\r\n    if (!internalId) {\r\n      internalId = guid();\r\n      log.info(`Measurement ID not found. Generating UID: ${internalId}`);\r\n    }\r\n\r\n    const newMeasurement = {\r\n      ...measurement,\r\n      modifiedTimestamp: Math.floor(Date.now() / 1000),\r\n      id: internalId,\r\n    };\r\n\r\n    if (this.measurements[internalId]) {\r\n      log.info(\r\n        `Measurement already defined. Updating measurement.`,\r\n        newMeasurement\r\n      );\r\n      this.measurements[internalId] = newMeasurement;\r\n      this._broadcastEvent(this.EVENTS.MEASUREMENT_UPDATED, {\r\n        source,\r\n        measurement: newMeasurement,\r\n        notYetUpdatedAtSource: false,\r\n      });\r\n    } else {\r\n      log.info('Measurement added.', newMeasurement);\r\n      this.measurements[internalId] = newMeasurement;\r\n      this._broadcastEvent(this.EVENTS.MEASUREMENT_ADDED, {\r\n        source,\r\n        measurement: newMeasurement,\r\n      });\r\n    }\r\n\r\n    return newMeasurement.id;\r\n  }\r\n\r\n  /**\r\n   * Removes a measurement and broadcasts the removed event.\r\n   *\r\n   * @param {string} id The measurement id\r\n   * @param {MeasurementSource} source The measurement source instance\r\n   * @return {string} The removed measurement id\r\n   */\r\n  remove(id, source) {\r\n    if (!id || !this.measurements[id]) {\r\n      log.warn(`No id provided, or unable to find measurement by id.`);\r\n      return;\r\n    }\r\n\r\n    delete this.measurements[id];\r\n    this._broadcastEvent(this.EVENTS.MEASUREMENT_REMOVED, {\r\n      source,\r\n      measurement: id, // This is weird :shrug:\r\n    });\r\n  }\r\n\r\n  clearMeasurements() {\r\n    this.measurements = {};\r\n    this._jumpToMeasurementCache = {};\r\n    this._broadcastEvent(this.EVENTS.MEASUREMENTS_CLEARED);\r\n  }\r\n\r\n  jumpToMeasurement(viewportIndex, id) {\r\n    const measurement = this.measurements[id];\r\n\r\n    if (!measurement) {\r\n      log.warn(`No id provided, or unable to find measurement by id.`);\r\n      return;\r\n    }\r\n\r\n    this._addJumpToMeasurement(viewportIndex, id);\r\n\r\n    const eventName = this.EVENTS.JUMP_TO_MEASUREMENT;\r\n\r\n    const hasListeners = Object.keys(this.listeners).length > 0;\r\n    const hasCallbacks = Array.isArray(this.listeners[eventName]);\r\n\r\n    if (hasListeners && hasCallbacks) {\r\n      this.listeners[eventName].forEach(listener => {\r\n        listener.callback({ viewportIndex, measurement });\r\n      });\r\n    }\r\n  }\r\n\r\n  _addJumpToMeasurement(viewportIndex, id) {\r\n    this._jumpToMeasurementCache[viewportIndex] = id;\r\n  }\r\n\r\n  getJumpToMeasurement(viewportIndex) {\r\n    return this._jumpToMeasurementCache[viewportIndex];\r\n  }\r\n\r\n  removeJumpToMeasurement(viewportIndex) {\r\n    delete this._jumpToMeasurementCache[viewportIndex];\r\n  }\r\n\r\n  _getMappingByMeasurementSource(measurementId, definition) {\r\n    const measurement = this.getMeasurement(measurementId);\r\n    if (this._isValidSource(measurement.source)) {\r\n      return this.mappings[measurement.source.id].find(\r\n        m => m.definition === definition\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all measurements and broadcasts cleared event.\r\n   */\r\n  clear() {\r\n    this.measurements = {};\r\n    this._broadcastEvent(this.EVENTS.MEASUREMENTS_CLEARED);\r\n  }\r\n\r\n  /**\r\n   * Get measurement mapping function if matching criteria.\r\n   *\r\n   * @param {MeasurementSource} source Measurement source instance\r\n   * @param {string} definition The source definition\r\n   * @param {Measurement} measurement The measurement service measurement\r\n   * @return {Object} The mapping based on matched criteria\r\n   */\r\n  _getMatchingMapping(source, definition, measurement) {\r\n    const sourceMappings = this.mappings[source.id];\r\n\r\n    const sourceMappingsByDefinition = sourceMappings.filter(\r\n      mapping => mapping.definition === definition\r\n    );\r\n\r\n    /* Criteria Matching */\r\n    return sourceMappingsByDefinition.find(({ matchingCriteria }) => {\r\n      return (\r\n        measurement.points &&\r\n        measurement.points.length === matchingCriteria.points\r\n      );\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns formatted string with source info.\r\n   *\r\n   * @param {MeasurementSource} source Measurement source\r\n   * @return {string} Source information\r\n   */\r\n  _getSourceInfo(source) {\r\n    return `${source.name}@${source.version}`;\r\n  }\r\n\r\n  /**\r\n   * Checks if given source is valid.\r\n   *\r\n   * @param {MeasurementSource} source Measurement source\r\n   * @return {boolean} Measurement source validation\r\n   */\r\n  _isValidSource(source) {\r\n    return source && this.sources[source.id];\r\n  }\r\n\r\n  /**\r\n   * Checks if a given source has mappings.\r\n   *\r\n   * @param {MeasurementSource} source The measurement source\r\n   * @return {boolean} Validation if source has mappings\r\n   */\r\n  _sourceHasMappings(source) {\r\n    return (\r\n      Array.isArray(this.mappings[source.id]) && this.mappings[source.id].length\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Check if a given measurement data is valid.\r\n   *\r\n   * @param {Measurement} measurementData Measurement data\r\n   * @return {boolean} Measurement validation\r\n   */\r\n  _isValidMeasurement(measurementData) {\r\n    Object.keys(measurementData).forEach(key => {\r\n      if (!MEASUREMENT_SCHEMA_KEYS.includes(key)) {\r\n        log.warn(`Invalid measurement key: ${key}`);\r\n        return false;\r\n      }\r\n    });\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Check if a given measurement service event is valid.\r\n   *\r\n   * @param {string} eventName The name of the event\r\n   * @return {boolean} Event name validation\r\n  //  */\r\n  // _isValidEvent(eventName) {\r\n  //   return Object.values(this.EVENTS).includes(eventName);\r\n  // }\r\n\r\n  /**\r\n   * Converts object of objects to array.\r\n   *\r\n   * @return {Array} Array of objects\r\n   */\r\n  _arrayOfObjects = obj => {\r\n    return Object.entries(obj).map(e => ({ [e[0]]: e[1] }));\r\n  };\r\n}\r\n\r\nexport default MeasurementService;\r\nexport { EVENTS, VALUE_TYPES };\r\n","import MeasurementService from './MeasurementService';\r\n\r\nexport default {\r\n  name: 'MeasurementService',\r\n  create: ({ configuration = {} }) => {\r\n    return new MeasurementService();\r\n  },\r\n};\r\n","import log from './../log.js';\r\n\r\nexport default class ServicesManager {\r\n  constructor(commandsManager) {\r\n    this._commandsManager = commandsManager;\r\n    this.services = {};\r\n    this.registeredServiceNames = [];\r\n  }\r\n\r\n  /**\r\n   * Registers a new service.\r\n   *\r\n   * @param {Object} service\r\n   * @param {Object} configuration\r\n   */\r\n  registerService(service, configuration = {}) {\r\n    if (!service) {\r\n      log.warn(\r\n        'Attempting to register a null/undefined service. Exiting early.'\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (!service.name) {\r\n      log.warn(`Service name not set. Exiting early.`);\r\n      return;\r\n    }\r\n\r\n    if (this.registeredServiceNames.includes(service.name)) {\r\n      log.warn(\r\n        `Service name ${service.name} has already been registered. Exiting before duplicating services.`\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (service.create) {\r\n      this.services[service.name] = service.create({\r\n        configuration,\r\n        commandsManager: this._commandsManager,\r\n      });\r\n    } else {\r\n      log.warn(`Service create factory function not defined. Exiting early.`);\r\n      return;\r\n    }\r\n\r\n    /* Track service registration */\r\n    this.registeredServiceNames.push(service.name);\r\n  }\r\n\r\n  /**\r\n   * An array of services, or an array of arrays that contains service\r\n   * configuration pairs.\r\n   *\r\n   * @param {Object[]} services - Array of services\r\n   */\r\n  registerServices(services) {\r\n    services.forEach(service => {\r\n      const hasConfiguration = Array.isArray(service);\r\n\r\n      if (hasConfiguration) {\r\n        const [ohifService, configuration] = service;\r\n        this.registerService(ohifService, configuration);\r\n      } else {\r\n        this.registerService(service);\r\n      }\r\n    });\r\n  }\r\n}\r\n","import merge from 'lodash.merge';\r\nimport pubSubServiceInterface from '../_shared/pubSubServiceInterface';\r\n\r\nconst EVENTS = {\r\n  TOOL_BAR_MODIFIED: 'event::toolBarService:toolBarModified',\r\n  TOOL_BAR_STATE_MODIFIED: 'event::toolBarService:toolBarStateModified',\r\n};\r\n\r\nexport default class ToolBarService {\r\n  constructor(commandsManager) {\r\n    this._commandsManager = commandsManager;\r\n    //\r\n    this.EVENTS = EVENTS;\r\n    this.listeners = {};\r\n    this.buttons = {};\r\n    this.unsubscriptions = []; // if tools need to unsubscribe from events\r\n    this.buttonSections = {\r\n      /**\r\n       * primary: ['Zoom', 'Wwwc'],\r\n       * secondary: ['Length', 'RectangleRoi']\r\n       */\r\n    };\r\n\r\n    // TODO: Do we need to track per context? Or do we allow for a mixed\r\n    // definition that adapts based on context?\r\n    this.state = {\r\n      primaryToolId: 'Wwwc',\r\n      toggles: {\r\n        /* id: true/false */\r\n      },\r\n      groups: {\r\n        /* track most recent click per group...? */\r\n      },\r\n    };\r\n\r\n    Object.assign(this, pubSubServiceInterface);\r\n  }\r\n\r\n  init(extensionManager) {\r\n    this.extensionManager = extensionManager;\r\n  }\r\n\r\n  reset() {\r\n    this.unsubscriptions.forEach(unsub => unsub());\r\n    this.state = {\r\n      primaryToolId: 'Wwwc',\r\n      toggles: {},\r\n      groups: {},\r\n    };\r\n    this.unsubscriptions = [];\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {*} interaction\r\n   */\r\n  recordInteraction(interaction) {\r\n    const commandsManager = this._commandsManager;\r\n    const { groupId, itemId, interactionType, commandName, commandOptions } = interaction;\r\n\r\n    switch (interactionType) {\r\n      case 'action': {\r\n        break;\r\n      }\r\n      case 'tool': {\r\n        this.state.primaryToolId = itemId;\r\n        // TODO: Force run this for all contexts? Even inactive?\r\n        // or... They'll just detect primaryToolId when they spin up and apply...\r\n        commandsManager.runCommand('setToolActive', commandOptions);\r\n        break;\r\n      }\r\n      case 'toggle': {\r\n        this.state.toggles[itemId] =\r\n          this.state.toggles[itemId] === undefined\r\n            ? true\r\n            : !this.state.toggles[itemId];\r\n        if (commandOptions) {\r\n          commandOptions.toggledState = this.state.toggles[itemId];\r\n        }\r\n        break;\r\n      }\r\n      default:\r\n        throw new Error(`Invalid interaction type: ${interactionType}`);\r\n    }\r\n\r\n    // Run command if there's one associated\r\n    //\r\n    // NOTE: Should probably just do this for tools as well?\r\n    // But would be nice if we could enforce at least the command name?\r\n    let unsubscribe;\r\n    if (commandName) {\r\n      unsubscribe = commandsManager.runCommand(commandName, commandOptions);\r\n    }\r\n\r\n    // Storing the unsubscribe for later reseting\r\n    if (unsubscribe && typeof unsubscribe === 'function') {\r\n      if (this.unsubscriptions.indexOf(unsubscribe) === -1) {\r\n        this.unsubscriptions.push(unsubscribe);\r\n      }\r\n    }\r\n\r\n    // Track last touched id for each group\r\n    if (groupId) {\r\n      this.state.groups[groupId] = itemId;\r\n    }\r\n\r\n    this._broadcastEvent(this.EVENTS.TOOL_BAR_STATE_MODIFIED, {});\r\n  }\r\n\r\n  getButtons() {\r\n    return this.buttons;\r\n  }\r\n\r\n  getActiveTools() {\r\n    return [this.state.primaryToolId, ...Object.keys(this.state.toggles)];\r\n  }\r\n\r\n  setButton(id, button) {\r\n    if (this.buttons[id]) {\r\n      this.buttons[id] = merge(this.buttons[id], button);\r\n      this._broadcastEvent(this.EVENTS.TOOL_BAR_MODIFIED, {\r\n        buttons: this.buttons,\r\n        button: this.buttons[id],\r\n        buttonSections: this.buttonSections,\r\n      });\r\n    }\r\n  }\r\n\r\n  setButtons(buttons) {\r\n    this.buttons = buttons;\r\n    this._broadcastEvent(this.EVENTS.TOOL_BAR_MODIFIED, {\r\n      buttons: this.buttons,\r\n      buttonSections: this.buttonSections,\r\n    });\r\n  }\r\n\r\n  _buttonTypes() {\r\n    const buttonTypes = {};\r\n    const registeredToolbarModules = this.extensionManager.modules[\r\n      'toolbarModule'\r\n    ];\r\n\r\n    if (\r\n      Array.isArray(registeredToolbarModules) &&\r\n      registeredToolbarModules.length\r\n    ) {\r\n      registeredToolbarModules.forEach(toolbarModule =>\r\n        toolbarModule.module.forEach(def => {\r\n          buttonTypes[def.name] = def;\r\n        })\r\n      );\r\n    }\r\n\r\n    return buttonTypes;\r\n  }\r\n\r\n  createButtonSection(key, buttons) {\r\n    // Maybe do this mapping at time of return, instead of time of create\r\n    // Props check important for validation here...\r\n\r\n    this.buttonSections[key] = buttons;\r\n    this._broadcastEvent(this.EVENTS.TOOL_BAR_MODIFIED, {});\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Finds a button section by it's name, then maps the list of string name\r\n   * identifiers to schema/values that can be used to render the buttons.\r\n   *\r\n   * @param {string} key\r\n   * @param {*} props\r\n   */\r\n  getButtonSection(key, props) {\r\n    const buttonSectionIds = this.buttonSections[key];\r\n    const buttonsInSection = [];\r\n\r\n    if (buttonSectionIds && buttonSectionIds.length !== 0) {\r\n      buttonSectionIds.forEach(btnId => {\r\n        const btn = this.buttons[btnId];\r\n        const metadata = {};\r\n        const mappedBtn = this._mapButtonToDisplay(btn, key, metadata, props);\r\n\r\n        buttonsInSection.push(mappedBtn);\r\n      });\r\n    }\r\n\r\n    return buttonsInSection;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {object[]} buttons\r\n   * @param {string} buttons[].id\r\n   */\r\n  addButtons(buttons) {\r\n    buttons.forEach(button => {\r\n      if (!this.buttons[button.id]) {\r\n        this.buttons[button.id] = button;\r\n      }\r\n    });\r\n\r\n    this._broadcastEvent(this.EVENTS.TOOL_BAR_MODIFIED, {});\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {*} btn\r\n   * @param {*} btnSection\r\n   * @param {*} metadata\r\n   * @param {*} props - Props set by the Viewer layer\r\n   */\r\n  _mapButtonToDisplay(btn, btnSection, metadata, props) {\r\n    const { id, type, component } = btn;\r\n    const buttonType = this._buttonTypes()[type];\r\n\r\n    if (!buttonType) {\r\n      return;\r\n    }\r\n\r\n    return {\r\n      id,\r\n      Component: component || buttonType.defaultComponent,\r\n      componentProps: Object.assign({}, btn.props, props),\r\n    };\r\n  }\r\n}\r\n","import ToolBarService from './ToolBarService';\r\n\r\nexport default {\r\n  name: 'ToolBarService',\r\n  create: ({ configuration = {}, commandsManager }) => {\r\n    return new ToolBarService(commandsManager);\r\n  },\r\n};\r\n","/**\r\n * A UI Element Position\r\n *\r\n * @typedef {Object} ElementPosition\r\n * @property {number} top -\r\n * @property {number} left -\r\n * @property {number} right -\r\n * @property {number} bottom -\r\n */\r\n\r\n/**\r\n * UI Dialog\r\n *\r\n * @typedef {Object} DialogProps\r\n * @property {string} id The dialog id.\r\n * @property {ReactElement|HTMLElement} content The dialog content.\r\n * @property {Object} contentProps The dialog content props.\r\n * @property {boolean} [isDraggable=true] Controls if dialog content is draggable or not.\r\n * @property {boolean} [showOverlay=false] Controls dialog overlay.\r\n * @property {boolean} [centralize=false] Center the dialog on the screen.\r\n * @property {boolean} [preservePosition=true] Use last position instead of default.\r\n * @property {ElementPosition} defaultPosition Specifies the `x` and `y` that the dragged item should start at.\r\n * @property {Function} onStart Called when dragging starts. If `false` is returned any handler, the action will cancel.\r\n * @property {Function} onStop Called when dragging stops.\r\n * @property {Function} onDrag Called while dragging.\r\n */\r\n\r\nconst name = 'UIDialogService';\r\n\r\nconst publicAPI = {\r\n  name,\r\n  dismiss: _dismiss,\r\n  dismissAll: _dismissAll,\r\n  create: _create,\r\n  setServiceImplementation,\r\n};\r\n\r\nconst serviceImplementation = {\r\n  _dismiss: () => console.warn('dismiss() NOT IMPLEMENTED'),\r\n  _dismissAll: () => console.warn('dismissAll() NOT IMPLEMENTED'),\r\n  _create: () => console.warn('create() NOT IMPLEMENTED'),\r\n};\r\n\r\n/**\r\n * Show a new UI dialog;\r\n *\r\n * @param {DialogProps} props { id, content, contentProps, onStart, onDrag, onStop, centralize, isDraggable, showOverlay, preservePosition, defaultPosition }\r\n */\r\nfunction _create({\r\n  id,\r\n  content,\r\n  contentProps,\r\n  onStart,\r\n  onDrag,\r\n  onStop,\r\n  centralize = false,\r\n  preservePosition = true,\r\n  isDraggable = true,\r\n  showOverlay = false,\r\n  onClickOutside,\r\n  defaultPosition,\r\n}) {\r\n  return serviceImplementation._create({\r\n    id,\r\n    content,\r\n    contentProps,\r\n    onStart,\r\n    onDrag,\r\n    onStop,\r\n    centralize,\r\n    preservePosition,\r\n    isDraggable,\r\n    onClickOutside,\r\n    showOverlay,\r\n    defaultPosition,\r\n  });\r\n}\r\n\r\n/**\r\n * Destroys all dialogs, if any\r\n *\r\n * @returns void\r\n */\r\nfunction _dismissAll() {\r\n  return serviceImplementation._dismissAll();\r\n}\r\n\r\n/**\r\n * Destroy the dialog, if currently created\r\n *\r\n * @returns void\r\n */\r\nfunction _dismiss({ id }) {\r\n  return serviceImplementation._dismiss({ id });\r\n}\r\n\r\n/**\r\n *\r\n *\r\n * @param {*} {\r\n *   dismiss: dismissImplementation,\r\n *   dismissAll: dismissAllImplementation,\r\n *   create: createImplementation,\r\n * }\r\n */\r\nfunction setServiceImplementation({\r\n  dismiss: dismissImplementation,\r\n  dismissAll: dismissAllImplementation,\r\n  create: createImplementation,\r\n}) {\r\n  if (dismissImplementation) {\r\n    serviceImplementation._dismiss = dismissImplementation;\r\n  }\r\n  if (dismissAllImplementation) {\r\n    serviceImplementation._dismissAll = dismissAllImplementation;\r\n  }\r\n  if (createImplementation) {\r\n    serviceImplementation._create = createImplementation;\r\n  }\r\n}\r\n\r\nexport default {\r\n  name,\r\n  create: ({ configuration = {} }) => {\r\n    return publicAPI;\r\n  },\r\n};\r\n","/**\r\n * UI Modal\r\n *\r\n * @typedef {Object} ModalProps\r\n * @property {ReactElement|HTMLElement} [content=null] Modal content.\r\n * @property {Object} [contentProps=null] Modal content props.\r\n * @property {boolean} [shouldCloseOnEsc=false] Modal is dismissible via the esc key.\r\n * @property {boolean} [isOpen=true] Make the Modal visible or hidden.\r\n * @property {boolean} [closeButton=true] Should the modal body render the close button.\r\n * @property {string} [title=null] Should the modal render the title independently of the body content.\r\n * @property {string} [customClassName=null] The custom class to style the modal.\r\n */\r\n\r\nconst name = 'UIModalService';\r\n\r\nconst publicAPI = {\r\n  name,\r\n  hide: _hide,\r\n  show: _show,\r\n  setServiceImplementation,\r\n};\r\n\r\nconst serviceImplementation = {\r\n  _hide: () => console.warn('hide() NOT IMPLEMENTED'),\r\n  _show: () => console.warn('show() NOT IMPLEMENTED'),\r\n};\r\n\r\n/**\r\n * Show a new UI modal;\r\n *\r\n * @param {ModalProps} props { content, contentProps, shouldCloseOnEsc, isOpen, closeButton, title, customClassName }\r\n */\r\nfunction _show({\r\n  content = null,\r\n  contentProps = null,\r\n  shouldCloseOnEsc = true,\r\n  isOpen = true,\r\n  closeButton = true,\r\n  title = null,\r\n  customClassName = null,\r\n}) {\r\n  return serviceImplementation._show({\r\n    content,\r\n    contentProps,\r\n    shouldCloseOnEsc,\r\n    isOpen,\r\n    closeButton,\r\n    title,\r\n    customClassName,\r\n  });\r\n}\r\n\r\n/**\r\n * Hides/dismisses the modal, if currently shown\r\n *\r\n * @returns void\r\n */\r\nfunction _hide() {\r\n  return serviceImplementation._hide();\r\n}\r\n\r\n/**\r\n *\r\n *\r\n * @param {*} {\r\n *   hide: hideImplementation,\r\n *   show: showImplementation,\r\n * }\r\n */\r\nfunction setServiceImplementation({\r\n  hide: hideImplementation,\r\n  show: showImplementation,\r\n}) {\r\n  if (hideImplementation) {\r\n    serviceImplementation._hide = hideImplementation;\r\n  }\r\n  if (showImplementation) {\r\n    serviceImplementation._show = showImplementation;\r\n  }\r\n}\r\n\r\nexport default {\r\n  name,\r\n  create: ({ configuration = {} }) => {\r\n    return publicAPI;\r\n  },\r\n};\r\n","/**\r\n * A UI Notification\r\n *\r\n * @typedef {Object} Notification\r\n * @property {string} title -\r\n * @property {string} message -\r\n * @property {number} [duration=5000] - in ms\r\n * @property {string} [position=\"bottomRight\"] -\"topLeft\" | \"topCenter | \"topRight\" | \"bottomLeft\" | \"bottomCenter\" | \"bottomRight\"\r\n * @property {string} [type=\"info\"] - \"info\" | \"error\" | \"warning\" | \"success\"\r\n * @property {boolean} [autoClose=true]\r\n */\r\n\r\nconst name = 'UINotificationService';\r\n\r\nconst serviceShowRequestQueue = [];\r\n\r\nconst publicAPI = {\r\n  name,\r\n  hide: _hide,\r\n  show: _show,\r\n  setServiceImplementation,\r\n};\r\n\r\nconst serviceImplementation = {\r\n  _hide: () => console.warn('hide() NOT IMPLEMENTED'),\r\n  _show: showArguments => {\r\n    serviceShowRequestQueue.push(showArguments);\r\n\r\n    console.warn('show() NOT IMPLEMENTED');\r\n  },\r\n};\r\n\r\n/**\r\n * Create and show a new UI notification; returns the\r\n * ID of the created notification.\r\n *\r\n * @param {Notification} notification { title, message, duration, position, type, autoClose}\r\n * @returns {number} id\r\n */\r\nfunction _show({\r\n  title,\r\n  message,\r\n  duration = 5000,\r\n  position = 'bottomRight',\r\n  type = 'info',\r\n  autoClose = true,\r\n}) {\r\n  return serviceImplementation._show({\r\n    title,\r\n    message,\r\n    duration,\r\n    position,\r\n    type,\r\n    autoClose,\r\n  });\r\n}\r\n\r\n/**\r\n * Hides/dismisses the notification, if currently shown\r\n *\r\n * @param {number} id - id of the notification to hide/dismiss\r\n * @returns undefined\r\n */\r\nfunction _hide(id) {\r\n  return serviceImplementation._hide({ id });\r\n}\r\n\r\n/**\r\n *\r\n *\r\n * @param {*} {\r\n *   hide: hideImplementation,\r\n *   show: showImplementation,\r\n * }\r\n */\r\nfunction setServiceImplementation({\r\n  hide: hideImplementation,\r\n  show: showImplementation,\r\n}) {\r\n  if (hideImplementation) {\r\n    serviceImplementation._hide = hideImplementation;\r\n  }\r\n  if (showImplementation) {\r\n    serviceImplementation._show = showImplementation;\r\n\r\n    while (serviceShowRequestQueue.length > 0) {\r\n      const showArguments = serviceShowRequestQueue.pop();\r\n      serviceImplementation._show(showArguments);\r\n    }\r\n  }\r\n}\r\n\r\nexport default {\r\n  name,\r\n  create: ({ configuration = {} }) => {\r\n    return publicAPI;\r\n  },\r\n};\r\n","/**\r\n * Viewport Dialog\r\n *\r\n * @typedef {Object} ViewportDialogProps\r\n * @property {ReactElement|HTMLElement} [content=null] Modal content.\r\n * @property {Object} [contentProps=null] Modal content props.\r\n * @property {boolean} [viewportIndex=false] Modal is dismissible via the esc key.\r\n */\r\n\r\nconst name = 'UIViewportDialogService';\r\n\r\nconst publicAPI = {\r\n  name,\r\n  hide: _hide,\r\n  show: _show,\r\n  setServiceImplementation,\r\n};\r\n\r\nconst serviceImplementation = {\r\n  _hide: () => console.warn('hide() NOT IMPLEMENTED'),\r\n  _show: () => console.warn('show() NOT IMPLEMENTED'),\r\n};\r\n\r\n/**\r\n * Show a new UI viewport dialog on the specified viewportIndex;\r\n *\r\n * @param {ViewportDialogProps} props { content, contentProps, viewportIndex }\r\n */\r\nfunction _show({\r\n  viewportIndex,\r\n  id,\r\n  type,\r\n  message,\r\n  actions,\r\n  onSubmit,\r\n  onOutsideClick,\r\n}) {\r\n  return serviceImplementation._show({\r\n    viewportIndex,\r\n    id,\r\n    type,\r\n    message,\r\n    actions,\r\n    onSubmit,\r\n    onOutsideClick,\r\n  });\r\n}\r\n\r\n/**\r\n * Hides/dismisses the viewport dialog, if currently shown\r\n */\r\nfunction _hide() {\r\n  return serviceImplementation._hide();\r\n}\r\n\r\n/**\r\n *\r\n *\r\n * @param {*} {\r\n *   hide: hideImplementation,\r\n *   show: showImplementation,\r\n *   viewportIndex,\r\n * }\r\n */\r\nfunction setServiceImplementation({\r\n  hide: hideImplementation,\r\n  show: showImplementation,\r\n}) {\r\n  if (hideImplementation) {\r\n    serviceImplementation._hide = hideImplementation;\r\n  }\r\n  if (showImplementation) {\r\n    serviceImplementation._show = showImplementation;\r\n  }\r\n}\r\n\r\nexport default {\r\n  name,\r\n  create: ({ configuration = {} }) => {\r\n    return publicAPI;\r\n  },\r\n};\r\n","const name = 'UserAuthenticationService';\r\n\r\nconst publicAPI = {\r\n  name,\r\n  getState: _getState,\r\n  setUser: _setUser,\r\n  getUser: _getUser,\r\n  getAuthorizationHeader: _getAuthorizationHeader,\r\n  handleUnauthenticated: _handleUnauthenticated,\r\n  setServiceImplementation,\r\n  reset: _reset,\r\n  set: _set,\r\n};\r\n\r\nconst serviceImplementation = {\r\n  _getState: () => console.warn('getState() NOT IMPLEMENTED'),\r\n  _setUser: () => console.warn('_setUser() NOT IMPLEMENTED'),\r\n  _getUser: () => console.warn('_setUser() NOT IMPLEMENTED'),\r\n  _getAuthorizationHeader: () => {}, // TODO: have enabled/disabled state?\r\n  //console.warn('_getAuthorizationHeader() NOT IMPLEMENTED'),\r\n  _handleUnauthenticated: () =>\r\n    console.warn('_handleUnauthenticated() NOT IMPLEMENTED'),\r\n  _reset: () => console.warn('reset() NOT IMPLEMENTED'),\r\n  _set: () => console.warn('set() NOT IMPLEMENTED'),\r\n};\r\n\r\nfunction _getState() {\r\n  return serviceImplementation._getState();\r\n}\r\n\r\nfunction _setUser(user) {\r\n  return serviceImplementation._setUser(user);\r\n}\r\n\r\nfunction _getUser() {\r\n  return serviceImplementation._getUser();\r\n}\r\n\r\nfunction _getAuthorizationHeader() {\r\n  return serviceImplementation._getAuthorizationHeader();\r\n}\r\n\r\nfunction _handleUnauthenticated() {\r\n  return serviceImplementation._handleUnauthenticated();\r\n}\r\n\r\nfunction _set(state) {\r\n  return serviceImplementation._set(state);\r\n}\r\n\r\nfunction _reset() {\r\n  return serviceImplementation._reset({});\r\n}\r\n\r\nfunction setServiceImplementation({\r\n  getState: getStateImplementation,\r\n  setUser: setUserImplementation,\r\n  getUser: getUserImplementation,\r\n  getAuthorizationHeader: getAuthorizationHeaderImplementation,\r\n  handleUnauthenticated: handleUnauthenticatedImplementation,\r\n  reset: resetImplementation,\r\n  set: setImplementation,\r\n}) {\r\n  if (getStateImplementation) {\r\n    serviceImplementation._getState = getStateImplementation;\r\n  }\r\n  if (setUserImplementation) {\r\n    serviceImplementation._setUser = setUserImplementation;\r\n  }\r\n  if (getUserImplementation) {\r\n    serviceImplementation._getUser = getUserImplementation;\r\n  }\r\n  if (getAuthorizationHeaderImplementation) {\r\n    serviceImplementation._getAuthorizationHeader = getAuthorizationHeaderImplementation;\r\n  }\r\n  if (handleUnauthenticatedImplementation) {\r\n    serviceImplementation._handleUnauthenticated = handleUnauthenticatedImplementation;\r\n  }\r\n  if (resetImplementation) {\r\n    serviceImplementation._reset = resetImplementation;\r\n  }\r\n  if (setImplementation) {\r\n    serviceImplementation._set = setImplementation;\r\n  }\r\n}\r\n\r\nexport default {\r\n  name,\r\n  create: ({ configuration = {} }) => {\r\n    return publicAPI;\r\n  },\r\n};\r\n","import UserAuthenticationService from './UserAuthenticationService';\r\n\r\nexport default UserAuthenticationService;\r\n","const name = 'ViewportGridService';\r\n\r\nconst publicAPI = {\r\n  name,\r\n  getState: _getState,\r\n  setActiveViewportIndex: _setActiveViewportIndex,\r\n  setDisplaysetForViewport: _setDisplaysetForViewport,\r\n  setLayout: _setLayout,\r\n  setCachedLayout: _setCachedLayout,\r\n  setServiceImplementation,\r\n  reset: _reset,\r\n  set: _set,\r\n};\r\n\r\nconst serviceImplementation = {\r\n  _getState: () => console.warn('getState() NOT IMPLEMENTED'),\r\n  _setActiveViewportIndex: () =>\r\n    console.warn('setActiveViewportIndex() NOT IMPLEMENTED'),\r\n  _setDisplaysetForViewport: () =>\r\n    console.warn('setDisplaysetForViewport() NOT IMPLEMENTED'),\r\n  _setLayout: () => console.warn('setLayout() NOT IMPLEMENTED'),\r\n  _reset: () => console.warn('reset() NOT IMPLEMENTED'),\r\n  _setCachedLayout: () => console.warn('setCachedLayout() NOT IMPLEMENTED'),\r\n  _set: () => console.warn('set() NOT IMPLEMENTED'),\r\n};\r\n\r\nfunction _getState() {\r\n  return serviceImplementation._getState();\r\n}\r\n\r\nfunction _setActiveViewportIndex(index) {\r\n  return serviceImplementation._setActiveViewportIndex(index);\r\n}\r\n\r\nfunction _setDisplaysetForViewport({ viewportIndex, displaySetInstanceUID }) {\r\n  return serviceImplementation._setDisplaysetForViewport({\r\n    viewportIndex,\r\n    displaySetInstanceUID,\r\n  });\r\n}\r\n\r\nfunction _setLayout({ numCols, numRows }) {\r\n  return serviceImplementation._setLayout({ numCols, numRows });\r\n}\r\n\r\nfunction _set(state) {\r\n  return serviceImplementation._set(state);\r\n}\r\n\r\nfunction _reset() {\r\n  return serviceImplementation._reset({});\r\n}\r\n\r\nfunction _setCachedLayout({ numCols, numRows, viewports }) {\r\n  return serviceImplementation._setLayout({ numCols, numRows, viewports });\r\n}\r\n\r\nfunction setServiceImplementation({\r\n  getState: getStateImplementation,\r\n  setActiveViewportIndex: setActiveViewportIndexImplementation,\r\n  setDisplaysetForViewport: setDisplaysetForViewportImplementation,\r\n  setCachedLayout: setCachedLayoutImplementation,\r\n  setLayout: setLayoutImplementation,\r\n  reset: resetImplementation,\r\n  set: setImplementation,\r\n}) {\r\n  if (getStateImplementation) {\r\n    serviceImplementation._getState = getStateImplementation;\r\n  }\r\n  if (setActiveViewportIndexImplementation) {\r\n    serviceImplementation._setActiveViewportIndex = setActiveViewportIndexImplementation;\r\n  }\r\n  if (setDisplaysetForViewportImplementation) {\r\n    serviceImplementation._setDisplaysetForViewport = setDisplaysetForViewportImplementation;\r\n  }\r\n  if (setLayoutImplementation) {\r\n    serviceImplementation._setLayout = setLayoutImplementation;\r\n  }\r\n  if (resetImplementation) {\r\n    serviceImplementation._reset = resetImplementation;\r\n  }\r\n  if (setCachedLayoutImplementation) {\r\n    serviceImplementation._setCachedLayout = setCachedLayoutImplementation;\r\n  }\r\n  if (setImplementation) {\r\n    serviceImplementation._set = setImplementation;\r\n  }\r\n}\r\n\r\nexport default {\r\n  name,\r\n  create: ({ configuration = {} }) => {\r\n    return publicAPI;\r\n  },\r\n};\r\n","import ViewportGridService from './ViewportGridService';\r\n\r\nexport default ViewportGridService;\r\n","import guid from '../../utils/guid';\r\n\r\n/**\r\n * Consumer must implement:\r\n * this.listeners = {}\r\n * this.EVENTS = { \"EVENT_KEY\": \"EVENT_VALUE\" }\r\n */\r\nexport default {\r\n  subscribe,\r\n  _broadcastEvent,\r\n  _unsubscribe,\r\n  _isValidEvent,\r\n};\r\n\r\n/**\r\n * Subscribe to updates.\r\n *\r\n * @param {string} eventName The name of the event\r\n * @param {Function} callback Events callback\r\n * @return {Object} Observable object with actions\r\n */\r\nfunction subscribe(eventName, callback) {\r\n  if (this._isValidEvent(eventName)) {\r\n    const listenerId = guid();\r\n    const subscription = { id: listenerId, callback };\r\n\r\n    console.info(`Subscribing to '${eventName}'.`);\r\n    if (Array.isArray(this.listeners[eventName])) {\r\n      this.listeners[eventName].push(subscription);\r\n    } else {\r\n      this.listeners[eventName] = [subscription];\r\n    }\r\n\r\n    return {\r\n      unsubscribe: () => this._unsubscribe(eventName, listenerId),\r\n    };\r\n  } else {\r\n    throw new Error(`Event ${eventName} not supported.`);\r\n  }\r\n}\r\n\r\n/**\r\n * Unsubscribe to measurement updates.\r\n *\r\n * @param {string} eventName The name of the event\r\n * @param {string} listenerId The listeners id\r\n * @return void\r\n */\r\nfunction _unsubscribe(eventName, listenerId) {\r\n  if (!this.listeners[eventName]) {\r\n    return;\r\n  }\r\n\r\n  const listeners = this.listeners[eventName];\r\n  if (Array.isArray(listeners)) {\r\n    this.listeners[eventName] = listeners.filter(({ id }) => id !== listenerId);\r\n  } else {\r\n    this.listeners[eventName] = undefined;\r\n  }\r\n}\r\n\r\n/**\r\n * Check if a given event is valid.\r\n *\r\n * @param {string} eventName The name of the event\r\n * @return {boolean} Event name validation\r\n */\r\nfunction _isValidEvent(eventName) {\r\n  return Object.values(this.EVENTS).includes(eventName);\r\n}\r\n\r\n/**\r\n * Broadcasts changes.\r\n *\r\n * @param {string} eventName - The event name\r\n * @param {func} callbackProps - Properties to pass callback\r\n * @return void\r\n */\r\nfunction _broadcastEvent(eventName, callbackProps) {\r\n  const hasListeners = Object.keys(this.listeners).length > 0;\r\n  const hasCallbacks = Array.isArray(this.listeners[eventName]);\r\n\r\n  if (hasListeners && hasCallbacks) {\r\n    this.listeners[eventName].forEach(listener => {\r\n      listener.callback(callbackProps);\r\n    });\r\n  }\r\n}\r\n","/**\r\n * Create a random GUID\r\n *\r\n * @return {string}\r\n */\r\nconst guid = () => {\r\n  const getFourRandomValues = () => {\r\n    return Math.floor((1 + Math.random()) * 0x10000)\r\n      .toString(16)\r\n      .substring(1);\r\n  };\r\n  return (\r\n    getFourRandomValues() +\r\n    getFourRandomValues() +\r\n    '-' +\r\n    getFourRandomValues() +\r\n    '-' +\r\n    getFourRandomValues() +\r\n    '-' +\r\n    getFourRandomValues() +\r\n    '-' +\r\n    getFourRandomValues() +\r\n    getFourRandomValues() +\r\n    getFourRandomValues()\r\n  );\r\n};\r\n\r\nexport default guid;\r\n","/**\r\n * adds a pause and unpause method to Mousetrap\r\n * this allows you to enable or disable keyboard shortcuts\r\n * without having to reset Mousetrap and rebind everything\r\n *\r\n * https://github.com/ccampbell/mousetrap/blob/master/plugins/pause/mousetrap-pause.js\r\n */\r\nexport default function pausePlugin(Mousetrap) {\r\n  var _originalStopCallback = Mousetrap.prototype.stopCallback;\r\n\r\n  Mousetrap.prototype.stopCallback = function(e, element, combo) {\r\n    var self = this;\r\n\r\n    if (self.paused) {\r\n      return true;\r\n    }\r\n\r\n    return _originalStopCallback.call(self, e, element, combo);\r\n  };\r\n\r\n  Mousetrap.prototype.pause = function() {\r\n    var self = this;\r\n    self.paused = true;\r\n  };\r\n\r\n  Mousetrap.prototype.unpause = function() {\r\n    var self = this;\r\n    self.paused = false;\r\n  };\r\n\r\n  Mousetrap.init();\r\n}\r\n","/**\r\n * This extension allows you to record a sequence using Mousetrap.\r\n *\r\n * @author Dan Tao <daniel.tao@gmail.com>\r\n */\r\nexport default function recordPlugin(Mousetrap, options = { timeout: 100 }) {\r\n  /**\r\n   * the sequence currently being recorded\r\n   *\r\n   * @type {Array}\r\n   */\r\n  var _recordedSequence = [],\r\n    /**\r\n     * a callback to invoke after recording a sequence\r\n     *\r\n     * @type {Function|null}\r\n     */\r\n    _recordedSequenceCallback = null,\r\n    /**\r\n     * a list of all of the keys currently held down\r\n     *\r\n     * @type {Array}\r\n     */\r\n    _currentRecordedKeys = [],\r\n    /**\r\n     * temporary state where we remember if we've already captured a\r\n     * character key in the current combo\r\n     *\r\n     * @type {boolean}\r\n     */\r\n    _recordedCharacterKey = false,\r\n    /**\r\n     * a handle for the timer of the current recording\r\n     *\r\n     * @type {null|number}\r\n     */\r\n    _recordTimer = null,\r\n    /**\r\n     * the original handleKey method to override when Mousetrap.record() is\r\n     * called\r\n     *\r\n     * @type {Function}\r\n     */\r\n    _origHandleKey = Mousetrap.prototype.handleKey;\r\n\r\n  /**\r\n   * handles a character key event\r\n   *\r\n   * @param {string} character\r\n   * @param {Array} modifiers\r\n   * @param {Event} e\r\n   * @returns void\r\n   */\r\n  function _handleKey(character, modifiers, e) {\r\n    var self = this;\r\n\r\n    if (!self.recording) {\r\n      _origHandleKey.apply(self, arguments);\r\n      return;\r\n    }\r\n\r\n    // remember this character if we're currently recording a sequence\r\n    if (e.type == 'keydown') {\r\n      if (character.length === 1 && _recordedCharacterKey) {\r\n        _recordCurrentCombo();\r\n      }\r\n\r\n      for (let i = 0; i < modifiers.length; ++i) {\r\n        _recordKey(modifiers[i]);\r\n      }\r\n      _recordKey(character);\r\n\r\n      // once a key is released, all keys that were held down at the time\r\n      // count as a keypress\r\n    } else if (e.type == 'keyup' && _currentRecordedKeys.length > 0) {\r\n      _recordCurrentCombo();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * marks a character key as held down while recording a sequence\r\n   *\r\n   * @param {string} key\r\n   * @returns void\r\n   */\r\n  function _recordKey(key) {\r\n    // one-off implementation of Array.indexOf, since IE6-9 don't support it\r\n    for (let i = 0; i < _currentRecordedKeys.length; ++i) {\r\n      if (_currentRecordedKeys[i] === key) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    _currentRecordedKeys.push(key);\r\n\r\n    if (key.length === 1) {\r\n      _recordedCharacterKey = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * marks whatever key combination that's been recorded so far as finished\r\n   * and gets ready for the next combo\r\n   *\r\n   * @returns void\r\n   */\r\n  function _recordCurrentCombo() {\r\n    _recordedSequence.push(_currentRecordedKeys);\r\n    _currentRecordedKeys = [];\r\n    _recordedCharacterKey = false;\r\n    _restartRecordTimer();\r\n  }\r\n\r\n  /**\r\n   * ensures each combo in a sequence is in a predictable order and formats\r\n   * key combos to be '+'-delimited\r\n   *\r\n   * modifies the sequence in-place\r\n   *\r\n   * @param {Array} sequence\r\n   * @returns void\r\n   */\r\n  function _normalizeSequence(sequence) {\r\n    for (let i = 0; i < sequence.length; ++i) {\r\n      sequence[i].sort(function(x, y) {\r\n        // modifier keys always come first, in alphabetical order\r\n        if (x.length > 1 && y.length === 1) {\r\n          return -1;\r\n        } else if (x.length === 1 && y.length > 1) {\r\n          return 1;\r\n        }\r\n\r\n        // character keys come next (list should contain no duplicates,\r\n        // so no need for equality check)\r\n        return x > y ? 1 : -1;\r\n      });\r\n\r\n      sequence[i] = sequence[i].join('+');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * finishes the current recording, passes the recorded sequence to the stored\r\n   * callback, and sets Mousetrap.handleKey back to its original function\r\n   *\r\n   * @returns void\r\n   */\r\n  function _finishRecording() {\r\n    if (_recordedSequenceCallback) {\r\n      _normalizeSequence(_recordedSequence);\r\n      _recordedSequenceCallback(_recordedSequence);\r\n    }\r\n\r\n    // reset all recorded state\r\n    _recordedSequence = [];\r\n    _recordedSequenceCallback = null;\r\n    _currentRecordedKeys = [];\r\n  }\r\n\r\n  /**\r\n   * called to set a 1 second timeout on the current recording\r\n   *\r\n   * this is so after each key press in the sequence the recording will wait for\r\n   * 1 more second before executing the callback\r\n   *\r\n   * @returns void\r\n   */\r\n  function _restartRecordTimer() {\r\n    clearTimeout(_recordTimer);\r\n    _recordTimer = setTimeout(_finishRecording, options.timeout);\r\n  }\r\n\r\n  /**\r\n   * records the next sequence and passes it to a callback once it's\r\n   * completed\r\n   *\r\n   * @param {Function} callback\r\n   * @returns void\r\n   */\r\n  Mousetrap.prototype.record = function(callback) {\r\n    var self = this;\r\n    self.recording = true;\r\n    _recordedSequenceCallback = function() {\r\n      self.recording = false;\r\n      callback.apply(self, arguments);\r\n    };\r\n  };\r\n\r\n  /**\r\n   * stop recording\r\n   *\r\n   * @param {Function} callback\r\n   * @returns void\r\n   */\r\n  Mousetrap.prototype.stopRecord = function() {\r\n    var self = this;\r\n    self.recording = false;\r\n  };\r\n\r\n  /**\r\n   * start recording\r\n   *\r\n   * @param {Function} callback\r\n   * @returns void\r\n   */\r\n  Mousetrap.prototype.startRecording = function() {\r\n    var self = this;\r\n    self.recording = true;\r\n  };\r\n  Mousetrap.prototype.handleKey = function() {\r\n    var self = this;\r\n    _handleKey.apply(self, arguments);\r\n  };\r\n\r\n  Mousetrap.init();\r\n}\r\n","import Mousetrap from 'mousetrap';\r\nimport pausePlugin from './pausePlugin';\r\nimport recordPlugin from './recordPlugin';\r\n\r\nrecordPlugin(Mousetrap);\r\npausePlugin(Mousetrap);\r\n\r\nexport default Mousetrap;\r\n","export class ObjectPath {\r\n  /**\r\n   * Set an object property based on \"path\" (namespace) supplied creating\r\n   * ... intermediary objects if they do not exist.\r\n   * @param object {Object} An object where the properties specified on path should be set.\r\n   * @param path {String} A string representing the property to be set, e.g. \"user.study.series.timepoint\".\r\n   * @param value {Any} The value of the property that will be set.\r\n   * @return {Boolean} Returns \"true\" on success, \"false\" if any intermediate component of the supplied path\r\n   * ... is not a valid Object, in which case the property cannot be set. No excpetions are thrown.\r\n   */\r\n  static set(object, path, value) {\r\n    let components = ObjectPath.getPathComponents(path),\r\n      length = components !== null ? components.length : 0,\r\n      result = false;\r\n\r\n    if (length > 0 && ObjectPath.isValidObject(object)) {\r\n      let i = 0,\r\n        last = length - 1,\r\n        currentObject = object;\r\n\r\n      while (i < last) {\r\n        let field = components[i];\r\n\r\n        if (field in currentObject) {\r\n          if (!ObjectPath.isValidObject(currentObject[field])) {\r\n            break;\r\n          }\r\n        } else {\r\n          currentObject[field] = {};\r\n        }\r\n\r\n        currentObject = currentObject[field];\r\n        i++;\r\n      }\r\n\r\n      if (i === last) {\r\n        currentObject[components[last]] = value;\r\n        result = true;\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get an object property based on \"path\" (namespace) supplied traversing the object\r\n   * ... tree as necessary.\r\n   * @param object {Object} An object where the properties specified might exist.\r\n   * @param path {String} A string representing the property to be searched for, e.g. \"user.study.series.timepoint\".\r\n   * @return {Any} The value of the property if found. By default, returns the special type \"undefined\".\r\n   */\r\n  static get(object, path) {\r\n    let found, // undefined by default\r\n      components = ObjectPath.getPathComponents(path),\r\n      length = components !== null ? components.length : 0;\r\n\r\n    if (length > 0 && ObjectPath.isValidObject(object)) {\r\n      let i = 0,\r\n        last = length - 1,\r\n        currentObject = object;\r\n\r\n      while (i < last) {\r\n        let field = components[i];\r\n\r\n        const isValid = ObjectPath.isValidObject(currentObject[field]);\r\n        if (field in currentObject && isValid) {\r\n          currentObject = currentObject[field];\r\n          i++;\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (i === last && components[last] in currentObject) {\r\n        found = currentObject[components[last]];\r\n      }\r\n    }\r\n\r\n    return found;\r\n  }\r\n\r\n  /**\r\n   * Check if the supplied argument is a real JavaScript Object instance.\r\n   * @param object {Any} The subject to be tested.\r\n   * @return {Boolean} Returns \"true\" if the object is a real Object instance and \"false\" otherwise.\r\n   */\r\n  static isValidObject(object) {\r\n    return (\r\n      typeof object === 'object' && object !== null && object instanceof Object\r\n    );\r\n  }\r\n\r\n  static getPathComponents(path) {\r\n    return typeof path === 'string' ? path.split('.') : null;\r\n  }\r\n}\r\n\r\nexport default ObjectPath;\r\n","let stackMap = {};\r\nlet configuration = {};\r\nconst stackUpdatedCallbacks = [];\r\n\r\n/**\r\n * Loop through the current series and add metadata to the\r\n * Cornerstone meta data provider. This will be used to fill information\r\n * into the viewport overlays, and to calculate reference lines and orientation markers\r\n * @param  {Object} stackMap              stackMap object\r\n * @param  {Object} displaySet            The set of images to make the stack from\r\n * @return {Array}                        Array with image IDs\r\n */\r\nfunction createAndAddStack(\r\n  stackMap,\r\n  displaySet,\r\n  dataSource,\r\n  stackUpdatedCallbacks\r\n) {\r\n  const {\r\n    images,\r\n    displaySetInstanceUID,\r\n    StudyInstanceUID,\r\n    frameRate,\r\n    isClip,\r\n    initialImageIdIndex,\r\n  } = displaySet;\r\n  if (!images) {\r\n    return;\r\n  }\r\n\r\n  const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\r\n\r\n  const stack = {\r\n    StudyInstanceUID,\r\n    displaySetInstanceUID,\r\n    imageIds,\r\n    frameRate,\r\n    isClip,\r\n    initialImageIdIndex,\r\n  };\r\n\r\n  stackMap[displaySetInstanceUID] = stack;\r\n\r\n  return stack;\r\n}\r\n\r\nconfiguration = {\r\n  createAndAddStack,\r\n};\r\n\r\n/**\r\n * This object contains all the functions needed for interacting with the stack manager.\r\n * Generally, findStack is the only function used. If you want to know when new stacks\r\n * come in, you can register a callback with addStackUpdatedCallback.\r\n */\r\nconst StackManager = {\r\n  /**\r\n   * Removes all current stacks\r\n   */\r\n  clearStacks() {\r\n    stackMap = {};\r\n  },\r\n  /**\r\n   * Create a stack from an image set, as well as add in the metadata on a per image bases.\r\n   * @param displaySet The set of images to make the stack from\r\n   * @return {Array} Array with image IDs\r\n   */\r\n  makeAndAddStack(displaySet, dataSource) {\r\n    return configuration.createAndAddStack(\r\n      stackMap,\r\n      displaySet,\r\n      dataSource,\r\n      stackUpdatedCallbacks\r\n    );\r\n  },\r\n  /**\r\n   * Find a stack from the currently created stacks.\r\n   * @param displaySetInstanceUID The UID of the stack to find.\r\n   * @returns {*} undefined if not found, otherwise the stack object is returned.\r\n   */\r\n  findStack(displaySetInstanceUID) {\r\n    return stackMap[displaySetInstanceUID];\r\n  },\r\n  /**\r\n   * Find a stack or reate one if it has not been created yet\r\n   * @param displaySet The set of images to make the stack from\r\n   * @return {Array} Array with image IDs\r\n   */\r\n  findOrCreateStack(displaySet, dataSource) {\r\n    let stack = this.findStack(displaySet.displaySetInstanceUID);\r\n\r\n    if (!stack || !stack.imageIds) {\r\n      stack = this.makeAndAddStack(displaySet, dataSource);\r\n    }\r\n\r\n    return stack;\r\n  },\r\n  /**\r\n   * Gets the underlying map of displaySetInstanceUID to stack object.\r\n   * WARNING: Do not change this object. It directly affects the manager.\r\n   * @returns {{}} map of displaySetInstanceUID -> stack.\r\n   */\r\n  getAllStacks() {\r\n    return stackMap;\r\n  },\r\n  /**\r\n   * Adds in a callback to be called on a stack being added / updated.\r\n   * @param callback must accept at minimum one argument,\r\n   * which is the stack that was added / updated.\r\n   */\r\n  addStackUpdatedCallback(callback) {\r\n    if (typeof callback !== 'function') {\r\n      throw new Error('callback must be provided as a function');\r\n    }\r\n    stackUpdatedCallbacks.push(callback);\r\n  },\r\n  /**\r\n   * Return configuration\r\n   */\r\n  getConfiguration() {\r\n    return configuration;\r\n  },\r\n  /**\r\n   * Set configuration, in order to provide compatibility\r\n   * with other systems by overriding this functions\r\n   * @param {Object} config object with functions to be overrided\r\n   *\r\n   * For now, only makeAndAddStack can be overrided\r\n   */\r\n  setConfiguration(config) {\r\n    configuration = config;\r\n  },\r\n};\r\n\r\nexport { StackManager };\r\nexport default StackManager;\r\n","const absoluteUrl = path => {\r\n  let absolutePath = '/';\r\n\r\n  if (!path) return absolutePath;\r\n\r\n  // TODO: Find another way to get root url\r\n  const absoluteUrl = window.location.origin;\r\n  const absoluteUrlParts = absoluteUrl.split('/');\r\n\r\n  if (absoluteUrlParts.length > 4) {\r\n    const rootUrlPrefixIndex = absoluteUrl.indexOf(absoluteUrlParts[3]);\r\n    absolutePath += absoluteUrl.substring(rootUrlPrefixIndex) + path;\r\n  } else {\r\n    absolutePath += path;\r\n  }\r\n\r\n  return absolutePath.replace(/\\/\\/+/g, '/');\r\n};\r\n\r\nexport default absoluteUrl;\r\n","/*\r\n * Sorting function\r\n * Sorts an array by seriesDate and seriesNumber if equal\r\n */\r\nconst sortBySeriesDate = array =>\r\n  array.sort((a, b) => {\r\n    if (a.seriesNumber !== b.seriesNumber) {\r\n      return a.seriesNumber - b.seriesNumber;\r\n    }\r\n\r\n    const seriesDateA = Date.parse(a.seriesDate);\r\n    const seriesDateB = Date.parse(b.seriesDate);\r\n\r\n    return seriesDateA - seriesDateB;\r\n  });\r\n\r\nexport default sortBySeriesDate;\r\n","import cornerstone from 'cornerstone-core';\r\nimport cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\r\nimport { api } from 'dicomweb-client';\r\nimport DICOMWeb from '../DICOMWeb';\r\n\r\nimport errorHandler from '../errorHandler';\r\n\r\nconst getImageId = imageObj => {\r\n  if (!imageObj) {\r\n    return;\r\n  }\r\n\r\n  return typeof imageObj.getImageId === 'function'\r\n    ? imageObj.getImageId()\r\n    : imageObj.url;\r\n};\r\n\r\nconst findImageIdOnStudies = (studies, displaySetInstanceUID) => {\r\n  const study = studies.find(study => {\r\n    const displaySet = study.displaySets.some(\r\n      displaySet => displaySet.displaySetInstanceUID === displaySetInstanceUID\r\n    );\r\n    return displaySet;\r\n  });\r\n  const { series = [] } = study;\r\n  const { instances = [] } = series[0] || {};\r\n  const instance = instances[0];\r\n\r\n  return getImageId(instance);\r\n};\r\n\r\nconst someInvalidStrings = strings => {\r\n  const stringsArray = Array.isArray(strings) ? strings : [strings];\r\n  const emptyString = string => !string;\r\n  let invalid = stringsArray.some(emptyString);\r\n  return invalid;\r\n};\r\n\r\nconst getImageInstance = dataset => {\r\n  return dataset && dataset.images && dataset.images[0];\r\n};\r\n\r\nconst getImageInstanceId = imageInstance => {\r\n  return getImageId(imageInstance);\r\n};\r\n\r\nconst fetchIt = (url, headers = DICOMWeb.getAuthorizationHeader()) => {\r\n  return fetch(url, headers).then(response => response.arrayBuffer());\r\n};\r\n\r\nconst cornerstoneRetriever = imageId => {\r\n  return cornerstone.loadAndCacheImage(imageId).then(image => {\r\n    return image && image.data && image.data.byteArray.buffer;\r\n  });\r\n};\r\n\r\nconst wadorsRetriever = (\r\n  url,\r\n  studyInstanceUID,\r\n  seriesInstanceUID,\r\n  sopInstanceUID,\r\n  headers = DICOMWeb.getAuthorizationHeader(),\r\n  errorInterceptor = errorHandler.getHTTPErrorHandler()\r\n) => {\r\n  const config = {\r\n    url,\r\n    headers,\r\n    errorInterceptor,\r\n  };\r\n  const dicomWeb = new api.DICOMwebClient(config);\r\n\r\n  return dicomWeb.retrieveInstance({\r\n    studyInstanceUID,\r\n    seriesInstanceUID,\r\n    sopInstanceUID,\r\n  });\r\n};\r\n\r\nconst getImageLoaderType = imageId => {\r\n  const loaderRegExp = /^\\w+\\:/;\r\n  const loaderType = loaderRegExp.exec(imageId);\r\n\r\n  return (\r\n    (loaderRegExp.lastIndex === 0 &&\r\n      loaderType &&\r\n      loaderType[0] &&\r\n      loaderType[0].replace(':', '')) ||\r\n    ''\r\n  );\r\n};\r\n\r\nclass DicomLoaderService {\r\n  getLocalData(dataset, studies) {\r\n    if (dataset && dataset.localFile) {\r\n      // Use referenced imageInstance\r\n      const imageInstance = getImageInstance(dataset);\r\n      let imageId = getImageInstanceId(imageInstance);\r\n\r\n      // or Try to get it from studies\r\n      if (someInvalidStrings(imageId)) {\r\n        imageId = findImageIdOnStudies(studies, dataset.displaySetInstanceUID);\r\n      }\r\n\r\n      if (!someInvalidStrings(imageId)) {\r\n        return cornerstoneWADOImageLoader.wadouri.loadFileRequest(imageId);\r\n      }\r\n    }\r\n  }\r\n\r\n  getDataByImageType(dataset) {\r\n    const imageInstance = getImageInstance(dataset);\r\n\r\n    if (imageInstance) {\r\n      const imageId = getImageInstanceId(imageInstance);\r\n      let getDicomDataMethod = fetchIt;\r\n      const loaderType = getImageLoaderType(imageId);\r\n\r\n      switch (loaderType) {\r\n        case 'dicomfile':\r\n          getDicomDataMethod = cornerstoneRetriever.bind(this, imageId);\r\n          break;\r\n        case 'wadors':\r\n          const url = imageInstance.getData().wadoRoot;\r\n          const studyInstanceUID = imageInstance.getStudyInstanceUID();\r\n          const seriesInstanceUID = imageInstance.getSeriesInstanceUID();\r\n          const sopInstanceUID = imageInstance.getSOPInstanceUID();\r\n          const invalidParams = someInvalidStrings([\r\n            url,\r\n            studyInstanceUID,\r\n            seriesInstanceUID,\r\n            sopInstanceUID,\r\n          ]);\r\n          if (invalidParams) {\r\n            return;\r\n          }\r\n\r\n          getDicomDataMethod = wadorsRetriever.bind(\r\n            this,\r\n            url,\r\n            studyInstanceUID,\r\n            seriesInstanceUID,\r\n            sopInstanceUID\r\n          );\r\n          break;\r\n        case 'wadouri':\r\n          // Strip out the image loader specifier\r\n          imageId = imageId.substring(imageId.indexOf(':') + 1);\r\n\r\n          if (someInvalidStrings(imageId)) {\r\n            return;\r\n          }\r\n          getDicomDataMethod = fetchIt.bind(this, imageId);\r\n          break;\r\n      }\r\n\r\n      return getDicomDataMethod();\r\n    }\r\n  }\r\n\r\n  getDataByDatasetType(dataset) {\r\n    const {\r\n      StudyInstanceUID,\r\n      SeriesInstanceUID,\r\n      SOPInstanceUID,\r\n      authorizationHeaders,\r\n      wadoRoot,\r\n      wadoUri,\r\n    } = dataset;\r\n    // Retrieve wadors or just try to fetch wadouri\r\n    if (!someInvalidStrings(wadoRoot)) {\r\n      return wadorsRetriever(\r\n        wadoRoot,\r\n        StudyInstanceUID,\r\n        SeriesInstanceUID,\r\n        SOPInstanceUID,\r\n        authorizationHeaders\r\n      );\r\n    } else if (!someInvalidStrings(wadoUri)) {\r\n      return fetchIt(wadoUri, { headers: authorizationHeaders });\r\n    }\r\n  }\r\n\r\n  *getLoaderIterator(dataset, studies) {\r\n    yield this.getLocalData(dataset, studies);\r\n    yield this.getDataByImageType(dataset);\r\n    yield this.getDataByDatasetType(dataset);\r\n  }\r\n\r\n  findDicomDataPromise(dataset, studies) {\r\n    const loaderIterator = this.getLoaderIterator(dataset, studies);\r\n    // it returns first valid retriever method.\r\n    for (const loader of loaderIterator) {\r\n      if (loader) {\r\n        return loader;\r\n      }\r\n    }\r\n\r\n    // in case of no valid loader\r\n    throw new Error('Invalid dicom data loader');\r\n  }\r\n}\r\n\r\nconst dicomLoaderService = new DicomLoaderService();\r\n\r\nexport default dicomLoaderService;\r\n","/* Enabled JPEG images downloading on IE11. */\r\nconst b64toBlob = (b64Data, contentType = '', sliceSize = 512) => {\r\n  const byteCharacters = atob(b64Data);\r\n  const byteArrays = [];\r\n\r\n  for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {\r\n    const slice = byteCharacters.slice(offset, offset + sliceSize);\r\n\r\n    const byteNumbers = new Array(slice.length);\r\n    for (let i = 0; i < slice.length; i++) {\r\n      byteNumbers[i] = slice.charCodeAt(i);\r\n    }\r\n\r\n    const byteArray = new Uint8Array(byteNumbers);\r\n    byteArrays.push(byteArray);\r\n  }\r\n\r\n  const blob = new Blob(byteArrays, { type: contentType });\r\n  return blob;\r\n};\r\n\r\nexport default b64toBlob;\r\n","import lib from 'query-string';\r\n\r\nconst PARAM_SEPARATOR = ';';\r\nconst PARAM_PATTERN_IDENTIFIER = ':';\r\n\r\nfunction toLowerCaseFirstLetter(word) {\r\n  return word[0].toLowerCase() + word.slice(1);\r\n}\r\nconst getQueryFilters = (location = {}) => {\r\n  const { search } = location;\r\n\r\n  if (!search) {\r\n    return;\r\n  }\r\n\r\n  const searchParameters = parse(search);\r\n  const filters = {};\r\n\r\n  Object.entries(searchParameters).forEach(([key, value]) => {\r\n    filters[toLowerCaseFirstLetter(key)] = value;\r\n  });\r\n\r\n  return filters;\r\n};\r\n\r\nconst decode = (strToDecode = '') => {\r\n  try {\r\n    const decoded = window.atob(strToDecode);\r\n    return decoded;\r\n  } catch (e) {\r\n    return strToDecode;\r\n  }\r\n};\r\n\r\nconst parse = toParse => {\r\n  if (toParse) {\r\n    return lib.parse(toParse);\r\n  }\r\n\r\n  return {};\r\n};\r\nconst parseParam = paramStr => {\r\n  const _paramDecoded = decode(paramStr);\r\n  if (_paramDecoded && typeof _paramDecoded === 'string') {\r\n    return _paramDecoded.split(PARAM_SEPARATOR);\r\n  }\r\n};\r\n\r\nconst replaceParam = (path = '', paramKey, paramValue) => {\r\n  const paramPattern = `${PARAM_PATTERN_IDENTIFIER}${paramKey}`;\r\n  if (paramValue) {\r\n    return path.replace(paramPattern, paramValue);\r\n  }\r\n\r\n  return path;\r\n};\r\n\r\nconst isValidPath = path => {\r\n  const paramPatternPiece = `/${PARAM_PATTERN_IDENTIFIER}`;\r\n  return path.indexOf(paramPatternPiece) < 0;\r\n};\r\n\r\nconst queryString = {\r\n  getQueryFilters,\r\n};\r\n\r\nconst paramString = {\r\n  isValidPath,\r\n  parseParam,\r\n  replaceParam,\r\n};\r\n\r\nconst urlUtil = { parse, queryString, paramString };\r\n\r\nexport default urlUtil;\r\n","export default function makeDeferred() {\r\n  let reject,\r\n    resolve,\r\n    promise = new Promise(function(res, rej) {\r\n      resolve = res;\r\n      reject = rej;\r\n    });\r\n  return Object.freeze({ promise, resolve, reject });\r\n}\r\n","export default class Queue {\r\n  constructor(limit) {\r\n    this.limit = limit;\r\n    this.size = 0;\r\n    this.awaiting = null;\r\n  }\r\n\r\n  /**\r\n   * Creates a new \"proxy\" function associated with the current execution queue\r\n   * instance. When the returned function is invoked, the queue limit is checked\r\n   * to make sure the limit of scheduled tasks is repected (throwing an\r\n   * exception when the limit has been reached and before calling the original\r\n   * function). The original function is only invoked after all the previously\r\n   * scheduled tasks have finished executing (their returned promises have\r\n   * resolved/rejected);\r\n   *\r\n   * @param {function} task The function whose execution will be associated\r\n   * with the current Queue instance;\r\n   * @returns {function} The \"proxy\" function bound to the current Queue\r\n   * instance;\r\n   */\r\n  bind(task) {\r\n    return bind(this, task);\r\n  }\r\n\r\n  bindSafe(task, onError) {\r\n    const boundTask = bind(this, task);\r\n    return async function safeTask(...args) {\r\n      try {\r\n        return await boundTask(...args);\r\n      } catch (e) {\r\n        onError(e);\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Utils\r\n */\r\n\r\nfunction bind(queue, task) {\r\n  const cleaner = clean.bind(null, queue);\r\n  return async function boundTask(...args) {\r\n    if (queue.size >= queue.limit) {\r\n      throw new Error('Queue limit reached');\r\n    }\r\n    const promise = chain(queue.awaiting, task, args);\r\n    queue.awaiting = promise.then(cleaner, cleaner);\r\n    queue.size++;\r\n    return promise;\r\n  };\r\n}\r\n\r\nfunction clean(queue) {\r\n  if (queue.size > 0 && --queue.size === 0) {\r\n    queue.awaiting = null;\r\n  }\r\n}\r\n\r\nasync function chain(prev, task, args) {\r\n  await prev;\r\n  return task(...args);\r\n}\r\n","/**\r\n * Constants\r\n */\r\n\r\nconst SEPARATOR = '/';\r\n\r\n/**\r\n * API\r\n */\r\n\r\n/**\r\n * Add values to a list hierarchically.\r\n *  @ For example:\r\n *    addToList([], 'a', 'b', 'c');\r\n *  will add the following hierarchy to the list:\r\n *    a > b > c\r\n *  resulting in the following array:\r\n *    [['a', [['b', ['c']]]]]\r\n * @param {Array} list The target list;\r\n * @param  {...string} values The values to be hierarchically added to the list;\r\n * @returns {Array} Returns the provided list possibly updated with the given\r\n *  values or null when a bad list (not an actual array) is provided\r\n */\r\nfunction addToList(list, ...values) {\r\n  if (Array.isArray(list)) {\r\n    if (values.length > 0) {\r\n      addValuesToList(list, values);\r\n    }\r\n    return list;\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Iterates through the provided hierarchical list executing the callback\r\n * once for each leaf-node of the tree. The ancestors of the leaf-node being\r\n * visited are passed to the callback function along with the leaf-node in\r\n * the exact same order they appear on the tree (from root to leaf);\r\n *  @ For example, if the hierachy `a > b > c` appears on the tree (\"a\" being\r\n *    the root and \"c\" being the leaf) the callback function will be called as:\r\n *  callback('a', 'b', 'c');\r\n * @param {Array} list The hierarchical list to be iterated\r\n * @param {function} callback The callback which will be exected once for\r\n *  each leaf-node of the hierarchical list;\r\n * @returns {Array} Returns the provided list or null for bad arguments;\r\n */\r\nfunction forEach(list, callback) {\r\n  if (Array.isArray(list)) {\r\n    if (typeof callback === 'function') {\r\n      forEachValue(list, callback);\r\n    }\r\n    return list;\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Retrieves an item from the given hierarchical list based on an index (number)\r\n * or a path (string).\r\n *  @ For example:\r\n *    getItem(list, '1/0/4')\r\n *  will retrieve the fourth grandchild, from the first child of the second\r\n *  element of the list;\r\n * @param {Array} list The source list;\r\n * @param {string|number} indexOrPath The index of the element inside list\r\n *  (number) or the path to reach the desired element (string). The slash \"/\"\r\n *  character is cosidered the path separator;\r\n */\r\nfunction getItem(list, indexOrPath) {\r\n  if (Array.isArray(list)) {\r\n    let subpath = null;\r\n    let index = typeof indexOrPath === 'number' ? indexOrPath : -1;\r\n    if (typeof indexOrPath === 'string') {\r\n      const separator = indexOrPath.indexOf(SEPARATOR);\r\n      if (separator > 0) {\r\n        index = parseInt(indexOrPath.slice(0, separator), 10);\r\n        if (separator + 1 < indexOrPath.length) {\r\n          subpath = indexOrPath.slice(separator + 1, indexOrPath.length);\r\n        }\r\n      } else {\r\n        index = parseInt(indexOrPath, 10);\r\n      }\r\n    }\r\n    if (index >= 0 && index < list.length) {\r\n      const item = list[index];\r\n      if (isSublist(item)) {\r\n        if (subpath !== null) {\r\n          return getItem(item[1], subpath);\r\n        }\r\n        return item[0];\r\n      }\r\n      return item;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Pretty-print the provided hierarchical list;\r\n * @param {Array} list The source list;\r\n * @returns {string} The textual representation of the hierarchical list;\r\n */\r\nfunction print(list) {\r\n  let text = '';\r\n  if (Array.isArray(list)) {\r\n    let prev = [];\r\n    forEachValue(list, function(...args) {\r\n      let prevLen = prev.length;\r\n      for (let i = 0, l = args.length; i < l; ++i) {\r\n        if (i < prevLen && args[i] === prev[i]) {\r\n          continue;\r\n        }\r\n        text += '  '.repeat(i) + args[i] + '\\n';\r\n      }\r\n      prev = args;\r\n    });\r\n  }\r\n  return text;\r\n}\r\n\r\n/**\r\n * Utils\r\n */\r\n\r\nfunction forEachValue(list, callback) {\r\n  for (let i = 0, l = list.length; i < l; ++i) {\r\n    let item = list[i];\r\n    if (isSublist(item)) {\r\n      if (item[1].length > 0) {\r\n        forEachValue(item[1], callback.bind(null, item[0]));\r\n        continue;\r\n      }\r\n      item = item[0];\r\n    }\r\n    callback(item);\r\n  }\r\n}\r\n\r\nfunction addValuesToList(list, values) {\r\n  let value = values.shift();\r\n  let index = add(list, value);\r\n  if (index >= 0) {\r\n    if (values.length > 0) {\r\n      let sublist = list[index];\r\n      if (!isSublist(sublist)) {\r\n        sublist = toSublist(value);\r\n        list[index] = sublist;\r\n      }\r\n      return addValuesToList(sublist[1], values);\r\n    }\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction add(list, value) {\r\n  let index = find(list, value);\r\n  if (index === -2) {\r\n    index = list.push(value) - 1;\r\n  }\r\n  return index;\r\n}\r\n\r\nfunction find(list, value) {\r\n  if (typeof value === 'string') {\r\n    for (let i = 0, l = list.length; i < l; ++i) {\r\n      let item = list[i];\r\n      if (item === value || (isSublist(item) && item[0] === value)) {\r\n        return i;\r\n      }\r\n    }\r\n    return -2;\r\n  }\r\n  return -1;\r\n}\r\n\r\nfunction isSublist(subject) {\r\n  return (\r\n    Array.isArray(subject) &&\r\n    subject.length === 2 &&\r\n    typeof subject[0] === 'string' &&\r\n    Array.isArray(subject[1])\r\n  );\r\n}\r\n\r\nfunction toSublist(value) {\r\n  return [value + '', []];\r\n}\r\n\r\n/**\r\n * Exports\r\n */\r\n\r\nconst hierarchicalListUtils = { addToList, getItem, forEach, print };\r\nexport { addToList, getItem, forEach, print };\r\nexport default hierarchicalListUtils;\r\n","import makeDeferred from './makeDeferred';\r\n\r\n/**\r\n * Constants\r\n */\r\n\r\nconst TYPE = Symbol('Type');\r\nconst TASK = Symbol('Task');\r\nconst LIST = Symbol('List');\r\n\r\n/**\r\n * Public Methods\r\n */\r\n\r\n/**\r\n * Creates an instance of a task list\r\n * @returns {Object} A task list object\r\n */\r\nfunction createList() {\r\n  return objectWithType(LIST, {\r\n    head: null,\r\n    named: Object.create(null),\r\n    observers: [],\r\n  });\r\n}\r\n\r\n/**\r\n * Checks if the given argument is a List instance\r\n * @param {any} subject The value to be tested\r\n * @returns {boolean} true if a valid List instance is given, false otherwise\r\n */\r\nfunction isList(subject) {\r\n  return isOfType(LIST, subject);\r\n}\r\n\r\n/**\r\n * Creates an instance of a task\r\n * @param {Object} list The List instance related to this task\r\n * @param {Object} next The next Task instance to link to\r\n * @returns {Object} A task object\r\n */\r\nfunction createTask(list, next) {\r\n  return objectWithType(TASK, {\r\n    list: isList(list) ? list : null,\r\n    next: isTask(next) ? next : null,\r\n    failed: false,\r\n    awaiting: null,\r\n    progress: 0.0,\r\n  });\r\n}\r\n\r\n/**\r\n * Checks if the given argument is a Task instance\r\n * @param {any} subject The value to be tested\r\n * @returns {boolean} true if a valid Task instance is given, false otherwise\r\n */\r\nfunction isTask(subject) {\r\n  return isOfType(TASK, subject);\r\n}\r\n\r\n/**\r\n * Appends a new Task to the given List instance and notifies the list observers\r\n * @param {Object} list A List instance\r\n * @returns {Object} The new Task instance appended to the List or null if the\r\n *  given List instanc is not valid\r\n */\r\nfunction increaseList(list) {\r\n  if (isList(list)) {\r\n    const task = createTask(list, list.head);\r\n    list.head = task;\r\n    notify(list, getOverallProgress(list));\r\n    return task;\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Updates the internal progress value of the given Task instance and notifies\r\n * the observers of the associated list.\r\n * @param {Object} task The Task instance to be updated\r\n * @param {number} value A number between 0 (inclusive) and 1 (exclusive)\r\n *  indicating the progress of the task;\r\n * @returns {void} Nothing is returned\r\n */\r\nfunction update(task, value) {\r\n  if (isTask(task) && isValidProgress(value) && value < 1.0) {\r\n    if (task.progress !== value) {\r\n      task.progress = value;\r\n      if (isList(task.list)) {\r\n        notify(task.list, getOverallProgress(task.list));\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Sets a Task instance as finished (progress = 1.0), freezes it in order to\r\n * prevent further modifications and notifies the observers of the associated\r\n * list.\r\n * @param {Object} task The Task instance to be finalized\r\n * @returns {void} Nothing is returned\r\n */\r\nfunction finish(task) {\r\n  if (isTask(task)) {\r\n    task.progress = 1.0;\r\n    task.awaiting = null;\r\n    Object.freeze(task);\r\n    if (isList(task.list)) {\r\n      notify(task.list, getOverallProgress(task.list));\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Generate a summarized snapshot of the current status of the given task List\r\n * @param {Object} list The List instance to be scanned\r\n * @returns {Object} An obeject representing the summarized status of the list\r\n */\r\nfunction getOverallProgress(list) {\r\n  const status = createStatus();\r\n  if (isList(list)) {\r\n    let task = list.head;\r\n    while (isTask(task)) {\r\n      status.total++;\r\n      if (isValidProgress(task.progress)) {\r\n        status.partial += task.progress;\r\n        if (task.progress === 1.0 && task.failed) status.failures++;\r\n      }\r\n      task = task.next;\r\n    }\r\n  }\r\n  if (status.total > 0) {\r\n    status.progress = status.partial / status.total;\r\n  }\r\n  return Object.freeze(status);\r\n}\r\n\r\n/**\r\n * Adds a Task instance to the given list that waits on a given \"thenable\". When\r\n * the thenable resolves the \"finish\" method is called on the newly created\r\n * instance thus notifying the observers of the list.\r\n * @param {Object} list The List instance to which the new task will be added\r\n * @param {Object|Promise} thenable The thenable to be waited on\r\n * @returns {Object} A reference to the newly created Task;\r\n */\r\nfunction waitOn(list, thenable) {\r\n  const task = increaseList(list);\r\n  if (isTask(task)) {\r\n    task.awaiting = Promise.resolve(thenable).then(\r\n      function() {\r\n        finish(task);\r\n      },\r\n      function() {\r\n        task.failed = true;\r\n        finish(task);\r\n      }\r\n    );\r\n    return task;\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Adds a Task instance to the given list using a deferred (a Promise that can\r\n * be externally resolved) notifying the observers of the list.\r\n * @param {Object} list The List instance to which the new task will be added\r\n * @returns {Object} An object with references to the created deferred and task\r\n */\r\nfunction addDeferred(list) {\r\n  const deferred = makeDeferred();\r\n  const task = waitOn(list, deferred.promise);\r\n  return Object.freeze({\r\n    deferred,\r\n    task,\r\n  });\r\n}\r\n\r\n/**\r\n * Assigns a name to a specific task of the list\r\n * @param {Object} list The List instance whose task will be named\r\n * @param {Object} task The specified Task instance\r\n * @param {string} name The name of the task\r\n * @returns {boolean} Returns true on success, false otherwise\r\n */\r\nfunction setTaskName(list, task, name) {\r\n  if (\r\n    contains(list, task) &&\r\n    list.named !== null &&\r\n    typeof list.named === 'object' &&\r\n    typeof name === 'string'\r\n  ) {\r\n    list.named[name] = task;\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Retrieves a task by name\r\n * @param {Object} list The List instance whose task will be retrieved\r\n * @param {string} name The name of the task to be retrieved\r\n * @returns {Object} The Task instance or null if not found\r\n */\r\nfunction getTaskByName(list, name) {\r\n  if (\r\n    isList(list) &&\r\n    list.named !== null &&\r\n    typeof list.named === 'object' &&\r\n    typeof name === 'string'\r\n  ) {\r\n    const task = list.named[name];\r\n    if (isTask(task)) {\r\n      return task;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Adds an observer (callback function) to a given List instance\r\n * @param {Object} list The List instance to which the observer will be appended\r\n * @param {Function} observer The observer (function) that will be executed\r\n *  every time a change happens within the list\r\n * @returns {boolean} Returns true on success and false otherewise\r\n */\r\nfunction addObserver(list, observer) {\r\n  if (\r\n    isList(list) &&\r\n    Array.isArray(list.observers) &&\r\n    typeof observer === 'function'\r\n  ) {\r\n    list.observers.push(observer);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Removes an observer (callback function) from a given List instance\r\n * @param {Object} list The instance List from which the observer will removed\r\n * @param {Function} observer The observer function to be removed\r\n * @returns {boolean} Returns true on success and false otherewise\r\n */\r\nfunction removeObserver(list, observer) {\r\n  if (\r\n    isList(list) &&\r\n    Array.isArray(list.observers) &&\r\n    list.observers.length > 0\r\n  ) {\r\n    const index = list.observers.indexOf(observer);\r\n    if (index >= 0) {\r\n      list.observers.splice(index, 1);\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Utils\r\n */\r\n\r\nfunction createStatus() {\r\n  return Object.seal({\r\n    total: 0,\r\n    partial: 0.0,\r\n    progress: 0.0,\r\n    failures: 0,\r\n  });\r\n}\r\n\r\nfunction objectWithType(type, object) {\r\n  return Object.seal(Object.defineProperty(object, TYPE, { value: type }));\r\n}\r\n\r\nfunction isOfType(type, subject) {\r\n  return (\r\n    subject !== null && typeof subject === 'object' && subject[TYPE] === type\r\n  );\r\n}\r\n\r\nfunction isValidProgress(value) {\r\n  return typeof value === 'number' && value >= 0.0 && value <= 1.0;\r\n}\r\n\r\nfunction contains(list, task) {\r\n  if (isList(list) && isTask(task)) {\r\n    let item = list.head;\r\n    while (isTask(item)) {\r\n      if (item === task) {\r\n        return true;\r\n      }\r\n      item = item.next;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction notify(list, data) {\r\n  if (\r\n    isList(list) &&\r\n    Array.isArray(list.observers) &&\r\n    list.observers.length > 0\r\n  ) {\r\n    list.observers.slice().forEach(function(observer) {\r\n      if (typeof observer === 'function') {\r\n        try {\r\n          observer(data, list);\r\n        } catch (e) {\r\n          /* Oops! */\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Exports\r\n */\r\n\r\nconst progressTrackingUtils = {\r\n  createList,\r\n  isList,\r\n  createTask,\r\n  isTask,\r\n  increaseList,\r\n  update,\r\n  finish,\r\n  getOverallProgress,\r\n  waitOn,\r\n  addDeferred,\r\n  setTaskName,\r\n  getTaskByName,\r\n  addObserver,\r\n  removeObserver,\r\n};\r\n\r\nexport default progressTrackingUtils;\r\n","const LOW_PRIORITY_MODALITIES = Object.freeze(['SEG', 'KO', 'PR', 'SR', 'RTSTRUCT']);\r\n\r\nexport default function isLowPriorityModality(Modality) {\r\n  return LOW_PRIORITY_MODALITIES.includes(Modality);\r\n}\r\n","import ObjectPath from './objectPath';\r\nimport StackManager from './StackManager.js';\r\nimport absoluteUrl from './absoluteUrl';\r\nimport guid from './guid';\r\nimport sortBy from './sortBy.js';\r\nimport sortBySeriesDate from './sortBySeriesDate.js';\r\nimport writeScript from './writeScript.js';\r\nimport DicomLoaderService from './dicomLoaderService.js';\r\nimport b64toBlob from './b64toBlob.js';\r\n//import loadAndCacheDerivedDisplaySets from './loadAndCacheDerivedDisplaySets.js';\r\nimport urlUtil from './urlUtil';\r\nimport makeDeferred from './makeDeferred';\r\nimport makeCancelable from './makeCancelable';\r\nimport hotkeys from './hotkeys';\r\nimport Queue from './Queue';\r\nimport isDicomUid from './isDicomUid';\r\nimport formatDate from './formatDate';\r\nimport formatPN from './formatPN';\r\nimport resolveObjectPath from './resolveObjectPath';\r\nimport hierarchicalListUtils from './hierarchicalListUtils';\r\nimport progressTrackingUtils from './progressTrackingUtils';\r\nimport isLowPriorityModality from './isLowPriorityModality';\r\n\r\n// Commented out unused functionality.\r\n// Need to implement new mechanism for dervived displaySets using the displaySetManager.\r\n\r\nconst utils = {\r\n  guid,\r\n  ObjectPath,\r\n  absoluteUrl,\r\n  sortBy,\r\n  sortBySeriesDate,\r\n  writeScript,\r\n  formatDate,\r\n  formatPN,\r\n  b64toBlob,\r\n  StackManager,\r\n  DicomLoaderService,\r\n  urlUtil,\r\n  //loadAndCacheDerivedDisplaySets,\r\n  makeDeferred,\r\n  makeCancelable,\r\n  hotkeys,\r\n  Queue,\r\n  isDicomUid,\r\n  resolveObjectPath,\r\n  hierarchicalListUtils,\r\n  progressTrackingUtils,\r\n  isLowPriorityModality,\r\n};\r\n\r\nexport {\r\n  guid,\r\n  ObjectPath,\r\n  absoluteUrl,\r\n  sortBy,\r\n  formatDate,\r\n  writeScript,\r\n  b64toBlob,\r\n  StackManager,\r\n  DicomLoaderService,\r\n  urlUtil,\r\n  //loadAndCacheDerivedDisplaySets,\r\n  makeDeferred,\r\n  makeCancelable,\r\n  hotkeys,\r\n  Queue,\r\n  isDicomUid,\r\n  resolveObjectPath,\r\n  hierarchicalListUtils,\r\n  progressTrackingUtils,\r\n  isLowPriorityModality,\r\n};\r\n\r\nexport default utils;\r\n","/* jshint -W060 */\r\nimport absoluteUrl from './absoluteUrl';\r\n\r\nexport default function writeScript(fileName, callback) {\r\n  const script = document.createElement('script');\r\n  script.src = absoluteUrl(fileName);\r\n  script.onload = () => {\r\n    if (typeof callback === 'function') {\r\n      callback(script);\r\n    }\r\n  };\r\n\r\n  document.body.appendChild(script);\r\n}\r\n","import moment from 'moment';\r\n\r\n/**\r\n * Format date\r\n *\r\n * @param {string} date Date to be formatted\r\n * @param {string} format Desired date format\r\n * @returns {string} Formatted date\r\n */\r\nexport default (date, format = 'DD-MMM-YYYY') => {\r\n  return moment(date).format(format);\r\n};\r\n","/**\r\n * Formats a patient name for display purposes\r\n */\r\nexport default function formatPN(name) {\r\n  if (!name) {\r\n    return;\r\n  }\r\n\r\n  // Convert the first ^ to a ', '. String.replace() only affects\r\n  // the first appearance of the character.\r\n  const commaBetweenFirstAndLast = name.replace('^', ', ');\r\n\r\n  // Replace any remaining '^' characters with spaces\r\n  const cleaned = commaBetweenFirstAndLast.replace(/\\^/g, ' ');\r\n\r\n  // Trim any extraneous whitespace\r\n  return cleaned.trim();\r\n}\r\n","export default function makeCancelable(thenable) {\r\n  let isCanceled = false;\r\n  const promise = Promise.resolve(thenable).then(\r\n    function(result) {\r\n      if (isCanceled) throw Object.freeze({ isCanceled });\r\n      return result;\r\n    },\r\n    function(error) {\r\n      if (isCanceled) throw Object.freeze({ isCanceled, error });\r\n      throw error;\r\n    }\r\n  );\r\n  return Object.assign(Object.create(promise), {\r\n    then: promise.then.bind(promise),\r\n    cancel() {\r\n      isCanceled = true;\r\n    },\r\n  });\r\n}\r\n","export default function isDicomUid(subject) {\r\n  const regex = /^\\d+(?:\\.\\d+)*$/;\r\n  return typeof subject === 'string' && regex.test(subject.trim());\r\n}\r\n","export default function resolveObjectPath(root, path, defaultValue) {\r\n  if (root !== null && typeof root === 'object' && typeof path === 'string') {\r\n    let value,\r\n      separator = path.indexOf('.');\r\n    if (separator >= 0) {\r\n      return resolveObjectPath(\r\n        root[path.slice(0, separator)],\r\n        path.slice(separator + 1, path.length),\r\n        defaultValue\r\n      );\r\n    }\r\n    value = root[path];\r\n    return value === undefined && defaultValue !== undefined\r\n      ? defaultValue\r\n      : value;\r\n  }\r\n}\r\n","// Return the array sorting function for its object's properties\r\nexport default function sortBy() {\r\n  var fields = [].slice.call(arguments),\r\n    n_fields = fields.length;\r\n\r\n  return function(A, B) {\r\n    var a, b, field, key, reverse, result, i;\r\n\r\n    for (i = 0; i < n_fields; i++) {\r\n      result = 0;\r\n      field = fields[i];\r\n\r\n      key = typeof field === 'string' ? field : field.name;\r\n\r\n      a = A[key];\r\n      b = B[key];\r\n\r\n      if (typeof field.primer !== 'undefined') {\r\n        a = field.primer(a);\r\n        b = field.primer(b);\r\n      }\r\n\r\n      reverse = field.reverse ? -1 : 1;\r\n\r\n      if (a < b) {\r\n        result = reverse * -1;\r\n      }\r\n\r\n      if (a > b) {\r\n        result = reverse * 1;\r\n      }\r\n\r\n      if (result !== 0) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return result;\r\n  };\r\n}\r\n","import React, {\r\n  useState,\r\n  createContext,\r\n  useContext,\r\n  useCallback,\r\n  useEffect,\r\n  useRef,\r\n} from 'react';\r\n\r\nimport PropTypes from 'prop-types';\r\nimport Draggable from 'react-draggable';\r\nimport classNames from 'classnames';\r\n\r\n/*\r\n * This is a workaround to import things from ohif/core as docz does\r\n * not allow us to access window element and @ohif/core does use it once\r\n * we import to instanciate cornerstone\r\n */\r\nimport guid from './../../../core/src/utils/guid';\r\n\r\nimport './DialogProvider.css';\r\n\r\nconst DialogContext = createContext(null);\r\n\r\nexport const useDialog = () => useContext(DialogContext);\r\n\r\nconst DialogProvider = ({ children, service }) => {\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const [dialogs, setDialogs] = useState([]);\r\n  const [lastDialogId, setLastDialogId] = useState(null);\r\n  const [lastDialogPosition, setLastDialogPosition] = useState(null);\r\n  const [centerPositions, setCenterPositions] = useState([]);\r\n\r\n  useEffect(() => {\r\n    setCenterPositions(\r\n      dialogs.map(dialog => ({\r\n        id: dialog.id,\r\n        ...getCenterPosition(dialog.id),\r\n      }))\r\n    );\r\n  }, [dialogs]);\r\n\r\n  const getCenterPosition = id => {\r\n    const root = document.querySelector('#root');\r\n    const centerX = root.offsetLeft + root.offsetWidth / 2;\r\n    const centerY = root.offsetTop + root.offsetHeight / 2;\r\n    const item = document.querySelector(`#draggableItem-${id}`);\r\n    const itemBounds = item.getBoundingClientRect();\r\n    return {\r\n      x: centerX - itemBounds.width / 2,\r\n      y: centerY - itemBounds.height / 2,\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Sets the implementation of a dialog service that can be used by extensions.\r\n   *\r\n   * @returns void\r\n   */\r\n  useEffect(() => {\r\n    if (service) {\r\n      service.setServiceImplementation({ create, dismiss, dismissAll });\r\n    }\r\n  }, [create, dismiss, service]);\r\n\r\n  /**\r\n   * UI Dialog\r\n   *\r\n   * @typedef {Object} DialogProps\r\n   * @property {string} id The dialog id.\r\n   * @property {DialogContent} content The dialog content.\r\n   * @property {Object} contentProps The dialog content props.\r\n   * @property {boolean} isDraggable Controls if dialog content is draggable or not.\r\n   * @property {boolean} showOverlay Controls dialog overlay.\r\n   * @property {boolean} centralize Center the dialog on the screen.\r\n   * @property {boolean} preservePosition Use last position instead of default.\r\n   * @property {ElementPosition} defaultPosition Specifies the `x` and `y` that the dragged item should start at.\r\n   * @property {Function} onStart Called when dragging starts. If `false` is returned any handler, the action will cancel.\r\n   * @property {Function} onStop Called when dragging stops.\r\n   * @property {Function} onDrag Called while dragging.\r\n   */\r\n\r\n  useEffect(() => _bringToFront(lastDialogId), [_bringToFront, lastDialogId]);\r\n\r\n  /**\r\n   * Creates a new dialog and return its id.\r\n   *\r\n   * @param {DialogProps} props The dialog props.\r\n   * @returns The new dialog id.\r\n   */\r\n  const create = useCallback(props => {\r\n    const { id } = props;\r\n\r\n    let dialogId = id;\r\n    if (!dialogId) {\r\n      dialogId = guid();\r\n    }\r\n\r\n    setDialogs(dialogs => [...dialogs, { ...props, id: dialogId }]);\r\n    setLastDialogId(dialogId);\r\n\r\n    return dialogId;\r\n  }, []);\r\n\r\n  /**\r\n   * Dismisses the dialog with a given id.\r\n   *\r\n   * @param {Object} props -\r\n   * @property {string} props.id The dialog id.\r\n   * @returns void\r\n   */\r\n  const dismiss = useCallback(\r\n    ({ id }) =>\r\n      setDialogs(dialogs => dialogs.filter(dialog => dialog.id !== id)),\r\n    []\r\n  );\r\n\r\n  /**\r\n   * Dismisses all dialogs.\r\n   *\r\n   * @returns void\r\n   */\r\n  const dismissAll = () => {\r\n    setDialogs([]);\r\n  };\r\n\r\n  /**\r\n   * Indicate if there are no dialogs present.\r\n   *\r\n   * @returns True if no dialogs are present.\r\n   */\r\n  const isEmpty = () => dialogs && dialogs.length < 1;\r\n\r\n  /**\r\n   * Moves the dialog to the foreground if clicked.\r\n   *\r\n   * @param {string} id The dialog id.\r\n   * @returns void\r\n   */\r\n  const _bringToFront = useCallback(id => {\r\n    setDialogs(dialogs => {\r\n      const topDialog = dialogs.find(dialog => dialog.id === id);\r\n      return topDialog\r\n        ? [...dialogs.filter(dialog => dialog.id !== id), topDialog]\r\n        : dialogs;\r\n    });\r\n  }, []);\r\n\r\n  const renderDialogs = () =>\r\n    dialogs.map(dialog => {\r\n      const {\r\n        id,\r\n        content: DialogContent,\r\n        contentProps,\r\n        defaultPosition,\r\n        centralize = false,\r\n        preservePosition = true,\r\n        isDraggable = true,\r\n        onStart,\r\n        onStop,\r\n        onDrag,\r\n        onClickOutside,\r\n        showOverlay,\r\n      } = dialog;\r\n\r\n      let position =\r\n        (preservePosition && lastDialogPosition) || defaultPosition;\r\n      if (centralize) {\r\n        position = centerPositions.find(position => position.id === id);\r\n      }\r\n\r\n      const dragableItem = () => (\r\n        <Draggable\r\n          key={id}\r\n          disabled={!isDraggable}\r\n          position={position}\r\n          defaultPosition={position}\r\n          bounds=\"parent\"\r\n          onStart={event => {\r\n            const e = event || (typeof window !== 'undefined' && window.event);\r\n            const target = e.target || e.srcElement;\r\n            const BLACKLIST = [\r\n              'SVG',\r\n              'BUTTON',\r\n              'PATH',\r\n              'INPUT',\r\n              'SPAN',\r\n              'LABEL',\r\n            ];\r\n            if (BLACKLIST.includes(target.tagName.toUpperCase())) {\r\n              return false;\r\n            }\r\n\r\n            if (validCallback(onStart)) {\r\n              return onStart(event);\r\n            }\r\n          }}\r\n          onStop={event => {\r\n            setIsDragging(false);\r\n\r\n            if (validCallback(onStop)) {\r\n              return onStop(event);\r\n            }\r\n          }}\r\n          onDrag={event => {\r\n            setIsDragging(true);\r\n            _bringToFront(id);\r\n            _updateLastDialogPosition(id);\r\n\r\n            if (validCallback(onDrag)) {\r\n              return onDrag(event);\r\n            }\r\n          }}\r\n        >\r\n          <div\r\n            id={`draggableItem-${id}`}\r\n            className={classNames(\r\n              'DraggableItem',\r\n              isDragging && 'dragging',\r\n              isDraggable && 'draggable'\r\n            )}\r\n            style={{ zIndex: '999', position: 'absolute' }}\r\n            onClick={() => _bringToFront(id)}\r\n          >\r\n            <DialogContent {...dialog} {...contentProps} />\r\n          </div>\r\n        </Draggable>\r\n      );\r\n\r\n      const withOverlay = component => {\r\n        const background = 'bg-black bg-opacity-50';\r\n        const overlay = 'fixed z-50 left-0 top-0 w-full h-full overflow-auto';\r\n        return (\r\n          <div className={classNames(overlay, background)} key={id}>\r\n            {component}\r\n          </div>\r\n        );\r\n      };\r\n\r\n      let result = dragableItem();\r\n\r\n      if (showOverlay) {\r\n        result = withOverlay(result);\r\n      }\r\n\r\n      if (typeof onClickOutside === 'function') {\r\n        result = (\r\n          <OutsideAlerter key={id} onClickOutside={onClickOutside}>\r\n            {result}\r\n          </OutsideAlerter>\r\n        );\r\n      }\r\n\r\n      return result;\r\n    });\r\n\r\n  /**\r\n   * Update the last dialog position to be used as the new default position.\r\n   *\r\n   * @returns void\r\n   */\r\n  const _updateLastDialogPosition = dialogId => {\r\n    const draggableItemBounds = document\r\n      .querySelector(`#draggableItem-${dialogId}`)\r\n      .getBoundingClientRect();\r\n    setLastDialogPosition({\r\n      x: draggableItemBounds.x,\r\n      y: draggableItemBounds.y,\r\n    });\r\n  };\r\n\r\n  const onKeyDownHandler = event => {\r\n    if (event.key === 'Escape') {\r\n      dismissAll();\r\n    }\r\n  };\r\n\r\n  const validCallback = callback => callback && typeof callback === 'function';\r\n\r\n  return (\r\n    <DialogContext.Provider value={{ create, dismiss, dismissAll, isEmpty }}>\r\n      {!isEmpty() && (\r\n        <div className=\"w-full h-full absolute\" onKeyDown={onKeyDownHandler}>\r\n          {renderDialogs()}\r\n        </div>\r\n      )}\r\n      {children}\r\n    </DialogContext.Provider>\r\n  );\r\n};\r\n\r\n/**\r\n *\r\n * High Order Component to use the dialog methods through a Class Component\r\n *\r\n */\r\nexport const withDialog = Component => {\r\n  return function WrappedComponent(props) {\r\n    const { create, dismiss, dismissAll, isEmpty } = useDialog();\r\n    return (\r\n      <Component {...props} dialog={{ create, dismiss, dismissAll, isEmpty }} />\r\n    );\r\n  };\r\n};\r\n\r\nDialogProvider.defaultProps = {\r\n  service: null,\r\n};\r\n\r\nDialogProvider.propTypes = {\r\n  children: PropTypes.oneOfType([\r\n    PropTypes.arrayOf(PropTypes.node),\r\n    PropTypes.node,\r\n    PropTypes.func,\r\n  ]).isRequired,\r\n  service: PropTypes.shape({\r\n    setServiceImplementation: PropTypes.func,\r\n  }),\r\n};\r\n\r\nexport default DialogProvider;\r\n\r\nfunction OutsideAlerter(props) {\r\n  const wrapperRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    /**\r\n     * Alert if clicked on outside of element\r\n     */\r\n    function handleInteractionOutside(event) {\r\n      if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {\r\n        props.onClickOutside();\r\n      }\r\n    }\r\n\r\n    // Bind the event listener\r\n    document.addEventListener('mousedown', handleInteractionOutside);\r\n    document.addEventListener('touchstart', handleInteractionOutside);\r\n    return () => {\r\n      // Unbind the event listener on clean up\r\n      document.removeEventListener('mousedown', handleInteractionOutside);\r\n      document.removeEventListener('touchstart', handleInteractionOutside);\r\n    };\r\n  }, [wrapperRef]);\r\n\r\n  return <div ref={wrapperRef}>{props.children}</div>;\r\n}\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { DndProvider } from 'react-dnd';\r\nimport { HTML5Backend } from 'react-dnd-html5-backend';\r\n\r\n// import TouchBackend from 'react-dnd-touch-backend';\r\n\r\n// TODO: this is false when it should not be :thinking:\r\nconst isTouchDevice =\r\n  typeof window !== `undefined` &&\r\n  !!('ontouchstart' in window || navigator.maxTouchPoints);\r\n\r\n/**\r\n * Relevant:\r\n * https://github.com/react-dnd/react-dnd/issues/186#issuecomment-335429067\r\n * https://github.com/react-dnd/react-dnd/issues/186#issuecomment-282789420\r\n *\r\n * Docs:\r\n * http://react-dnd.github.io/react-dnd/docs/api/drag-drop-context\r\n */\r\nfunction DragAndDropProvider({ children }) {\r\n  const backend = HTML5Backend; // isTouchDevice ? TouchBackend : HTML5Backend;\r\n  const opts = {}; // isTouchDevice ? { enableMouseEvents: true } : {};\r\n\r\n  console.log('using... touch backend?', isTouchDevice);\r\n\r\n  return (\r\n    <DndProvider backend={backend} opts={opts}>\r\n      {children}\r\n    </DndProvider>\r\n  );\r\n}\r\n\r\nDragAndDropProvider.propTypes = {\r\n  children: PropTypes.any,\r\n};\r\n\r\nexport default DragAndDropProvider;\r\n","import React, {\r\n  useState,\r\n  createContext,\r\n  useContext,\r\n  useEffect,\r\n  useCallback,\r\n} from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nconst ModalContext = createContext(null);\r\nconst { Provider } = ModalContext;\r\n\r\nexport const useModal = () => useContext(ModalContext);\r\n\r\n/**\r\n * UI Modal\r\n *\r\n * @typedef {Object} ModalProps\r\n * @property {ReactElement|HTMLElement} [content=null] Modal content.\r\n * @property {Object} [contentProps=null] Modal content props.\r\n * @property {boolean} [shouldCloseOnEsc=true] Modal is dismissible via the esc key.\r\n * @property {boolean} [isOpen=true] Make the Modal visible or hidden.\r\n * @property {boolean} [closeButton=true] Should the modal body render the close button.\r\n * @property {string} [title=null] Should the modal render the title independently of the body content.\r\n * @property {string} [customClassName=null] The custom class to style the modal.\r\n */\r\n\r\nconst ModalProvider = ({ children, modal: Modal, service }) => {\r\n  const DEFAULT_OPTIONS = {\r\n    content: null,\r\n    contentProps: null,\r\n    shouldCloseOnEsc: true,\r\n    isOpen: true,\r\n    closeButton: true,\r\n    title: null,\r\n    customClassName: '',\r\n  };\r\n  const { t } = useTranslation('Modals');\r\n\r\n\r\n  const [options, setOptions] = useState(DEFAULT_OPTIONS);\r\n\r\n  /**\r\n   * Show the modal and override its configuration props.\r\n   *\r\n   * @param {ModalProps} props { content, contentProps, shouldCloseOnEsc, isOpen, closeButton, title, customClassName }\r\n   * @returns void\r\n   */\r\n  const show = useCallback(props => setOptions({ ...options, ...props }), [\r\n    options,\r\n  ]);\r\n\r\n  /**\r\n   * Hide the modal and set its properties to default.\r\n   *\r\n   * @returns void\r\n   */\r\n  const hide = useCallback(() => setOptions(DEFAULT_OPTIONS), [\r\n    DEFAULT_OPTIONS,\r\n  ]);\r\n\r\n  /**\r\n   * Sets the implementation of a modal service that can be used by extensions.\r\n   *\r\n   * @returns void\r\n   */\r\n  useEffect(() => {\r\n    if (service) {\r\n      service.setServiceImplementation({ hide, show });\r\n    }\r\n  }, [hide, service, show]);\r\n\r\n  const {\r\n    content: ModalContent,\r\n    contentProps,\r\n    isOpen,\r\n    title,\r\n    customClassName,\r\n    shouldCloseOnEsc,\r\n    closeButton,\r\n  } = options;\r\n\r\n  return (\r\n    <Provider value={{ show, hide }}>\r\n      {ModalContent && (\r\n        <Modal\r\n          className={classNames(customClassName, ModalContent.className)}\r\n          shouldCloseOnEsc={shouldCloseOnEsc}\r\n          isOpen={isOpen}\r\n          title={t(title)}\r\n          closeButton={closeButton}\r\n          onClose={hide}\r\n        >\r\n          <ModalContent {...contentProps} show={show} hide={hide} />\r\n        </Modal>\r\n      )}\r\n      {children}\r\n    </Provider>\r\n  );\r\n};\r\n\r\n/**\r\n * Higher Order Component to use the modal methods through a Class Component.\r\n *\r\n * @returns\r\n */\r\nexport const withModal = Component => {\r\n  return function WrappedComponent(props) {\r\n    const { show, hide } = useModal();\r\n    return <Component {...props} modal={{ show, hide }} />;\r\n  };\r\n};\r\n\r\nModalProvider.defaultProps = {\r\n  service: null,\r\n};\r\n\r\nModalProvider.propTypes = {\r\n  children: PropTypes.oneOfType([\r\n    PropTypes.arrayOf(PropTypes.node),\r\n    PropTypes.node,\r\n  ]).isRequired,\r\n  modal: PropTypes.oneOfType([\r\n    PropTypes.arrayOf(PropTypes.node),\r\n    PropTypes.node,\r\n    PropTypes.func,\r\n  ]).isRequired,\r\n  service: PropTypes.shape({\r\n    setServiceImplementation: PropTypes.func,\r\n  }),\r\n};\r\n\r\nexport default ModalProvider;\r\n\r\nexport const ModalConsumer = ModalContext.Consumer;\r\n","import React, { createContext, useContext, useReducer, useMemo } from 'react';\r\n\r\n// export const IMAGE_VIEWER_DEFAULT_VALUE = {\r\n//   StudyInstanceUIDs: [],\r\n//   setImageViewer: () => {},\r\n// };\r\n\r\nexport const ImageViewerContext = createContext();\r\n\r\nexport function ImageViewerProvider({\r\n  StudyInstanceUIDs,\r\n  reducer,\r\n  initialState,\r\n  children,\r\n}) {\r\n  const value = useMemo(() => {\r\n    return { StudyInstanceUIDs };\r\n  }, [StudyInstanceUIDs]);\r\n\r\n  return (\r\n    <ImageViewerContext.Provider value={value}>\r\n      {children}\r\n    </ImageViewerContext.Provider>\r\n  );\r\n}\r\n\r\nexport const useImageViewer = () => useContext(ImageViewerContext);\r\n","import React, {\r\n  createContext,\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useReducer,\r\n} from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst DEFAULT_STATE = {\r\n  isCineEnabled: false,\r\n  cines: {\r\n    /*\r\n     * 1: { isPlaying: false, frameRate: 24 };\r\n     */\r\n  }\r\n};\r\n\r\nconst DEFAULT_CINE = { isPlaying: false, frameRate: 24 };\r\n\r\nexport const CineContext = createContext(DEFAULT_STATE);\r\n\r\nexport default function CineProvider({ children, service }) {\r\n  const reducer = (state, action) => {\r\n    switch (action.type) {\r\n      case 'SET_CINE': {\r\n        const { id, frameRate, isPlaying = undefined } = action.payload;\r\n        const cines = state.cines;\r\n\r\n        if (!cines[id]) cines[id] = { id, ...DEFAULT_CINE };\r\n        cines[id].frameRate = frameRate || cines[id].frameRate;\r\n        cines[id].isPlaying = isPlaying !== undefined ? isPlaying : cines[id].isPlaying;\r\n\r\n        return { ...state, ...{ cines } };\r\n      }\r\n      case 'SET_IS_CINE_ENABLED': {\r\n        return { ...state, ...{ isCineEnabled: action.payload } };\r\n      }\r\n      default:\r\n        return action.payload;\r\n    }\r\n  };\r\n\r\n  const [state, dispatch] = useReducer(\r\n    reducer,\r\n    DEFAULT_STATE\r\n  );\r\n\r\n  const getState = useCallback(() => state, [state]);\r\n\r\n  const setIsCineEnabled = useCallback(\r\n    isCineEnabled => dispatch({ type: 'SET_IS_CINE_ENABLED', payload: isCineEnabled }),\r\n    [dispatch]\r\n  );\r\n\r\n  const setCine = useCallback(\r\n    ({ id, frameRate, isPlaying }) =>\r\n      dispatch({\r\n        type: 'SET_CINE',\r\n        payload: {\r\n          id,\r\n          frameRate,\r\n          isPlaying,\r\n        },\r\n      }),\r\n    [dispatch]\r\n  );\r\n\r\n  /**\r\n   * Sets the implementation of a modal service that can be used by extensions.\r\n   *\r\n   * @returns void\r\n   */\r\n  useEffect(() => {\r\n    if (service) {\r\n      service.setServiceImplementation({ getState, setIsCineEnabled, setCine });\r\n    }\r\n  }, [\r\n    getState,\r\n    service,\r\n    setCine,\r\n    setIsCineEnabled,\r\n  ]);\r\n\r\n  const api = {\r\n    getState,\r\n    setCine,\r\n    setIsCineEnabled,\r\n  };\r\n\r\n  return (\r\n    <CineContext.Provider value={[state, api]}>\r\n      {children}\r\n    </CineContext.Provider>\r\n  );\r\n}\r\n\r\nCineProvider.propTypes = {\r\n  children: PropTypes.any,\r\n  service: PropTypes.shape({\r\n    setServiceImplementation: PropTypes.func,\r\n  }).isRequired,\r\n};\r\n\r\nexport const useCine = () => useContext(CineContext);\r\n","export default {\r\n  INFO: 'info',\r\n  WARNING: 'warning',\r\n  SUCCESS: 'success',\r\n  ERROR: 'error',\r\n};\r\n","import React, { useEffect } from 'react';\r\nimport classNames from 'classnames';\r\n\r\nimport SnackbarTypes from './SnackbarTypes';\r\n\r\nconst SnackbarItem = ({ options, onClose }) => {\r\n  const handleClose = () => onClose(options.id);\r\n\r\n  useEffect(() => {\r\n    if (options.autoClose) {\r\n      setTimeout(() => handleClose(), options.duration);\r\n    }\r\n  }, []);\r\n\r\n  const typeClasses = {\r\n    [SnackbarTypes.INFO]: 'bg-primary-active',\r\n    [SnackbarTypes.WARNING]: 'bg-yellow-600',\r\n    [SnackbarTypes.SUCCESS]: 'bg-green-600',\r\n    [SnackbarTypes.ERROR]: 'bg-red-600'\r\n  };\r\n\r\n  const hidden = 'duration-300 transition-all ease-in-out h-0 opacity-0 pt-0 mb-0 pb-0';\r\n\r\n  return (\r\n    <div\r\n      className={classNames(\r\n        `${options.visible ? '' : hidden} sb-item`,\r\n        typeClasses[options.type]\r\n      )}\r\n    >\r\n      <span className=\"sb-closeBtn\" onClick={handleClose}>\r\n        <span className=\"sb-closeIcon\">x</span>\r\n      </span>\r\n      {options.title && <div className=\"sb-title\">{options.title}</div>}\r\n      {options.message && <div className=\"sb-message\">{options.message}</div>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SnackbarItem;\r\n","import React from 'react';\r\nimport SnackbarItem from './SnackbarItem'\r\nimport { useSnackbar } from '../../contextProviders/SnackbarProvider';\r\n\r\nimport './Snackbar.css';\r\n\r\nconst SnackbarContainer = () => {\r\n  const { snackbarItems, hide } = useSnackbar();\r\n\r\n  const renderItem = item => (\r\n    <SnackbarItem\r\n      key={item.itemId}\r\n      options={item}\r\n      onClose={hide}\r\n    />\r\n  );\r\n\r\n  const renderItems = () => {\r\n    const items = {\r\n      topLeft: [],\r\n      topCenter: [],\r\n      topRight: [],\r\n      bottomLeft: [],\r\n      bottomCenter: [],\r\n      bottomRight: [],\r\n    };\r\n\r\n    snackbarItems.forEach(item => items[item.position].push(item));\r\n\r\n    return snackbarItems && (\r\n      <div>\r\n        {Object.keys(items).map(pos => {\r\n          if (!items[pos].length) {\r\n            return null;\r\n          }\r\n\r\n          return (\r\n            <div key={pos} className={`fixed z-50 p-6 box-border h-auto sb-${pos}`}>\r\n              {items[pos].map((item, index) => (\r\n                <div key={item.id + index}>{renderItem(item)}</div>\r\n              ))}\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return <>{renderItems()}</>;\r\n};\r\n\r\nexport default SnackbarContainer;\r\n","import React, {\r\n  useState,\r\n  createContext,\r\n  useContext,\r\n  useCallback,\r\n  useEffect,\r\n} from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport SnackbarTypes from '../components/Snackbar/SnackbarTypes';\r\nimport SnackbarContainer from '../components/Snackbar/SnackbarContainer';\r\n\r\nconst SnackbarContext = createContext(null);\r\n\r\nexport const useSnackbar = () => useContext(SnackbarContext);\r\n\r\nconst SnackbarProvider = ({ children, service }) => {\r\n  const DEFAULT_OPTIONS = {\r\n    title: '',\r\n    message: '',\r\n    duration: 5000,\r\n    autoClose: true,\r\n    position: 'bottomRight',\r\n    type: SnackbarTypes.INFO,\r\n  };\r\n\r\n  const [count, setCount] = useState(1);\r\n  const [snackbarItems, setSnackbarItems] = useState([]);\r\n\r\n  /**\r\n   * Sets the implementation of a notification service that can be used by extensions.\r\n   *\r\n   * @returns void\r\n   */\r\n  useEffect(() => {\r\n    if (service) {\r\n      service.setServiceImplementation({ hide, show });\r\n    }\r\n  }, [service, hide, show]);\r\n\r\n  const show = useCallback(\r\n    options => {\r\n      if (!options || (!options.title && !options.message)) {\r\n        console.warn(\r\n          'Snackbar cannot be rendered without required parameters: title | message'\r\n        );\r\n\r\n        return null;\r\n      }\r\n\r\n      const newItem = {\r\n        ...DEFAULT_OPTIONS,\r\n        ...options,\r\n        id: count,\r\n        visible: true,\r\n      };\r\n\r\n      setSnackbarItems(state => [...state, newItem]);\r\n      setCount(count + 1);\r\n    },\r\n    [count, DEFAULT_OPTIONS]\r\n  );\r\n\r\n  const hide = useCallback(\r\n    id => {\r\n      const hideItem = items => {\r\n        const newItems = items.map(item => {\r\n          if (item.id === id) {\r\n            item.visible = false;\r\n          }\r\n\r\n          return item;\r\n        });\r\n\r\n        return newItems;\r\n      };\r\n\r\n      setSnackbarItems(state => hideItem(state));\r\n\r\n      setTimeout(() => {\r\n        setSnackbarItems(state => [...state.filter(item => item.id !== id)]);\r\n      }, 1000);\r\n    },\r\n    [setSnackbarItems]\r\n  );\r\n\r\n  const hideAll = () => {\r\n    // reset count\r\n    setCount(1);\r\n\r\n    // remove all items from array\r\n    setSnackbarItems(() => []);\r\n  };\r\n\r\n  if (typeof window !== 'undefined') {\r\n    /**\r\n     * expose snackbar methods to window for debug purposes\r\n     * TODO: Check if it's really necessary\r\n     */\r\n    window.snackbar = {\r\n      show,\r\n      hide,\r\n      hideAll,\r\n    };\r\n  }\r\n\r\n  return (\r\n    <SnackbarContext.Provider value={{ show, hide, hideAll, snackbarItems }}>\r\n      {!!snackbarItems && <SnackbarContainer />}\r\n      {children}\r\n    </SnackbarContext.Provider>\r\n  );\r\n};\r\n\r\nSnackbarProvider.defaultProps = {\r\n  service: null,\r\n};\r\n\r\nSnackbarProvider.propTypes = {\r\n  children: PropTypes.oneOfType([\r\n    PropTypes.arrayOf(PropTypes.node),\r\n    PropTypes.node,\r\n    PropTypes.func,\r\n  ]).isRequired,\r\n  service: PropTypes.shape({\r\n    setServiceImplementation: PropTypes.func,\r\n  }),\r\n};\r\n\r\n/**\r\n *\r\n * High Order Component to use the snackbar methods through a Class Component\r\n *\r\n */\r\nexport const withSnackbar = Component => {\r\n  return function WrappedComponent(props) {\r\n    const snackbarContext = {\r\n      ...useSnackbar(),\r\n    };\r\n    return <Component {...props} snackbarContext={snackbarContext} />;\r\n  };\r\n};\r\n\r\nexport default SnackbarProvider;\r\n","import React, {\r\n  useState,\r\n  createContext,\r\n  useContext,\r\n  useCallback,\r\n  useEffect,\r\n} from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst DEFAULT_STATE = {\r\n  viewportIndex: null,\r\n  message: undefined,\r\n  type: 'info', // \"error\" | \"warning\" | \"info\" | \"success\"\r\n  actions: undefined, // array of { type, text, value }\r\n  // dismissable?\r\n  // blockInteraction (single viewport? allViewports? everything?)\r\n  // TODO: Buttons --> type/color? text? value?\r\n  onSubmit: () => {\r\n    console.log('btn value?');\r\n  },\r\n  onOutsideClick: () => {\r\n    console.warn('default: onOutsideClick')\r\n  },\r\n  onDismiss: () => {\r\n    console.log('dismiss? -1');\r\n  },\r\n};\r\n\r\nconst ViewportDialogContext = createContext(null);\r\nconst { Provider } = ViewportDialogContext;\r\n\r\nexport const useViewportDialog = () => useContext(ViewportDialogContext);\r\n\r\nconst ViewportDialogProvider = ({ children, service }) => {\r\n  const [viewportDialogState, setViewportDialogState] = useState(DEFAULT_STATE);\r\n  const show = useCallback(\r\n    params => setViewportDialogState({ ...viewportDialogState, ...params }),\r\n    [viewportDialogState]\r\n  );\r\n  const hide = useCallback(() => setViewportDialogState(DEFAULT_STATE), []);\r\n\r\n  useEffect(() => {\r\n    if (service) {\r\n      service.setServiceImplementation({ hide, show });\r\n    }\r\n  }, [hide, service, show]);\r\n\r\n  return (\r\n    <Provider value={[viewportDialogState, { show, hide }]}>\r\n      {children}\r\n    </Provider>\r\n  );\r\n};\r\n\r\nViewportDialogProvider.propTypes = {\r\n  /** Children that will be wrapped with Modal Context */\r\n  children: PropTypes.oneOfType([\r\n    PropTypes.arrayOf(PropTypes.node),\r\n    PropTypes.node,\r\n  ]).isRequired,\r\n  service: PropTypes.shape({\r\n    setServiceImplementation: PropTypes.func,\r\n  }),\r\n};\r\n\r\nexport default ViewportDialogProvider;\r\n","import React, {\r\n  createContext,\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useReducer,\r\n} from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst DEFAULT_STATE = {\r\n  // starting from null, hanging\r\n  // protocol will defined number of rows and cols\r\n  numRows: null,\r\n  numCols: null,\r\n  viewports: [\r\n    /*\r\n     * {\r\n     *    displaySetInstanceUID: string,\r\n     * }\r\n     */\r\n  ],\r\n  activeViewportIndex: 0,\r\n};\r\n\r\nexport const ViewportGridContext = createContext(DEFAULT_STATE);\r\n\r\nexport function ViewportGridProvider({ children, service }) {\r\n  const viewportGridReducer = (state, action) => {\r\n    switch (action.type) {\r\n      case 'SET_ACTIVE_VIEWPORT_INDEX': {\r\n        return { ...state, ...{ activeViewportIndex: action.payload } };\r\n      }\r\n      case 'SET_DISPLAYSET_FOR_VIEWPORT': {\r\n        const { viewportIndex, displaySetInstanceUID } = action.payload;\r\n        const viewports = state.viewports.slice();\r\n\r\n        viewports[viewportIndex] = { displaySetInstanceUID };\r\n\r\n        return { ...state, ...{ viewports }, cachedLayout: null };\r\n      }\r\n      case 'SET_LAYOUT': {\r\n        const { numCols, numRows } = action.payload;\r\n        const numPanes = numCols * numRows;\r\n        const viewports = state.viewports.slice();\r\n        const activeViewportIndex =\r\n          state.activeViewportIndex >= numPanes ? 0 : state.activeViewportIndex;\r\n\r\n        while (viewports.length < numPanes) {\r\n          viewports.push({});\r\n        }\r\n        while (viewports.length > numPanes) {\r\n          viewports.pop();\r\n        }\r\n\r\n        return {\r\n          ...state,\r\n          ...{ activeViewportIndex, numCols, numRows, viewports },\r\n          cachedLayout: null,\r\n        };\r\n      }\r\n      case 'RESET': {\r\n        return {\r\n          numCols: null,\r\n          numRows: null,\r\n          activeViewportIndex: 0,\r\n          viewports: [\r\n            {\r\n              displaySetInstanceUID: null,\r\n            },\r\n          ],\r\n          cachedLayout: null,\r\n        };\r\n      }\r\n\r\n      case 'SET_CACHED_LAYOUT': {\r\n        return { ...state, cachedLayout: action.payload };\r\n      }\r\n      case 'SET': {\r\n        return {\r\n          ...state,\r\n          ...action.payload,\r\n        };\r\n      }\r\n\r\n      default:\r\n        return action.payload;\r\n    }\r\n  };\r\n\r\n  const [viewportGridState, dispatch] = useReducer(\r\n    viewportGridReducer,\r\n    DEFAULT_STATE\r\n  );\r\n\r\n  const getState = useCallback(() => viewportGridState, [viewportGridState]);\r\n\r\n  const setActiveViewportIndex = useCallback(\r\n    index => dispatch({ type: 'SET_ACTIVE_VIEWPORT_INDEX', payload: index }),\r\n    [dispatch]\r\n  );\r\n\r\n  const setDisplaysetForViewport = useCallback(\r\n    ({ viewportIndex, displaySetInstanceUID }) =>\r\n      dispatch({\r\n        type: 'SET_DISPLAYSET_FOR_VIEWPORT',\r\n        payload: {\r\n          viewportIndex,\r\n          displaySetInstanceUID,\r\n        },\r\n      }),\r\n    [dispatch]\r\n  );\r\n\r\n  const setLayout = useCallback(\r\n    ({ numCols, numRows }) =>\r\n      dispatch({\r\n        type: 'SET_LAYOUT',\r\n        payload: {\r\n          numCols,\r\n          numRows,\r\n        },\r\n      }),\r\n    [dispatch]\r\n  );\r\n\r\n  const reset = useCallback(\r\n    () =>\r\n      dispatch({\r\n        type: 'RESET',\r\n        payload: {},\r\n      }),\r\n    [dispatch]\r\n  );\r\n\r\n  const setCachedLayout = useCallback(\r\n    payload =>\r\n      dispatch({\r\n        type: 'SET_CACHED_LAYOUT',\r\n        payload,\r\n      }),\r\n    [dispatch]\r\n  );\r\n\r\n  const set = useCallback(\r\n    payload =>\r\n      dispatch({\r\n        type: 'SET',\r\n        payload,\r\n      }),\r\n    [dispatch]\r\n  );\r\n\r\n  /**\r\n   * Sets the implementation of a modal service that can be used by extensions.\r\n   *\r\n   * @returns void\r\n   */\r\n  useEffect(() => {\r\n    if (service) {\r\n      service.setServiceImplementation({\r\n        getState,\r\n        setActiveViewportIndex,\r\n        setDisplaysetForViewport,\r\n        setLayout,\r\n        reset,\r\n        setCachedLayout,\r\n        set,\r\n      });\r\n    }\r\n  }, [\r\n    getState,\r\n    service,\r\n    setActiveViewportIndex,\r\n    setDisplaysetForViewport,\r\n    setLayout,\r\n    reset,\r\n    setCachedLayout,\r\n    set,\r\n  ]);\r\n\r\n  const api = {\r\n    getState,\r\n    setActiveViewportIndex,\r\n    setDisplaysetForViewport,\r\n    setLayout,\r\n    setCachedLayout,\r\n    reset,\r\n    set,\r\n  };\r\n\r\n  return (\r\n    <ViewportGridContext.Provider value={[viewportGridState, api]}>\r\n      {children}\r\n    </ViewportGridContext.Provider>\r\n  );\r\n}\r\n\r\nViewportGridProvider.propTypes = {\r\n  children: PropTypes.any,\r\n  service: PropTypes.shape({\r\n    setServiceImplementation: PropTypes.func,\r\n  }).isRequired,\r\n};\r\n\r\nexport const useViewportGrid = () => useContext(ViewportGridContext);\r\n","import React, {\r\n  createContext,\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useReducer,\r\n} from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst DEFAULT_STATE = {\r\n  user: null,\r\n  enabled: false,\r\n};\r\n\r\nexport const UserAuthenticationContext = createContext(DEFAULT_STATE);\r\n\r\nexport function UserAuthenticationProvider({ children, service }) {\r\n  const userAuthenticationReducer = (state, action) => {\r\n    switch (action.type) {\r\n      case 'SET_USER': {\r\n        return {\r\n          ...state,\r\n          ...{ user: action.payload.user },\r\n        };\r\n      }\r\n      case 'RESET': {\r\n        return {\r\n          user: null,\r\n        };\r\n      }\r\n\r\n      case 'SET': {\r\n        return {\r\n          ...state,\r\n          ...action.payload,\r\n        };\r\n      }\r\n\r\n      default:\r\n        return action.payload;\r\n    }\r\n  };\r\n\r\n  const [userAuthenticationState, dispatch] = useReducer(\r\n    userAuthenticationReducer,\r\n    DEFAULT_STATE\r\n  );\r\n\r\n  const getState = useCallback(() => userAuthenticationState, [\r\n    userAuthenticationState,\r\n  ]);\r\n\r\n  const setUser = useCallback(\r\n    user =>\r\n      dispatch({\r\n        type: 'SET_USER',\r\n        payload: {\r\n          user,\r\n        },\r\n      }),\r\n    [dispatch]\r\n  );\r\n\r\n  const getUser = useCallback(() => userAuthenticationState.user, [\r\n    userAuthenticationState,\r\n  ]);\r\n\r\n  const reset = useCallback(\r\n    () =>\r\n      dispatch({\r\n        type: 'RESET',\r\n        payload: {},\r\n      }),\r\n    [dispatch]\r\n  );\r\n\r\n  const set = useCallback(\r\n    payload =>\r\n      dispatch({\r\n        type: 'SET',\r\n        payload,\r\n      }),\r\n    [dispatch]\r\n  );\r\n\r\n  /**\r\n   * Sets the implementation of the UserAuthenticationService that can be used by extensions.\r\n   *\r\n   * @returns void\r\n   */\r\n  // TODO: should this be a useEffect or not?\r\n  useEffect(() => {\r\n    if (service) {\r\n      service.setServiceImplementation({\r\n        getState,\r\n        setUser,\r\n        getUser,\r\n        reset,\r\n        set,\r\n      });\r\n    }\r\n  }, [getState, service, setUser, getUser, reset, set]);\r\n\r\n  // TODO: This may not be correct, but I think we need to set the implementation for the service\r\n  // immediately when this runs, since otherwise the authentication redirects will fail.\r\n  // (useEffect only runs after the child components - in this case, routing logic - has failed)\r\n  if (service) {\r\n    service.setServiceImplementation({\r\n      getState,\r\n      setUser,\r\n      getUser,\r\n      reset,\r\n      set,\r\n    });\r\n  }\r\n\r\n  const api = {\r\n    getState,\r\n    setUser,\r\n    getUser,\r\n    getAuthorizationHeader: service.getAuthorizationHeader,\r\n    handleUnauthenticated: service.handleUnauthenticated,\r\n    reset,\r\n    set,\r\n  };\r\n\r\n  return (\r\n    <UserAuthenticationContext.Provider value={[userAuthenticationState, api]}>\r\n      {children}\r\n    </UserAuthenticationContext.Provider>\r\n  );\r\n}\r\n\r\nexport default UserAuthenticationProvider;\r\n\r\nconst UserAuthenticationConsumer = UserAuthenticationContext.Consumer;\r\nexport { UserAuthenticationConsumer };\r\n\r\nUserAuthenticationProvider.propTypes = {\r\n  children: PropTypes.any,\r\n  service: PropTypes.shape({\r\n    setServiceImplementation: PropTypes.func,\r\n  }).isRequired,\r\n};\r\n\r\nexport const useUserAuthentication = () =>\r\n  useContext(UserAuthenticationContext);\r\n","import React from 'react';\r\nimport { Typography, Icon } from '../';\r\nimport PropTypes from 'prop-types';\r\nimport detect from 'browser-detect';\r\n\r\nconst Link = ({ href, children, showIcon = false }) => {\r\n  return (\r\n    <a href={href} target=\"_blank\" rel=\"noopener noreferrer\">\r\n      <Typography\r\n        variant=\"subtitle\"\r\n        component=\"p\"\r\n        className=\"flex items-center text-primary-active\"\r\n      >\r\n        {children}\r\n        {!!showIcon && (\r\n          <Icon name=\"external-link\" className=\"w-5 text-white ml-2\" />\r\n        )}\r\n      </Typography>\r\n    </a>\r\n  );\r\n};\r\n\r\nconst Row = ({ title, value, link }) => {\r\n  return (\r\n    <div className=\"flex mb-4\">\r\n      <Typography variant=\"subtitle\" component=\"p\" className=\"text-white w-48\">\r\n        {title}\r\n      </Typography>\r\n\r\n      {link ? (\r\n        <Link href={link}>{value}</Link>\r\n      ) : (\r\n          <Typography\r\n            variant=\"subtitle\"\r\n            component=\"p\"\r\n            className=\"text-white w-48\"\r\n          >\r\n            {value}\r\n          </Typography>\r\n        )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst AboutModal = ({buildNumber, versionNumber}) => {\r\n  const { os, version, name } = detect();\r\n  const browser = `${name[0].toUpperCase()}${name.substr(1)} ${version}`;\r\n\r\n  const renderRowTitle = title => (\r\n    <div className=\"border-b-2 border-black pb-3 mb-3\">\r\n      <Typography variant=\"h6\" className=\"text-primary-light\">\r\n        {title}\r\n      </Typography>\r\n    </div>\r\n  );\r\n  return (\r\n    <div>\r\n      {renderRowTitle('Important Links')}\r\n      <div className=\"flex mb-8\">\r\n        <Link\r\n          href=\"https://community.ohif.org/\"\r\n          showIcon={true}\r\n        >\r\n          Visit the forum\r\n        </Link>\r\n        <span className=\"ml-4\">\r\n          <Link\r\n            href=\"https://github.com/OHIF/Viewers/issues/new/choose\"\r\n            showIcon={true}\r\n          >\r\n            Report an issue\r\n          </Link>\r\n        </span>\r\n        <span className=\"ml-4\">\r\n          <Link href=\"https://ohif.org/\" showIcon={true}>\r\n            More details\r\n          </Link>\r\n        </span>\r\n      </div>\r\n\r\n      {renderRowTitle('Version Information')}\r\n      <div className=\"flex flex-col\">\r\n        <Row\r\n          title=\"Repository URL\"\r\n          value=\"https://github.com/OHIF/Viewers/tree/v3-stable\"\r\n          link=\"https://github.com/OHIF/Viewers/tree/v3-stable\"\r\n        />\r\n        {/* <Row\r\n          title=\"Last Master Commits\"\r\n          value=\"https://github.com/OHIF/Viewers/tree/v3-stable\"\r\n          link=\"https://github.com/OHIF/Viewers/tree/v3-stable\"\r\n        /> */}\r\n        <Row title=\"Version number\" value={versionNumber} />\r\n        <Row title=\"Build number\" value={buildNumber} />\r\n        <Row title=\"Browser\" value={browser} />\r\n        <Row title=\"OS\" value={os} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nAboutModal.propTypes = {\r\n  buildNumber: PropTypes.string,\r\n  versionNumber: PropTypes.string,\r\n}\r\n\r\nexport default AboutModal;\r\n","import AboutModal from './AboutModal';\r\nexport default AboutModal;\r\n","import React, { useRef } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nconst baseClasses =\r\n  'leading-none font-sans text-center justify-center items-center outline-none transition duration-300 ease-in-out focus:outline-none';\r\n\r\nconst defaults = {\r\n  color: 'default',\r\n  disabled: false,\r\n  fullWidth: false,\r\n  rounded: 'medium',\r\n  size: 'medium',\r\n  type: 'button',\r\n  variant: 'contained',\r\n};\r\n\r\nconst roundedClasses = {\r\n  none: '',\r\n  small: 'rounded',\r\n  medium: 'rounded-md',\r\n  large: 'rounded-lg',\r\n  full: 'rounded-full',\r\n};\r\n\r\n\r\nconst variantClasses = {\r\n  text: {\r\n    default:\r\n      'text-primary-light hover:bg-primary-light hover:text-white active:opacity-80 focus:bg-primary-light focus:text-white',\r\n    primary:\r\n      'text-primary-main hover:bg-primary-main hover:text-white active:opacity-80 focus:bg-primary-main focus:text-white',\r\n    secondary:\r\n      'text-secondary-light hover:bg-secondary-light hover:text-white active:opacity-80 focus:bg-secondary-light focus:text-white',\r\n    white:\r\n      'text-white hover:bg-white hover:text-black active:opacity-80 focus:bg-white focus:text-black',\r\n    black:\r\n      'text-black hover:bg-black hover:text-white focus:bg-black focus:text-white active:opacity-80',\r\n  },\r\n  outlined: {\r\n    default:\r\n      'border bg-trasparent border-primary-light text-primary-light hover:bg-primary-light hover:text-black focus:text-black focus:bg-primary-light active:opacity-80',\r\n    primary:\r\n      'border bg-transparent border-primary-main text-primary-main hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    secondary:\r\n      'border bg-transparent border-secondary-light text-secondary-light hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    white:\r\n      'border bg-transparent border-white text-white hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    black:\r\n      'border bg-black border-primary-main text-white hover:bg-primary-main focus:bg-primary-main hover:border-black focus:border-black',\r\n  },\r\n  contained: {\r\n    default:\r\n      'bg-primary-light text-black hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    primary:\r\n      'bg-primary-main text-white hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    secondary:\r\n      'bg-secondary-light text-white hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    white:\r\n      'bg-white text-black hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    black:\r\n      'bg-black text-white hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    light:\r\n      'border bg-primary-light border-primary-light text-black hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n  },\r\n  disabled: {\r\n    default:\r\n      'cursor-not-allowed opacity-50 bg-primary-light text-black',\r\n    primary:\r\n      'cursor-not-allowed opacity-50 bg-primary-main text-white',\r\n    secondary:\r\n      'cursor-not-allowed opacity-50 bg-secondary-light text-white',\r\n    white:\r\n      'cursor-not-allowed opacity-50 bg-white text-black',\r\n    black:\r\n      'cursor-not-allowed opacity-50 bg-black text-white',\r\n    light:\r\n      'cursor-not-allowed opacity-50 border bg-primary-light border-primary-light text-black',\r\n  },\r\n};\r\n\r\nconst sizeClasses = {\r\n  small: 'py-2 px-2 text-sm min-w-md',\r\n  medium: 'py-2 px-2 text-lg min-w-md',\r\n  large: 'py-2 px-6 text-xl min-w-md',\r\n  initial: '',\r\n};\r\n\r\nconst fullWidthClasses = {\r\n  true: 'flex w-full',\r\n  false: 'inline-flex',\r\n};\r\n\r\nconst Button = ({\r\n  children,\r\n  variant = defaults.variant,\r\n  color = defaults.color,\r\n  size = defaults.size,\r\n  rounded = defaults.rounded,\r\n  disabled = defaults.disabled,\r\n  type = defaults.type,\r\n  fullWidth = defaults.fullWidth,\r\n  startIcon: startIconProp,\r\n  endIcon: endIconProp,\r\n  name,\r\n  className,\r\n  onClick,\r\n  /** TODO: All possible props should be explicitly defined -- avoid spreading props  */\r\n  ...rest\r\n}) => {\r\n  const startIcon = startIconProp && (\r\n    <div className=\"mr-2\">\r\n      {React.cloneElement(startIconProp, {\r\n        className: classnames('w-4 h-4 fill-current'),\r\n      })}\r\n    </div>\r\n  );\r\n\r\n  const endIcon = endIconProp && (\r\n    <div className=\"ml-2\">\r\n      {React.cloneElement(endIconProp, {\r\n        className: classnames('w-4 h-4 fill-current'),\r\n      })}\r\n    </div>\r\n  );\r\n  const buttonElement = useRef(null);\r\n\r\n  const handleOnClick = e => {\r\n    buttonElement.current.blur();\r\n    if (!disabled) {\r\n      onClick(e);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <button\r\n      className={classnames(\r\n        className,\r\n        baseClasses,\r\n        variantClasses[variant][color],\r\n        roundedClasses[rounded],\r\n        sizeClasses[size],\r\n        fullWidthClasses[fullWidth],\r\n      )}\r\n      disabled={disabled}\r\n      ref={buttonElement}\r\n      onClick={handleOnClick}\r\n      type={type}\r\n      data-cy={`${name}-btn`}\r\n      {...rest}\r\n    >\r\n      {startIcon}\r\n      {children}\r\n      {endIcon}\r\n    </button>\r\n  );\r\n};\r\n\r\nButton.propTypes = {\r\n  children: PropTypes.node,\r\n  size: PropTypes.oneOf(['small', 'medium', 'large', 'initial', 'inherit']),\r\n  rounded: PropTypes.oneOf(['none', 'small', 'medium', 'large', 'full']),\r\n  variant: PropTypes.oneOf(['text', 'outlined', 'contained']),\r\n  color: PropTypes.oneOf([\r\n    'default',\r\n    'primary',\r\n    'secondary',\r\n    'white',\r\n    'black',\r\n    'inherit',\r\n    'light'\r\n  ]),\r\n  fullWidth: PropTypes.bool,\r\n  disabled: PropTypes.bool,\r\n  type: PropTypes.string,\r\n  name: PropTypes.string,\r\n  startIcon: PropTypes.node,\r\n  endIcon: PropTypes.node,\r\n  className: PropTypes.string,\r\n  onClick: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default Button;\r\n","import Button from './Button';\r\nexport default Button;\r\n","import React, { useRef } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nconst baseButtonClass = 'border outline-none';\r\nconst roundedClasses = {\r\n  vertical: {\r\n    none: '',\r\n    small: 'first:rounded-t last:rounded-b',\r\n    medium: 'first:rounded-t-md last:rounded-b-md',\r\n    large: 'first:rounded-t-lg last:rounded-b-lg',\r\n    full: 'first:rounded-t-full last:rounded-b-full',\r\n  },\r\n  horizontal: {\r\n    none: '',\r\n    small: 'first:rounded-l last:rounded-r',\r\n    medium: 'first:rounded-l-md last:rounded-r-md',\r\n    large: 'first:rounded-l-lg last:rounded-r-lg',\r\n    full: 'first:rounded-l-full last:rounded-r-full',\r\n  },\r\n};\r\n\r\nconst borderClasses = {\r\n  text: {\r\n    vertical: 'border-t-0 border-l-0 border-r-0 last:border-b-0',\r\n    horizontal: 'border-l-0 border-t-0 border-b-0 last:border-r-0',\r\n  },\r\n  outlined: {\r\n    vertical: 'border border-b-0 last:border-b',\r\n    horizontal: 'border border-r-0 last:border-r',\r\n  },\r\n  contained: {\r\n    vertical: 'border-t-0 border-l-0 border-r-0 last:border-b-0',\r\n    horizontal: 'border-l-0 border-t-0 border-b-0 last:border-r-0',\r\n  },\r\n};\r\n\r\nconst variantClasses = {\r\n  text: {\r\n    default: 'border-primary-light',\r\n    primary: 'border-primary-main',\r\n    secondary: 'border-secondary-light',\r\n    white: 'border-white',\r\n    black: 'border-primary-main',\r\n  },\r\n  outlined: {\r\n    default: '',\r\n    primary: '',\r\n    secondary: '',\r\n    white: '',\r\n    black:\r\n      'border-primary-main group-hover:bg-primary-main group-hover:border-black',\r\n  },\r\n  contained: {\r\n    default: 'border-white',\r\n    primary: 'border-white',\r\n    secondary: 'border-white',\r\n    white: 'border-black',\r\n    black: 'border-primary-main',\r\n  },\r\n};\r\n\r\nconst orientationClasses = {\r\n  vertical: 'flex-col',\r\n  horizontal: 'flex-row',\r\n};\r\n\r\nconst baseDisplayClass = 'inline-flex';\r\nconst fullWidthDisplayClass = 'flex';\r\n\r\nconst ButtonGroup = ({\r\n  children,\r\n  className,\r\n  disabled = false,\r\n  fullWidth = false,\r\n  color = 'default',\r\n  orientation = 'horizontal',\r\n  rounded = 'medium',\r\n  size = 'medium',\r\n  variant = 'outlined',\r\n  ...other\r\n}) => {\r\n  const ref = useRef(null);\r\n\r\n  const buttonClasses = classnames(\r\n    baseButtonClass,\r\n    borderClasses[variant] && borderClasses[variant][orientation],\r\n    variantClasses[variant] && variantClasses[variant][color],\r\n    roundedClasses[orientation] && roundedClasses[orientation][rounded]\r\n  );\r\n\r\n  return (\r\n    <div\r\n      role=\"group\"\r\n      className={classnames(\r\n        'group',\r\n        className,\r\n        orientationClasses[orientation],\r\n        fullWidth ? fullWidthDisplayClass : baseDisplayClass\r\n      )}\r\n      ref={ref}\r\n      {...other}\r\n    >\r\n      {React.Children.map(children, child => {\r\n        if (!React.isValidElement(child)) {\r\n          return null;\r\n        }\r\n\r\n        return React.cloneElement(child, {\r\n          className: classnames(buttonClasses, child.props.className),\r\n          disabled: child.props.disabled || disabled,\r\n          color: child.props.color || color,\r\n          fullWidth,\r\n          rounded: 'none',\r\n          size: child.props.size || size,\r\n          variant: child.props.variant || variant,\r\n        });\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n\r\nButtonGroup.propTypes = {\r\n  children: PropTypes.node.isRequired,\r\n  className: PropTypes.string,\r\n  color: PropTypes.oneOf([\r\n    'default',\r\n    'inherit',\r\n    'primary',\r\n    'secondary',\r\n    'white',\r\n    'black',\r\n  ]),\r\n  disabled: PropTypes.bool,\r\n  fullWidth: PropTypes.bool,\r\n  orientation: PropTypes.oneOf(['vertical', 'horizontal']),\r\n  rounded: PropTypes.oneOf(['none', 'small', 'medium', 'large', 'full']),\r\n  size: PropTypes.oneOf(['small', 'medium', 'large', 'inherit']),\r\n  variant: PropTypes.oneOf(['text', 'outlined', 'contained']),\r\n};\r\n\r\nexport default ButtonGroup;\r\n","import ButtonGroup from './ButtonGroup';\r\nexport default ButtonGroup;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Typography } from '../';\r\n\r\nconst ContextMenu = ({ items }) => {\r\n  return (\r\n    <div\r\n      className=\"relative bg-secondary-dark rounded z-50 block w-48\"\r\n      onContextMenu={e => e.preventDefault()}\r\n    >\r\n      {items.map((item, index) => (\r\n        <div\r\n          key={index}\r\n          onClick={() => item.action(item)}\r\n          className=\"flex px-4 py-3 cursor-pointer items-center transition duration-300 hover:bg-primary-dark border-b border-primary-dark last:border-b-0\"\r\n        >\r\n          <Typography>{item.label}</Typography>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nContextMenu.propTypes = {\r\n  items: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      label: PropTypes.string.isRequired,\r\n      actionType: PropTypes.string.isRequired,\r\n      action: PropTypes.func.isRequired,\r\n    })\r\n  ).isRequired,\r\n};\r\n\r\nexport default ContextMenu;\r\n","import React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport debounce from 'lodash.debounce';\r\nimport { IconButton, Icon } from '../';\r\n\r\nimport './CinePlayerCustomInputRange.css';\r\n\r\nconst CinePlayer = ({\r\n  isPlaying,\r\n  minFrameRate,\r\n  maxFrameRate,\r\n  stepFrameRate,\r\n  frameRate: defaultFrameRate,\r\n  onFrameRateChange,\r\n  onPlayPauseChange,\r\n  onClose,\r\n}) => {\r\n  const [frameRate, setFrameRate] = useState(defaultFrameRate);\r\n  const debouncedSetFrameRate = debounce(onFrameRateChange, 300);\r\n\r\n  const onFrameRateChangeHandler = ({ target }) => {\r\n    const frameRate = parseFloat(target.value);\r\n    debouncedSetFrameRate(frameRate);\r\n    setFrameRate(frameRate);\r\n  };\r\n\r\n  const onPlayPauseChangeHandler = () => onPlayPauseChange(!isPlaying);\r\n\r\n  const action = {\r\n    false: { icon: 'old-play' },\r\n    true: { icon: 'old-stop' },\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-row items-center justify-center h-10 border rounded-full CinePlayer border-primary-light\">\r\n      <IconButton\r\n        variant=\"text\"\r\n        color=\"inherit\"\r\n        size=\"initial\"\r\n        className=\"ml-4 mr-3 text-primary-active\"\r\n        onClick={onPlayPauseChangeHandler}\r\n      >\r\n        <Icon width=\"15px\" height=\"15px\" name={action[isPlaying].icon} />\r\n      </IconButton>\r\n      <div className=\"flex flex-col justify-center h-full pt-2 pl-1 pr-1 mr-3\">\r\n        <input\r\n          type=\"range\"\r\n          name=\"frameRate\"\r\n          min={minFrameRate}\r\n          max={maxFrameRate}\r\n          step={stepFrameRate}\r\n          value={frameRate}\r\n          onChange={onFrameRateChangeHandler}\r\n        />\r\n        <p className=\"-mt-2 text-sm text-primary-light\">{`${frameRate.toFixed(\r\n          1\r\n        )} fps`}</p>\r\n      </div>\r\n      <IconButton\r\n        color=\"inherit\"\r\n        size=\"initial\"\r\n        className=\"mr-3 border rounded-full text-primary-active border-primary-active\"\r\n        onClick={onClose}\r\n      >\r\n        <Icon name=\"close\" width=\"15px\" height=\"15px\" />\r\n      </IconButton>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst noop = () => {};\r\n\r\nCinePlayer.defaultProps = {\r\n  isPlaying: false,\r\n  minFrameRate: 1,\r\n  maxFrameRate: 90,\r\n  stepFrameRate: 1,\r\n  frameRate: 24,\r\n  onPlayPauseChange: noop,\r\n  onFrameRateChange: noop,\r\n  onClose: noop,\r\n};\r\n\r\nCinePlayer.propTypes = {\r\n  /** Minimum value for range slider */\r\n  minFrameRate: PropTypes.number.isRequired,\r\n  /** Maximum value for range slider */\r\n  maxFrameRate: PropTypes.number.isRequired,\r\n  /** Increment range slider can \"step\" in either direction */\r\n  stepFrameRate: PropTypes.number.isRequired,\r\n  frameRate: PropTypes.number.isRequired,\r\n  /** 'true' if playing, 'false' if paused */\r\n  isPlaying: PropTypes.bool.isRequired,\r\n  onPlayPauseChange: PropTypes.func,\r\n  onFrameRateChange: PropTypes.func,\r\n  onClose: PropTypes.func,\r\n};\r\n\r\nexport default CinePlayer;\r\n","import CinePlayer from './CinePlayer';\r\nexport default CinePlayer;\r\n","import React, { useState, useCallback } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport moment from 'moment';\r\n\r\n/** REACT DATES */\r\nimport { DateRangePicker, isInclusivelyBeforeDay } from 'react-dates';\r\nimport 'react-dates/initialize';\r\nimport 'react-dates/lib/css/_datepicker.css';\r\nimport './DateRange.css';\r\n\r\nconst today = moment();\r\nconst lastWeek = moment().subtract(7, 'day');\r\nconst lastMonth = moment().subtract(1, 'month');\r\nconst studyDatePresets = [\r\n  {\r\n    text: 'Today',\r\n    start: today,\r\n    end: today,\r\n  },\r\n  {\r\n    text: 'Last 7 days',\r\n    start: lastWeek,\r\n    end: today,\r\n  },\r\n  {\r\n    text: 'Last 30 days',\r\n    start: lastMonth,\r\n    end: today,\r\n  },\r\n];\r\n\r\nconst renderYearsOptions = () => {\r\n  const currentYear = moment().year();\r\n  const options = [];\r\n\r\n  for (let i = 0; i < 20; i++) {\r\n    const year = currentYear - i;\r\n    options.push(\r\n      <option key={year} value={year}>\r\n        {year}\r\n      </option>\r\n    );\r\n  }\r\n\r\n  return options;\r\n};\r\n\r\nconst DateRange = (props) => {\r\n  const { id, onChange, startDate, endDate } = props;\r\n  const [focusedInput, setFocusedInput] = useState(null);\r\n  const renderYearsOptionsCallback = useCallback(renderYearsOptions, []);\r\n\r\n  const renderDatePresets = () => {\r\n    return (\r\n      <div className=\"PresetDateRangePicker_panel flex justify-between\">\r\n        {studyDatePresets.map(({ text, start, end }) => {\r\n          return (\r\n            <button\r\n              key={text}\r\n              type=\"button\"\r\n              className={`m-0 py-2 px-3 bg-primary-main border-0 rounded text-white text-base transition duration-300 hover:opacity-80`}\r\n              onClick={() =>\r\n                onChange({\r\n                  startDate: start ? start.format('YYYYMMDD') : undefined,\r\n                  endDate: end ? end.format('YYYYMMDD') : undefined,\r\n                  preset: true,\r\n                })\r\n              }\r\n            >\r\n              {text}\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  };\r\n  const renderMonthElement = ({ month, onMonthSelect, onYearSelect }) => {\r\n    renderMonthElement.propTypes = {\r\n      month: PropTypes.object,\r\n      onMonthSelect: PropTypes.func,\r\n      onYearSelect: PropTypes.func,\r\n    };\r\n\r\n    const handleMonthChange = (event) => {\r\n      onMonthSelect(month, event.target.value);\r\n    };\r\n\r\n    const handleYearChange = (event) => {\r\n      onYearSelect(month, event.target.value);\r\n    };\r\n\r\n    const handleOnBlur = () => { };\r\n\r\n    return (\r\n      <div className=\"flex justify-center\">\r\n        <div className=\"my-0 mx-1\">\r\n          <select\r\n            className=\"DateRangePicker_select\"\r\n            value={month.month()}\r\n            onChange={handleMonthChange}\r\n            onBlur={handleOnBlur}\r\n          >\r\n            {moment.months().map((label, value) => (\r\n              <option key={value} value={value}>\r\n                {label}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n        <div className=\"my-0 mx-1\">\r\n          <select\r\n            className=\"DateRangePicker_select\"\r\n            value={month.year()}\r\n            onChange={handleYearChange}\r\n            onBlur={handleOnBlur}\r\n          >\r\n            {renderYearsOptionsCallback()}\r\n          </select>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Moment\r\n  const parsedStartDate = startDate ? moment(startDate, 'YYYYMMDD') : null;\r\n  const parsedEndDate = endDate ? moment(endDate, 'YYYYMMDD') : null;\r\n\r\n  return (\r\n    <DateRangePicker\r\n      /** REQUIRED */\r\n      startDate={parsedStartDate}\r\n      startDateId={`date-range-${id}-start-date`}\r\n      endDate={parsedEndDate}\r\n      endDateId={`date-range-${id}-end-date`}\r\n      onDatesChange={({ startDate: newStartDate, endDate: newEndDate }) => {\r\n        onChange({\r\n          startDate: newStartDate ? newStartDate.format('YYYYMMDD') : undefined,\r\n          endDate: newEndDate ? newEndDate.format('YYYYMMDD') : undefined,\r\n        })\r\n      }}\r\n      focusedInput={focusedInput}\r\n      onFocusChange={(updatedVal) => setFocusedInput(updatedVal)}\r\n      /** OPTIONAL */\r\n      renderCalendarInfo={renderDatePresets}\r\n      renderMonthElement={renderMonthElement}\r\n      startDatePlaceholderText={'Start Date'}\r\n      endDatePlaceholderText={'End Date'}\r\n      phrases={{\r\n        closeDatePicker: 'Close',\r\n        clearDates: 'Clear dates',\r\n      }}\r\n      isOutsideRange={(day) => !isInclusivelyBeforeDay(day, moment())}\r\n      hideKeyboardShortcutsPanel={true}\r\n      numberOfMonths={1}\r\n      showClearDates={false}\r\n      anchorDirection=\"left\"\r\n    />\r\n  );\r\n};\r\n\r\nDateRange.defaultProps = {\r\n  id: '',\r\n  startDate: null,\r\n  endDate: null,\r\n};\r\n\r\nDateRange.propTypes = {\r\n  id: PropTypes.string,\r\n  /** YYYYMMDD (19921022) */\r\n  startDate: PropTypes.string,\r\n  /** YYYYMMDD (19921022) */\r\n  endDate: PropTypes.object,\r\n  /** Callback that received { startDate: string(YYYYMMDD), endDate: string(YYYYMMDD)} */\r\n  onChange: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default DateRange;\r\n","import DateRange from './DateRange';\r\n\r\nexport default DateRange;\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport { Button } from '..';\r\n\r\nconst Footer = ({ actions, className, onSubmit, value }) => {\r\n  const flex = 'flex items-center justify-end';\r\n  const border = 'border-t-2 border-solid border-black rounded-b';\r\n  const spacing = 'p-6';\r\n  const theme = 'bg-primary-dark';\r\n\r\n  return (\r\n    <div className={classNames(flex, border, spacing, theme, className)}>\r\n      {actions.map((action, index) => {\r\n        const isFirst = index === 0;\r\n        const isPrimary = action.type === 'primary';\r\n\r\n        const onClickHandler = event => onSubmit({ action, value, event });\r\n\r\n        return (\r\n          <Button\r\n            key={index}\r\n            className={classNames({ 'ml-2': !isFirst }, action.classes)}\r\n            color={isPrimary ? 'primary' : undefined}\r\n            onClick={onClickHandler}\r\n            style={{ transition: 'all .15s ease', height: 34 }}\r\n          >\r\n            {action.text}\r\n          </Button>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst noop = () => {};\r\n\r\nFooter.propTypes = {\r\n  className: PropTypes.string,\r\n  onSubmit: PropTypes.func.isRequired,\r\n  actions: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      id: PropTypes.string.isRequired,\r\n      text: PropTypes.string.isRequired,\r\n      value: PropTypes.any,\r\n      type: PropTypes.oneOf(['primary', 'secondary', 'cancel']).isRequired,\r\n      classes: PropTypes.arrayOf(PropTypes.string),\r\n    })\r\n  ).isRequired,\r\n};\r\n\r\nFooter.defaultProps = {\r\n  onSubmit: noop,\r\n  actions: [],\r\n};\r\n\r\nexport default Footer;\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport { Typography } from '..';\r\n\r\nconst Body = ({ text, className }) => {\r\n  const theme = 'bg-primary-dark';\r\n  return (\r\n    <div className={classNames('relative flex-auto', theme, className)}>\r\n      <div className=\"p-6\">\r\n        <Typography variant=\"body\" className=\"my-4 leading-relaxed\">\r\n          {text}\r\n        </Typography>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nBody.propTypes = {\r\n  text: PropTypes.string,\r\n  className: PropTypes.string,\r\n};\r\n\r\nexport default Body;\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport { Typography, Icon } from '..';\r\n\r\nconst CloseButton = ({ onClick }) => {\r\n  return (\r\n    <Icon\r\n      data-cy=\"close-button\"\r\n      onClick={onClick}\r\n      name=\"close\"\r\n      className=\"cursor-pointer text-primary-active w-6 h-6\"\r\n    />\r\n  );\r\n};\r\n\r\nCloseButton.propTypes = {\r\n  onClick: PropTypes.func,\r\n};\r\n\r\nconst Header = ({ title, noCloseButton, onClose }) => {\r\n  const theme = 'bg-secondary-main';\r\n  const flex = 'flex items-center justify-between';\r\n  const border = 'border-b-2 border-solid border-black rounded-t';\r\n  const spacing = 'p-4';\r\n\r\n  return (\r\n    <div className={classNames(theme, flex, border, spacing)}>\r\n      <Typography variant=\"h6\" className=\"text-primary-active\">\r\n        {title}\r\n      </Typography>\r\n      {!noCloseButton && <CloseButton onClick={onClose} />}\r\n    </div>\r\n  );\r\n};\r\n\r\nHeader.propTypes = {\r\n  className: PropTypes.string,\r\n  title: PropTypes.string,\r\n  noCloseButton: PropTypes.bool,\r\n  onClose: PropTypes.func,\r\n};\r\n\r\nHeader.defaultProps = {\r\n  noCloseButton: false\r\n};\r\n\r\nexport default Header;\r\n","import React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\n\r\nimport Footer from './Footer';\r\nimport Body from './Body';\r\nimport Header from './Header';\r\nimport { useEffect } from 'react';\r\n\r\nconst Dialog = ({\r\n  title,\r\n  text,\r\n  onClose,\r\n  noCloseButton,\r\n  actions,\r\n  onShow,\r\n  onSubmit,\r\n  header: HeaderComponent,\r\n  body: BodyComponent,\r\n  footer: FooterComponent,\r\n  value: defaultValue,\r\n}) => {\r\n  const [value, setValue] = useState(defaultValue);\r\n\r\n  const theme = 'bg-secondary-light';\r\n  const flex = 'flex flex-col';\r\n  const border = 'border-0 rounded-lg shadow-lg';\r\n  const outline = 'outline-none focus:outline-none';\r\n  const position = 'relative';\r\n  const width = 'w-full';\r\n\r\n  useEffect(() => {\r\n    if (onShow) {\r\n      onShow();\r\n    }\r\n  }, [onShow]);\r\n\r\n  return (\r\n    <div className={classNames(theme, flex, border, outline, position, width)}>\r\n      <HeaderComponent\r\n        title={title}\r\n        noCloseButton={noCloseButton}\r\n        onClose={onClose}\r\n        value={value}\r\n        setValue={setValue}\r\n      />\r\n      <BodyComponent text={text} value={value} setValue={setValue} />\r\n      <FooterComponent\r\n        actions={actions}\r\n        onSubmit={onSubmit}\r\n        value={value}\r\n        setValue={setValue}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nDialog.propTypes = {\r\n  title: PropTypes.string,\r\n  text: PropTypes.string,\r\n  onClose: PropTypes.func,\r\n  noCloseButton: PropTypes.bool,\r\n  header: PropTypes.oneOfType([PropTypes.node, PropTypes.func]),\r\n  body: PropTypes.oneOfType([PropTypes.node, PropTypes.func]),\r\n  footer: PropTypes.oneOfType([PropTypes.node, PropTypes.func]),\r\n  onSubmit: PropTypes.func.isRequired,\r\n  value: PropTypes.object,\r\n  actions: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      id: PropTypes.string.isRequired,\r\n      text: PropTypes.string.isRequired,\r\n      value: PropTypes.any,\r\n      type: PropTypes.oneOf(['primary', 'secondary', 'cancel']).isRequired,\r\n    })\r\n  ).isRequired,\r\n};\r\n\r\nDialog.defaultProps = {\r\n  header: Header,\r\n  footer: Footer,\r\n  body: Body,\r\n  value: {},\r\n};\r\n\r\nexport default Dialog;\r\n","import Dialog from './Dialog';\r\nexport default Dialog;\r\n","import React, { useEffect, useCallback, useState, useRef } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nimport { Icon, Typography } from '../';\r\n\r\nconst Dropdown = ({ id, children, showDropdownIcon, list }) => {\r\n  const [open, setOpen] = useState(false);\r\n  const element = useRef(null);\r\n\r\n  const DropdownItem = useCallback(({ id, title, icon, onClick }) => {\r\n    return (\r\n      <div\r\n        key={title}\r\n        className={classnames(\r\n          'flex px-4 py-2 cursor-pointer items-center transition duration-300 hover:bg-secondary-main border-b last:border-b-0 border-secondary-main'\r\n        )}\r\n        onClick={() => {\r\n          setOpen(false);\r\n          onClick();\r\n        }}\r\n        data-cy={id}\r\n      >\r\n        {!!icon && <Icon name={icon} className=\"text-white w-4 mr-2\" />}\r\n        <Typography>{title}</Typography>\r\n      </div>\r\n    );\r\n  }, []);\r\n\r\n  DropdownItem.defaultProps = {\r\n    icon: '',\r\n  };\r\n\r\n  DropdownItem.propTypes = {\r\n    id: PropTypes.string,\r\n    title: PropTypes.string.isRequired,\r\n    icon: PropTypes.string,\r\n    onClick: PropTypes.func.isRequired,\r\n  };\r\n\r\n  const renderTitleElement = () => {\r\n    return (\r\n      <div className=\"flex text-white items-center\">\r\n        {children}\r\n        {showDropdownIcon && (\r\n          <Icon name=\"chevron-down\" className=\"text-white ml-1\" />\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const toggleList = () => {\r\n    setOpen(s => !s);\r\n  };\r\n\r\n  const handleClick = e => {\r\n    if (element.current && !element.current.contains(e.target)) {\r\n      setOpen(false);\r\n    }\r\n  };\r\n\r\n  const renderList = () => {\r\n    return (\r\n      <div\r\n        className={classnames(\r\n          'absolute top-100 right-0 mt-2 z-10 origin-top-right transition duration-300 transform bg-primary-dark border border-secondary-main rounded shadow',\r\n          {\r\n            'scale-0': !open,\r\n            'scale-100': open,\r\n          }\r\n        )}\r\n        data-cy={`${id}-dropdown`}\r\n      >\r\n        {list.map((item, idx) => (\r\n          <DropdownItem\r\n            id={item.id}\r\n            title={item.title}\r\n            icon={item.icon}\r\n            onClick={item.onClick}\r\n            key={idx}\r\n          />\r\n        ))}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  useEffect(() => {\r\n    document.addEventListener('click', handleClick);\r\n\r\n    if (!open) {\r\n      document.removeEventListener('click', handleClick);\r\n    }\r\n  }, [open]);\r\n\r\n  return (\r\n    <div data-cy=\"dropdown\" ref={element} className=\"relative\">\r\n      <div className=\"cursor-pointer flex items-center\" onClick={toggleList}>\r\n        {renderTitleElement()}\r\n      </div>\r\n\r\n      {renderList()}\r\n    </div>\r\n  );\r\n};\r\n\r\nDropdown.defaultProps = {\r\n  showDropdownIcon: true,\r\n};\r\n\r\nDropdown.propTypes = {\r\n  id: PropTypes.string,\r\n  children: PropTypes.node.isRequired,\r\n  showDropdownIcon: PropTypes.bool,\r\n  /** Items to render in the select's drop down */\r\n  list: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      title: PropTypes.string.isRequired,\r\n      icon: PropTypes.string,\r\n      onClick: PropTypes.func.isRequired,\r\n    })\r\n  ).isRequired,\r\n};\r\n\r\nexport default Dropdown;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\nimport { Icon, Typography } from '../';\r\n\r\n// TODO: Add loading spinner to OHIF + use it here.\r\nconst EmptyStudies = ({ className, isLoading }) => {\r\n  return (\r\n    <div className={classnames('flex-col inline-flex items-center', className)}>\r\n      <Icon name=\"magnifier\" className=\"mb-4\" />\r\n      <Typography className=\"text-primary-light\" variant=\"h5\">\r\n        {!isLoading ? 'No studies available' : 'Loading...'}\r\n      </Typography>\r\n    </div>\r\n  );\r\n};\r\n\r\nEmptyStudies.defaultProps = {\r\n  className: '',\r\n};\r\n\r\nEmptyStudies.propTypes = {\r\n  className: PropTypes.string,\r\n};\r\n\r\nexport default EmptyStudies;\r\n","import EmptyStudies from './EmptyStudies';\r\nexport default EmptyStudies;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport ReactModal from 'react-modal';\r\n\r\nimport './Modal.css';\r\n\r\nimport { Typography, Icon } from '../';\r\nimport { useModal } from '../../contextProviders'\r\n\r\nif (typeof document !== 'undefined') {\r\n  ReactModal.setAppElement(document.getElementById('root'));\r\n}\r\n\r\nconst Modal = ({\r\n  closeButton,\r\n  shouldCloseOnEsc,\r\n  isOpen,\r\n  title,\r\n  onClose,\r\n  children,\r\n}) => {\r\n  const { hide } = useModal();\r\n\r\n  const handleClose = () => {\r\n    hide();\r\n  };\r\n\r\n  const renderHeader = () => {\r\n    return (\r\n      title && (\r\n        <header className=\"flex items-center p-4 border-b-2 border-black bg-secondary-dark rounded-tl rounded-tr\">\r\n          <Typography\r\n            variant=\"h4\"\r\n            className=\"flex flex-grow text-primary-light font-light\"\r\n          >\r\n            {title}\r\n          </Typography>\r\n          {closeButton && (\r\n            <Icon\r\n              onClick={onClose}\r\n              name=\"close\"\r\n              className=\"cursor-pointer text-primary-active w-6 h-6\"\r\n            />\r\n          )}\r\n        </header>\r\n      )\r\n    );\r\n  };\r\n\r\n  return (\r\n    <ReactModal\r\n      className=\"relative w-11/12 lg:w-10/12 xl:w-1/2 max-h-full outline-none  text-white\"\r\n      overlayClassName=\"fixed top-0 left-0 right-0 bottom-0 z-50 bg-overlay flex items-start justify-center py-16\"\r\n      shouldCloseOnEsc={shouldCloseOnEsc}\r\n      onRequestClose={handleClose}\r\n      isOpen={isOpen}\r\n      title={title}\r\n    >\r\n      {renderHeader()}\r\n      <section className=\"ohif-scrollbar modal-content overflow-y-auto px-4 py-6 rounded-bl rounded-br bg-primary-dark\">\r\n        {children}\r\n      </section>\r\n    </ReactModal>\r\n  );\r\n};\r\n\r\nModal.defaultProps = {\r\n  shouldCloseOnEsc: true,\r\n};\r\n\r\nModal.propTypes = {\r\n  closeButton: PropTypes.bool,\r\n  shouldCloseOnEsc: PropTypes.bool,\r\n  isOpen: PropTypes.bool,\r\n  title: PropTypes.string,\r\n  onClose: PropTypes.func,\r\n  /** The modal's content */\r\n  children: PropTypes.oneOfType([\r\n    PropTypes.arrayOf(PropTypes.node),\r\n    PropTypes.node,\r\n  ]).isRequired,\r\n};\r\n\r\nexport default Modal;\r\n","import Modal from './Modal';\r\nexport default Modal;\r\n","import React, { useState } from 'react';\r\nimport { ErrorBoundary as ReactErrorBoundary } from 'react-error-boundary';\r\nimport PropTypes from 'prop-types';\r\nimport Modal from '../Modal';\r\n\r\nconst isProduction = process.env.NODE_ENV === 'production';\r\n\r\nconst DefaultFallback = ({ error, componentStack, context, resetErrorBoundary, fallbackRoute }) => {\r\n  const title = `Something went wrong${!isProduction && ` in ${context}`}.`;\r\n  const subtitle = `Sorry, something went wrong there. Try again.`;\r\n  return (\r\n    <div className=\"ErrorFallback bg-primary-dark w-full h-full\" role=\"alert\">\r\n      <p className=\"text-primary-light text-xl\">{title}</p>\r\n      <p className=\"text-primary-light text-base\">{subtitle}</p>\r\n      {!isProduction && (\r\n        <div className=\"rounded-md bg-secondary-dark p-5 mt-5\">\r\n          <pre className=\"text-primary-light\">Context: {context}</pre>\r\n          <pre className=\"text-primary-light\">Error Message: {error.message}</pre>\r\n          <pre className=\"text-primary-light\">Stack: {componentStack}</pre>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst noop = () => { };\r\n\r\nDefaultFallback.propTypes = {\r\n  error: PropTypes.object.isRequired,\r\n  resetErrorBoundary: PropTypes.func,\r\n  componentStack: PropTypes.string,\r\n};\r\n\r\nDefaultFallback.defaultProps = {\r\n  resetErrorBoundary: noop\r\n};\r\n\r\nconst ErrorBoundary = ({\r\n  context,\r\n  onReset,\r\n  onError,\r\n  fallbackComponent: FallbackComponent,\r\n  children,\r\n  fallbackRoute,\r\n  isPage\r\n}) => {\r\n  const [isOpen, setIsOpen] = useState(true);\r\n\r\n  const onErrorHandler = (error, componentStack) => {\r\n    console.error(`${context} Error Boundary`, error, componentStack, context);\r\n    onError(error, componentStack, context);\r\n  };\r\n\r\n  const onResetHandler = (...args) => onReset(...args);\r\n\r\n  const withModal = (Component) => props => (\r\n    <Modal\r\n      closeButton\r\n      shouldCloseOnEsc\r\n      isOpen={isOpen}\r\n      title={'Something went wrong'}\r\n      onClose={() => {\r\n        setIsOpen(false);\r\n        if (fallbackRoute && typeof window !== 'undefined') {\r\n          window.location = fallbackRoute;\r\n        }\r\n      }}\r\n    >\r\n      <Component {...props} />\r\n    </Modal>\r\n  );\r\n\r\n  const Fallback = isPage ? FallbackComponent : withModal(FallbackComponent);\r\n\r\n  return (\r\n    <ReactErrorBoundary\r\n      fallbackRender={props => (\r\n        <Fallback\r\n          {...props}\r\n          context={context}\r\n          fallbackRoute={fallbackRoute}\r\n        />\r\n      )}\r\n      onReset={onResetHandler}\r\n      onError={onErrorHandler}\r\n    >\r\n      {children}\r\n    </ReactErrorBoundary>\r\n  );\r\n};\r\n\r\nErrorBoundary.propTypes = {\r\n  context: PropTypes.string,\r\n  onReset: PropTypes.func,\r\n  onError: PropTypes.func,\r\n  fallbackComponent: PropTypes.oneOfType([PropTypes.node, PropTypes.func]),\r\n  children: PropTypes.node.isRequired,\r\n  fallbackRoute: PropTypes.string\r\n};\r\n\r\nErrorBoundary.defaultProps = {\r\n  context: 'OHIF',\r\n  onReset: noop,\r\n  onError: noop,\r\n  fallbackComponent: DefaultFallback,\r\n  fallbackRoute: null\r\n};\r\n\r\nexport default ErrorBoundary;\r\n","import ErrorBoundary from './ErrorBoundary';\r\nexport default ErrorBoundary;\r\n","import React from 'react';\r\n// Icons\r\n\r\nimport arrowDown from './../../assets/icons/arrow-down.svg';\r\nimport arrowLeft from './../../assets/icons/arrow-left.svg';\r\nimport calendar from './../../assets/icons/calendar.svg';\r\nimport cancel from './../../assets/icons/cancel.svg';\r\nimport clipboard from './../../assets/icons/clipboard.svg';\r\nimport close from './../../assets/icons/close.svg';\r\nimport dottedCircle from './../../assets/icons/dotted-circle.svg';\r\nimport circledCheckmark from './../../assets/icons/circled-checkmark.svg';\r\nimport chevronDown from './../../assets/icons/chevron-down.svg';\r\nimport chevronLeft from './../../assets/icons/chevron-left.svg';\r\nimport chevronRight from './../../assets/icons/chevron-right.svg';\r\nimport eyeVisible from './../../assets/icons/eye-visible.svg';\r\nimport eyeHidden from './../../assets/icons/eye-hidden.svg';\r\nimport exclamation from './../../assets/icons/exclamation.svg';\r\nimport externalLink from './../../assets/icons/external-link.svg';\r\nimport groupLayers from './../../assets/icons/group-layers.svg';\r\nimport info from './../../assets/icons/info.svg';\r\nimport infoLink from './../../assets/icons/info-link.svg';\r\nimport launchArrow from './../../assets/icons/launch-arrow.svg';\r\nimport launchInfo from './../../assets/icons/launch-info.svg';\r\nimport link from './../../assets/icons/link.svg';\r\nimport listBullets from './../../assets/icons/list-bullets.svg';\r\nimport lock from './../../assets/icons/lock.svg';\r\nimport logoOhifSmall from './../../assets/icons/logo-ohif-small.svg';\r\nimport magnifier from './../../assets/icons/magnifier.svg';\r\nimport notificationwarningDiamond from './../../assets/icons/notificationwarning-diamond.svg';\r\nimport pencil from './../../assets/icons/pencil.svg';\r\nimport profile from './../../assets/icons/profile.svg';\r\nimport pushLeft from './../../assets/icons/push-left.svg';\r\nimport pushRight from './../../assets/icons/push-right.svg';\r\nimport settings from './../../assets/icons/settings.svg';\r\nimport sorting from './../../assets/icons/sorting.svg';\r\nimport sortingActiveDown from './../../assets/icons/sorting-active-down.svg';\r\nimport sortingActiveUp from './../../assets/icons/sorting-active-up.svg';\r\nimport tracked from './../../assets/icons/tracked.svg';\r\nimport unlink from './../../assets/icons/unlink.svg';\r\n\r\n/** Tools */\r\nimport toolZoom from './../../assets/icons/tool-zoom.svg';\r\nimport toolCapture from './../../assets/icons/tool-capture.svg';\r\nimport toolLayout from './../../assets/icons/tool-layout.svg';\r\nimport toolMore from './../../assets/icons/tool-more-menu.svg';\r\nimport toolMove from './../../assets/icons/tool-move.svg';\r\nimport toolWindow from './../../assets/icons/tool-window-level.svg';\r\nimport toolAnnotate from './../../assets/icons/tool-annotate.svg';\r\nimport toolBidirectional from './../../assets/icons/tool-bidirectional.svg';\r\nimport toolElipse from './../../assets/icons/tool-elipse.svg';\r\nimport toolLength from './../../assets/icons/tool-length.svg';\r\nimport toolStackScroll from './../../assets/icons/tool-stack-scroll.svg';\r\nimport toolMagnify from './../../assets/icons/tool-magnify.svg';\r\nimport toolFlipHorizontal from './../../assets/icons/tool-flip-horizontal.svg';\r\nimport toolInvert from './../../assets/icons/tool-invert.svg';\r\nimport toolRotateRight from './../../assets/icons/tool-rotate-right.svg';\r\nimport toolCine from './../../assets/icons/tool-cine.svg';\r\nimport toolProbe from './../../assets/icons/tool-probe.svg';\r\nimport toolAngle from './../../assets/icons/tool-angle.svg';\r\nimport toolReset from './../../assets/icons/tool-reset.svg';\r\nimport toolRectangle from './../../assets/icons/tool-rectangle.svg';\r\n\r\n/** Old OHIF */\r\nimport oldTrash from './../../assets/icons/old-trash.svg';\r\nimport oldPlay from './../../assets/icons/old-play.svg';\r\nimport oldStop from './../../assets/icons/old-stop.svg';\r\n\r\nconst ICONS = {\r\n  'arrow-down': arrowDown,\r\n  calendar: calendar,\r\n  cancel: cancel,\r\n  clipboard: clipboard,\r\n  close: close,\r\n  'dotted-circle': dottedCircle,\r\n  'circled-checkmark': circledCheckmark,\r\n  'chevron-down': chevronDown,\r\n  'chevron-left': chevronLeft,\r\n  'chevron-right': chevronRight,\r\n  'eye-visible': eyeVisible,\r\n  'eye-hidden': eyeHidden,\r\n  'external-link': externalLink,\r\n  'group-layers': groupLayers,\r\n  info: info,\r\n  'info-link': infoLink,\r\n  'arrow-left': arrowLeft,\r\n  'launch-arrow': launchArrow,\r\n  'launch-info': launchInfo,\r\n  link: link,\r\n  'list-bullets': listBullets,\r\n  lock: lock,\r\n  'logo-ohif-small': logoOhifSmall,\r\n  magnifier: magnifier,\r\n  exclamation: exclamation,\r\n  'notificationwarning-diamond': notificationwarningDiamond,\r\n  pencil: pencil,\r\n  profile: profile,\r\n  'push-left': pushLeft,\r\n  'push-right': pushRight,\r\n  settings: settings,\r\n  'sorting-active-down': sortingActiveDown,\r\n  'sorting-active-up': sortingActiveUp,\r\n  sorting: sorting,\r\n  tracked: tracked,\r\n  unlink: unlink,\r\n\r\n  /** Tools */\r\n  'tool-zoom': toolZoom,\r\n  'tool-capture': toolCapture,\r\n  'tool-layout': toolLayout,\r\n  'tool-more-menu': toolMore,\r\n  'tool-move': toolMove,\r\n  'tool-window-level': toolWindow,\r\n  'tool-annotate': toolAnnotate,\r\n  'tool-bidirectional': toolBidirectional,\r\n  'tool-elipse': toolElipse,\r\n  'tool-length': toolLength,\r\n  'tool-stack-scroll': toolStackScroll,\r\n  'tool-magnify': toolMagnify,\r\n  'tool-flip-horizontal': toolFlipHorizontal,\r\n  'tool-invert': toolInvert,\r\n  'tool-rotate-right': toolRotateRight,\r\n  'tool-cine': toolCine,\r\n  'tool-probe': toolProbe,\r\n  'tool-angle': toolAngle,\r\n  'tool-reset': toolReset,\r\n  'tool-rectangle': toolRectangle,\r\n\r\n  /** Old OHIF */\r\n  'old-trash': oldTrash,\r\n  'old-play': oldPlay,\r\n  'old-stop': oldStop,\r\n};\r\n\r\n/**\r\n * Return the matching SVG Icon as a React Component.\r\n * Results in an inlined SVG Element. If there's no match,\r\n * return `null`\r\n */\r\nexport default function getIcon(key, props) {\r\n  if (!key || !ICONS[key]) {\r\n    return React.createElement('div', null, 'Missing Icon');\r\n  }\r\n\r\n  return React.createElement(ICONS[key], props);\r\n}\r\n\r\nexport { getIcon, ICONS };\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport getIcon from './getIcon';\r\n\r\nconst Icon = ({ name, ...otherProps }) => {\r\n  return <React.Fragment>{getIcon(name, { ...otherProps })}</React.Fragment>;\r\n};\r\n\r\nIcon.propTypes = {\r\n  name: PropTypes.string.isRequired,\r\n};\r\n\r\nexport default Icon;\r\n","import Icon from './Icon';\r\nexport default Icon;\r\n","import React, { useRef } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nconst baseClasses =\r\n  'text-center items-center justify-center transition duration-300 ease-in-out outline-none font-bold focus:outline-none';\r\n\r\nconst roundedClasses = {\r\n  none: '',\r\n  small: 'rounded',\r\n  medium: 'rounded-md',\r\n  large: 'rounded-lg',\r\n  full: 'rounded-full',\r\n};\r\n\r\nconst disabledClasses = {\r\n  true: 'cursor-not-allowed',\r\n  false: '',\r\n};\r\n\r\nconst variantClasses = {\r\n  text: {\r\n    default:\r\n      'text-white hover:bg-primary-light hover:text-black active:opacity-80 focus:bg-primary-light focus:text-black',\r\n    primary:\r\n      'text-primary-main hover:bg-primary-main hover:text-white active:opacity-80 focus:bg-primary-main focus:text-white',\r\n    secondary:\r\n      'text-secondary-light hover:bg-secondary-light hover:text-white active:opacity-80 focus:bg-secondary-light focus:text-white',\r\n    white:\r\n      'text-white hover:bg-white hover:text-black active:opacity-80 focus:bg-white focus:text-black',\r\n    black:\r\n      'text-black hover:bg-black hover:text-white focus:bg-black focus:text-white active:opacity-80',\r\n  },\r\n  outlined: {\r\n    default:\r\n      'border bg-trasparent border-primary-light text-white hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    primary:\r\n      'border bg-transparent border-primary-main text-primary-main hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    secondary:\r\n      'border bg-transparent border-secondary-light text-secondary-light hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    white:\r\n      'border bg-transparent border-white text-white hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    black:\r\n      'border bg-black border-primary-main text-white hover:bg-primary-main focus:bg-primary-main hover:border-black focus:border-black',\r\n  },\r\n  contained: {\r\n    default:\r\n      'bg-primary-light text-black hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    primary:\r\n      'bg-primary-main text-white hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    secondary:\r\n      'bg-secondary-light text-white hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    white:\r\n      'bg-white text-black hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n    black:\r\n      'bg-black text-white hover:opacity-80 active:opacity-100 focus:opacity-80',\r\n  },\r\n};\r\n\r\nconst sizeClasses = {\r\n  small: 'py-2 px-2 text-base',\r\n  medium: 'py-3 px-3 text-lg',\r\n  large: 'py-4 px-4 text-xl',\r\n  initial: '',\r\n  toolbar: 'text-lg',\r\n};\r\n\r\nconst iconSizeClasses = {\r\n  small: 'w-4 h-4',\r\n  medium: 'w-5 h-5',\r\n  large: 'w-6 h-6',\r\n  toolbar: 'w-5 h-5',\r\n};\r\n\r\nconst fullWidthClasses = {\r\n  true: 'flex w-full',\r\n  false: 'inline-flex',\r\n};\r\n\r\nconst IconButton = ({\r\n  children,\r\n  variant,\r\n  color,\r\n  size,\r\n  rounded,\r\n  disabled,\r\n  type,\r\n  fullWidth,\r\n  onClick,\r\n  className,\r\n  name,\r\n  id,\r\n  ...rest\r\n}) => {\r\n  const buttonElement = useRef(null);\r\n\r\n  const handleOnClick = e => {\r\n    buttonElement.current.blur();\r\n    onClick(e);\r\n  };\r\n  return (\r\n    <button\r\n      className={classnames(\r\n        baseClasses,\r\n        variantClasses[variant][color],\r\n        roundedClasses[rounded],\r\n        sizeClasses[size],\r\n        fullWidthClasses[fullWidth],\r\n        disabledClasses[disabled],\r\n        className\r\n      )}\r\n      style={{\r\n        padding: size === 'toolbar' ? '10px' : null,\r\n      }}\r\n      ref={buttonElement}\r\n      onClick={handleOnClick}\r\n      type={type}\r\n      data-cy={id}\r\n      {...rest}\r\n    >\r\n      {React.cloneElement(children, {\r\n        className: classnames(iconSizeClasses[size], 'fill-current'),\r\n      })}\r\n    </button>\r\n  );\r\n};\r\n\r\nIconButton.defaultProps = {\r\n  onClick: () => {},\r\n  color: 'default',\r\n  disabled: false,\r\n  fullWidth: false,\r\n  rounded: 'medium',\r\n  size: 'medium',\r\n  type: 'button',\r\n  variant: 'contained',\r\n};\r\n\r\nIconButton.propTypes = {\r\n  children: PropTypes.node.isRequired,\r\n  size: PropTypes.oneOf(['small', 'medium', 'large', 'initial', 'toolbar']),\r\n  rounded: PropTypes.oneOf(['none', 'small', 'medium', 'large', 'full']),\r\n  variant: PropTypes.oneOf(['text', 'outlined', 'contained']),\r\n  color: PropTypes.oneOf([\r\n    'default',\r\n    'primary',\r\n    'secondary',\r\n    'white',\r\n    'black',\r\n    'inherit',\r\n  ]),\r\n  fullWidth: PropTypes.bool,\r\n  disabled: PropTypes.bool,\r\n  type: PropTypes.string,\r\n  id: PropTypes.string,\r\n  className: PropTypes.node,\r\n  onClick: PropTypes.func,\r\n};\r\n\r\nexport default IconButton;\r\n","import IconButton from './IconButton';\r\nexport default IconButton;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nconst Label = ({ children, className, text, ...rest }) => {\r\n  const baseClasses = '';\r\n\r\n  return (\r\n    <label className={classnames(baseClasses, className)} {...rest}>\r\n      {text}\r\n      {children}\r\n    </label>\r\n  );\r\n};\r\n\r\nLabel.propTypes = {\r\n  children: PropTypes.node,\r\n};\r\n\r\nexport default Label;\r\n","import Label from './Label';\r\nexport default Label;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Label from '../Label';\r\nimport classnames from 'classnames';\r\n\r\nconst baseInputClasses =\r\n  'shadow transition duration-300 appearance-none border border-primary-main hover:border-gray-500 focus:border-gray-500 focus:outline-none rounded w-full py-2 px-3 text-sm text-white leading-tight focus:outline-none';\r\n\r\nconst transparentClasses = {\r\n  true: 'bg-transparent',\r\n  false: 'bg-black',\r\n};\r\n\r\nconst Input = ({\r\n  id,\r\n  label,\r\n  containerClassName = '',\r\n  labelClassName = '',\r\n  className = '',\r\n  transparent = false,\r\n  type = 'text',\r\n  value,\r\n  onChange,\r\n  onFocus,\r\n  autoFocus,\r\n  onKeyPress,\r\n  onKeyDown,\r\n  readOnly,\r\n  disabled,\r\n  ...otherProps\r\n}) => {\r\n  return (\r\n    <div className={classnames('flex flex-col flex-1', containerClassName)}>\r\n      <Label className={labelClassName} text={label}></Label>\r\n      <input\r\n        data-cy={`input-${id}`}\r\n        className={classnames(\r\n          label && 'mt-2',\r\n          className,\r\n          baseInputClasses,\r\n          transparentClasses[transparent],\r\n          { 'cursor-not-allowed': disabled }\r\n        )}\r\n        disabled={disabled}\r\n        readOnly={readOnly}\r\n        autoFocus={autoFocus}\r\n        type={type}\r\n        value={value}\r\n        onChange={onChange}\r\n        onFocus={onFocus}\r\n        onKeyPress={onKeyPress}\r\n        onKeyDown={onKeyDown}\r\n        {...otherProps}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nInput.propTypes = {\r\n  label: PropTypes.string,\r\n  containerClassName: PropTypes.string,\r\n  labelClassName: PropTypes.string,\r\n  className: PropTypes.string,\r\n  transparent: PropTypes.bool,\r\n  type: PropTypes.string,\r\n  value: PropTypes.any,\r\n  onChange: PropTypes.func,\r\n  onFocus: PropTypes.func,\r\n  autoFocus: PropTypes.bool,\r\n  readOnly: PropTypes.bool,\r\n  onKeyPress: PropTypes.func,\r\n  onKeyDown: PropTypes.func,\r\n  disabled: PropTypes.bool\r\n};\r\n\r\nexport default Input;\r\n","import Input from './Input';\r\nexport default Input;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport { DateRange, InputLabelWrapper } from '../';\r\n\r\nconst InputDateRange = ({\r\n  id,\r\n  label,\r\n  isSortable,\r\n  sortDirection,\r\n  onLabelClick,\r\n  value,\r\n  onChange,\r\n}) => {\r\n  const { startDate, endDate } = value;\r\n\r\n  const onClickHandler = (event) => {\r\n    event.preventDefault();\r\n    onLabelClick(event);\r\n  };\r\n\r\n  return (\r\n    <InputLabelWrapper\r\n      label={label}\r\n      isSortable={isSortable}\r\n      sortDirection={sortDirection}\r\n      onLabelClick={onClickHandler}\r\n    >\r\n      <div className=\"relative\">\r\n        <DateRange\r\n          id={id}\r\n          startDate={startDate}\r\n          endDate={endDate}\r\n          onChange={onChange}\r\n        />\r\n      </div>\r\n    </InputLabelWrapper>\r\n  );\r\n};\r\n\r\nconst noop = () => { };\r\n\r\nInputDateRange.defaultProps = {\r\n  value: {},\r\n  onLabelClick: noop\r\n};\r\n\r\nInputDateRange.propTypes = {\r\n  id: PropTypes.string,\r\n  label: PropTypes.string.isRequired,\r\n  isSortable: PropTypes.bool.isRequired,\r\n  sortDirection: PropTypes.oneOf(['ascending', 'descending', 'none'])\r\n    .isRequired,\r\n  onLabelClick: PropTypes.func.isRequired,\r\n  value: PropTypes.shape({\r\n    /** YYYYMMDD (19921022) */\r\n    startDate: PropTypes.string,\r\n    /** YYYYMMDD (19921022) */\r\n    endDate: PropTypes.string,\r\n  }),\r\n  onChange: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default InputDateRange;\r\n","import InputDateRange from './InputDateRange';\r\nexport default InputDateRange;\r\n","// This is really annoying, but we can't use string concatenation to produce names\r\n// or the purger will purge stuff we need. This is a lazy workaground.\r\n// The alternative would be to use the safelist, but then we would have to remember\r\n// which components which entry in the safelist are used for.\r\n// https://tailwindcss.com/docs/optimizing-for-production\r\nexport default function getGridWidthClass(gridCol) {\r\n  const widthClasses = {\r\n    1: 'w-1/24',\r\n    2: 'w-2/24',\r\n    3: 'w-3/24',\r\n    4: 'w-4/24',\r\n    5: 'w-5/24',\r\n    6: 'w-6/24',\r\n    7: 'w-7/24',\r\n    8: 'w-8/24',\r\n    9: 'w-9/24',\r\n    10: 'w-10/24',\r\n    11: 'w-11/24',\r\n    12: 'w-12/24',\r\n    13: 'w-13/24',\r\n    14: 'w-14/24',\r\n    15: 'w-15/24',\r\n    16: 'w-16/24',\r\n    17: 'w-17/24',\r\n    18: 'w-18/24',\r\n    19: 'w-19/24',\r\n    20: 'w-20/24',\r\n    21: 'w-21/24',\r\n    22: 'w-22/24',\r\n    23: 'w-23/24',\r\n    24: 'w-24/24',\r\n  };\r\n\r\n  return widthClasses[gridCol];\r\n}\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\nimport getGridWidthClass from '../../utils/getGridWidthClass'\r\n\r\nimport {\r\n  InputText,\r\n  InputDateRange,\r\n  InputMultiSelect,\r\n  InputLabelWrapper,\r\n} from '../';\r\n\r\nconst InputGroup = ({\r\n  inputMeta,\r\n  values,\r\n  onValuesChange,\r\n  sorting,\r\n  onSortingChange,\r\n  isSortingEnabled,\r\n}) => {\r\n  const { sortBy, sortDirection } = sorting;\r\n\r\n  const handleFilterLabelClick = name => {\r\n    if (isSortingEnabled) {\r\n      let _sortDirection = 'descending';\r\n      if (sortBy === name) {\r\n        if (sortDirection === 'ascending') {\r\n          _sortDirection = 'descending';\r\n        } else if (sortDirection === 'descending') {\r\n          _sortDirection = 'ascending';\r\n        }\r\n      }\r\n\r\n      onSortingChange({\r\n        sortBy: _sortDirection !== 'none' ? name : '',\r\n        sortDirection: _sortDirection,\r\n      });\r\n    }\r\n  };\r\n\r\n  const renderFieldInputComponent = ({\r\n    name,\r\n    displayName,\r\n    inputProps,\r\n    isSortable,\r\n    inputType,\r\n  }) => {\r\n    const _isSortable = isSortable && isSortingEnabled;\r\n    const _sortDirection = sortBy !== name ? 'none' : sortDirection;\r\n\r\n    const onLabelClick = () => {\r\n      handleFilterLabelClick(name);\r\n    };\r\n\r\n    const handleFieldChange = newValue => {\r\n      onValuesChange({\r\n        ...values,\r\n        [name]: newValue,\r\n      });\r\n    };\r\n\r\n    const handleDateRangeFieldChange = ({ startDate, endDate }) => {\r\n      onValuesChange({\r\n        ...values,\r\n        [name]: {\r\n          startDate: startDate,\r\n          endDate: endDate,\r\n        },\r\n      });\r\n    };\r\n\r\n    switch (inputType) {\r\n      case 'Text':\r\n        return (\r\n          <InputText\r\n            id={name}\r\n            key={name}\r\n            label={displayName}\r\n            isSortable={_isSortable}\r\n            sortDirection={_sortDirection}\r\n            onLabelClick={onLabelClick}\r\n            value={values[name]}\r\n            onChange={handleFieldChange}\r\n          />\r\n        );\r\n      case 'MultiSelect':\r\n        return (\r\n          <InputMultiSelect\r\n            id={name}\r\n            key={name}\r\n            label={displayName}\r\n            isSortable={_isSortable}\r\n            sortDirection={_sortDirection}\r\n            onLabelClick={onLabelClick}\r\n            value={values[name]}\r\n            onChange={handleFieldChange}\r\n            options={inputProps.options}\r\n          />\r\n        );\r\n      case 'DateRange':\r\n        return (\r\n          <InputDateRange\r\n            id={name}\r\n            key={name}\r\n            label={displayName}\r\n            isSortable={_isSortable}\r\n            sortDirection={_sortDirection}\r\n            onLabelClick={onLabelClick}\r\n            value={values[name]}\r\n            onChange={handleDateRangeFieldChange}\r\n          />\r\n        );\r\n      case 'None':\r\n        return (\r\n          <InputLabelWrapper\r\n            key={name}\r\n            label={displayName}\r\n            isSortable={_isSortable}\r\n            sortDirection={_sortDirection}\r\n            onLabelClick={onLabelClick}\r\n          />\r\n        );\r\n      default:\r\n        break;\r\n    }\r\n  };\r\n  return (\r\n    <div className=\"container m-auto relative flex flex-col\">\r\n      <div className=\"flex flex-row w-full\">\r\n        {inputMeta.map(inputMeta => {\r\n          return (\r\n            <div\r\n              key={inputMeta.name}\r\n              className={classnames(\r\n                'pl-4 first:pl-12',\r\n                getGridWidthClass(inputMeta.gridCol)\r\n              )}\r\n            >\r\n              {renderFieldInputComponent(inputMeta)}\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nInputGroup.propTypes = {\r\n  inputMeta: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      name: PropTypes.string.isRequired,\r\n      displayName: PropTypes.string.isRequired,\r\n      inputType: PropTypes.oneOf(['Text', 'MultiSelect', 'DateRange', 'None'])\r\n        .isRequired,\r\n      isSortable: PropTypes.bool.isRequired,\r\n      gridCol: PropTypes.oneOf([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12])\r\n        .isRequired,\r\n      option: PropTypes.arrayOf(\r\n        PropTypes.shape({\r\n          value: PropTypes.string,\r\n          label: PropTypes.string,\r\n        })\r\n      ),\r\n    })\r\n  ).isRequired,\r\n  values: PropTypes.object.isRequired,\r\n  onValuesChange: PropTypes.func.isRequired,\r\n  sorting: PropTypes.shape({\r\n    sortBy: PropTypes.string,\r\n    sortDirection: PropTypes.oneOf(['ascending', 'descending', 'none']),\r\n  }).isRequired,\r\n  onSortingChange: PropTypes.func.isRequired,\r\n  isSortingEnabled: PropTypes.bool.isRequired,\r\n};\r\n\r\nexport default InputGroup;\r\n","import InputGroup from './InputGroup';\r\nexport default InputGroup;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport { Icon } from '../';\r\n\r\nconst baseLabelClassName =\r\n  'flex flex-col flex-1 text-white text-lg pl-1 select-none';\r\nconst spanClassName = 'flex flex-row items-center cursor-pointer focus:outline-none';\r\nconst sortIconMap = {\r\n  descending: 'sorting-active-up',\r\n  ascending: 'sorting-active-down',\r\n  none: 'sorting',\r\n};\r\n\r\nconst InputLabelWrapper = ({\r\n  label,\r\n  isSortable,\r\n  sortDirection,\r\n  onLabelClick,\r\n  className,\r\n  children,\r\n}) => {\r\n  const { t } = useTranslation(\"StudyList\")\r\n\r\n  const onClickHandler = e => {\r\n    if (!isSortable) {\r\n      return;\r\n    }\r\n\r\n    onLabelClick(e);\r\n  };\r\n\r\n  return (\r\n    <label className={classnames(baseLabelClassName, className)}>\r\n      <span\r\n        role=\"button\"\r\n        className={spanClassName}\r\n        onClick={onClickHandler}\r\n        onKeyDown={onClickHandler}\r\n        tabIndex=\"0\"\r\n      >\r\n        {t(label)}\r\n        {isSortable && (\r\n          <Icon\r\n            name={sortIconMap[sortDirection]}\r\n            className={classnames(\r\n              'mx-2 w-2',\r\n              sortDirection !== 'none'\r\n                ? 'text-primary-light'\r\n                : 'text-primary-main'\r\n            )}\r\n          />\r\n        )}\r\n      </span>\r\n      <span>{children}</span>\r\n    </label>\r\n  );\r\n};\r\n\r\nInputLabelWrapper.defaultProps = {\r\n  className: '',\r\n};\r\n\r\nInputLabelWrapper.propTypes = {\r\n  label: PropTypes.string.isRequired,\r\n  isSortable: PropTypes.bool.isRequired,\r\n  sortDirection: PropTypes.oneOf(['ascending', 'descending', 'none'])\r\n    .isRequired,\r\n  onLabelClick: PropTypes.func.isRequired,\r\n  className: PropTypes.string,\r\n  children: PropTypes.node,\r\n};\r\n\r\nexport default InputLabelWrapper;\r\n","import InputLabelWrapper from './InputLabelWrapper';\r\nexport default InputLabelWrapper;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport { Select, InputLabelWrapper } from '../';\r\n\r\nconst InputMultiSelect = ({\r\n  id,\r\n  label,\r\n  isSortable,\r\n  sortDirection,\r\n  onLabelClick,\r\n  value,\r\n  placeholder,\r\n  options,\r\n  onChange,\r\n}) => {\r\n  return (\r\n    <InputLabelWrapper\r\n      label={label}\r\n      isSortable={isSortable}\r\n      sortDirection={sortDirection}\r\n      onLabelClick={onLabelClick}\r\n    >\r\n      <Select\r\n        id={id}\r\n        placeholder={placeholder}\r\n        className=\"mt-2\"\r\n        options={options}\r\n        value={value}\r\n        isMulti={true}\r\n        isClearable={false}\r\n        isSearchable={false}\r\n        closeMenuOnSelect={false}\r\n        hideSelectedOptions={false}\r\n        onChange={(selectedOptions, action) => {\r\n          switch (action) {\r\n            case 'select-option':\r\n            case 'remove-value':\r\n            case 'deselect-option':\r\n            case 'clear':\r\n              onChange(selectedOptions);\r\n              break;\r\n            default:\r\n              break;\r\n          }\r\n        }}\r\n      />\r\n    </InputLabelWrapper>\r\n  );\r\n};\r\n\r\nInputMultiSelect.defaultProps = {\r\n  value: [],\r\n  placeholder: '',\r\n  options: [],\r\n};\r\n\r\nInputMultiSelect.propTypes = {\r\n  id: PropTypes.string,\r\n  label: PropTypes.string.isRequired,\r\n  isSortable: PropTypes.bool.isRequired,\r\n  sortDirection: PropTypes.oneOf(['ascending', 'descending', 'none'])\r\n    .isRequired,\r\n  onLabelClick: PropTypes.func.isRequired,\r\n  onChange: PropTypes.func.isRequired,\r\n  placeholder: PropTypes.string,\r\n  /** Array of options to list as options */\r\n  options: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      value: PropTypes.string,\r\n      label: PropTypes.string,\r\n    })\r\n  ),\r\n  /** Array of string values that exist in our list of options */\r\n  value: PropTypes.arrayOf(PropTypes.string),\r\n};\r\n\r\nexport default InputMultiSelect;\r\n","import InputMultiSelect from './InputMultiSelect';\r\nexport default InputMultiSelect;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport { Input, InputLabelWrapper } from '../';\r\n\r\nconst InputText = ({\r\n  id,\r\n  label,\r\n  isSortable,\r\n  sortDirection,\r\n  onLabelClick,\r\n  value,\r\n  onChange,\r\n}) => {\r\n  return (\r\n    <InputLabelWrapper\r\n      label={label}\r\n      isSortable={isSortable}\r\n      sortDirection={sortDirection}\r\n      onLabelClick={onLabelClick}\r\n    >\r\n      <Input\r\n        id={id}\r\n        className=\"border-primary-main mt-2 bg-black\"\r\n        type=\"text\"\r\n        containerClassName=\"mr-2\"\r\n        value={value}\r\n        onChange={event => {\r\n          onChange(event.target.value);\r\n        }}\r\n      />\r\n    </InputLabelWrapper>\r\n  );\r\n};\r\n\r\nInputText.defaultProps = {\r\n  value: '',\r\n  isSortable: false,\r\n  onLabelClick: () => {},\r\n  sortDirection: 'none',\r\n};\r\n\r\nInputText.propTypes = {\r\n  id: PropTypes.string,\r\n  label: PropTypes.string.isRequired,\r\n  isSortable: PropTypes.bool,\r\n  sortDirection: PropTypes.oneOf(['ascending', 'descending', 'none']),\r\n  onLabelClick: PropTypes.func,\r\n  value: PropTypes.any,\r\n  onChange: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default InputText;\r\n","import InputText from './InputText';\r\nexport default InputText;\r\n","import React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nfunction LayoutSelector({ onSelection }) {\r\n  const [hoveredIndex, setHoveredIndex] = useState();\r\n  const hoverX = hoveredIndex % 3;\r\n  const hoverY = Math.floor(hoveredIndex / 3);\r\n  const isHovered = index => {\r\n    const x = index % 3;\r\n    const y = Math.floor(index / 3);\r\n\r\n    return x <= hoverX && y <= hoverY;\r\n  };\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        display: 'grid',\r\n        gridTemplateColumns: '20px 20px 20px',\r\n        gridTemplateRows: '20px 20px 20px',\r\n        backgroundColor: '#090c29', // primary-dark\r\n      }}\r\n      className=\"p-2\"\r\n    >\r\n      {[0, 1, 2, 3, 4, 5, 6, 7, 8].map(index => (\r\n        <div\r\n          key={index}\r\n          style={{\r\n            border: '1px solid white',\r\n            backgroundColor: isHovered(index) ? '#5acce6' : '#0b1a42',\r\n          }}\r\n          className=\"cursor-pointer\"\r\n          onClick={() => {\r\n            const x = index % 3;\r\n            const y = Math.floor(index / 3);\r\n\r\n            onSelection({\r\n              numRows: y + 1,\r\n              numCols: x + 1,\r\n            });\r\n          }}\r\n          onMouseEnter={() => setHoveredIndex(index)}\r\n          onMouseLeave={() => setHoveredIndex(-1)}\r\n        ></div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nLayoutSelector.defaultProps = {\r\n  onSelection: () => {},\r\n};\r\n\r\nLayoutSelector.propTypes = {\r\n  onSelection: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default LayoutSelector;\r\n","import LayoutSelector from './LayoutSelector';\r\nexport default LayoutSelector;\r\n","import React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\nimport { Icon } from '../';\r\n\r\nconst MeasurementItem = ({\r\n  id,\r\n  index,\r\n  label,\r\n  displayText,\r\n  isActive,\r\n  onClick,\r\n  onEdit,\r\n}) => {\r\n  const [isHovering, setIsHovering] = useState(false);\r\n\r\n  const onEditHandler = event => {\r\n    event.stopPropagation();\r\n    onEdit({ id, isActive, event });\r\n  };\r\n\r\n  const onClickHandler = event => onClick({ id, isActive, event });\r\n\r\n  const onMouseEnter = () => setIsHovering(true);\r\n  const onMouseLeave = () => setIsHovering(false);\r\n\r\n  return (\r\n    <div\r\n      className={classnames(\r\n        'group flex cursor-pointer bg-black border outline-none border-transparent transition duration-300',\r\n        {\r\n          'rounded overflow-hidden border-primary-light': isActive,\r\n        }\r\n      )}\r\n      onMouseEnter={onMouseEnter}\r\n      onMouseLeave={onMouseLeave}\r\n      onClick={onClickHandler}\r\n      role=\"button\"\r\n      tabIndex=\"0\"\r\n      data-cy={\"measurement-item\"}\r\n    >\r\n      <div\r\n        className={classnames(\r\n          'text-center w-6 py-1 text-base transition duration-300',\r\n          {\r\n            'bg-primary-light text-black active': isActive,\r\n            'bg-primary-dark text-primary-light group-hover:bg-secondary-main': !isActive,\r\n          }\r\n        )}\r\n      >\r\n        {index}\r\n      </div>\r\n      <div className=\"relative flex flex-col flex-1 px-2 py-1\">\r\n        <span className=\"mb-1 text-base text-primary-light\">{label}</span>\r\n        {displayText.map(line => (\r\n          <span\r\n            key={line}\r\n            className=\"pl-2 text-base text-white border-l border-primary-light\"\r\n            dangerouslySetInnerHTML={{ __html: line }}\r\n          ></span>\r\n        ))}\r\n        <Icon\r\n          className={classnames(\r\n            'text-white w-4 absolute cursor-pointer transition duration-300',\r\n            { 'invisible opacity-0 mr-2': !isActive && !isHovering },\r\n            { 'visible opacity-1': !isActive && isHovering }\r\n          )}\r\n          name=\"pencil\"\r\n          style={{\r\n            top: 4,\r\n            right: 4,\r\n            transform: isActive || isHovering ? '' : 'translateX(100%)',\r\n          }}\r\n          onClick={onEditHandler}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nMeasurementItem.propTypes = {\r\n  id: PropTypes.oneOfType([\r\n    PropTypes.number.isRequired,\r\n    PropTypes.string.isRequired,\r\n  ]),\r\n  index: PropTypes.number.isRequired,\r\n  label: PropTypes.string,\r\n  displayText: PropTypes.array.isRequired,\r\n  isActive: PropTypes.bool,\r\n  onClick: PropTypes.func,\r\n  onEdit: PropTypes.func,\r\n};\r\n\r\nMeasurementItem.defaultProps = {\r\n  isActive: false,\r\n};\r\n\r\nexport default MeasurementItem;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport MeasurementItem from './MeasurementItem';\r\n\r\nconst MeasurementTable = ({ data, title, amount, onClick, onEdit }) => {\r\n  const { t } = useTranslation(\"MeasurementTable\")\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"flex justify-between px-2 py-1 bg-secondary-main\">\r\n        <span className=\"text-base font-bold tracking-widest text-white uppercase\">\r\n          {t(title)}\r\n        </span>\r\n        <span className=\"text-base font-bold text-white\">{amount}</span>\r\n      </div>\r\n      <div className=\"overflow-hidden ohif-scrollbar max-h-112\">\r\n        {data.length !== 0 &&\r\n          data.map((measurementItem, index) => (\r\n            <MeasurementItem\r\n              key={measurementItem.id}\r\n              id={measurementItem.id}\r\n              index={index + 1}\r\n              label={measurementItem.label}\r\n              isActive={measurementItem.isActive}\r\n              displayText={measurementItem.displayText}\r\n              onClick={onClick}\r\n              onEdit={onEdit}\r\n            />\r\n          ))}\r\n        {data.length === 0 && (\r\n          <div className=\"flex transition duration-300 bg-black border border-transparent cursor-default group\">\r\n            <div className=\"w-6 py-1 text-base text-center transition duration-300 bg-primary-dark text-primary-light group-hover:bg-secondary-main\"></div>\r\n            <div className=\"flex items-center justify-between flex-1 px-2 py-4\">\r\n              <span className=\"flex items-center flex-1 mb-1 text-base text-primary-light\">\r\n                {t('No tracked measurements')}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nMeasurementTable.defaultProps = {\r\n  amount: null,\r\n  data: [],\r\n  onClick: () => {},\r\n  onEdit: () => {},\r\n};\r\n\r\nMeasurementTable.propTypes = {\r\n  title: PropTypes.string.isRequired,\r\n  amount: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\r\n  data: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      id: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\r\n      label: PropTypes.string,\r\n      displayText: PropTypes.arrayOf(PropTypes.string),\r\n      isActive: PropTypes.bool,\r\n    })\r\n  ),\r\n  onClick: PropTypes.func,\r\n  onEdit: PropTypes.func,\r\n};\r\n\r\nexport default MeasurementTable;\r\n","import MeasurementTable from './MeasurementTable';\r\n\r\nexport default MeasurementTable;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nconst stickyClasses = 'sticky top-0';\r\nconst notStickyClasses = 'relative';\r\n\r\nconst NavBar = ({ className, children, isSticky }) => {\r\n  return (\r\n    <div\r\n      className={classnames(\r\n        'flex flex-row items-center bg-secondary-dark px-3 border-b-4 border-black z-20',\r\n        isSticky && stickyClasses,\r\n        !isSticky && notStickyClasses,\r\n        className\r\n      )}\r\n      style={{ paddingTop: '4px', paddingBottom: '4px', minHeight: '52px' }}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\nNavBar.propTypes = {\r\n  className: PropTypes.string,\r\n  children: PropTypes.node,\r\n  isSticky: PropTypes.bool,\r\n};\r\n\r\nexport default NavBar;\r\n","import NavBar from './NavBar';\r\nexport default NavBar;\r\n","import React, { useEffect, useRef } from 'react';\r\nimport classnames from 'classnames';\r\nimport PropTypes from 'prop-types';\r\nimport { Button, Icon } from '../';\r\n\r\nconst Notification = ({ id, type, message, actions, onSubmit, onOutsideClick }) => {\r\n  const notificationRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const notificationElement = notificationRef.current;\r\n    const handleClick = function(event) {\r\n      const isClickInside = notificationElement.contains(event.target);\r\n\r\n      if (!isClickInside) {\r\n        onOutsideClick();\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClick);\r\n\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClick);\r\n    };\r\n  }, [onOutsideClick]);\r\n\r\n  const iconsByType = {\r\n    error: {\r\n      icon: 'info',\r\n      color: 'text-red-700',\r\n    },\r\n    warning: {\r\n      icon: 'notificationwarning-diamond',\r\n      color: 'text-yellow-500',\r\n    },\r\n    info: {\r\n      icon: 'info',\r\n      color: 'text-primary-main',\r\n    },\r\n    success: {\r\n      icon: 'info',\r\n      color: 'text-green-500',\r\n    },\r\n  };\r\n\r\n  const getIconData = () => {\r\n    return (\r\n      iconsByType[type] || {\r\n        icon: '',\r\n        color: '',\r\n      }\r\n    );\r\n  };\r\n\r\n  const { icon, color } = getIconData();\r\n\r\n  return (\r\n    <div\r\n      ref={notificationRef}\r\n      className=\"flex flex-col p-2 mx-2 mt-2 rounded bg-common-bright\"\r\n      data-cy={id}\r\n    >\r\n      <div className=\"flex flex-grow\">\r\n        <Icon name={icon} className={classnames('w-5', color)} />\r\n        <span className=\"ml-2 text-base text-black\">{message}</span>\r\n      </div>\r\n      <div className=\"flex justify-end mt-2\">\r\n        {actions.map((action, index) => {\r\n          const isFirst = index === 0;\r\n          const isPrimary = action.type === 'primary';\r\n\r\n          return (\r\n            <Button\r\n              data-cy={action.id}\r\n              key={index}\r\n              className={classnames({ 'ml-2': !isFirst })}\r\n              color={isPrimary ? 'primary' : undefined}\r\n              onClick={() => {\r\n                onSubmit(action.value);\r\n              }}\r\n            >\r\n              {action.text}\r\n            </Button>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nNotification.defaultProps = {\r\n  type: 'info',\r\n  onOutsideClick: () => {},\r\n};\r\n\r\nNotification.propTypes = {\r\n  type: PropTypes.string,\r\n  message: PropTypes.string.isRequired,\r\n  actions: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      text: PropTypes.string.isRequired,\r\n      value: PropTypes.any.isRequired,\r\n      type: PropTypes.oneOf(['primary', 'secondary', 'cancel']).isRequired,\r\n    })\r\n  ).isRequired,\r\n  onSubmit: PropTypes.func.isRequired,\r\n  /** Can be used as a callback to dismiss the notification for clicks that occur outside of it */\r\n  onOutsideClick: PropTypes.func,\r\n};\r\n\r\nexport default Notification;\r\n","import Notification from './Notification';\r\nexport default Notification;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\nimport ReactSelect, { components } from 'react-select';\r\n\r\nimport './Select.css';\r\n\r\nconst MultiValue = props => {\r\n  const values = props.selectProps.value;\r\n  const lastValue = values[values.length - 1];\r\n  let label = props.data.label;\r\n  if (lastValue.label !== label) {\r\n    label += ', ';\r\n  }\r\n\r\n  return <span>{label}</span>;\r\n};\r\n\r\nconst Option = props => {\r\n  return (\r\n    <div>\r\n      <components.Option {...props}>\r\n        <input\r\n          type=\"checkbox\"\r\n          checked={props.isSelected}\r\n          className=\"w-6 h-6 mr-2\"\r\n          onChange={e => null}\r\n        />\r\n        <label>{props.value} </label>\r\n      </components.Option>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Select = ({\r\n  id,\r\n  className,\r\n  closeMenuOnSelect,\r\n  hideSelectedOptions,\r\n  isClearable,\r\n  isDisabled,\r\n  isMulti,\r\n  isSearchable,\r\n  onChange,\r\n  options,\r\n  placeholder,\r\n  noIcons,\r\n  menuPlacement,\r\n  value,\r\n}) => {\r\n  const _noIconComponents = { DropdownIndicator: () => null, IndicatorSeparator: () => null };\r\n  let _components = isMulti ? { Option, MultiValue } : {};\r\n  _components = noIcons ? { ..._components, ..._noIconComponents } : _components;\r\n  const selectedOptions = [];\r\n\r\n  // Map array of values to an array of selected options\r\n  if (value && Array.isArray(value)) {\r\n    value.forEach(val => {\r\n      const found = options.find(opt => opt.value === val);\r\n      if (found) {\r\n        selectedOptions.push(JSON.parse(JSON.stringify(found)));\r\n      }\r\n    });\r\n  }\r\n\r\n  return (\r\n    <ReactSelect\r\n      inputId={`input-${id}`}\r\n      className={classnames(\r\n        className,\r\n        'flex flex-col flex-1 customSelect__wrapper'\r\n      )}\r\n      classNamePrefix=\"customSelect\"\r\n      isDisabled={isDisabled}\r\n      isClearable={isClearable}\r\n      isMulti={isMulti}\r\n      isSearchable={isSearchable}\r\n      menuPlacement={menuPlacement}\r\n      closeMenuOnSelect={closeMenuOnSelect}\r\n      hideSelectedOptions={hideSelectedOptions}\r\n      components={_components}\r\n      placeholder={placeholder}\r\n      options={options}\r\n      value={value && Array.isArray(value) ? selectedOptions : value}\r\n      onChange={(selectedOptions, { action }) => {\r\n        const newSelection = !selectedOptions.length\r\n          ? selectedOptions\r\n          : selectedOptions.reduce((acc, curr) => acc.concat([curr.value]), []);\r\n        onChange(newSelection, action);\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\nSelect.defaultProps = {\r\n  className: '',\r\n  closeMenuOnSelect: true,\r\n  hideSelectedOptions: true,\r\n  isClearable: true,\r\n  isDisabled: false,\r\n  isMulti: false,\r\n  isSearchable: true,\r\n  noIcons: false,\r\n  menuPlacement: 'auto',\r\n  value: [],\r\n};\r\n\r\nSelect.propTypes = {\r\n  className: PropTypes.string,\r\n  closeMenuOnSelect: PropTypes.bool,\r\n  hideSelectedOptions: PropTypes.bool,\r\n  isClearable: PropTypes.bool,\r\n  isDisabled: PropTypes.bool,\r\n  isMulti: PropTypes.bool,\r\n  isSearchable: PropTypes.bool,\r\n  noIcons: PropTypes.bool,\r\n  menuPlacement: PropTypes.oneOf(['auto', 'bottom', 'top']),\r\n  onChange: PropTypes.func.isRequired,\r\n  options: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      value: PropTypes.string,\r\n      label: PropTypes.string,\r\n    })\r\n  ),\r\n  placeholder: PropTypes.string,\r\n  value: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.string), PropTypes.any]),\r\n};\r\n\r\nexport default Select;\r\n","import Select from './Select';\r\nexport default Select;\r\n","import React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\nimport { Icon } from '../';\r\n\r\nconst SegmentationTable = ({ title, amount, data }) => {\r\n  const [activeItem, setActiveItem] = useState(null);\r\n\r\n  // TODO: colorLUT should be defined in the application\r\n  const colorLUT = [\r\n    '#932a13',\r\n    '#821393',\r\n    '#2b7fc4',\r\n    '#12c457',\r\n    '#7f7d2e',\r\n    '#7f2e4a',\r\n    '#866943',\r\n    '#65ae7f',\r\n    '#334b5f',\r\n    '#3cb0dc',\r\n    '#292ac9',\r\n    '#629753',\r\n  ];\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"flex justify-between px-2 py-1 bg-secondary-main\">\r\n        <span className=\"text-base font-bold text-white tracking-widest uppercase\">\r\n          {title}\r\n        </span>\r\n        <div className=\"flex\">\r\n          <span className=\"text-base font-bold text-white\">{amount}</span>\r\n          <Icon\r\n            name=\"eye-hidden\"\r\n            className=\"w-6 text-white ml-2 cursor-pointer transition duration-300 hover:opacity-80\"\r\n            onClick={() => alert('TBD')}\r\n          />\r\n        </div>\r\n      </div>\r\n      <div className=\"overflow-y-auto overflow-x-hidden ohif-scrollbar max-h-64\">\r\n        {!!data.length &&\r\n          data.map((e, i) => {\r\n            const itemKey = i;\r\n            const currentItem = i + 1;\r\n            const isActive = !!activeItem && activeItem[title] === i;\r\n\r\n            const handleOnClick = () => {\r\n              setActiveItem((s) => {\r\n                return {\r\n                  ...s,\r\n                  [title]: s && s[title] === itemKey ? null : itemKey,\r\n                };\r\n              });\r\n            };\r\n\r\n            return (\r\n              <div\r\n                key={i}\r\n                className={classnames(\r\n                  'group flex cursor-default bg-black border border-transparent transition duration-300 rounded overflow-hidden',\r\n                  {\r\n                    'border-primary-light': isActive,\r\n                  }\r\n                )}\r\n                onClick={handleOnClick}\r\n                onKeyDown={handleOnClick}\r\n                role=\"button\"\r\n                tabIndex=\"0\"\r\n              >\r\n                <div\r\n                  className={classnames(\r\n                    'text-center w-6 py-1 text-base transition duration-300',\r\n                    {\r\n                      'bg-primary-light text-black': isActive,\r\n                      'bg-primary-dark text-primary-light group-hover:bg-secondary-main': !isActive,\r\n                    }\r\n                  )}\r\n                >\r\n                  {currentItem}\r\n                </div>\r\n                <div className=\"px-2 py-1 flex flex-1 items-center justify-between\">\r\n                  <span className=\"text-base text-primary-light mb-1 flex items-center flex-1\">\r\n                    <div\r\n                      className=\"w-3 h-3 rounded-full mr-2\"\r\n                      style={{ backgroundColor: colorLUT[i] }}\r\n                    ></div>\r\n                    Label short description\r\n                  </span>\r\n                  <Icon\r\n                    className={classnames(\r\n                      'text-white w-6 cursor-pointer transition duration-300 hover:opacity-80'\r\n                    )}\r\n                    name=\"eye-visible\"\r\n                    onClick={(e) => {\r\n                      // stopPropagation needed to avoid disable the current active item\r\n                      e.stopPropagation();\r\n                      alert('Toggle');\r\n                    }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nSegmentationTable.defaultProps = {\r\n  amount: null,\r\n  data: [],\r\n};\r\n\r\nSegmentationTable.propTypes = {\r\n  title: PropTypes.string.isRequired,\r\n  amount: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\r\n  data: PropTypes.array, // TODO: define better the array structure\r\n};\r\n\r\nexport default SegmentationTable;\r\n","import React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport { Button, Icon } from '../';\r\n\r\nconst borderSize = 4;\r\nconst expandedWidth = 248;\r\nconst collapsedWidth = 56;\r\n\r\nconst baseStyle = {\r\n  maxWidth: `${expandedWidth}px`,\r\n  width: `${expandedWidth}px`,\r\n};\r\n\r\nconst collapsedHideWidth = expandedWidth - collapsedWidth - borderSize;\r\nconst styleMap = {\r\n  open: {\r\n    left: { marginLeft: '0px' },\r\n    right: { marginRight: '0px' },\r\n  },\r\n  closed: {\r\n    left: { marginLeft: `-${collapsedHideWidth}px` },\r\n    right: { marginRight: `-${collapsedHideWidth}px` },\r\n  },\r\n};\r\n\r\nconst baseClasses =\r\n  'transition-all duration-300 ease-in-out h-100 bg-primary-dark border-black flex flex-col justify-start box-content';\r\n\r\nconst classesMap = {\r\n  open: {\r\n    left: `border-r-4`,\r\n    right: `border-l-4`,\r\n  },\r\n  closed: {\r\n    left: `border-r-4 items-end`,\r\n    right: `border-l-4 items-start`,\r\n  },\r\n};\r\n\r\nconst openIconName = {\r\n  left: 'push-left',\r\n  right: 'push-right',\r\n};\r\n\r\nconst position = {\r\n  left: {\r\n    right: 5,\r\n  },\r\n  right: {\r\n    left: 5,\r\n  },\r\n};\r\n\r\nconst getChildComponent = (childComponents, componentOpen) => {\r\n  if (Array.isArray(childComponents)) {\r\n    return childComponents.find(\r\n      _childComponent => _childComponent.name === componentOpen\r\n    );\r\n  } else {\r\n    return childComponents;\r\n  }\r\n};\r\n\r\nconst SidePanel = ({\r\n  side,\r\n  className,\r\n  defaultComponentOpen,\r\n  childComponents,\r\n}) => {\r\n  const { t } = useTranslation('SidePanel');\r\n\r\n  const [componentOpen, setComponentOpen] = useState(defaultComponentOpen);\r\n\r\n  const openStatus = componentOpen ? 'open' : 'closed';\r\n  const style = Object.assign({}, styleMap[openStatus][side], baseStyle);\r\n\r\n  const childComponent = getChildComponent(childComponents, componentOpen);\r\n\r\n  const getPanelButtons = () => {\r\n    const _childComponents = Array.isArray(childComponents)\r\n      ? childComponents\r\n      : [childComponents];\r\n    return _childComponents.map((childComponent, i) => {\r\n      return (\r\n        <Button\r\n          key={i}\r\n          variant=\"text\"\r\n          color=\"inherit\"\r\n          onClick={() => {\r\n            setComponentOpen(childComponent.name);\r\n          }}\r\n          style={{\r\n            minWidth: `${collapsedWidth}px`,\r\n            width: `${collapsedWidth}px`,\r\n          }}\r\n          name={childComponent.name}\r\n          className=\"flex flex-col text-xs px-1 py-1 text-white border-transparent border-b\"\r\n        >\r\n          <Icon\r\n            name={childComponent.iconName}\r\n            className=\"text-primary-active\"\r\n          />\r\n          <span className=\"mt-2 text-white text-xs\">\r\n            {t(childComponent.iconLabel)}\r\n          </span>\r\n        </Button>\r\n      );\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={classnames(\r\n        className,\r\n        baseClasses,\r\n        classesMap[openStatus][side]\r\n      )}\r\n      style={style}\r\n    >\r\n      {componentOpen ? (\r\n        <React.Fragment>\r\n          <div className=\"px-3 border-b border-secondary-light\">\r\n            <Button\r\n              variant=\"text\"\r\n              color=\"inherit\"\r\n              rounded=\"none\"\r\n              onClick={() => {\r\n                setComponentOpen(null);\r\n              }}\r\n              name={childComponent.name}\r\n              className=\"flex flex-row items-center px-3 h-12 relative w-full\"\r\n            >\r\n              <Icon\r\n                name={openIconName[side]}\r\n                className={classnames(\r\n                  'text-primary-active absolute',\r\n                  side === 'left' && 'order-last'\r\n                )}\r\n                style={{ ...position[side] }}\r\n              />\r\n              <span className=\"flex-1 text-primary-active\">\r\n                {t(childComponent.label)}\r\n              </span>\r\n            </Button>\r\n          </div>\r\n          <childComponent.content />\r\n        </React.Fragment>\r\n      ) : (\r\n        <React.Fragment>{getPanelButtons()}</React.Fragment>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nSidePanel.defaultProps = {\r\n  defaultComponentOpen: null,\r\n};\r\n\r\nSidePanel.propTypes = {\r\n  side: PropTypes.oneOf(['left', 'right']).isRequired,\r\n  className: PropTypes.string,\r\n  defaultComponentOpen: PropTypes.string,\r\n  childComponents: PropTypes.oneOfType([\r\n    PropTypes.shape({\r\n      iconName: PropTypes.string.isRequired,\r\n      iconLabel: PropTypes.string.isRequired,\r\n      name: PropTypes.string.isRequired,\r\n      label: PropTypes.string.isRequired,\r\n      content: PropTypes.func, // TODO: Should be node, but it keeps complaining?\r\n    }),\r\n    PropTypes.arrayOf(\r\n      PropTypes.shape({\r\n        iconName: PropTypes.string.isRequired,\r\n        iconLabel: PropTypes.string.isRequired,\r\n        name: PropTypes.string.isRequired,\r\n        label: PropTypes.string.isRequired,\r\n        content: PropTypes.func, // TODO: Should be node, but it keeps complaining?\r\n      })\r\n    ),\r\n  ]),\r\n};\r\n\r\nexport default SidePanel;\r\n","import SidePanel from './SidePanel';\r\nexport default SidePanel;\r\n","import React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\nimport OutsideClickHandler from 'react-outside-click-handler';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport { Icon, Tooltip, ListMenu } from '../';\r\n\r\nconst baseClasses = {\r\n  Button:\r\n    'flex items-center rounded-md border-transparent border-2 cursor-pointer',\r\n  Primary:\r\n    'h-full flex flex-1 items-center rounded-md rounded-tr-none rounded-br-none',\r\n  Secondary:\r\n    'h-full flex items-center justify-center rounded-tr-md rounded-br-md w-4',\r\n  PrimaryIcon: 'w-5 h-5',\r\n  SecondaryIcon: 'w-4 h-full stroke-1',\r\n  Separator: 'border-l pt-2 pb-2',\r\n  Content: 'absolute z-10 top-0 mt-12',\r\n};\r\n\r\nconst classes = {\r\n  Button: ({ isExpanded, primary }) =>\r\n    classNames(\r\n      baseClasses.Button,\r\n      !isExpanded &&\r\n        !primary.isActive &&\r\n        'hover:bg-primary-dark hover:border-primary-dark'\r\n    ),\r\n  Interface: 'h-full flex flex-row items-center',\r\n  Primary: ({ primary, isExpanded }) =>\r\n    classNames(\r\n      baseClasses.Primary,\r\n      primary.isActive && !isExpanded\r\n        ? 'bg-primary-light rounded-tr-md rounded-br-md active'\r\n        : isExpanded\r\n        ? 'bg-primary-dark'\r\n        : 'bg-secondary-dark hover:bg-primary-dark'\r\n    ),\r\n  Secondary: ({ isExpanded, primary }) =>\r\n    classNames(\r\n      baseClasses.Secondary,\r\n      isExpanded\r\n        ? 'bg-primary-light rounded-tr-md rounded-br-md'\r\n        : primary.isActive\r\n        ? 'bg-secondary-dark'\r\n        : 'hover:bg-primary-dark bg-secondary-dark'\r\n    ),\r\n  PrimaryIcon: ({ primary, isExpanded }) =>\r\n    classNames(\r\n      baseClasses.PrimaryIcon,\r\n      primary.isActive && !isExpanded\r\n        ? 'text-primary-dark'\r\n        : 'text-common-bright'\r\n    ),\r\n  SecondaryIcon: ({ isExpanded }) =>\r\n    classNames(\r\n      baseClasses.SecondaryIcon,\r\n      isExpanded\r\n        ? 'text-primary-dark'\r\n        : 'text-primary-active hover:text-common-bright'\r\n    ),\r\n  Separator: ({ primary, isExpanded, isHovering }) =>\r\n    classNames(\r\n      baseClasses.Separator,\r\n      isHovering || isExpanded || primary.isActive\r\n        ? 'border-transparent'\r\n        : 'border-primary-active'\r\n    ),\r\n  Content: ({ isExpanded }) =>\r\n    classNames(baseClasses.Content, isExpanded ? 'block' : 'hidden'),\r\n};\r\n\r\nconst SplitButton = ({\r\n  isRadio,\r\n  isAction,\r\n  //\r\n  bState,\r\n  //\r\n  groupId,\r\n  primary: _primary,\r\n  secondary,\r\n  items: _items,\r\n  renderer,\r\n  onInteraction,\r\n}) => {\r\n  const { t } = useTranslation('Buttons');\r\n\r\n  const { primaryToolId, toggles } = bState;\r\n  /* Bubbles up individual item clicks */\r\n  const getSplitButtonItems = items =>\r\n    items.map((item, index) => ({\r\n      ...item,\r\n      index,\r\n      onClick: () => {\r\n        onInteraction({\r\n          groupId,\r\n          //\r\n          itemId: item.id,\r\n          interactionType: item.type,\r\n          // splitButtonId? (so we can track group?)\r\n          // info to fire item's command/event?\r\n          commandName: item.commandName,\r\n          commandOptions: item.commandOptions,\r\n        });\r\n\r\n        setState(state => ({\r\n          ...state,\r\n          primary: !isAction ? { ...item, index } : state.primary,\r\n          isExpanded: false,\r\n          items: getSplitButtonItems(_items).filter(item =>\r\n            isRadio && !isAction ? item.index !== index : true\r\n          ),\r\n        }));\r\n      },\r\n    }));\r\n\r\n  const [state, setState] = useState({\r\n    primary: _primary,\r\n    items: getSplitButtonItems(_items).filter(item =>\r\n      isRadio && !isAction ? item.id !== _primary.id : true\r\n    ),\r\n    isHovering: false,\r\n    isExpanded: false,\r\n  });\r\n\r\n  const onSecondaryClickHandler = () =>\r\n    setState(state => ({ ...state, isExpanded: !state.isExpanded }));\r\n  const onMouseEnterHandler = () =>\r\n    setState(state => ({ ...state, isHovering: true }));\r\n  const onMouseLeaveHandler = () =>\r\n    setState(state => ({ ...state, isHovering: false }));\r\n  const outsideClickHandler = () =>\r\n    setState(state => ({ ...state, isExpanded: false }));\r\n  const onPrimaryClickHandler = () => {\r\n    onInteraction({\r\n      groupId,\r\n      itemId: state.primary.id,\r\n      interactionType: state.primary.type,\r\n      // splitButtonId? (so we can track group?)\r\n      // info to fire item's command/event?\r\n      //\r\n      commandName: state.primary.commandName,\r\n      commandOptions: state.primary.commandOptions,\r\n    });\r\n  };\r\n\r\n  const isPrimaryActive =\r\n    (state.primary.type === 'tool' && primaryToolId === state.primary.id) ||\r\n    (state.primary.type === 'toggle' && toggles[state.primary.id] === true);\r\n\r\n  return (\r\n    <OutsideClickHandler onOutsideClick={outsideClickHandler}>\r\n      <div name=\"SplitButton\" className=\"relative\">\r\n        <div\r\n          className={classes.Button({\r\n            ...state,\r\n            primary: { isActive: isPrimaryActive },\r\n          })}\r\n          style={{ height: '40px' }}\r\n          onMouseEnter={onMouseEnterHandler}\r\n          onMouseLeave={onMouseLeaveHandler}\r\n        >\r\n          <div className={classes.Interface}>\r\n            <div\r\n              onClick={onPrimaryClickHandler}\r\n              className={classes.Primary({\r\n                ...state,\r\n                primary: { isActive: isPrimaryActive },\r\n              })}\r\n              data-tool={state.primary.id}\r\n              data-cy={`${groupId}-split-button-primary`}\r\n            >\r\n              <Tooltip\r\n                isDisabled={!state.primary.tooltip}\r\n                content={state.primary.tooltip}\r\n              >\r\n                <div\r\n                  className=\"flex items-center justify-center w-full h-full\"\r\n                  style={{ padding: '10px' }}\r\n                >\r\n                  <Icon\r\n                    name={state.primary.icon}\r\n                    className={classes.PrimaryIcon({\r\n                      ...state,\r\n                      primary: { isActive: isPrimaryActive },\r\n                    })}\r\n                  />\r\n                </div>\r\n              </Tooltip>\r\n            </div>\r\n            <div\r\n              className={classes.Separator({\r\n                ...state,\r\n                primary: { isActive: isPrimaryActive },\r\n              })}\r\n            ></div>\r\n            <div\r\n              className={classes.Secondary({\r\n                ...state,\r\n                primary: { isActive: isPrimaryActive },\r\n              })}\r\n              onClick={onSecondaryClickHandler}\r\n              data-cy={`${groupId}-split-button-secondary`}\r\n            >\r\n              <Tooltip\r\n                isDisabled={state.isExpanded || !secondary.tooltip}\r\n                content={secondary.tooltip}\r\n                className=\"h-full\"\r\n              >\r\n                <Icon\r\n                  name={secondary.icon}\r\n                  className={classes.SecondaryIcon({\r\n                    ...state,\r\n                    primary: { isActive: isPrimaryActive },\r\n                  })}\r\n                />\r\n              </Tooltip>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        {/* EXPANDED LIST OF OPTIONS */}\r\n        <div\r\n          className={classes.Content({ ...state })}\r\n          data-cy={`${groupId}-list-menu`}\r\n        >\r\n          <ListMenu items={state.items} renderer={(args) => renderer({ ...args, t })} />\r\n        </div>\r\n      </div>\r\n    </OutsideClickHandler>\r\n  );\r\n};\r\n\r\nconst DefaultListItemRenderer = ({ icon, label, isActive, t }) => (\r\n  <div\r\n    className={classNames(\r\n      'flex flex-row items-center p-3 h-8 w-full hover:bg-primary-dark',\r\n      isActive && 'bg-primary-dark'\r\n    )}\r\n  >\r\n    <span className=\"mr-4 text-base whitespace-pre text-common-bright\">\r\n      <Icon name={icon} className=\"w-5 h-5 text-common-bright\" />\r\n    </span>\r\n    <span className=\"mr-5 text-base whitespace-pre text-common-bright\">\r\n      {t(label)}\r\n    </span>\r\n  </div>\r\n);\r\n\r\nconst noop = () => {};\r\n\r\nSplitButton.defaultProps = {\r\n  isRadio: false,\r\n  isAction: false,\r\n  primary: {\r\n    label: null,\r\n    tooltip: null,\r\n  },\r\n  secondary: {\r\n    icon: 'chevron-down',\r\n    label: null,\r\n    isActive: true,\r\n    tooltip: 'More Measure Tools',\r\n  },\r\n  items: [],\r\n  renderer: DefaultListItemRenderer,\r\n};\r\n\r\nSplitButton.propTypes = {\r\n  primary: PropTypes.shape({\r\n    id: PropTypes.string.isRequired,\r\n    icon: PropTypes.string,\r\n    label: PropTypes.string,\r\n    type: PropTypes.oneOf(['tool', 'action', 'toggle']).isRequired,\r\n    tooltip: PropTypes.string,\r\n  }),\r\n  secondary: PropTypes.shape({\r\n    id: PropTypes.string,\r\n    icon: PropTypes.string,\r\n    label: PropTypes.string,\r\n    tooltip: PropTypes.string,\r\n    isActive: PropTypes.bool,\r\n  }),\r\n  renderer: PropTypes.func,\r\n  items: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      id: PropTypes.string.isRequired,\r\n      icon: PropTypes.string,\r\n      label: PropTypes.string,\r\n      type: PropTypes.oneOf(['tool', 'action', 'toggle']).isRequired,\r\n      tooltip: PropTypes.string,\r\n      isActive: PropTypes.bool,\r\n    })\r\n  ),\r\n  /** Callback function to inform ToolbarService of important events */\r\n  onInteraction: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default SplitButton;\r\n","import SplitButton from './SplitButton';\r\nexport default SplitButton;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport { ButtonGroup, Button, StudyItem, ThumbnailList } from '../';\r\n\r\nconst buttonClasses = 'text-white text-base border-none bg-black p-2 min-w-18';\r\nconst activeButtonClasses = 'bg-primary-main';\r\n\r\nconst getTrackedSeries = displaySets => {\r\n  let trackedSeries = 0;\r\n  displaySets.forEach(displaySet => {\r\n    if (displaySet.isTracked) {\r\n      trackedSeries++;\r\n    }\r\n  });\r\n\r\n  return trackedSeries;\r\n};\r\n\r\nconst StudyBrowser = ({\r\n  tabs,\r\n  activeTabName,\r\n  expandedStudyInstanceUIDs,\r\n  onClickTab,\r\n  onClickStudy,\r\n  onClickThumbnail,\r\n  onDoubleClickThumbnail,\r\n  onClickUntrack,\r\n  activeDisplaySetInstanceUID,\r\n}) => {\r\n  const { t } = useTranslation(\"StudyBrowser\")\r\n\r\n  const getTabContent = () => {\r\n    const tabData = tabs.find(tab => tab.name === activeTabName);\r\n\r\n    return tabData.studies.map(\r\n      ({\r\n        studyInstanceUid,\r\n        date,\r\n        description,\r\n        numInstances,\r\n        modalities,\r\n        displaySets,\r\n      }) => {\r\n        const isExpanded = expandedStudyInstanceUIDs.includes(studyInstanceUid);\r\n        return (\r\n          <React.Fragment key={studyInstanceUid}>\r\n            <StudyItem\r\n              date={date}\r\n              description={description}\r\n              numInstances={numInstances}\r\n              modalities={modalities}\r\n              trackedSeries={getTrackedSeries(displaySets)}\r\n              isActive={isExpanded}\r\n              onClick={() => {\r\n                onClickStudy(studyInstanceUid);\r\n              }}\r\n              data-cy=\"thumbnail-list\"\r\n            />\r\n            {isExpanded && displaySets && (\r\n              <ThumbnailList\r\n                thumbnails={displaySets}\r\n                activeDisplaySetInstanceUID={activeDisplaySetInstanceUID}\r\n                onThumbnailClick={onClickThumbnail}\r\n                onThumbnailDoubleClick={onDoubleClickThumbnail}\r\n                onClickUntrack={onClickUntrack}\r\n              />\r\n            )}\r\n          </React.Fragment>\r\n        );\r\n      }\r\n    );\r\n  };\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <div className=\"flex flex-row items-center justify-center h-16 p-4 border-b w-100 border-secondary-light bg-primary-dark\" data-cy={\"studyBrowser-panel\"}>\r\n        <ButtonGroup\r\n          variant=\"outlined\"\r\n          color=\"inherit\"\r\n          className=\"border rounded-md border-secondary-light\"\r\n        >\r\n          {tabs.map(tab => {\r\n            const { name, label, studies } = tab;\r\n            const isActive = activeTabName === name;\r\n            const isDisabled = !studies.length;\r\n            return (\r\n              <Button\r\n                key={name}\r\n                className={classnames(\r\n                  buttonClasses,\r\n                  isActive && activeButtonClasses\r\n                )}\r\n                size=\"initial\"\r\n                onClick={() => {\r\n                  onClickTab(name);\r\n                }}\r\n                disabled={isDisabled}\r\n              >\r\n                {t(label)}\r\n              </Button>\r\n            );\r\n          })}\r\n        </ButtonGroup>\r\n      </div>\r\n      <div className=\"flex flex-col flex-1 overflow-auto\">\r\n        {getTabContent()}\r\n      </div>\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nStudyBrowser.propTypes = {\r\n  onClickTab: PropTypes.func.isRequired,\r\n  onClickStudy: PropTypes.func,\r\n  onClickThumbnail: PropTypes.func,\r\n  onDoubleClickThumbnail: PropTypes.func,\r\n  onClickUntrack: PropTypes.func,\r\n  activeTabName: PropTypes.string.isRequired,\r\n  expandedStudyInstanceUIDs: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n  activeDisplaySetInstanceUID: PropTypes.string,\r\n  tabs: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      name: PropTypes.string.isRequired,\r\n      label: PropTypes.string.isRequired,\r\n      studies: PropTypes.arrayOf(\r\n        PropTypes.shape({\r\n          studyInstanceUid: PropTypes.string.isRequired,\r\n          date: PropTypes.string,\r\n          numInstances: PropTypes.number,\r\n          modalities: PropTypes.string,\r\n          description: PropTypes.string,\r\n          displaySets: PropTypes.arrayOf(\r\n            PropTypes.shape({\r\n              displaySetInstanceUID: PropTypes.string.isRequired,\r\n              imageSrc: PropTypes.string,\r\n              imageAltText: PropTypes.string,\r\n              seriesDate: PropTypes.string,\r\n              seriesNumber: PropTypes.number,\r\n              numInstances: PropTypes.number,\r\n              description: PropTypes.string,\r\n              componentType: PropTypes.oneOf([\r\n                'thumbnail',\r\n                'thumbnailTracked',\r\n                'thumbnailNoImage',\r\n              ]).isRequired,\r\n              isTracked: PropTypes.bool,\r\n              viewportIdentificator: PropTypes.arrayOf(PropTypes.string),\r\n              /**\r\n               * Data the thumbnail should expose to a receiving drop target. Use a matching\r\n               * `dragData.type` to identify which targets can receive this draggable item.\r\n               * If this is not set, drag-n-drop will be disabled for this thumbnail.\r\n               *\r\n               * Ref: https://react-dnd.github.io/react-dnd/docs/api/use-drag#specification-object-members\r\n               */\r\n              dragData: PropTypes.shape({\r\n                /** Must match the \"type\" a dropTarget expects */\r\n                type: PropTypes.string.isRequired,\r\n              }),\r\n            })\r\n          ),\r\n        })\r\n      ).isRequired,\r\n    })\r\n  ),\r\n};\r\n\r\nconst noop = () => { };\r\n\r\nStudyBrowser.defaultProps = {\r\n  onClickTab: noop,\r\n  onClickStudy: noop,\r\n  onClickThumbnail: noop,\r\n  onDoubleClickThumbnail: noop,\r\n  onClickUntrack: noop,\r\n};\r\n\r\nexport default StudyBrowser;\r\n","import StudyBrowser from './StudyBrowser';\r\nexport default StudyBrowser;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nimport { Icon } from '../';\r\n\r\nconst baseClasses =\r\n  'first:border-0 border-t border-secondary-light cursor-pointer select-none outline-none';\r\n\r\nconst StudyItem = ({\r\n  date,\r\n  description,\r\n  numInstances,\r\n  modalities,\r\n  trackedSeries,\r\n  isActive,\r\n  onClick,\r\n}) => {\r\n  return (\r\n    <div\r\n      className={classnames(\r\n        isActive ? 'bg-secondary-dark' : 'bg-black hover:bg-secondary-main',\r\n        baseClasses\r\n      )}\r\n      onClick={onClick}\r\n      onKeyDown={onClick}\r\n      role=\"button\"\r\n      tabIndex=\"0\"\r\n    >\r\n      <div className=\"flex flex-col flex-1 px-4 pb-2\">\r\n        <div className=\"flex flex-row items-center justify-between pt-2 pb-2\">\r\n          <div className=\"text-base text-white\">{date}</div>\r\n          <div className=\"flex flex-row items-center text-base text-blue-300\">\r\n            <Icon name=\"group-layers\" className=\"w-4 mx-2 text-blue-300\" />\r\n            {numInstances}\r\n          </div>\r\n        </div>\r\n        <div className=\"flex flex-row py-1\">\r\n          <div className=\"pr-5 text-xl text-blue-300\">{modalities}</div>\r\n          <div className=\"text-base text-blue-300 break-words truncate-2-lines\">{description}</div>\r\n        </div>\r\n      </div>\r\n      {!!trackedSeries && (\r\n        <div className=\"flex flex-2\">\r\n          <div\r\n            className={classnames(\r\n              'flex flex-row bg-secondary-main text-base text-white py-1 pl-2 pr-4 mt-2 ',\r\n              isActive\r\n                ? 'flex-1 border-t border-secondary-light justify-center'\r\n                : 'rounded-sm mx-4 mb-4'\r\n            )}\r\n          >\r\n            <Icon name=\"tracked\" className=\"w-4 mr-2 text-primary-light\" />\r\n            {trackedSeries} Tracked Series\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nStudyItem.propTypes = {\r\n  date: PropTypes.string.isRequired,\r\n  description: PropTypes.string.isRequired,\r\n  modalities: PropTypes.string.isRequired,\r\n  numInstances: PropTypes.number.isRequired,\r\n  trackedSeries: PropTypes.number,\r\n  isActive: PropTypes.bool,\r\n  onClick: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default StudyItem;\r\n","import StudyItem from './StudyItem';\r\nexport default StudyItem;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport { Table, TableHead, TableBody, TableRow, TableCell } from '../';\r\n\r\nconst StudyListExpandedRow = ({\r\n  seriesTableColumns,\r\n  seriesTableDataSource,\r\n  children,\r\n}) => {\r\n  const { t } = useTranslation('StudyList');\r\n\r\n\r\n  return (\r\n    <div className=\"w-full bg-black py-4 pl-12 pr-2\">\r\n      <div className=\"block\">{children}</div>\r\n      <div className=\"mt-4\">\r\n        <Table>\r\n          <TableHead>\r\n            <TableRow>\r\n              {Object.keys(seriesTableColumns).map(columnKey => {\r\n                return (\r\n                  <TableCell key={columnKey}>\r\n                    {t(seriesTableColumns[columnKey])}\r\n                  </TableCell>\r\n                );\r\n              })}\r\n            </TableRow>\r\n          </TableHead>\r\n\r\n          <TableBody>\r\n            {seriesTableDataSource.map((row, i) => (\r\n              <TableRow key={i}>\r\n                {Object.keys(row).map(cellKey => {\r\n                  const content = row[cellKey];\r\n                  return (\r\n                    <TableCell key={cellKey} className=\"truncate\">\r\n                      {content}\r\n                    </TableCell>\r\n                  );\r\n                })}\r\n              </TableRow>\r\n            ))}\r\n          </TableBody>\r\n        </Table>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nStudyListExpandedRow.propTypes = {\r\n  seriesTableDataSource: PropTypes.arrayOf(PropTypes.object).isRequired,\r\n  seriesTableColumns: PropTypes.object.isRequired,\r\n  children: PropTypes.node.isRequired,\r\n};\r\n\r\nexport default StudyListExpandedRow;\r\n","import StudyListExpandedRow from './StudyListExpandedRow';\r\nexport default StudyListExpandedRow;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport { Button, Icon, Typography, InputGroup } from '../';\r\n\r\nconst StudyListFilter = ({\r\n  filtersMeta,\r\n  filterValues,\r\n  onChange,\r\n  clearFilters,\r\n  isFiltering,\r\n  numOfStudies,\r\n}) => {\r\n  const { t } = useTranslation(\"StudyList\")\r\n  const { sortBy, sortDirection } = filterValues;\r\n  const filterSorting = { sortBy, sortDirection };\r\n  const setFilterSorting = sortingValues => {\r\n    onChange({\r\n      ...filterValues,\r\n      ...sortingValues,\r\n    });\r\n  };\r\n  const isSortingEnabled = numOfStudies > 0 && numOfStudies <= 100;\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <div>\r\n        <div className=\"bg-primary-dark\">\r\n          <div className=\"container relative flex flex-col pt-5 m-auto\">\r\n            <div className=\"flex flex-row justify-between px-12 mb-5\">\r\n              <div className=\"flex flex-row\">\r\n                <Typography variant=\"h4\" className=\"mr-6 text-primary-light\">\r\n                  {t('Study list')}\r\n                </Typography>\r\n              </div>\r\n              <div className=\"flex flex-row\">\r\n                {isFiltering && (\r\n                  <Button\r\n                    rounded=\"full\"\r\n                    variant=\"outlined\"\r\n                    color=\"primary\"\r\n                    className=\"mx-8 text-primary-active border-primary-active\"\r\n                    startIcon={<Icon name=\"cancel\" />}\r\n                    onClick={clearFilters}\r\n                  >\r\n                    {t('Clear filters')}\r\n                  </Button>\r\n                )}\r\n                <Typography variant=\"h4\" className=\"mr-2\" data-cy={\"num-studies\"}>\r\n                  {numOfStudies > 100 ? '>100' : numOfStudies}\r\n                </Typography>\r\n                <Typography\r\n                  variant=\"h6\"\r\n                  className=\"self-end pb-1 text-common-light\"\r\n                >\r\n                  {t('Studies')}\r\n                </Typography>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div\r\n        className=\"sticky z-10 border-b-4 border-black\"\r\n        style={{ top: '52px' }}\r\n      >\r\n        <div className=\"pt-3 pb-3 bg-primary-dark \">\r\n          <InputGroup\r\n            inputMeta={filtersMeta}\r\n            values={filterValues}\r\n            onValuesChange={onChange}\r\n            sorting={filterSorting}\r\n            onSortingChange={setFilterSorting}\r\n            isSortingEnabled={isSortingEnabled}\r\n          />\r\n        </div>\r\n        {numOfStudies > 100 && (\r\n          <div className=\"container m-auto\">\r\n            <div className=\"py-1 text-base text-center rounded-b bg-primary-main\">\r\n              <p className=\"text-white\">\r\n                {t('Filter list to 100 studies or less to enable sorting')}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nStudyListFilter.propTypes = {\r\n  filtersMeta: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      /** Identifier used to map a field to it's value in `filterValues` */\r\n      name: PropTypes.string.isRequired,\r\n      /** Friendly label for filter field */\r\n      displayName: PropTypes.string.isRequired,\r\n      /** One of the supported filter field input types */\r\n      inputType: PropTypes.oneOf(['Text', 'MultiSelect', 'DateRange', 'None'])\r\n        .isRequired,\r\n      isSortable: PropTypes.bool.isRequired,\r\n      /** Size of filter field in a 12-grid system */\r\n      gridCol: PropTypes.oneOf([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12])\r\n        .isRequired,\r\n      /** Options for a \"MultiSelect\" inputType */\r\n      option: PropTypes.arrayOf(\r\n        PropTypes.shape({\r\n          value: PropTypes.string,\r\n          label: PropTypes.string,\r\n        })\r\n      ),\r\n    })\r\n  ).isRequired,\r\n  filterValues: PropTypes.object.isRequired,\r\n  numOfStudies: PropTypes.number.isRequired,\r\n  onChange: PropTypes.func.isRequired,\r\n  clearFilters: PropTypes.func.isRequired,\r\n  isFiltering: PropTypes.bool.isRequired,\r\n};\r\n\r\nexport default StudyListFilter;\r\n","import React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Button, ButtonGroup, Typography, Select } from '../';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nconst StudyListPagination = ({\r\n  onChangePage,\r\n  currentPage,\r\n  perPage,\r\n  onChangePerPage,\r\n}) => {\r\n  const { t } = useTranslation(\"StudyList\")\r\n\r\n  const navigateToPage = page => {\r\n    const toPage = page < 1 ? 1 : page;\r\n    onChangePage(toPage);\r\n  };\r\n\r\n  const ranges = [\r\n    { value: '25', label: '25' },\r\n    { value: '50', label: '50' },\r\n    { value: '100', label: '100' },\r\n  ];\r\n  const [selectedRange, setSelectedRange] = useState(ranges.find(r => r.value === perPage));\r\n  const onSelectedRange = (selectedRange) => {\r\n    setSelectedRange(selectedRange);\r\n    onChangePerPage(selectedRange.value);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-black py-10\">\r\n      <div className=\"container m-auto relative px-8\">\r\n        <div className=\"flex justify-between\">\r\n          <div className=\"flex items-center\">\r\n            <Select\r\n              id={\"rows-per-page\"}\r\n              className=\"relative mr-3 w-16 border-primary-main\"\r\n              options={ranges}\r\n              value={selectedRange}\r\n              isMulti={false}\r\n              isClearable={false}\r\n              isSearchable={false}\r\n              closeMenuOnSelect={false}\r\n              hideSelectedOptions={true}\r\n              onChange={onSelectedRange}\r\n            />\r\n            <Typography className=\"text-base opacity-60\">\r\n              {t('Results per page')}\r\n            </Typography>\r\n          </div>\r\n          <div className=\"\">\r\n            <div className=\"flex items-center\">\r\n              <Typography className=\"opacity-60 mr-4 text-base\">\r\n                Page {currentPage}\r\n              </Typography>\r\n              <ButtonGroup color=\"primary\">\r\n                <Button\r\n                  size=\"initial\"\r\n                  className=\"border-primary-main px-4 py-2 text-base\"\r\n                  color=\"white\"\r\n                  onClick={() => navigateToPage(1)}\r\n                >\r\n                  {`<<`}\r\n                </Button>\r\n                <Button\r\n                  size=\"initial\"\r\n                  className=\"border-primary-main py-2 px-2 text-base\"\r\n                  color=\"white\"\r\n                  onClick={() => navigateToPage(currentPage - 1)}\r\n                >{t(`< Previous`)}</Button>\r\n                <Button\r\n                  size=\"initial\"\r\n                  className=\"border-primary-main py-2 px-4 text-base\"\r\n                  color=\"white\"\r\n                  onClick={() => navigateToPage(currentPage + 1)}\r\n                >\r\n                  {t(`Next >`)}\r\n                </Button>\r\n              </ButtonGroup>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nStudyListPagination.propTypes = {\r\n  onChangePage: PropTypes.func.isRequired,\r\n  currentPage: PropTypes.number.isRequired,\r\n  perPage: PropTypes.number.isRequired,\r\n  onChangePerPage: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default StudyListPagination;\r\n","import StudyListPagination from './StudyListPagination';\r\n\r\nexport default StudyListPagination;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\nimport { Icon } from '../';\r\nimport getGridWidthClass from '../../utils/getGridWidthClass';\r\n\r\nconst StudyListTableRow = props => {\r\n  const { tableData } = props;\r\n  const { row, expandedContent, onClickRow, isExpanded } = tableData;\r\n  return (\r\n    <>\r\n      <tr className=\"select-none\">\r\n        <td\r\n          className={classnames('border-0 p-0', {\r\n            'border-b border-secondary-light bg-primary-dark': isExpanded,\r\n          })}\r\n        >\r\n          <div\r\n            className={classnames(\r\n              'w-full transition border-transparent duration-300',\r\n              {\r\n                'border border-primary-light rounded overflow-hidden mb-2 hover:border-secondary-light': isExpanded,\r\n              }\r\n            )}\r\n          >\r\n            <table className={classnames('w-full p-4')}>\r\n              <tbody>\r\n                <tr\r\n                  className={classnames(\r\n                    'cursor-pointer hover:bg-secondary-main transition duration-300 bg-black',\r\n                    {\r\n                      'bg-primary-dark': !isExpanded,\r\n                    },\r\n                    { 'bg-secondary-dark': isExpanded }\r\n                  )}\r\n                  onClick={onClickRow}\r\n                >\r\n                  {row.map((cell, index) => {\r\n                    const { content, title, gridCol } = cell;\r\n                    return (\r\n                      <td\r\n                        key={index}\r\n                        className={classnames(\r\n                          'px-4 py-2 text-base truncate',\r\n                          { 'border-b border-secondary-light': !isExpanded },\r\n                          getGridWidthClass(gridCol) || ''\r\n                        )}\r\n                        style={{\r\n                          maxWidth: 0,\r\n                        }}\r\n                        title={title}\r\n                      >\r\n                        <div className=\"flex\">\r\n                          {index === 0 && (\r\n                            <div>\r\n                              <Icon\r\n                                name={isExpanded ? 'chevron-down' : 'chevron-right'}\r\n                                className=\"mr-4 inline-flex\"\r\n                              />\r\n                            </div>\r\n                          )}\r\n                          <div className={classnames(\r\n                            { 'overflow-hidden': true },\r\n                            { 'truncate': true }\r\n                          )}>\r\n                            {content}\r\n                          </div>\r\n                        </div>\r\n                      </td>\r\n                    );\r\n                  })}\r\n                </tr>\r\n                {isExpanded && (\r\n                  <tr className=\"w-full bg-black select-text max-h-0 overflow-hidden\">\r\n                    <td colSpan={row.length}>{expandedContent}</td>\r\n                  </tr>\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </td>\r\n      </tr>\r\n    </>\r\n  );\r\n};\r\n\r\nStudyListTableRow.propTypes = {\r\n  tableData: PropTypes.shape({\r\n    /** A table row represented by an array of \"cell\" objects */\r\n    row: PropTypes.arrayOf(\r\n      PropTypes.shape({\r\n        key: PropTypes.string.isRequired,\r\n        /** Optional content to render in row's cell */\r\n        content: PropTypes.node,\r\n        /** Title attribute to use for provided content */\r\n        title: PropTypes.string,\r\n        gridCol: PropTypes.number.isRequired,\r\n      })\r\n    ).isRequired,\r\n    expandedContent: PropTypes.node.isRequired,\r\n    onClickRow: PropTypes.func.isRequired,\r\n    isExpanded: PropTypes.bool.isRequired,\r\n  }),\r\n};\r\n\r\nexport default StudyListTableRow;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport StudyListTableRow from './StudyListTableRow';\r\n\r\nconst StudyListTable = ({ tableDataSource }) => {\r\n  return (\r\n    <div className=\"bg-black\">\r\n      <div className=\"container m-auto relative\">\r\n        <table className=\"w-full text-white\">\r\n          <tbody data-cy=\"study-list-results\">\r\n            {tableDataSource.map((tableData, i) => {\r\n              return <StudyListTableRow tableData={tableData} key={i} />;\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nStudyListTable.propTypes = {\r\n  tableDataSource: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      row: PropTypes.array.isRequired,\r\n      expandedContent: PropTypes.node.isRequired,\r\n      onClickRow: PropTypes.func.isRequired,\r\n      isExpanded: PropTypes.bool.isRequired,\r\n    })\r\n  ),\r\n};\r\n\r\nexport default StudyListTable;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst StudySummary = ({ date, modality, description }) => {\r\n  return (\r\n    <div className=\"p-2\">\r\n      <div className=\"leading-none\">\r\n        <span className=\"mr-2 text-base text-white\">{date}</span>\r\n        <span className=\"px-1 text-base font-bold text-black rounded-sm bg-common-bright\">\r\n          {modality}\r\n        </span>\r\n      </div>\r\n      <div className=\"pt-2 text-base leading-none truncate text-primary-light ellipse\">\r\n        {description}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nStudySummary.propTypes = {\r\n  date: PropTypes.string.isRequired,\r\n  modality: PropTypes.string.isRequired,\r\n  description: PropTypes.string.isRequired,\r\n};\r\n\r\nexport default StudySummary;\r\n","import StudySummary from './StudySummary.jsx';\r\n\r\nexport default StudySummary;\r\n","import React from 'react';\r\n// Svgs\r\nimport logoOhif from './../../assets/svgs/logo-ohif.svg';\r\n\r\nconst SVGS = {\r\n  'logo-ohif': logoOhif,\r\n};\r\n\r\n/**\r\n * Return the matching SVG as a React Component.\r\n * Results in an inlined SVG Element. If there's no match,\r\n * return `null`\r\n */\r\nexport default function getSvg(key, props) {\r\n  if (!key || !SVGS[key]) {\r\n    return React.createElement('div', null, 'Missing SVG');\r\n  }\r\n\r\n  return React.createElement(SVGS[key], props);\r\n}\r\n\r\nexport { SVGS };\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport getSvg from './getSvg';\r\n\r\nconst Svg = ({ name, ...otherProps }) => {\r\n  return <React.Fragment>{getSvg(name, { ...otherProps })}</React.Fragment>;\r\n};\r\n\r\nSvg.propTypes = {\r\n  name: PropTypes.string.isRequired,\r\n};\r\n\r\nexport default Svg;\r\n","import Svg from './Svg';\r\nexport default Svg;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nconst Table = ({ children, className, fullWidth, style }) => {\r\n  const classes = {\r\n    base: 'text-lg text-white',\r\n    fullWidth: {\r\n      true: 'w-full',\r\n      false: '',\r\n    },\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={classnames(\r\n        classes.base,\r\n        classes.fullWidth[fullWidth],\r\n        className\r\n      )}\r\n      style={style}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\nTable.defaultProps = {\r\n  className: '',\r\n  fullWidth: true,\r\n  style: {},\r\n};\r\n\r\nTable.propTypes = {\r\n  fullWidth: PropTypes.bool,\r\n  children: PropTypes.node.isRequired,\r\n  className: PropTypes.string,\r\n  style: PropTypes.object,\r\n};\r\n\r\nexport default Table;\r\n","import Table from './Table';\r\nexport default Table;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nconst TableBody = ({ children, className, style }) => {\r\n  return (\r\n    <div\r\n      className={classnames(\r\n        'mt-2 max-h-48 overflow-y-scroll ohif-scrollbar',\r\n        className\r\n      )}\r\n      style={style}\r\n    >\r\n      {React.isValidElement(children)\r\n        ? React.cloneElement(children, {\r\n            isTableHead: false,\r\n          })\r\n        : children}\r\n    </div>\r\n  );\r\n};\r\n\r\nTableBody.defaultProps = {\r\n  className: '',\r\n  style: {},\r\n};\r\n\r\nTableBody.propTypes = {\r\n  children: function(props, propName, componentName) {\r\n    const elements = React.Children.toArray(props.children);\r\n    const isString = elements.some(child => typeof child === 'string');\r\n\r\n    if (isString) {\r\n      return new Error(\r\n        `Failed prop type: Invalid prop ${propName} supplied to ${componentName}, expected a valid element instead of a string.`\r\n      );\r\n    }\r\n\r\n    const isInvalidElement = elements.some(\r\n      child => !React.isValidElement(child)\r\n    );\r\n\r\n    if (isInvalidElement) {\r\n      return new Error(\r\n        `Failed prop type: Invalid prop ${propName} supplied to ${componentName}, expected a valid node element.`\r\n      );\r\n    }\r\n  },\r\n  className: PropTypes.string,\r\n  style: PropTypes.object,\r\n};\r\n\r\nexport default TableBody;\r\n","import TableBody from './TableBody';\r\nexport default TableBody;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nconst TableCell = ({\r\n  children,\r\n  className,\r\n  colSpan,\r\n  // ignored because we don't wan't to expose this prop\r\n  // eslint-disable-next-line react/prop-types\r\n  cellsNum,\r\n  isTableHead,\r\n  align,\r\n  style,\r\n}) => {\r\n  const classes = {\r\n    align: {\r\n      left: 'text-left',\r\n      center: 'text-center',\r\n      right: 'text-right',\r\n      justify: 'text-justify',\r\n    },\r\n    isTableHead: {\r\n      true: '',\r\n      false: 'border-r border-secondary-light',\r\n    },\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={classnames(\r\n        'px-2 last:border-r-0 break-all',\r\n        `w-${colSpan}/${cellsNum}`,\r\n        classes.align[align],\r\n        classes.isTableHead[isTableHead],\r\n        className\r\n      )}\r\n      style={style}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\nTableCell.defaultProps = {\r\n  align: 'left',\r\n  className: '',\r\n  colSpan: 1,\r\n  isTableHead: false,\r\n  style: {},\r\n};\r\n\r\nTableCell.propTypes = {\r\n  align: PropTypes.oneOf(['left', 'center', 'right', 'justify']),\r\n  children: PropTypes.node.isRequired,\r\n  className: PropTypes.string,\r\n  colSpan: PropTypes.number,\r\n  isTableHead: PropTypes.bool,\r\n  style: PropTypes.object,\r\n};\r\n\r\nexport default TableCell;\r\n","import TableCell from './TableCell';\r\nexport default TableCell;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nconst TableHead = ({ children, className, style }) => {\r\n  return (\r\n    <div\r\n      className={classnames(\r\n        'bg-secondary-dark border-b border-secondary-light flex font-bold pr-2',\r\n        className\r\n      )}\r\n      style={style}\r\n    >\r\n      {React.isValidElement(children)\r\n        ? React.cloneElement(children, {\r\n            isTableHead: true,\r\n          })\r\n        : children}\r\n    </div>\r\n  );\r\n};\r\n\r\nTableHead.defaultProps = {\r\n  className: '',\r\n  style: {},\r\n};\r\n\r\nTableHead.propTypes = {\r\n  children: function (props, propName, componentName) {\r\n    const elements = React.Children.toArray(props.children);\r\n    const isString = elements.some((child) => typeof child === 'string');\r\n\r\n    if (isString) {\r\n      return new Error(\r\n        `Failed prop type: Invalid prop ${propName} supplied to ${componentName}, expected a valid element instead of a string.`\r\n      );\r\n    }\r\n\r\n    const isInvalidElement = elements.some(\r\n      (child) => !React.isValidElement(child)\r\n    );\r\n\r\n    if (isInvalidElement) {\r\n      return new Error(\r\n        `Failed prop type: Invalid prop ${propName} supplied to ${componentName}, expected a valid node element.`\r\n      );\r\n    }\r\n  },\r\n  className: PropTypes.string,\r\n  style: PropTypes.object,\r\n};\r\n\r\nexport default TableHead;\r\n","import TableHead from './TableHead';\r\nexport default TableHead;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nconst TableRow = ({ children, className, isTableHead, style }) => {\r\n  const childrens = React.Children.map(children, child => {\r\n    const isValidReactElement = React.isValidElement(child);\r\n\r\n    return isValidReactElement\r\n      ? React.cloneElement(child, { isTableHead, cellsNum: children.length })\r\n      : children;\r\n  });\r\n\r\n  return (\r\n    <div className={classnames('w-full flex', className)} style={style}>\r\n      {childrens}\r\n    </div>\r\n  );\r\n};\r\n\r\nTableRow.defaultProps = {\r\n  isTableHead: false,\r\n  className: '',\r\n  style: {},\r\n};\r\n\r\nTableRow.propTypes = {\r\n  isTableHead: PropTypes.bool,\r\n  children: function(props, propName, componentName) {\r\n    const elements = React.Children.toArray(props.children);\r\n    const isString = elements.some(child => typeof child === 'string');\r\n\r\n    if (isString) {\r\n      return new Error(\r\n        `Failed prop type: Invalid prop ${propName} supplied to ${componentName}, expected a valid element instead of a string.`\r\n      );\r\n    }\r\n\r\n    const isInvalidElement = elements.some(\r\n      child => !React.isValidElement(child)\r\n    );\r\n\r\n    if (isInvalidElement) {\r\n      return new Error(\r\n        `Failed prop type: Invalid prop ${propName} supplied to ${componentName}, expected a valid node element.`\r\n      );\r\n    }\r\n  },\r\n  className: PropTypes.string,\r\n  style: PropTypes.object,\r\n};\r\n\r\nexport default TableRow;\r\n","import TableRow from './TableRow';\r\nexport default TableRow;\r\n","import ThemeWrapper from './ThemeWrapper';\r\nexport default ThemeWrapper;\r\n","import React from 'react';\r\nimport '../../tailwind.css';\r\nimport '../../assets/styles/styles.css';\r\n\r\nexport const ThemeWrapper = ({ children }) => (\r\n  <React.Fragment>{children}</React.Fragment>\r\n);\r\n\r\nexport default ThemeWrapper;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\nimport { useDrag } from 'react-dnd';\r\nimport { Icon } from '../';\r\n\r\n/**\r\n *\r\n */\r\nconst Thumbnail = ({\r\n  displaySetInstanceUID,\r\n  className,\r\n  imageSrc,\r\n  imageAltText,\r\n  description,\r\n  seriesNumber,\r\n  numInstances,\r\n  dragData,\r\n  isActive,\r\n  onClick,\r\n  onDoubleClick,\r\n}) => {\r\n  // TODO: We should wrap our thumbnail to create a \"DraggableThumbnail\", as\r\n  // this will still allow for \"drag\", even if there is no drop target for the\r\n  // specified item.\r\n  const [collectedProps, drag, dragPreview] = useDrag({\r\n    type: \"displayset\",\r\n    item: { ...dragData },\r\n    canDrag: function(monitor) {\r\n      return Object.keys(dragData).length !== 0;\r\n    },\r\n  });\r\n\r\n  return (\r\n    <div\r\n      className={classnames(\r\n        className,\r\n        'flex flex-col flex-1 px-3 mb-8 cursor-pointer outline-none select-none group'\r\n      )}\r\n      id={`thumbnail-${displaySetInstanceUID}`}\r\n      data-cy={`study-browser-thumbnail`}\r\n      onClick={onClick}\r\n      onDoubleClick={onDoubleClick}\r\n      role=\"button\"\r\n      tabIndex=\"0\"\r\n    >\r\n      <div ref={drag}>\r\n        <div\r\n          className={classnames(\r\n            'flex flex-1 items-center justify-center rounded-md bg-black text-base text-white overflow-hidden min-h-32',\r\n            isActive\r\n              ? 'border-2 border-primary-light'\r\n              : 'border border-secondary-light group-focus:border-blue-300 hover:border-blue-300'\r\n          )}\r\n          style={{\r\n            margin: isActive ? '0' : '1px',\r\n          }}\r\n        >\r\n          {imageSrc ? (\r\n            <img\r\n              src={imageSrc}\r\n              alt={imageAltText}\r\n              className=\"object-none min-h-32\"\r\n            />\r\n          ) : (\r\n            <div>{imageAltText}</div>\r\n          )}\r\n        </div>\r\n        <div className=\"flex flex-row items-center flex-1 text-base text-blue-300 pt-2\">\r\n          <div className=\"mr-4\">\r\n            <span className=\"font-bold text-primary-main\">{'S: '}</span>\r\n            {seriesNumber}\r\n          </div>\r\n          <div className=\"flex flex-row items-center flex-1\">\r\n            <Icon name=\"group-layers\" className=\"w-3 mr-2\" /> {numInstances}\r\n          </div>\r\n        </div>\r\n        <div className=\"text-base text-white break-all\">{description}</div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nThumbnail.propTypes = {\r\n  displaySetInstanceUID: PropTypes.string.isRequired,\r\n  className: PropTypes.string,\r\n  imageSrc: PropTypes.string,\r\n  /**\r\n   * Data the thumbnail should expose to a receiving drop target. Use a matching\r\n   * `dragData.type` to identify which targets can receive this draggable item.\r\n   * If this is not set, drag-n-drop will be disabled for this thumbnail.\r\n   *\r\n   * Ref: https://react-dnd.github.io/react-dnd/docs/api/use-drag#specification-object-members\r\n   */\r\n  dragData: PropTypes.shape({\r\n    /** Must match the \"type\" a dropTarget expects */\r\n    type: PropTypes.string.isRequired,\r\n  }),\r\n  imageAltText: PropTypes.string,\r\n  description: PropTypes.string.isRequired,\r\n  seriesNumber: PropTypes.number.isRequired,\r\n  numInstances: PropTypes.number.isRequired,\r\n  isActive: PropTypes.bool.isRequired,\r\n  onClick: PropTypes.func.isRequired,\r\n  onDoubleClick: PropTypes.func.isRequired,\r\n};\r\n\r\nThumbnail.defaultProps = {\r\n  dragData: {},\r\n};\r\n\r\nexport default Thumbnail;\r\n","import Thumbnail from './Thumbnail';\r\nexport default Thumbnail;\r\n","import React from 'react';\r\nimport classnames from 'classnames';\r\nimport PropTypes from 'prop-types';\r\nimport { useDrag } from 'react-dnd';\r\nimport { Icon, Tooltip, Typography } from '../';\r\n\r\nconst ThumbnailNoImage = ({\r\n  displaySetInstanceUID,\r\n  description,\r\n  seriesDate,\r\n  modality,\r\n  modalityTooltip,\r\n  onClick,\r\n  onDoubleClick,\r\n  canReject,\r\n  onReject,\r\n  dragData,\r\n  isActive,\r\n}) => {\r\n  const [collectedProps, drag, dragPreview] = useDrag({\r\n    type: \"displayset\",\r\n    item: { ...dragData },\r\n    canDrag: function(monitor) {\r\n      return Object.keys(dragData).length !== 0;\r\n    },\r\n  });\r\n\r\n  return (\r\n    <div\r\n      className={classnames(\r\n        'flex flex-row flex-1 cursor-pointer outline-none border-transparent hover:border-blue-300 focus:border-blue-300 rounded select-none',\r\n        isActive ? 'border-2 border-primary-light' : 'border'\r\n      )}\r\n      style={{\r\n        padding: isActive ? '11px' : '12px',\r\n      }}\r\n      id={`thumbnail-${displaySetInstanceUID}`}\r\n      onClick={onClick}\r\n      onDoubleClick={onDoubleClick}\r\n      role=\"button\"\r\n      tabIndex=\"0\"\r\n    >\r\n      <div ref={drag}>\r\n        <div className=\"flex flex-col flex-1\">\r\n          <div className=\"flex flex-row items-center flex-1 mb-2\">\r\n            <Icon name=\"list-bullets\" className=\"w-12 text-secondary-light\" />\r\n            <Tooltip\r\n              position=\"bottom\"\r\n              content={<Typography>{modalityTooltip}</Typography>}\r\n            >\r\n              <div className=\"px-3 text-lg text-white rounded-sm bg-primary-main\">\r\n                {modality}\r\n              </div>\r\n            </Tooltip>\r\n            <span className=\"ml-4 text-base text-blue-300\">{seriesDate}</span>\r\n          </div>\r\n          <div className=\"flex flex-row\">\r\n            {canReject && (\r\n              <Icon\r\n                name=\"old-trash\"\r\n                style={{ minWidth: '12px' }}\r\n                className=\"w-3 ml-4 text-red-500\"\r\n                onClick={onReject}\r\n              />\r\n            )}\r\n            <div className=\"ml-4 text-base text-white break-all\">\r\n              {description}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nThumbnailNoImage.propTypes = {\r\n  displaySetInstanceUID: PropTypes.string.isRequired,\r\n  /**\r\n   * Data the thumbnail should expose to a receiving drop target. Use a matching\r\n   * `dragData.type` to identify which targets can receive this draggable item.\r\n   * If this is not set, drag-n-drop will be disabled for this thumbnail.\r\n   *\r\n   * Ref: https://react-dnd.github.io/react-dnd/docs/api/use-drag#specification-object-members\r\n   */\r\n  dragData: PropTypes.shape({\r\n    /** Must match the \"type\" a dropTarget expects */\r\n    type: PropTypes.string.isRequired,\r\n  }),\r\n  description: PropTypes.string.isRequired,\r\n  modality: PropTypes.string.isRequired,\r\n  /* Tooltip message to display when modality text is hovered */\r\n  modalityTooltip: PropTypes.string.isRequired,\r\n  seriesDate: PropTypes.string.isRequired,\r\n  onClick: PropTypes.func.isRequired,\r\n  onDoubleClick: PropTypes.func.isRequired,\r\n  isActive: PropTypes.bool.isRequired,\r\n};\r\n\r\nexport default ThumbnailNoImage;\r\n","import ThumbnailNoImage from './ThumbnailNoImage';\r\nexport default ThumbnailNoImage;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nimport { Icon, Thumbnail, Tooltip } from '../';\r\n\r\nconst ThumbnailTracked = ({\r\n  displaySetInstanceUID,\r\n  className,\r\n  imageSrc,\r\n  imageAltText,\r\n  description,\r\n  seriesNumber,\r\n  numInstances,\r\n  dragData,\r\n  onClick,\r\n  onDoubleClick,\r\n  onClickUntrack,\r\n  viewportIdentificator,\r\n  isTracked,\r\n  isActive,\r\n}) => {\r\n  const trackedIcon = isTracked ? 'circled-checkmark' : 'dotted-circle';\r\n  const viewportIdentificatorLabel = viewportIdentificator.join(', ');\r\n  const renderViewportLabels = () => {\r\n    const MAX_LABELS_PER_COL = 3;\r\n    const shouldShowStack = viewportIdentificator.length > MAX_LABELS_PER_COL;\r\n    if (shouldShowStack) {\r\n      return (\r\n        <div>\r\n          <div>\r\n            {viewportIdentificator.slice(0, MAX_LABELS_PER_COL).map(label => (\r\n              <div key={label}>{label}</div>\r\n            ))}\r\n          </div>\r\n          <Tooltip\r\n            position=\"right\"\r\n            content={\r\n              <div className=\"text-left max-w-40\">\r\n                Series is displayed <br /> in viewport{' '}\r\n                {viewportIdentificatorLabel}\r\n              </div>\r\n            }\r\n          >\r\n            <Icon name=\"tool-more-menu\" className=\"text-white py-2\" />\r\n          </Tooltip>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return viewportIdentificator.map(label => <div key={label}>{label}</div>);\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={classnames(\r\n        'flex flex-row flex-1 px-3 py-2 cursor-pointer outline-none',\r\n        className\r\n      )}\r\n      id={`thumbnail-${displaySetInstanceUID}`}\r\n    >\r\n      <div className=\"flex flex-col items-center flex-2\">\r\n        <div\r\n          className={classnames(\r\n            'flex flex-col items-center justify-start p-2 mb-2 relative cursor-pointer',\r\n            isTracked && 'rounded-sm hover:bg-gray-900'\r\n          )}\r\n        >\r\n          <Tooltip\r\n            position=\"right\"\r\n            content={\r\n              <div className=\"flex flex-row flex-1\">\r\n                <div className=\"flex items-center justify-center pr-4 flex-2\">\r\n                  <Icon name=\"info-link\" className=\"text-primary-active\" />\r\n                </div>\r\n                <div className=\"flex flex-col flex-1\">\r\n                  <span>\r\n                    Series is\r\n                    <span className=\"text-white\">\r\n                      {isTracked ? ' tracked' : ' untracked'}\r\n                    </span>\r\n                  </span>\r\n                  {!!viewportIdentificator.length && (\r\n                    <span>\r\n                      in viewport\r\n                      <span className=\"ml-1 text-white\">\r\n                        {viewportIdentificatorLabel}\r\n                      </span>\r\n                    </span>\r\n                  )}\r\n                </div>\r\n\r\n              </div>\r\n            }\r\n          >\r\n            <Icon name={trackedIcon} className=\"w-4 mb-2 text-primary-light\" />\r\n          </Tooltip>\r\n          <div className=\"text-xl leading-tight text-white text-center\">\r\n            {renderViewportLabels()}\r\n          </div>\r\n        </div>\r\n        {isTracked && (\r\n          <div onClick={onClickUntrack}>\r\n            <Icon name=\"cancel\" className=\"w-4 text-primary-active\" />\r\n          </div>\r\n        )}\r\n      </div>\r\n      <Thumbnail\r\n        displaySetInstanceUID={displaySetInstanceUID}\r\n        imageSrc={imageSrc}\r\n        imageAltText={imageAltText}\r\n        dragData={dragData}\r\n        description={description}\r\n        seriesNumber={seriesNumber}\r\n        numInstances={numInstances}\r\n        isActive={isActive}\r\n        onClick={onClick}\r\n        onDoubleClick={onDoubleClick}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nThumbnailTracked.propTypes = {\r\n  /**\r\n   * Data the thumbnail should expose to a receiving drop target. Use a matching\r\n   * `dragData.type` to identify which targets can receive this draggable item.\r\n   * If this is not set, drag-n-drop will be disabled for this thumbnail.\r\n   *\r\n   * Ref: https://react-dnd.github.io/react-dnd/docs/api/use-drag#specification-object-members\r\n   */\r\n  dragData: PropTypes.shape({\r\n    /** Must match the \"type\" a dropTarget expects */\r\n    type: PropTypes.string.isRequired,\r\n  }),\r\n  displaySetInstanceUID: PropTypes.string.isRequired,\r\n  className: PropTypes.string,\r\n  imageSrc: PropTypes.string,\r\n  imageAltText: PropTypes.string,\r\n  description: PropTypes.string.isRequired,\r\n  seriesNumber: PropTypes.number.isRequired,\r\n  numInstances: PropTypes.number.isRequired,\r\n  onClick: PropTypes.func.isRequired,\r\n  onDoubleClick: PropTypes.func.isRequired,\r\n  onClickUntrack: PropTypes.func.isRequired,\r\n  viewportIdentificator: PropTypes.array,\r\n  isTracked: PropTypes.bool,\r\n  isActive: PropTypes.bool.isRequired,\r\n};\r\n\r\nexport default ThumbnailTracked;\r\n","import ThumbnailTracked from './ThumbnailTracked';\r\nexport default ThumbnailTracked;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport { Thumbnail, ThumbnailNoImage, ThumbnailTracked } from '../';\r\n\r\nconst ThumbnailList = ({\r\n  thumbnails,\r\n  activeDisplaySetInstanceUID,\r\n  onThumbnailClick,\r\n  onThumbnailDoubleClick,\r\n  onClickUntrack,\r\n}) => {\r\n  return (\r\n    <div className=\"py-3 bg-black overflow-y-hidden ohif-scrollbar\">\r\n      {thumbnails.map(\r\n        ({\r\n          displaySetInstanceUID,\r\n          description,\r\n          dragData,\r\n          seriesNumber,\r\n          numInstances,\r\n          modality,\r\n          componentType,\r\n          seriesDate,\r\n          viewportIdentificator,\r\n          isTracked,\r\n          canReject,\r\n          onReject,\r\n          imageSrc,\r\n          imageAltText,\r\n        }) => {\r\n          const isActive =\r\n            activeDisplaySetInstanceUID === displaySetInstanceUID;\r\n\r\n          switch (componentType) {\r\n            case 'thumbnail':\r\n              return (\r\n                <Thumbnail\r\n                  key={displaySetInstanceUID}\r\n                  displaySetInstanceUID={displaySetInstanceUID}\r\n                  dragData={dragData}\r\n                  description={description}\r\n                  seriesNumber={seriesNumber}\r\n                  numInstances={numInstances}\r\n                  imageSrc={imageSrc}\r\n                  imageAltText={imageAltText}\r\n                  viewportIdentificator={viewportIdentificator}\r\n                  isActive={isActive}\r\n                  onClick={() => onThumbnailClick(displaySetInstanceUID)}\r\n                  onDoubleClick={() =>\r\n                    onThumbnailDoubleClick(displaySetInstanceUID)\r\n                  }\r\n                />\r\n              );\r\n            case 'thumbnailTracked':\r\n              return (\r\n                <ThumbnailTracked\r\n                  key={displaySetInstanceUID}\r\n                  displaySetInstanceUID={displaySetInstanceUID}\r\n                  dragData={dragData}\r\n                  description={description}\r\n                  seriesNumber={seriesNumber}\r\n                  numInstances={numInstances}\r\n                  imageSrc={imageSrc}\r\n                  imageAltText={imageAltText}\r\n                  viewportIdentificator={viewportIdentificator}\r\n                  isTracked={isTracked}\r\n                  isActive={isActive}\r\n                  onClick={() => onThumbnailClick(displaySetInstanceUID)}\r\n                  onDoubleClick={() =>\r\n                    onThumbnailDoubleClick(displaySetInstanceUID)\r\n                  }\r\n                  onClickUntrack={() => onClickUntrack(displaySetInstanceUID)}\r\n                />\r\n              );\r\n            case 'thumbnailNoImage':\r\n              return (\r\n                <ThumbnailNoImage\r\n                  isActive={isActive}\r\n                  key={displaySetInstanceUID}\r\n                  displaySetInstanceUID={displaySetInstanceUID}\r\n                  dragData={dragData}\r\n                  modality={modality}\r\n                  modalityTooltip={_getModalityTooltip(modality)}\r\n                  seriesDate={seriesDate}\r\n                  description={description}\r\n                  canReject={canReject}\r\n                  onReject={onReject}\r\n                  onClick={() => onThumbnailClick(displaySetInstanceUID)}\r\n                  onDoubleClick={() =>\r\n                    onThumbnailDoubleClick(displaySetInstanceUID)\r\n                  }\r\n                  viewportIdentificator={viewportIdentificator}\r\n                />\r\n              );\r\n            default:\r\n              return <></>;\r\n          }\r\n        }\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nThumbnailList.propTypes = {\r\n  thumbnails: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      displaySetInstanceUID: PropTypes.string.isRequired,\r\n      imageSrc: PropTypes.string,\r\n      imageAltText: PropTypes.string,\r\n      seriesDate: PropTypes.string,\r\n      seriesNumber: PropTypes.number,\r\n      numInstances: PropTypes.number,\r\n      description: PropTypes.string,\r\n      componentType: PropTypes.oneOf([\r\n        'thumbnail',\r\n        'thumbnailTracked',\r\n        'thumbnailNoImage',\r\n      ]).isRequired,\r\n      viewportIdentificator: PropTypes.oneOfType([\r\n        PropTypes.string,\r\n        PropTypes.array,\r\n      ]),\r\n      isTracked: PropTypes.bool,\r\n      /**\r\n       * Data the thumbnail should expose to a receiving drop target. Use a matching\r\n       * `dragData.type` to identify which targets can receive this draggable item.\r\n       * If this is not set, drag-n-drop will be disabled for this thumbnail.\r\n       *\r\n       * Ref: https://react-dnd.github.io/react-dnd/docs/api/use-drag#specification-object-members\r\n       */\r\n      dragData: PropTypes.shape({\r\n        /** Must match the \"type\" a dropTarget expects */\r\n        type: PropTypes.string.isRequired,\r\n      }),\r\n    })\r\n  ),\r\n  activeDisplaySetInstanceUID: PropTypes.string,\r\n  onThumbnailClick: PropTypes.func.isRequired,\r\n  onThumbnailDoubleClick: PropTypes.func.isRequired,\r\n  onClickUntrack: PropTypes.func.isRequired,\r\n};\r\n\r\n// TODO: Support \"Viewport Identificator\"?\r\nfunction _getModalityTooltip(modality) {\r\n  if (_modalityTooltips.hasOwnProperty(modality)) {\r\n    return _modalityTooltips[modality];\r\n  }\r\n\r\n  return 'Unknown';\r\n}\r\n\r\nconst _modalityTooltips = {\r\n  SR: 'Structured Report',\r\n};\r\n\r\nexport default ThumbnailList;\r\n","import ThumbnailList from './ThumbnailList';\r\nexport default ThumbnailList;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nimport { IconButton, Icon, Tooltip } from '../';\r\n\r\nconst ToolbarButton = ({\r\n  type,\r\n  id,\r\n  icon,\r\n  label,\r\n  commandName,\r\n  commandOptions,\r\n  onInteraction,\r\n  dropdownContent,\r\n  //\r\n  isActive: _isActive,\r\n  bState = {},\r\n  //\r\n}) => {\r\n  const { primaryToolId } = bState;\r\n  const isActive = _isActive || (type === 'tool' && id === primaryToolId);\r\n  const classes = {\r\n    type: {\r\n      primary: isActive\r\n        ? 'text-black'\r\n        : 'text-common-bright hover:bg-primary-dark hover:text-primary-light',\r\n      secondary: isActive\r\n        ? 'text-black'\r\n        : 'text-white hover:bg-secondary-dark hover:text-white focus:bg-secondary-dark focus:text-white',\r\n    },\r\n  };\r\n\r\n  const activeClass = isActive ? 'active' : '';\r\n  const shouldShowDropdown = !!isActive && !!dropdownContent;\r\n\r\n  return (\r\n    <div key={id}>\r\n      <Tooltip\r\n        isSticky={shouldShowDropdown}\r\n        content={shouldShowDropdown ? dropdownContent : label}\r\n        tight={shouldShowDropdown}\r\n      >\r\n        <IconButton\r\n          variant={isActive ? 'contained' : 'text'}\r\n          size=\"toolbar\"\r\n          className={classnames('mx-1', activeClass, classes.type[type])}\r\n          onClick={() => {\r\n            onInteraction({\r\n              itemId: id,\r\n              interactionType: type,\r\n              commandName: commandName,\r\n              commandOptions: commandOptions,\r\n            });\r\n          }}\r\n          name={label}\r\n          key={id}\r\n          id={id}\r\n        >\r\n          <Icon name={icon} />\r\n        </IconButton>\r\n      </Tooltip>\r\n    </div>\r\n  );\r\n};\r\n\r\nToolbarButton.defaultProps = {\r\n  dropdownContent: null,\r\n  isActive: false,\r\n  type: 'action',\r\n};\r\n\r\nToolbarButton.propTypes = {\r\n  /* Influences background/hover styling */\r\n  type: PropTypes.oneOf(['action', 'toggle', 'tool']),\r\n  id: PropTypes.string.isRequired,\r\n  isActive: PropTypes.bool,\r\n  onInteraction: PropTypes.func.isRequired,\r\n  icon: PropTypes.string.isRequired,\r\n  label: PropTypes.string.isRequired,\r\n  /** Tooltip content can be replaced for a customized content by passing a node to this value. */\r\n  dropdownContent: PropTypes.oneOfType([PropTypes.node, PropTypes.func]),\r\n};\r\n\r\nexport default ToolbarButton;\r\n","import ToolbarButton from './ToolbarButton';\r\nexport default ToolbarButton;\r\n","import { ContextMenu } from '../';\r\nimport PropTypes from 'prop-types';\r\nimport React from 'react';\r\n\r\nconst ContextMenuMeasurements = ({\r\n  onGetMenuItems,\r\n  onSetLabel,\r\n  onClose,\r\n  onDelete,\r\n}) => {\r\n  const defaultMenuItems = [\r\n    {\r\n      label: 'Delete measurement',\r\n      actionType: 'Delete',\r\n      action: item => {\r\n        onDelete(item);\r\n        onClose();\r\n      },\r\n      value: {},\r\n    },\r\n    {\r\n      label: 'Add Label',\r\n      actionType: 'setLabel',\r\n      action: item => {\r\n        onSetLabel(item);\r\n        onClose();\r\n      },\r\n      value: {},\r\n    },\r\n  ];\r\n\r\n  const menuItems = onGetMenuItems(defaultMenuItems);\r\n\r\n  return <ContextMenu items={menuItems} />;\r\n};\r\n\r\nContextMenuMeasurements.propTypes = {\r\n  onClose: PropTypes.func.isRequired,\r\n  onSetLabel: PropTypes.func.isRequired,\r\n  onDelete: PropTypes.func.isRequired,\r\n  onGetMenuItems: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default ContextMenuMeasurements;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nimport { IconButton, Icon } from '../';\r\n\r\nimport './ExpandableToolbarButton.css';\r\n\r\nconst ExpandableToolbarButton = ({\r\n  type,\r\n  id,\r\n  isActive,\r\n  onClick,\r\n  icon,\r\n  className,\r\n  content: Content,\r\n  contentProps\r\n}) => {\r\n  const classes = {\r\n    type: {\r\n      primary: isActive\r\n        ? 'text-black'\r\n        : 'text-common-bright hover:bg-primary-dark hover:text-primary-light',\r\n      secondary: isActive\r\n        ? 'text-black'\r\n        : 'text-white hover:bg-secondary-dark focus:bg-secondary-dark',\r\n    },\r\n  };\r\n\r\n  const onChildClickHandler = (...args) => {\r\n    onClick(...args);\r\n\r\n    if (contentProps.onClick) {\r\n      contentProps.onClick(...args);\r\n    }\r\n  };\r\n\r\n  const onClickHandler = (...args) => {\r\n    onClick(...args);\r\n  };\r\n\r\n  return (\r\n    <div key={id} className=\"ExpandableToolbarButton\">\r\n      <IconButton\r\n        variant={isActive ? 'contained' : 'text'}\r\n        className={classnames(\r\n          'mx-1',\r\n          classes.type[type],\r\n          isActive && 'ExpandableToolbarButton__arrow'\r\n        )}\r\n        onClick={onClickHandler}\r\n        key={id}\r\n      >\r\n        <Icon name={icon} />\r\n      </IconButton>\r\n      <div className=\"absolute z-10 pt-4\">\r\n        <div className={classnames(\"ExpandableToolbarButton__content w-48\", className)}>\r\n          <Content {...contentProps} onClick={onChildClickHandler} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst noop = () => { };\r\n\r\nExpandableToolbarButton.defaultProps = {\r\n  isActive: false,\r\n  type: 'primary',\r\n  content: null,\r\n  onClick: noop,\r\n};\r\n\r\nExpandableToolbarButton.propTypes = {\r\n  /* Influences background/hover styling */\r\n  type: PropTypes.oneOf(['primary', 'secondary']),\r\n  id: PropTypes.string.isRequired,\r\n  isActive: PropTypes.bool,\r\n  onClick: PropTypes.func.isRequired,\r\n  icon: PropTypes.string.isRequired,\r\n  /** Expandable toolbar button content can be replaced for a customized content by passing a node to this value. */\r\n  content: PropTypes.oneOfType([PropTypes.node, PropTypes.func]),\r\n  contentProps: PropTypes.object,\r\n};\r\n\r\nexport default ExpandableToolbarButton;\r\n","import React, { useState } from 'react';\r\nimport classnames from 'classnames';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst ListMenu = ({ items = [], renderer, onClick }) => {\r\n  const [selectedIndex, setSelectedIndex] = useState(null);\r\n\r\n  const ListItem = ({ item, index, isSelected }) => {\r\n    const flex = 'flex flex-row justify-between items-center';\r\n    const theme = 'bg-indigo-dark';\r\n\r\n    const onClickHandler = () => {\r\n      setSelectedIndex(index);\r\n      onClick({ item, selectedIndex: index });\r\n      if (item.onClick) item.onClick({ ...item, index, isSelected });\r\n    };\r\n\r\n    return (\r\n      <div className={classnames(flex, theme, 'cursor-pointer')} onClick={onClickHandler} data-cy={item.id}>\r\n        {renderer && renderer({ ...item, index, isSelected })}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col rounded-md bg-secondary-dark pt-2 pb-2\">\r\n      {items.map((item, index) => {\r\n        return (\r\n          <ListItem\r\n            key={`ListItem${index}`}\r\n            index={index}\r\n            isSelected={selectedIndex === index}\r\n            item={item}\r\n          />\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst noop = () => { };\r\n\r\nListMenu.propTypes = {\r\n  items: PropTypes.array.isRequired,\r\n  renderer: PropTypes.func.isRequired,\r\n  onClick: PropTypes.func\r\n};\r\n\r\nListMenu.defaultProps = {\r\n  onClick: noop\r\n};\r\n\r\nexport default ListMenu;\r\n","import ListMenu from './ListMenu';\r\nexport default ListMenu;\r\n","import React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport './tooltip.css';\r\n\r\nconst arrowPositionStyle = {\r\n  bottom: {\r\n    top: -15,\r\n    left: '50%',\r\n    transform: 'translateX(-50%)',\r\n  },\r\n  'bottom-left': { top: -15, left: 5 },\r\n  'bottom-right': { top: -15, right: 5 },\r\n  right: {\r\n    top: 'calc(50% - 8px)',\r\n    left: -15,\r\n    transform: 'rotate(270deg)',\r\n  },\r\n  left: {\r\n    top: 'calc(50% - 8px)',\r\n    right: -15,\r\n    transform: 'rotate(-270deg)',\r\n  },\r\n};\r\n\r\nconst Tooltip = ({\r\n  content,\r\n  isSticky,\r\n  position,\r\n  tight,\r\n  children,\r\n  isDisabled,\r\n}) => {\r\n  const [isActive, setIsActive] = useState(false);\r\n  const { t } = useTranslation('Buttons');\r\n\r\n  const handleMouseOver = () => {\r\n    if (!isActive) {\r\n      setIsActive(true);\r\n    }\r\n  };\r\n\r\n  const handleMouseOut = () => {\r\n    if (isActive) {\r\n      setIsActive(false);\r\n    }\r\n  };\r\n\r\n  const isOpen = (isSticky || isActive) && !isDisabled;\r\n\r\n  return (\r\n    <div\r\n      className=\"relative\"\r\n      onMouseOver={handleMouseOver}\r\n      onFocus={handleMouseOver}\r\n      onMouseOut={handleMouseOut}\r\n      onBlur={handleMouseOut}\r\n      role=\"tooltip\"\r\n    >\r\n      {children}\r\n      <div\r\n        className={classnames(`tooltip tooltip-${position}`, {\r\n          block: isOpen,\r\n          hidden: !isOpen,\r\n        })}\r\n      >\r\n        <div\r\n          className={classnames(\r\n            'relative tooltip-box bg-primary-dark border border-secondary-main text-white text-base rounded inset-x-auto top-full w-max-content',\r\n            {\r\n              'py-1 px-4': !tight,\r\n            }\r\n          )}\r\n        >\r\n          {typeof content === 'string' ? t(content) : content}\r\n          <svg\r\n            className=\"absolute h-4 text-primary-dark stroke-secondary-main\"\r\n            style={arrowPositionStyle[position]}\r\n            xmlns=\"http://www.w3.org/2000/svg\"\r\n            viewBox=\"0 0 24 24\"\r\n          >\r\n            <path fill=\"currentColor\" d=\"M24 22h-24l12-20z\" />\r\n          </svg>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nTooltip.defaultProps = {\r\n  tight: false,\r\n  isSticky: false,\r\n  position: 'bottom',\r\n  isDisabled: false,\r\n};\r\n\r\nTooltip.propTypes = {\r\n  /** prevents tooltip from rendering despite hover/active/sticky */\r\n  isDisabled: PropTypes.bool,\r\n  content: PropTypes.oneOfType([PropTypes.node, PropTypes.func]),\r\n  position: PropTypes.oneOf([\r\n    'bottom',\r\n    'bottom-left',\r\n    'bottom-right',\r\n    'left',\r\n    'right',\r\n  ]),\r\n  isSticky: PropTypes.bool,\r\n  tight: PropTypes.bool,\r\n  children: PropTypes.node.isRequired,\r\n};\r\n\r\nexport default Tooltip;\r\n","import Tooltip from './Tooltip';\r\nexport default Tooltip;\r\n","import React, { useState, useRef, useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\nimport { Icon } from '../';\r\n\r\nconst DELAY_TO_SHOW = 1000;\r\nconst DELAY_TO_HIDE = 10; // it needs at least a little delay to prevent tooltip to suddenly hide\r\nconst DELAY_TO_HIDE_AFTER_COPYING = 1000;\r\n\r\nconst TooltipClipboard = ({ children, text }) => {\r\n  const [isActive, setIsActive] = useState(false);\r\n  const [message, setMessage] = useState(null);\r\n  const [isCopying, setIsCopying] = useState(false);\r\n  const timeoutShow = useRef(null);\r\n  const timeoutHide = useRef(null);\r\n  const tooltipBoxRef = useRef(null);\r\n  const tooltipContainerRef = useRef(null);\r\n\r\n  const copyToClipboard = async text => {\r\n    setIsCopying(true);\r\n    try {\r\n      await navigator.clipboard.writeText(text);\r\n      setMessage('Copied!');\r\n    } catch (err) {\r\n      console.error('Failed to copy: ', err);\r\n      setMessage('Failed to copy!');\r\n    } finally {\r\n      refreshElementPosition();\r\n\r\n      setTimeout(() => {\r\n        resetState();\r\n      }, DELAY_TO_HIDE_AFTER_COPYING);\r\n    }\r\n  };\r\n\r\n  const resetState = () => {\r\n    setIsActive(false);\r\n    setMessage(null);\r\n    setIsCopying(false);\r\n  };\r\n\r\n  const resetTimeout = timeOut => {\r\n    if (timeOut.current !== null) {\r\n      clearTimeout(timeOut.current);\r\n    }\r\n  };\r\n\r\n  const handleMouseOver = () => {\r\n    resetTimeout(timeoutHide);\r\n\r\n    if (!isActive) {\r\n      timeoutShow.current = setTimeout(() => {\r\n        timeoutShow.current = null;\r\n        setIsActive(true);\r\n      }, DELAY_TO_SHOW);\r\n    }\r\n  };\r\n\r\n  const handleMouseOut = e => {\r\n    resetTimeout(timeoutShow);\r\n\r\n    if (isActive && !isCopying) {\r\n      timeoutHide.current = setTimeout(() => {\r\n        timeoutHide.current = null;\r\n        resetState();\r\n      }, DELAY_TO_HIDE);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Trick to set the tooltip position based on its parent position\r\n   * because the tooltip box is not relative-positioned to avoid the tooltip\r\n   * to be clipped if the parent container is overflow-hidden\r\n   */\r\n  const refreshElementPosition = () => {\r\n    const tooltipContainer = tooltipContainerRef.current;\r\n    const tooltipBox = tooltipBoxRef.current;\r\n\r\n    const {\r\n      left: containerX,\r\n      top: containerY,\r\n      height: containerHeight,\r\n    } = tooltipContainer.getBoundingClientRect();\r\n\r\n    const top = containerY + containerHeight + 'px';\r\n    const left = containerX + 'px';\r\n\r\n    tooltipBox.style.top = top;\r\n    tooltipBox.style.left = left;\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isActive) {\r\n      refreshElementPosition();\r\n      if (typeof window !== 'undefined') {\r\n        window.addEventListener('scroll', refreshElementPosition);\r\n      }\r\n    } else {\r\n      if (typeof window !== 'undefined') {\r\n        window.removeEventListener('scroll', refreshElementPosition);\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (typeof window !== 'undefined') {\r\n        window.removeEventListener('scroll', refreshElementPosition);\r\n      }\r\n    };\r\n  }, [isActive]);\r\n\r\n  const onClickHandler = e => {\r\n    e.stopPropagation();\r\n    copyToClipboard(text || children);\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={classnames('inline-flex max-w-full')}\r\n      onMouseOver={handleMouseOver}\r\n      onFocus={handleMouseOver}\r\n      onMouseOut={handleMouseOut}\r\n      onBlur={handleMouseOut}\r\n      role=\"tooltip\"\r\n      ref={tooltipContainerRef}\r\n    >\r\n      <span className=\"truncate\">{children}</span>\r\n      <div\r\n        className={classnames(`fixed pt-1`, {\r\n          block: isActive,\r\n          hidden: !isActive,\r\n        })}\r\n        ref={tooltipBoxRef}\r\n        onClick={onClickHandler}\r\n      >\r\n        <div\r\n          className={classnames(\r\n            'flex items-center relative bg-primary-dark border border-secondary-main text-white text-base rounded px-2 py-2'\r\n          )}\r\n        >\r\n          {message || (\r\n            <>\r\n              {children}\r\n              <div className=\"ml-2 pl-2 border-l border-secondary-light\">\r\n                <Icon name=\"clipboard\" className=\"w-4 text-white\" />\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nTooltipClipboard.defaultProps = {\r\n  text: '',\r\n};\r\n\r\nTooltipClipboard.propTypes = {\r\n  text: PropTypes.string,\r\n  children: PropTypes.node.isRequired,\r\n};\r\n\r\nexport default TooltipClipboard;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nconst baseClasses = 'm-0 leading-tight';\r\n\r\nconst defaultVariantMapping = {\r\n  h1: 'h1',\r\n  h2: 'h2',\r\n  h3: 'h3',\r\n  h4: 'h4',\r\n  h5: 'h5',\r\n  h6: 'h6',\r\n  subtitle: 'h6',\r\n  body: 'p',\r\n};\r\n\r\nconst defaults = {\r\n  align: 'inherit',\r\n  color: 'initial',\r\n  display: 'initial',\r\n  gutterBottom: false,\r\n  noWrap: false,\r\n  paragraph: false,\r\n  variant: 'body',\r\n};\r\n\r\nconst classes = {\r\n  variant: {\r\n    h1: 'text-6xl',\r\n    h2: 'text-5xl',\r\n    h3: 'text-4xl',\r\n    h4: 'text-3xl',\r\n    h5: 'text-2xl',\r\n    h6: 'text-xl',\r\n    subtitle: 'text-lg',\r\n    body: 'text-base',\r\n    caption: 'text-xs',\r\n    button: 'text-sm uppercase',\r\n    overline: 'text-xs uppercase',\r\n    srOnly: 'absolute h-0 w-0 hidden',\r\n    inherit: '',\r\n  },\r\n  color: {\r\n    initial: 'text-white',\r\n    inherit: 'text-inherit',\r\n    primary: 'text-primary-main',\r\n    secondary: 'text-common-light',\r\n    error: 'text-red-600',\r\n  },\r\n  align: {\r\n    inherit: '',\r\n    left: 'text-left',\r\n    center: 'text-center',\r\n    right: 'text-right',\r\n    justify: 'text-justify',\r\n  },\r\n  display: {\r\n    initial: '',\r\n    block: 'block',\r\n    inline: 'inline',\r\n  },\r\n  gutterBottom: {\r\n    true: 'mb-3',\r\n    false: '',\r\n  },\r\n  paragraph: {\r\n    true: 'mb-3',\r\n    false: '',\r\n  },\r\n  noWrap: {\r\n    true: 'truncate',\r\n    false: '',\r\n  },\r\n};\r\n\r\nconst Typography = ({\r\n  align = defaults.align,\r\n  color = defaults.color,\r\n  display = defaults.display,\r\n  gutterBottom = defaults.gutterBottom,\r\n  noWrap = defaults.noWrap,\r\n  paragraph = defaults.paragraph,\r\n  variant = defaults.variant,\r\n  component,\r\n  className,\r\n  ...rest\r\n}) => {\r\n  const Component =\r\n    component || (paragraph ? 'p' : defaultVariantMapping[variant]) || 'span';\r\n  return (\r\n    <Component\r\n      className={classnames(\r\n        baseClasses,\r\n        classes.variant[variant],\r\n        classes.color[color],\r\n        classes.align[align],\r\n        classes.gutterBottom[gutterBottom],\r\n        classes.paragraph[paragraph],\r\n        classes.noWrap[noWrap],\r\n        classes.display[display],\r\n        className\r\n      )}\r\n      {...rest}\r\n    />\r\n  );\r\n};\r\n\r\nTypography.propTypes = {\r\n  component: PropTypes.elementType,\r\n  paragraph: PropTypes.bool,\r\n  display: PropTypes.oneOf(['initial', 'block', 'inline']),\r\n  variant: PropTypes.oneOf([\r\n    'h1',\r\n    'h2',\r\n    'h3',\r\n    'h4',\r\n    'h5',\r\n    'h6',\r\n    'subtitle',\r\n    'body',\r\n    'caption',\r\n    'button',\r\n    'overline',\r\n    'srOnly',\r\n    'inherit',\r\n  ]),\r\n  color: PropTypes.oneOf([\r\n    'initial',\r\n    'inherit',\r\n    'primary',\r\n    'secondary',\r\n    'error',\r\n  ]),\r\n  className: PropTypes.string,\r\n  children: PropTypes.node,\r\n  align: PropTypes.oneOf(['inherit', 'left', 'center', 'right', 'justify']),\r\n  gutterBottom: PropTypes.bool,\r\n  noWrap: PropTypes.bool,\r\n};\r\n\r\nexport default Typography;\r\n","import Typography from './Typography';\r\nexport default Typography;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ViewportActionBar, Notification } from '../';\r\n\r\nconst Viewport = ({ viewportIndex, onSeriesChange, studyData, children }) => {\r\n  return (\r\n    <div className=\"relative flex flex-col h-full\">\r\n      <div className=\"absolute top-0 left-0 w-full\">\r\n        <ViewportActionBar\r\n          onSeriesChange={onSeriesChange}\r\n          studyData={studyData}\r\n        />\r\n\r\n        {/* TODO: NOTIFICATION API DEFINITION - OHIF-112 */}\r\n        <Notification\r\n          message=\"Track all measurement for this series?\"\r\n          type=\"info\"\r\n          actions={[\r\n            {\r\n              type: 'cancel',\r\n              text: 'No',\r\n              value: 0,\r\n            },\r\n            {\r\n              type: 'secondary',\r\n              text: 'No, do not ask again',\r\n              value: -1,\r\n            },\r\n            {\r\n              type: 'primary',\r\n              text: 'Yes',\r\n              value: 1,\r\n            },\r\n          ]}\r\n          onSubmit={value => {\r\n            if (typeof window !== 'undefined') window.alert(value);\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      {/* STUDY IMAGE */}\r\n      <div className=\"w-full h-full\" id={`viewport-${viewportIndex}`}>\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nViewport.propTypes = {\r\n  viewportIndex: PropTypes.number.isRequired,\r\n  onSeriesChange: PropTypes.func.isRequired,\r\n  studyData: PropTypes.shape({\r\n    label: PropTypes.string.isRequired,\r\n    isTracked: PropTypes.bool.isRequired,\r\n    /* Specific to SR Viewports only... */\r\n    isLocked: PropTypes.bool.isRequired,\r\n    isRehydratable: PropTypes.bool.isRequired,\r\n    studyDate: PropTypes.string.isRequired,\r\n    currentSeries: PropTypes.number.isRequired,\r\n    seriesDescription: PropTypes.string.isRequired,\r\n    modality: PropTypes.string.isRequired,\r\n    patientInformation: PropTypes.shape({\r\n      patientName: PropTypes.string.isRequired,\r\n      patientSex: PropTypes.string.isRequired,\r\n      patientAge: PropTypes.string.isRequired,\r\n      MRN: PropTypes.string.isRequired,\r\n      thickness: PropTypes.string.isRequired,\r\n      spacing: PropTypes.string.isRequired,\r\n      scanner: PropTypes.string.isRequired,\r\n    }),\r\n  }).isRequired,\r\n  children: PropTypes.node.isRequired,\r\n};\r\n\r\nexport default Viewport;\r\n","import React, { useState, useRef, useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\nimport { Icon, ButtonGroup, Button, Tooltip, CinePlayer } from '../';\r\nimport useOnClickOutside from '../../utils/useOnClickOutside';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nconst classes = {\r\n  infoHeader: 'text-base text-primary-light',\r\n  infoText: 'text-base text-white max-w-24 truncate',\r\n  firstRow: 'flex flex-col',\r\n  row: 'flex flex-col ml-4',\r\n};\r\n\r\nconst ViewportActionBar = ({\r\n  studyData,\r\n  showNavArrows,\r\n  showStatus,\r\n  showCine,\r\n  cineProps,\r\n  showPatientInfo: patientInfoVisibility,\r\n  onSeriesChange,\r\n  onDoubleClick,\r\n  //\r\n  onPillClick,\r\n}) => {\r\n  const [showPatientInfo, setShowPatientInfo] = useState(patientInfoVisibility);\r\n\r\n  // TODO -> Remake this component with a bunch of generic slots that can be filled,\r\n  // Its not generic at all, isTracked etc shouldn't be parts of this component.\r\n  // It shouldn't care that a tracking mode or SR exists.\r\n  // Things like the right/left buttons should be made into smaller\r\n  // Components you can compose.\r\n  // OHIF-200 ticket.\r\n\r\n  const {\r\n    label,\r\n    isTracked,\r\n    isLocked,\r\n    isRehydratable,\r\n    useAltStyling,\r\n    modality,\r\n    studyDate,\r\n    currentSeries,\r\n    seriesDescription,\r\n    patientInformation,\r\n  } = studyData;\r\n\r\n  const {\r\n    patientName,\r\n    patientSex,\r\n    patientAge,\r\n    MRN,\r\n    thickness,\r\n    spacing,\r\n    scanner,\r\n  } = patientInformation;\r\n\r\n  const onPatientInfoClick = () => setShowPatientInfo(!showPatientInfo);\r\n  const closePatientInfo = () => setShowPatientInfo(false);\r\n  const showPatientInfoRef = useRef(null);\r\n  const clickOutsideListener = useOnClickOutside(\r\n    showPatientInfoRef,\r\n    closePatientInfo\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (showPatientInfo) {\r\n      clickOutsideListener.add();\r\n    } else {\r\n      clickOutsideListener.remove();\r\n    }\r\n\r\n    return () => clickOutsideListener.remove();\r\n  }, [clickOutsideListener, showPatientInfo]);\r\n\r\n  const renderIconStatus = () => {\r\n    if (modality === 'SR') {\r\n      // 1 - Incompatible\r\n      // 2 - Locked\r\n      // 3 - Rehydratable / Open\r\n      const state =\r\n        isRehydratable && !isLocked ? 3 : isRehydratable && isLocked ? 2 : 1;\r\n      let ToolTipMessage = null;\r\n      let StatusIcon = null;\r\n\r\n      switch (state) {\r\n        case 1:\r\n          StatusIcon = () => (\r\n            <div\r\n              className=\"flex items-center justify-center -mr-1 rounded-full\"\r\n              style={{\r\n                width: '18px',\r\n                height: '18px',\r\n                backgroundColor: '#98e5c1',\r\n                border: 'solid 1.5px #000000',\r\n              }}\r\n            >\r\n              <Icon\r\n                name=\"exclamation\"\r\n                style={{ color: '#000', width: '12px', height: '12px' }}\r\n              />\r\n            </div>\r\n          );\r\n\r\n          ToolTipMessage = () => (\r\n            <div>\r\n              This structured report is not compatible\r\n              <br />\r\n              with this application.\r\n            </div>\r\n          );\r\n          break;\r\n        case 2:\r\n          StatusIcon = () => (\r\n            <div\r\n              className=\"flex items-center justify-center -mr-1 bg-black rounded-full\"\r\n              style={{\r\n                width: '18px',\r\n                height: '18px',\r\n              }}\r\n            >\r\n              <Icon\r\n                name=\"lock\"\r\n                style={{ color: '#05D97C', width: '8px', height: '11px' }}\r\n              />\r\n            </div>\r\n          );\r\n\r\n          ToolTipMessage = () => (\r\n            <div>\r\n              This structured report is currently read-only\r\n              <br />\r\n              because you are tracking measurements in\r\n              <br />\r\n              another viewport.\r\n            </div>\r\n          );\r\n          break;\r\n        case 3:\r\n          StatusIcon = () => (\r\n            <div\r\n              className=\"flex items-center justify-center -mr-1 bg-white rounded-full group-hover:bg-customblue-200\"\r\n              style={{\r\n                width: '18px',\r\n                height: '18px',\r\n                border: 'solid 1.5px #000000',\r\n              }}\r\n            >\r\n              <Icon\r\n                name=\"arrow-left\"\r\n                style={{ color: '#000', width: '14px', height: '14px' }}\r\n              />\r\n            </div>\r\n          );\r\n\r\n          ToolTipMessage = () => <div>Click to restore measurements.</div>;\r\n      }\r\n\r\n      const StatusPill = () => (\r\n        <div\r\n          className={classnames(\r\n            'group relative flex items-center justify-center px-2 rounded-full cursor-default bg-customgreen-100',\r\n            {\r\n              'hover:bg-customblue-100': state === 3,\r\n              'cursor-pointer': state === 3,\r\n            }\r\n          )}\r\n          style={{\r\n            height: '24px',\r\n            width: '55px',\r\n          }}\r\n          onClick={() => {\r\n            if (state === 3) {\r\n              // TODO: Gatsby build failing due\r\n              //       to ESLint's \"no-unused-expressions\"\r\n              //onPillClick?.();\r\n              if (onPillClick) {\r\n                onPillClick();\r\n              }\r\n            }\r\n          }}\r\n        >\r\n          <span className=\"pr-1 text-lg font-bold leading-none text-black\">\r\n            SR\r\n          </span>\r\n          <StatusIcon />\r\n        </div>\r\n      );\r\n\r\n      return (\r\n        <>\r\n          {ToolTipMessage && (\r\n            <Tooltip content={<ToolTipMessage />} position=\"bottom-left\">\r\n              <StatusPill />\r\n            </Tooltip>\r\n          )}\r\n          {!ToolTipMessage && <StatusPill />}\r\n        </>\r\n      );\r\n    }\r\n\r\n    const trackedIcon = isTracked ? 'tracked' : 'dotted-circle';\r\n\r\n    return (\r\n      <div className=\"relative\">\r\n        <Tooltip\r\n          position=\"bottom-left\"\r\n          content={\r\n            <div className=\"flex py-2\">\r\n              <div className=\"flex pt-1\">\r\n                <Icon name=\"info-link\" className=\"w-4 text-primary-main\" />\r\n              </div>\r\n              <div className=\"flex ml-4\">\r\n                <span className=\"text-base text-common-light\">\r\n                  {isTracked ? (\r\n                    <>\r\n                      Series is\r\n                      <span className=\"font-bold text-white\"> tracked</span> and\r\n                      can be viewed <br /> in the measurement panel\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      Measurements for\r\n                      <span className=\"font-bold text-white\"> untracked </span>\r\n                      series <br /> will not be shown in the <br /> measurements\r\n                      panel\r\n                    </>\r\n                  )}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          }\r\n        >\r\n          <Icon name={trackedIcon} className=\"w-6 text-primary-light\" />\r\n        </Tooltip>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const borderColor = useAltStyling ? '#365A6A' : '#1D205A';\r\n  const backgroundColor = useAltStyling\r\n    ? '#031923'\r\n    : isTracked\r\n    ? '#020424'\r\n    : null;\r\n\r\n  return (\r\n    <div\r\n      className=\"flex flex-wrap items-center p-2 -mt-2 border-b select-none\"\r\n      style={{\r\n        borderColor: borderColor,\r\n        backgroundColor: backgroundColor,\r\n      }}\r\n      onDoubleClick={onDoubleClick}\r\n    >\r\n      <div className=\"flex flex-1 flex-grow mt-2 min-w-48\">\r\n        <div className=\"flex items-center\">\r\n          <span className=\"mr-2 text-white text-large\">{label}</span>\r\n          {showStatus && renderIconStatus()}\r\n        </div>\r\n        <div className=\"flex flex-col justify-start ml-4\">\r\n          <div className=\"flex\">\r\n            <span className=\"text-base text-white\">{studyDate}</span>\r\n            <span className=\"pl-2 ml-2 text-base border-l border-primary-light text-primary-light\">\r\n              S: {currentSeries}\r\n            </span>\r\n          </div>\r\n          <div className=\"flex\">\r\n            {/* TODO:\r\n                This is tricky. Our \"no-wrap\" in truncate means this has a hard\r\n                length. The overflow forces ellipse. If we don't set max width\r\n                appropriately, this causes the ActionBar to overflow.\r\n                Can clean up by setting percentage widths + calc on parent\r\n                containers\r\n             */}\r\n            <p className=\"text-base truncate max-w-40 text-primary-light\">\r\n              {seriesDescription}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {showNavArrows && !showCine && (\r\n        <div className=\"mt-2\" style={{ pointerEvents: 'all' }}>\r\n          <ButtonGroup>\r\n            <Button\r\n              size=\"initial\"\r\n              className=\"px-2 py-1 bg-black\"\r\n              onClick={() => onSeriesChange('left')}\r\n            >\r\n              <Icon name=\"chevron-left\" className=\"w-4 text-white\" />\r\n            </Button>\r\n            <Button\r\n              size=\"initial\"\r\n              className=\"px-2 py-1 bg-black\"\r\n              onClick={() => onSeriesChange('right')}\r\n            >\r\n              <Icon name=\"chevron-right\" className=\"w-4 text-white\" />\r\n            </Button>\r\n          </ButtonGroup>\r\n        </div>\r\n      )}\r\n      {showCine && !showNavArrows && (\r\n        <div className=\"mt-2 mr-auto min-w-48 max-w-48\">\r\n          <CinePlayer {...cineProps} />\r\n        </div>\r\n      )}\r\n      <div className=\"flex h-8 mt-2 ml-4 mr-2\" onClick={onPatientInfoClick}>\r\n        <PatientInfo\r\n          showPatientInfoRef={showPatientInfoRef}\r\n          isOpen={showPatientInfo}\r\n          patientName={patientName}\r\n          patientSex={patientSex}\r\n          patientAge={patientAge}\r\n          MRN={MRN}\r\n          thickness={thickness}\r\n          spacing={spacing}\r\n          scanner={scanner}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nViewportActionBar.propTypes = {\r\n  onSeriesChange: PropTypes.func.isRequired,\r\n  showNavArrows: PropTypes.bool,\r\n  showCine: PropTypes.bool,\r\n  cineProps: PropTypes.object,\r\n  showPatientInfo: PropTypes.bool,\r\n  studyData: PropTypes.shape({\r\n    //\r\n    useAltStyling: PropTypes.bool,\r\n    //\r\n    label: PropTypes.string.isRequired,\r\n    isTracked: PropTypes.bool.isRequired,\r\n    isRehydratable: PropTypes.bool.isRequired,\r\n    studyDate: PropTypes.string.isRequired,\r\n    currentSeries: PropTypes.number.isRequired,\r\n    seriesDescription: PropTypes.string.isRequired,\r\n    modality: PropTypes.string.isRequired,\r\n    patientInformation: PropTypes.shape({\r\n      patientName: PropTypes.string.isRequired,\r\n      patientSex: PropTypes.string.isRequired,\r\n      patientAge: PropTypes.string.isRequired,\r\n      MRN: PropTypes.string.isRequired,\r\n      thickness: PropTypes.string.isRequired,\r\n      spacing: PropTypes.string.isRequired,\r\n      scanner: PropTypes.string.isRequired,\r\n    }),\r\n  }).isRequired,\r\n};\r\n\r\nViewportActionBar.defaultProps = {\r\n  cineProps: {},\r\n  showCine: false,\r\n  showStatus: true,\r\n  showNavArrows: true,\r\n  showPatientInfo: false,\r\n};\r\n\r\nfunction PatientInfo({\r\n  patientName,\r\n  patientSex,\r\n  patientAge,\r\n  MRN,\r\n  thickness,\r\n  spacing,\r\n  scanner,\r\n  isOpen,\r\n  showPatientInfoRef,\r\n}) {\r\n  const { t } = useTranslation(\"PatientInfo\")\r\n\r\n  while (patientAge.charAt(0) === '0') {\r\n    patientAge = patientAge.substr(1);\r\n  }\r\n\r\n  return (\r\n    <div ref={showPatientInfoRef}>\r\n      <Tooltip\r\n        isSticky\r\n        isDisabled={!isOpen}\r\n        position=\"bottom-right\"\r\n        content={\r\n          isOpen && (\r\n            <div className=\"flex py-2\">\r\n              <div className=\"flex pt-1\">\r\n                <Icon name=\"info-link\" className=\"w-4 text-primary-main\" />\r\n              </div>\r\n              <div className=\"flex flex-col ml-2\">\r\n                <span\r\n                  className=\"text-base font-bold text-white\"\r\n                  title={patientName}\r\n                >\r\n                  {patientName}\r\n                </span>\r\n                <div className=\"flex pb-4 mt-4 mb-4 border-b border-secondary-main\">\r\n                  <div className={classnames(classes.firstRow)}>\r\n                    <span className={classnames(classes.infoHeader)}>{t('Sex')}</span>\r\n                    <span\r\n                      className={classnames(classes.infoText)}\r\n                      title={patientSex}\r\n                    >\r\n                      {patientSex}\r\n                    </span>\r\n                  </div>\r\n                  <div className={classnames(classes.row)}>\r\n                    <span className={classnames(classes.infoHeader)}>{t('Age')}</span>\r\n                    <span\r\n                      className={classnames(classes.infoText)}\r\n                      title={patientAge}\r\n                    >\r\n                      {patientAge}\r\n                    </span>\r\n                  </div>\r\n                  <div className={classnames(classes.row)}>\r\n                    <span className={classnames(classes.infoHeader)}>{t('MRN')}</span>\r\n                    <span className={classnames(classes.infoText)} title={MRN}>\r\n                      {MRN}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex\">\r\n                  <div className={classnames(classes.firstRow)}>\r\n                    <span className={classnames(classes.infoHeader)}>\r\n                      {t('Thickness')}\r\n                    </span>\r\n                    <span\r\n                      className={classnames(classes.infoText)}\r\n                      title={thickness}\r\n                    >\r\n                      {thickness}\r\n                    </span>\r\n                  </div>\r\n                  <div className={classnames(classes.row)}>\r\n                    <span className={classnames(classes.infoHeader)}>\r\n                      {t('Spacing')}\r\n                    </span>\r\n                    <span\r\n                      className={classnames(classes.infoText)}\r\n                      title={spacing}\r\n                    >\r\n                      {spacing}\r\n                    </span>\r\n                  </div>\r\n                  <div className={classnames(classes.row)}>\r\n                    <span className={classnames(classes.infoHeader)}>\r\n                      {t('Scanner')}\r\n                    </span>\r\n                    <span\r\n                      className={classnames(classes.infoText)}\r\n                      title={scanner}\r\n                    >\r\n                      {scanner}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )\r\n        }\r\n      >\r\n        <div className=\"relative flex justify-end cursor-pointer\">\r\n          <div className=\"relative\">\r\n            <Icon name=\"profile\" className=\"w-5 text-white\" />\r\n            <Icon\r\n              name=\"info-link\"\r\n              className=\"absolute w-5 text-white bg-black\"\r\n              style={{ right: -7, bottom: -10 }}\r\n            />\r\n          </div>\r\n        </div>\r\n      </Tooltip>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ViewportActionBar;\r\n","export default (element, onClickOutside) => {\r\n  const clickOutsideHandler = event => {\r\n    if (element.current && !element.current.contains(event.target)) {\r\n      onClickOutside();\r\n      if (typeof window !== 'undefined') {\r\n        window.removeEventListener('mousedown', clickOutsideHandler);\r\n      }\r\n    }\r\n  };\r\n\r\n  const add = () => {\r\n    if (typeof window !== 'undefined') {\r\n      window.addEventListener('mousedown', clickOutsideHandler);\r\n    }\r\n  };\r\n  const remove = () => {\r\n    if (typeof window !== 'undefined') {\r\n      window.removeEventListener('mousedown', clickOutsideHandler);\r\n    }\r\n  };\r\n\r\n  return {\r\n    add,\r\n    remove,\r\n  };\r\n};\r\n","import ViewportActionBar from './ViewportActionBar';\r\nexport default ViewportActionBar;\r\n","import React, {\r\n  useCallback,\r\n  useEffect,\r\n  useState,\r\n  createRef,\r\n  useRef,\r\n} from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport classnames from 'classnames';\r\n\r\nimport {\r\n  Typography,\r\n  Input,\r\n  Tooltip,\r\n  IconButton,\r\n  Icon,\r\n  Select,\r\n  InputLabelWrapper,\r\n  Button,\r\n} from '../';\r\n\r\nconst FILE_TYPE_OPTIONS = [\r\n  {\r\n    value: 'jpg',\r\n    label: 'jpg',\r\n  },\r\n  {\r\n    value: 'png',\r\n    label: 'png',\r\n  },\r\n];\r\n\r\nconst DEFAULT_FILENAME = 'image';\r\nconst REFRESH_VIEWPORT_TIMEOUT = 1000;\r\n\r\nconst ViewportDownloadForm = ({\r\n  activeViewport,\r\n  onClose,\r\n  updateViewportPreview,\r\n  enableViewport,\r\n  disableViewport,\r\n  toggleAnnotations,\r\n  loadImage,\r\n  downloadBlob,\r\n  defaultSize,\r\n  minimumSize,\r\n  maximumSize,\r\n  canvasClass,\r\n}) => {\r\n  const { t } = useTranslation('Modals');\r\n\r\n  const [filename, setFilename] = useState(DEFAULT_FILENAME);\r\n  const [fileType, setFileType] = useState(['jpg']);\r\n\r\n  const [dimensions, setDimensions] = useState({\r\n    width: defaultSize,\r\n    height: defaultSize,\r\n  });\r\n\r\n  const [showAnnotations, setShowAnnotations] = useState(true);\r\n\r\n  const [keepAspect, setKeepAspect] = useState(true);\r\n  const [aspectMultiplier, setAspectMultiplier] = useState({\r\n    width: 1,\r\n    height: 1,\r\n  });\r\n\r\n  const [viewportElement, setViewportElement] = useState();\r\n  const [viewportElementDimensions, setViewportElementDimensions] = useState({\r\n    width: defaultSize,\r\n    height: defaultSize,\r\n  });\r\n\r\n  const [downloadCanvas, setDownloadCanvas] = useState({\r\n    ref: createRef(),\r\n    width: defaultSize,\r\n    height: defaultSize,\r\n  });\r\n\r\n  const [viewportPreview, setViewportPreview] = useState({\r\n    src: null,\r\n    width: defaultSize,\r\n    height: defaultSize,\r\n  });\r\n\r\n  const [error, setError] = useState({\r\n    width: false,\r\n    height: false,\r\n    filename: false,\r\n  });\r\n\r\n  const hasError = Object.values(error).includes(true);\r\n\r\n  const refreshViewport = useRef(null);\r\n\r\n  const onKeepAspectToggle = () => {\r\n    const { width, height } = dimensions;\r\n    const aspectMultiplier = { ...aspectMultiplier };\r\n    if (!keepAspect) {\r\n      const base = Math.min(width, height);\r\n      aspectMultiplier.width = width / base;\r\n      aspectMultiplier.height = height / base;\r\n      setAspectMultiplier(aspectMultiplier);\r\n    }\r\n\r\n    setKeepAspect(!keepAspect);\r\n  };\r\n\r\n  const downloadImage = () => {\r\n    downloadBlob(\r\n      filename || DEFAULT_FILENAME,\r\n      fileType,\r\n      viewportElement,\r\n      downloadCanvas.ref.current\r\n    );\r\n  };\r\n\r\n  /**\r\n   * @param {object} value - Input value\r\n   * @param {string} dimension - \"height\" | \"width\"\r\n   */\r\n  const onDimensionsChange = (value, dimension) => {\r\n    const oppositeDimension = dimension === 'height' ? 'width' : 'height';\r\n    const sanitizedTargetValue = value.replace(/\\D/, '');\r\n    const isEmpty = sanitizedTargetValue === '';\r\n    const newDimensions = { ...dimensions };\r\n    const updatedDimension = isEmpty\r\n      ? ''\r\n      : Math.min(sanitizedTargetValue, maximumSize);\r\n\r\n    if (updatedDimension === dimensions[dimension]) {\r\n      return;\r\n    }\r\n\r\n    newDimensions[dimension] = updatedDimension;\r\n\r\n    if (keepAspect && newDimensions[oppositeDimension] !== '') {\r\n      newDimensions[oppositeDimension] = Math.round(\r\n        newDimensions[dimension] * aspectMultiplier[oppositeDimension]\r\n      );\r\n    }\r\n\r\n    // In current code, keepAspect is always `true`\r\n    // And we always start w/ a square width/height\r\n    setDimensions(newDimensions);\r\n\r\n    // Only update if value is non-empty\r\n    if (!isEmpty) {\r\n      setViewportElementDimensions(newDimensions);\r\n      setDownloadCanvas(state => ({\r\n        ...state,\r\n        ...newDimensions,\r\n      }));\r\n    }\r\n  };\r\n\r\n  const error_messages = {\r\n    width: 'The minimum valid width is 100px.',\r\n    height: 'The minimum valid height is 100px.',\r\n    filename: 'The file name cannot be empty.',\r\n  };\r\n\r\n  const renderErrorHandler = errorType => {\r\n    if (!error[errorType]) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <Typography className=\"pl-1 mt-2\" color=\"error\">\r\n        {error_messages[errorType]}\r\n      </Typography>\r\n    );\r\n  };\r\n\r\n  const validSize = useCallback(\r\n    value => (value >= minimumSize ? value : minimumSize),\r\n    [minimumSize]\r\n  );\r\n\r\n  const loadAndUpdateViewports = useCallback(async () => {\r\n    const { width: scaledWidth, height: scaledHeight } = await loadImage(\r\n      activeViewport,\r\n      viewportElement,\r\n      dimensions.width,\r\n      dimensions.height\r\n    );\r\n\r\n    toggleAnnotations(showAnnotations, viewportElement);\r\n\r\n    const scaledDimensions = {\r\n      height: validSize(scaledHeight),\r\n      width: validSize(scaledWidth),\r\n    };\r\n\r\n    setViewportElementDimensions(scaledDimensions);\r\n    setDownloadCanvas(state => ({\r\n      ...state,\r\n      ...scaledDimensions,\r\n    }));\r\n\r\n    const {\r\n      dataUrl,\r\n      width: viewportElementWidth,\r\n      height: viewportElementHeight,\r\n    } = await updateViewportPreview(\r\n      viewportElement,\r\n      downloadCanvas.ref.current,\r\n      fileType\r\n    );\r\n\r\n    setViewportPreview(state => ({\r\n      ...state,\r\n      src: dataUrl,\r\n      width: validSize(viewportElementWidth),\r\n      height: validSize(viewportElementHeight),\r\n    }));\r\n  }, [\r\n    loadImage,\r\n    activeViewport,\r\n    viewportElement,\r\n    dimensions.width,\r\n    dimensions.height,\r\n    toggleAnnotations,\r\n    showAnnotations,\r\n    validSize,\r\n    updateViewportPreview,\r\n    downloadCanvas.ref,\r\n    fileType,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    enableViewport(viewportElement);\r\n\r\n    return () => {\r\n      disableViewport(viewportElement);\r\n    };\r\n  }, [disableViewport, enableViewport, viewportElement]);\r\n\r\n  useEffect(() => {\r\n    if (refreshViewport.current !== null) {\r\n      clearTimeout(refreshViewport.current);\r\n    }\r\n\r\n    refreshViewport.current = setTimeout(() => {\r\n      refreshViewport.current = null;\r\n      loadAndUpdateViewports();\r\n    }, REFRESH_VIEWPORT_TIMEOUT);\r\n  }, [\r\n    activeViewport,\r\n    viewportElement,\r\n    showAnnotations,\r\n    dimensions,\r\n    loadImage,\r\n    toggleAnnotations,\r\n    updateViewportPreview,\r\n    fileType,\r\n    downloadCanvas.ref,\r\n    minimumSize,\r\n    maximumSize,\r\n    loadAndUpdateViewports,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const { width, height } = dimensions;\r\n    const hasError = {\r\n      width: width < minimumSize,\r\n      height: height < minimumSize,\r\n      filename: !filename,\r\n    };\r\n\r\n    setError({ ...hasError });\r\n  }, [dimensions, filename, minimumSize]);\r\n\r\n  return (\r\n    <div>\r\n      <Typography variant=\"h6\">\r\n        {t('Please specify the dimensions, filename, and desired type for the output image.')}\r\n      </Typography>\r\n\r\n      <div className=\"flex flex-col mt-6\">\r\n        <div className=\"w-full mb-4\">\r\n          <Input\r\n            data-cy=\"file-name\"\r\n            value={filename}\r\n            onChange={evt => setFilename(evt.target.value)}\r\n            label={t(\"File Name\")}\r\n          />\r\n          {renderErrorHandler('filename')}\r\n        </div>\r\n        <div className=\"flex\">\r\n          <div className=\"flex w-1/3\">\r\n            <div className=\"flex flex-col flex-grow\">\r\n              <div className=\"w-full\">\r\n                <Input\r\n                  type=\"number\"\r\n                  min={minimumSize}\r\n                  max={maximumSize}\r\n                  label={t(\"Image width (px)\")}\r\n                  value={dimensions.width}\r\n                  onChange={evt => onDimensionsChange(evt.target.value, 'width')}\r\n                  data-cy=\"image-width\"\r\n                />\r\n                {renderErrorHandler('width')}\r\n              </div>\r\n              <div className=\"w-full mt-4\">\r\n                <Input\r\n                  type=\"number\"\r\n                  min={minimumSize}\r\n                  max={maximumSize}\r\n                  label={t(\"Image height (px)\")}\r\n                  value={dimensions.height}\r\n                  onChange={evt => onDimensionsChange(evt.target.value, 'height')}\r\n                  data-cy=\"image-height\"\r\n                />\r\n                {renderErrorHandler('height')}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex items-center mt-8\">\r\n              <Tooltip\r\n                position=\"right\"\r\n                content={keepAspect ? 'Dismiss Aspect' : 'Keep Aspect'}\r\n              >\r\n                <IconButton\r\n                  onClick={onKeepAspectToggle}\r\n                  size=\"small\"\r\n                  rounded=\"full\"\r\n                >\r\n                  <Icon name={keepAspect ? 'link' : 'unlink'} />\r\n                </IconButton>\r\n              </Tooltip>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"w-1/4 pl-6 ml-6 border-l border-secondary-dark\">\r\n            <div>\r\n              <InputLabelWrapper\r\n                sortDirection=\"none\"\r\n                label={t(\"File Type\")}\r\n                isSortable={false}\r\n                onLabelClick={() => {}}\r\n              >\r\n                <Select\r\n                  className=\"mt-2\"\r\n                  isClearable={false}\r\n                  value={fileType}\r\n                  data-cy=\"file-type\"\r\n                  onChange={value => {\r\n                    setFileType([value.value]);\r\n                  }}\r\n                  hideSelectedOptions={false}\r\n                  options={FILE_TYPE_OPTIONS}\r\n                  placeholder=\"File Type\"\r\n                />\r\n              </InputLabelWrapper>\r\n            </div>\r\n            <div className=\"mt-4 ml-2\">\r\n              <label htmlFor=\"show-annotations\" className=\"flex items-center\">\r\n                <input\r\n                  id=\"show-annotations\"\r\n                  data-cy=\"show-annotations\"\r\n                  type=\"checkbox\"\r\n                  className=\"mr-2\"\r\n                  checked={showAnnotations}\r\n                  onChange={event => setShowAnnotations(event.target.checked)}\r\n                />\r\n                <Typography>{t(\"Show Annotations\")}</Typography>\r\n              </label>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"mt-8\">\r\n          <div\r\n            className=\"p-4 rounded bg-secondary-dark border-secondary-primary\"\r\n            data-cy=\"image-preview\"\r\n          >\r\n          <Typography variant=\"h5\">{t(\"Image preview\")}</Typography>\r\n            {activeViewport && (<div\r\n            className=\"mx-auto my-0\"\r\n              style={{\r\n                height: viewportElementDimensions.height,\r\n                width: viewportElementDimensions.width,\r\n              }}\r\n              ref={ref => setViewportElement(ref)}\r\n            >\r\n              <canvas\r\n                className={classnames('block', canvasClass)}\r\n                style={{\r\n                  height: downloadCanvas.height,\r\n                  width: downloadCanvas.width,\r\n                }}\r\n                width={downloadCanvas.width}\r\n                height={downloadCanvas.height}\r\n                ref={downloadCanvas.ref}\r\n              ></canvas>\r\n            </div>)}\r\n            {!activeViewport &&\r\n              <Typography className=\"mt-4\">\r\n            {t(\"Active viewport has no displayed image\")}\r\n              </Typography>\r\n            }\r\n          </div>\r\n      </div>\r\n\r\n      <div className=\"flex justify-end mt-4\">\r\n        <Button data-cy=\"cancel-btn\" variant=\"outlined\" onClick={onClose}>\r\n          {t(\"Cancel\")}\r\n        </Button>\r\n        <Button\r\n          className=\"ml-2\"\r\n          disabled={hasError}\r\n          onClick={downloadImage}\r\n          color=\"primary\"\r\n          data-cy=\"download-btn\"\r\n        >\r\n          {t(\"Download\")}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ViewportDownloadForm;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nfunction ViewportGrid({ numRows, numCols, children }) {\r\n  const rowSize = 100 / numRows;\r\n  const colSize = 100 / numCols;\r\n\r\n  return (\r\n    <div\r\n      data-cy=\"viewport-grid\"\r\n      style={{\r\n        display: 'grid',\r\n        gridTemplateRows: `repeat(${numRows}, ${rowSize}%)`,\r\n        gridTemplateColumns: `repeat(${numCols}, ${colSize}%)`,\r\n        height: '100%',\r\n        width: '100%',\r\n      }}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\nViewportGrid.propTypes = {\r\n  /** Number of columns */\r\n  numRows: PropTypes.number.isRequired,\r\n  /** Number of rows */\r\n  numCols: PropTypes.number.isRequired,\r\n  /** Array of React Components to render within grid */\r\n  children: PropTypes.arrayOf(PropTypes.node).isRequired,\r\n};\r\n\r\nexport default ViewportGrid;\r\n","import ViewportGrid from './ViewportGrid';\r\nexport default ViewportGrid;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\nimport { useDrop } from 'react-dnd';\r\n\r\n// NOTE: If we found a way to make `useDrop` conditional,\r\n// Or we provided a HOC of this component, we could provide\r\n// this UI without the DragAndDropContext dependency.\r\nfunction ViewportPane({\r\n  children,\r\n  className,\r\n  isActive,\r\n  onDrop,\r\n  onDoubleClick,\r\n  onInteraction,\r\n  acceptDropsFor,\r\n}) {\r\n  let dropElement = null;\r\n  const [{ isHovered, isHighlighted }, drop] = useDrop({\r\n    accept: acceptDropsFor,\r\n    // TODO: pass in as prop?\r\n    drop: (droppedItem, monitor) => {\r\n      const canDrop = monitor.canDrop();\r\n      const isOver = monitor.isOver();\r\n\r\n      if (canDrop && isOver && onDrop) {\r\n        onInteractionHandler();\r\n        onDrop(droppedItem);\r\n      }\r\n    },\r\n    // Monitor, and collect props; returned as values by `useDrop`\r\n    collect: monitor => ({\r\n      isHighlighted: monitor.canDrop(),\r\n      isHovered: monitor.isOver(),\r\n    }),\r\n  });\r\n\r\n  const focus = () => {\r\n    if (dropElement) {\r\n      dropElement.focus();\r\n    }\r\n  };\r\n\r\n  const onInteractionHandler = (event) => {\r\n    focus();\r\n    onInteraction(event);\r\n  };\r\n\r\n  const refHandler = element => {\r\n    drop(element);\r\n    dropElement = element;\r\n  };\r\n\r\n  return (\r\n    <div\r\n      ref={refHandler}\r\n      // onInteractionHandler...\r\n      // https://reactjs.org/docs/events.html#mouse-events\r\n      // https://stackoverflow.com/questions/8378243/catch-scrolling-event-on-overflowhidden-element\r\n      onMouseDown={onInteractionHandler}\r\n      onDoubleClick={onDoubleClick}\r\n      onClick={onInteractionHandler}\r\n      onScroll={onInteractionHandler}\r\n      onWheel={onInteractionHandler}\r\n      className={classnames(\r\n        'flex flex-col',\r\n        'rounded-lg hover:border-primary-light transition duration-300 outline-none overflow-hidden',\r\n        {\r\n          'border-2 border-primary-light': isActive,\r\n          'border border-secondary-light': !isActive,\r\n        },\r\n        className\r\n      )}\r\n      // Normally, we'd use tailwindcss classes here, but margin and border classes use different units\r\n      // m-# (rem), border-# (px). To make sure we don't change the box size of our viewports\r\n      // and trigger a canvas resize, we have to use this little trick for margin.\r\n      // Assumes a :root font-fize of `16px`\r\n      style={{\r\n        margin: isActive ? '3px' : '4px',\r\n      }}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\nViewportPane.propTypes = {\r\n  /** The ViewportComp */\r\n  children: PropTypes.node.isRequired,\r\n  /** Classes to append to container */\r\n  className: PropTypes.string,\r\n  /** Bool to show active styling */\r\n  isActive: PropTypes.bool.isRequired,\r\n  /** Indicates drag items we should accept for drops */\r\n  acceptDropsFor: PropTypes.string.isRequired,\r\n  /** Function that handles drop events */\r\n  onDrop: PropTypes.func.isRequired,\r\n  /** Called when the viewportPane is interacted with by the user */\r\n  onInteraction: PropTypes.func.isRequired,\r\n  /** Executed when the pane is double clicked */\r\n  onDoubleClick: PropTypes.func,\r\n};\r\n\r\nconst noop = () => { };\r\n\r\nViewportPane.defaultProps = {\r\n  onInteraction: noop,\r\n};\r\n\r\nexport default ViewportPane;\r\n","import ViewportPane from './ViewportPane';\r\nexport default ViewportPane;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\n\r\nconst WindowLevelMenuItem = ({ title, subtitle, isSelected, index }) => (\r\n  <>\r\n    <div className={classNames(\r\n      'flex flex-row items-center p-3 h-8 w-full hover:bg-primary-dark',\r\n      isSelected && 'bg-primary-dark'\r\n    )}\r\n    >\r\n      <span className='text-common-bright mr-2 text-base whitespace-nowrap'>\r\n        {title}\r\n      </span>\r\n      <span className='flex-1 text-aqua-pale font-light text-sm whitespace-nowrap'>\r\n        {subtitle}\r\n      </span>\r\n      <span className='text-primary-active ml-5 text-sm whitespace-nowrap'>{index + 1}</span>\r\n    </div>\r\n  </>\r\n);\r\n\r\nWindowLevelMenuItem.propTypes = {\r\n  title: PropTypes.string.isRequired,\r\n  subtitle: PropTypes.string.isRequired,\r\n  isSelected: PropTypes.bool.isRequired,\r\n  index: PropTypes.number.isRequired,\r\n};\r\n\r\nexport default WindowLevelMenuItem;\r\n","import WindowLevelMenuItem from './WindowLevelMenuItem';\r\nexport default WindowLevelMenuItem;\r\n","import React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Select, Typography, Button, HotkeysPreferences } from '../';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nconst UserPreferences = ({ availableLanguages, defaultLanguage, currentLanguage, disabled, hotkeyDefinitions, hotkeyDefaults, onCancel, onSubmit, onReset, hotkeysModule }) => {\r\n  const { t } = useTranslation('UserPreferencesModal');\r\n  const [state, setState] = useState({\r\n    isDisabled: disabled,\r\n    hotkeyErrors: {},\r\n    hotkeyDefinitions,\r\n    language: currentLanguage\r\n  });\r\n\r\n  const onSubmitHandler = () => {\r\n    onSubmit(state);\r\n  };\r\n\r\n  const onResetHandler = () => {\r\n    setState(state => ({\r\n      ...state,\r\n      language: defaultLanguage,\r\n      hotkeyDefinitions: hotkeyDefaults,\r\n      hotkeyErrors: {},\r\n      isDisabled: disabled,\r\n    }));\r\n    onReset();\r\n  };\r\n\r\n  const onCancelHandler = () => {\r\n    setState({ hotkeyDefinitions });\r\n    onCancel();\r\n  };\r\n\r\n  const onLanguageChangeHandler = (value) => {\r\n    setState(state => ({ ...state, language: value }));\r\n  };\r\n\r\n  const onHotkeysChangeHandler = (id, definition, errors) => {\r\n    setState(state => ({\r\n      ...state,\r\n      isDisabled: Object.values(errors).every(e => e !== undefined),\r\n      hotkeyErrors: errors,\r\n      hotkeyDefinitions: {\r\n        ...state.hotkeyDefinitions,\r\n        [id]: definition,\r\n      }\r\n    }));\r\n  };\r\n\r\n  const Section = ({ title, children }) => (\r\n    <>\r\n      <div className=\"border-b-2 border-black mb-2\">\r\n        <Typography\r\n          variant=\"h5\"\r\n          className=\"flex flex-grow text-primary-light font-light pb-2\"\r\n        >\r\n          {title}\r\n        </Typography>\r\n      </div>\r\n      <div className=\"mt-4 mb-8\">\r\n        {children}\r\n      </div>\r\n    </>\r\n  );\r\n\r\n  return (\r\n    <div className=\"p-2\">\r\n      <Section title={t('General')}>\r\n        <div className=\"flex flex-row justify-center items-center w-72\">\r\n          <Typography variant=\"subtitle\" className=\"mr-5 text-right h-full\">\r\n            {t('Language')}\r\n          </Typography>\r\n          <Select\r\n            isClearable={false}\r\n            onChange={onLanguageChangeHandler}\r\n            options={availableLanguages}\r\n            value={state.language}\r\n          />\r\n        </div>\r\n      </Section>\r\n      <Section title={t('Hotkeys')}>\r\n        <HotkeysPreferences\r\n          disabled={disabled}\r\n          hotkeyDefinitions={state.hotkeyDefinitions}\r\n          onChange={onHotkeysChangeHandler}\r\n          errors={state.hotkeyErrors}\r\n          hotkeysModule={hotkeysModule}\r\n        />\r\n      </Section>\r\n      <div className=\"flex flex-row justify-between\">\r\n        <Button variant=\"outlined\" onClick={onResetHandler} disabled={disabled}>\r\n          {t('Reset to Defaults')}\r\n        </Button>\r\n        <div className=\"flex flex-row\">\r\n          <Button variant=\"outlined\" onClick={onCancelHandler}>\r\n            {t('Cancel')}\r\n          </Button>\r\n          <Button\r\n            variant=\"contained\"\r\n            disabled={state.isDisabled}\r\n            color=\"light\"\r\n            className=\"ml-2\"\r\n            onClick={onSubmitHandler}\r\n          >\r\n            {t('Save')}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst noop = () => { };\r\n\r\nUserPreferences.propTypes = {\r\n  disabled: PropTypes.bool,\r\n  hotkeyDefaults: PropTypes.object.isRequired,\r\n  hotkeyDefinitions: PropTypes.object.isRequired,\r\n  languageOptions: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      label: PropTypes.string.isRequired,\r\n      value: PropTypes.any.isRequired,\r\n    })\r\n  ),\r\n  onCancel: PropTypes.func,\r\n  onSubmit: PropTypes.func,\r\n  onReset: PropTypes.func,\r\n  hotkeysModule: PropTypes.shape({\r\n    initialize: PropTypes.func.isRequired,\r\n    pause: PropTypes.func.isRequired,\r\n    unpause: PropTypes.func.isRequired,\r\n    startRecording: PropTypes.func.isRequired,\r\n    record: PropTypes.func.isRequired,\r\n  }).isRequired\r\n};\r\n\r\nUserPreferences.defaultProps = {\r\n  languageOptions: [\r\n    { value: 'ONE', label: 'ONE' },\r\n    { value: 'TWO', label: 'TWO' },\r\n  ],\r\n  onCancel: noop,\r\n  onSubmit: noop,\r\n  onReset: noop,\r\n  disabled: false\r\n};\r\n\r\nexport default UserPreferences;\r\n","import UserPreferences from './UserPreferences.jsx';\r\n\r\nexport default UserPreferences;\r\n","export const MODIFIER_KEYS = ['ctrl', 'alt', 'shift'];\r\n\r\nexport const DISALLOWED_COMBINATIONS = {\r\n  '': [],\r\n  alt: ['space'],\r\n  shift: [],\r\n  ctrl: [\r\n    'f4',\r\n    'f5',\r\n    'f11',\r\n    'w',\r\n    'r',\r\n    't',\r\n    'o',\r\n    'p',\r\n    'a',\r\n    'd',\r\n    'f',\r\n    'g',\r\n    'h',\r\n    'j',\r\n    'l',\r\n    'z',\r\n    'x',\r\n    'c',\r\n    'v',\r\n    'b',\r\n    'n',\r\n    'pagedown',\r\n    'pageup',\r\n  ],\r\n  'ctrl+shift': ['q', 'w', 'r', 't', 'p', 'a', 'h', 'v', 'b', 'n'],\r\n};\r\n\r\nexport const SPECIAL_KEYS = {\r\n  8: 'backspace',\r\n  9: 'tab',\r\n  13: 'return',\r\n  16: 'shift',\r\n  17: 'ctrl',\r\n  18: 'alt',\r\n  19: 'pause',\r\n  20: 'capslock',\r\n  27: 'esc',\r\n  32: 'space',\r\n  33: 'pageup',\r\n  34: 'pagedown',\r\n  35: 'end',\r\n  36: 'home',\r\n  37: 'left',\r\n  38: 'up',\r\n  39: 'right',\r\n  40: 'down',\r\n  45: 'insert',\r\n  46: 'del',\r\n  96: '0',\r\n  97: '1',\r\n  98: '2',\r\n  99: '3',\r\n  100: '4',\r\n  101: '5',\r\n  102: '6',\r\n  103: '7',\r\n  104: '8',\r\n  105: '9',\r\n  106: '*',\r\n  107: '+',\r\n  109: '-',\r\n  110: '.',\r\n  111: '/',\r\n  112: 'f1',\r\n  113: 'f2',\r\n  114: 'f3',\r\n  115: 'f4',\r\n  116: 'f5',\r\n  117: 'f6',\r\n  118: 'f7',\r\n  119: 'f8',\r\n  120: 'f9',\r\n  121: 'f10',\r\n  122: 'f11',\r\n  123: 'f12',\r\n  144: 'numlock',\r\n  145: 'scroll',\r\n  191: '/',\r\n  224: 'meta',\r\n};\r\n","import { MODIFIER_KEYS, DISALLOWED_COMBINATIONS } from './hotkeysConfig';\r\n\r\nconst formatPressedKeys = pressedKeysArray => pressedKeysArray.join('+');\r\n\r\nconst findConflictingCommand = (hotkeys, currentCommandName, pressedKeys) => {\r\n  let firstConflictingCommand = undefined;\r\n  const formatedPressedHotkeys = formatPressedKeys(pressedKeys);\r\n\r\n  for (const commandName in hotkeys) {\r\n    const toolHotkeys = hotkeys[commandName].keys;\r\n    const formatedToolHotkeys = formatPressedKeys(toolHotkeys);\r\n\r\n    if (\r\n      formatedPressedHotkeys === formatedToolHotkeys &&\r\n      commandName !== currentCommandName\r\n    ) {\r\n      firstConflictingCommand = hotkeys[commandName];\r\n      break;\r\n    }\r\n  }\r\n\r\n  return firstConflictingCommand;\r\n};\r\n\r\nconst ERROR_MESSAGES = {\r\n  MODIFIER:\r\n    \"It's not possible to define only modifier keys (ctrl, alt and shift) as a shortcut\",\r\n  EMPTY: \"Field can't be empty.\",\r\n};\r\n\r\n// VALIDATORS\r\n\r\nconst modifierValidator = ({ pressedKeys }) => {\r\n  const lastPressedKey = pressedKeys[pressedKeys.length - 1];\r\n  // Check if it has a valid modifier\r\n  const isModifier = MODIFIER_KEYS.includes(lastPressedKey);\r\n  if (isModifier) {\r\n    return { error: ERROR_MESSAGES.MODIFIER };\r\n  }\r\n};\r\n\r\nconst emptyValidator = ({ pressedKeys = [] }) => {\r\n  if (!pressedKeys.length) {\r\n    return { error: ERROR_MESSAGES.EMPTY };\r\n  }\r\n};\r\n\r\nconst conflictingValidator = ({ commandName, pressedKeys, hotkeys }) => {\r\n  const conflictingCommand = findConflictingCommand(\r\n    hotkeys,\r\n    commandName,\r\n    pressedKeys\r\n  );\r\n\r\n  if (conflictingCommand) {\r\n    return {\r\n      error: `\"${conflictingCommand.label}\" is already using the \"${pressedKeys}\" shortcut.`,\r\n    };\r\n  }\r\n};\r\n\r\nconst disallowedValidator = ({ pressedKeys = [] }) => {\r\n  const lastPressedKey = pressedKeys[pressedKeys.length - 1];\r\n  const modifierCommand = formatPressedKeys(\r\n    pressedKeys.slice(0, pressedKeys.length - 1)\r\n  );\r\n\r\n  const disallowedCombination = DISALLOWED_COMBINATIONS[modifierCommand];\r\n  const hasDisallowedCombinations = disallowedCombination\r\n    ? disallowedCombination.includes(lastPressedKey)\r\n    : false;\r\n\r\n  if (hasDisallowedCombinations) {\r\n    return {\r\n      error: `\"${formatPressedKeys(pressedKeys)}\" shortcut combination is not allowed`,\r\n    };\r\n  }\r\n};\r\n\r\nconst hotkeysValidators = [\r\n  emptyValidator,\r\n  modifierValidator,\r\n  conflictingValidator,\r\n  disallowedValidator,\r\n];\r\n\r\nexport { hotkeysValidators };\r\n","import React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\nimport { HotkeyField, Typography } from '../';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\n\r\n/* TODO: Move these configs and utils to core? */\r\nimport { MODIFIER_KEYS } from './hotkeysConfig';\r\nimport { validate, splitHotkeyDefinitionsAndCreateTuples } from './utils';\r\n\r\nconst HotkeysPreferences = ({ disabled, hotkeyDefinitions, errors: controlledErrors, onChange, hotkeysModule }) => {\r\n  const { t } = useTranslation('UserPreferencesModal');\r\n\r\n  const visibleHotkeys = Object.keys(hotkeyDefinitions)\r\n    .filter(key => hotkeyDefinitions[key].isEditable)\r\n    .reduce((obj, key) => {\r\n      obj[key] = hotkeyDefinitions[key];\r\n      return obj;\r\n    }, {});\r\n\r\n  const [errors, setErrors] = useState(controlledErrors);\r\n  const splitedHotkeys = splitHotkeyDefinitionsAndCreateTuples(visibleHotkeys);\r\n\r\n  if (!Object.keys(hotkeyDefinitions).length) {\r\n    return 'No hotkey definitions';\r\n  }\r\n\r\n  const onHotkeyChangeHandler = (id, definition) => {\r\n    const { error } = validate({\r\n      commandName: id,\r\n      pressedKeys: definition.keys,\r\n      hotkeys: hotkeyDefinitions,\r\n    });\r\n\r\n    setErrors(prevState => {\r\n      const errors = { ...prevState, [id]: error };\r\n      return errors;\r\n    });\r\n\r\n    onChange(id, definition, { ...errors, [id]: error });\r\n  };\r\n\r\n  return (\r\n    <div className='flex flex-row justify-center'>\r\n      <div className='flex flex-row justify-evenly w-full'>\r\n        {splitedHotkeys.map((hotkeys, index) => {\r\n          return (\r\n            <div key={`HotkeyGroup@${index}`} className='flex flex-row'>\r\n              <div className='p-2 text-right flex flex-col'>\r\n                {hotkeys.map((hotkey, hotkeyIndex) => {\r\n                  const [id, definition] = hotkey;\r\n                  const isFirst = hotkeyIndex === 0;\r\n                  const error = errors[id];\r\n\r\n                  const onChangeHandler = keys => onHotkeyChangeHandler(id, { ...definition, keys });\r\n\r\n                  return (\r\n                    <div key={`HotkeyItem@${hotkeyIndex}`} className='flex flex-row justify-end mb-2'>\r\n                      <div className='flex flex-col items-center'>\r\n                        <Typography\r\n                          variant='subtitle'\r\n                          className={classNames('pr-6 w-full text-right text-primary-light', !isFirst && 'hidden')}\r\n                        >\r\n                          {t('Function')}\r\n                      </Typography>\r\n                        <Typography\r\n                          variant='subtitle'\r\n                          className={classNames('pr-6 h-full flex flex-row items-center whitespace-nowrap', isFirst && 'mt-5')}>\r\n                          {definition.label}\r\n                        </Typography>\r\n                      </div>\r\n                      <div className='flex flex-col'>\r\n                        <Typography\r\n                          variant='subtitle'\r\n                          className={classNames('pr-6 pl-0 text-left text-primary-light', !isFirst && 'hidden')}\r\n                        >\r\n                          {t('Shortcut')}\r\n                      </Typography>\r\n                        <div className={classNames('flex flex-col w-32', isFirst && 'mt-5')}>\r\n                          <HotkeyField\r\n                            disabled={disabled}\r\n                            keys={definition.keys}\r\n                            modifierKeys={MODIFIER_KEYS}\r\n                            onChange={onChangeHandler}\r\n                            hotkeys={hotkeysModule}\r\n                            className='text-lg h-8'\r\n                          />\r\n                          {error && <span className='p-2 text-left text-red-600 text-sm'>{error}</span>}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst noop = () => { };\r\n\r\nHotkeysPreferences.propTypes = {\r\n  onChange: PropTypes.func,\r\n  disabled: PropTypes.bool,\r\n  hotkeyDefinitions: PropTypes.object.isRequired,\r\n  hotkeysModule: PropTypes.shape({\r\n    initialize: PropTypes.func.isRequired,\r\n    pause: PropTypes.func.isRequired,\r\n    unpause: PropTypes.func.isRequired,\r\n    startRecording: PropTypes.func.isRequired,\r\n    record: PropTypes.func.isRequired,\r\n  }).isRequired\r\n};\r\n\r\nHotkeysPreferences.defaultProps = {\r\n  onChange: noop,\r\n  disabled: false\r\n};\r\n\r\nexport default HotkeysPreferences;\r\n","import { hotkeysValidators } from './hotkeysValidators';\r\n\r\n/**\r\n * Split hotkeys definitions and create hotkey related tuples\r\n *\r\n * @param {array} hotkeyDefinitions\r\n * @returns {array} array of tuples consisted of command name and hotkey definition\r\n */\r\nconst splitHotkeyDefinitionsAndCreateTuples = hotkeyDefinitions => {\r\n  const splitedHotkeys = [];\r\n  const arrayHotkeys = Object.entries(hotkeyDefinitions);\r\n\r\n  if (arrayHotkeys.length) {\r\n    const halfwayThrough = Math.ceil(arrayHotkeys.length / 2);\r\n    splitedHotkeys.push(arrayHotkeys.slice(0, halfwayThrough));\r\n    splitedHotkeys.push(\r\n      arrayHotkeys.slice(halfwayThrough, arrayHotkeys.length)\r\n    );\r\n  }\r\n\r\n  return splitedHotkeys;\r\n};\r\n\r\n/**\r\n * Validate a hotkey change\r\n *\r\n * @param {Object} arguments\r\n * @param {string} arguments.commandName command name or id\r\n * @param {array} arguments.pressedKeys new keys\r\n * @param {array} arguments.hotkeys current hotkeys\r\n * @returns {Object} {error} validation error\r\n */\r\nconst validate = ({ commandName, pressedKeys, hotkeys }) => {\r\n  for (const validator of hotkeysValidators) {\r\n    const validation = validator({\r\n      commandName,\r\n      pressedKeys,\r\n      hotkeys,\r\n    });\r\n\r\n    if (validation && validation.error) {\r\n      return validation;\r\n    }\r\n  }\r\n\r\n  return { error: undefined };\r\n};\r\n\r\nexport { validate, splitHotkeyDefinitionsAndCreateTuples };\r\n","import HotkeysPreferences from './HotkeysPreferences.jsx';\r\n\r\nexport default HotkeysPreferences;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport Input from '../Input';\r\nimport { getKeys, formatKeysForInput } from './utils';\r\n\r\n/**\r\n * HotkeyField\r\n * Renders a hotkey input that records keys\r\n *\r\n * @param {object} props component props\r\n * @param {Array[]} props.keys keys to be controlled by this field\r\n * @param {boolean} props.disabled disables the field\r\n * @param {function} props.onChange callback with changed values\r\n * @param {string} props.className input classes\r\n * @param {Array[]} props.modifierKeys\r\n */\r\nconst HotkeyField = ({ disabled, keys, onChange, className, modifierKeys, hotkeys }) => {\r\n  const inputValue = formatKeysForInput(keys);\r\n\r\n  const onInputKeyDown = event => {\r\n    hotkeys.record(sequence => {\r\n      const keys = getKeys({ sequence, modifierKeys });\r\n      hotkeys.unpause();\r\n      onChange(keys);\r\n    });\r\n  };\r\n\r\n  const onFocus = () => {\r\n    hotkeys.pause();\r\n    hotkeys.startRecording();\r\n  };\r\n\r\n  return (\r\n    <Input\r\n      readOnly\r\n      disabled={disabled}\r\n      value={inputValue}\r\n      onKeyDown={onInputKeyDown}\r\n      onFocus={onFocus}\r\n      className={className}\r\n    />\r\n  );\r\n};\r\n\r\nHotkeyField.propTypes = {\r\n  keys: PropTypes.array.isRequired,\r\n  onChange: PropTypes.func.isRequired,\r\n  className: PropTypes.string,\r\n  modifierKeys: PropTypes.array,\r\n  disabled: PropTypes.bool,\r\n  hotkeys: PropTypes.shape({\r\n    initialize: PropTypes.func.isRequired,\r\n    pause: PropTypes.func.isRequired,\r\n    unpause: PropTypes.func.isRequired,\r\n    startRecording: PropTypes.func.isRequired,\r\n    record: PropTypes.func.isRequired,\r\n  }).isRequired\r\n};\r\n\r\nHotkeyField.defaultProps = {\r\n  disabled: false\r\n};\r\n\r\nexport default HotkeyField;\r\n","/**\r\n * Take the pressed key array and return the readable string for the keys\r\n *\r\n * @param {Array} [keys=[]]\r\n * @returns {string} string representation of an array of keys\r\n */\r\nconst formatKeysForInput = (keys = []) => keys.join('+');\r\n\r\n/**\r\n * formats given keys sequence to insert the modifier keys in the first index of the array\r\n * @param {string} sequence keys sequence from MouseTrap Record -> \"shift+left\"\r\n * @returns {Array} keys in array-format -> ['shift','left']\r\n */\r\nconst getKeys = ({ sequence, modifierKeys }) => {\r\n  const keysArray = sequence.join(' ').split('+');\r\n  let keys = [];\r\n  let modifiers = [];\r\n  keysArray.forEach(key => {\r\n    if (modifierKeys && modifierKeys.includes(key)) {\r\n      modifiers.push(key);\r\n    } else {\r\n      keys.push(key);\r\n    }\r\n  });\r\n  return [...modifiers, ...keys];\r\n};\r\n\r\nexport {\r\n  getKeys,\r\n  formatKeysForInput\r\n};\r\n","import HotkeyField from './HotkeyField.jsx';\r\n\r\nexport default HotkeyField;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useTranslation } from 'react-i18next';\r\nimport classNames from 'classnames';\r\nimport { NavBar, Svg, Icon, IconButton, Dropdown } from '../';\r\n\r\nfunction Header({ children, menuOptions, isReturnEnabled, onClickReturnButton, isSticky, WhiteLabeling }) {\r\n  const { t } = useTranslation('Header');\r\n\r\n  // TODO: this should be passed in as a prop instead and the react-router-dom\r\n  // dependency should be dropped\r\n  const onClickReturn = () => {\r\n    if (isReturnEnabled && onClickReturnButton) {\r\n      onClickReturnButton()\r\n    }\r\n  };\r\n\r\n  const CustomLogo = (React) => {\r\n    return WhiteLabeling.createLogoComponentFn(React)\r\n  }\r\n\r\n  return (\r\n    <NavBar className='justify-between border-b-4 border-black' isSticky={isSticky}>\r\n      <div className=\"flex justify-between flex-1\">\r\n        <div className=\"flex items-center\">\r\n          {/* // TODO: Should preserve filter/sort\r\n              // Either injected service? Or context (like react router's `useLocation`?) */}\r\n          <div\r\n            className={classNames(\"inline-flex items-center mr-3\", isReturnEnabled && 'cursor-pointer')}\r\n            onClick={onClickReturn}\r\n          >\r\n            {isReturnEnabled && <Icon name=\"chevron-left\" className=\"w-8 text-primary-active\" />}\r\n            <div className=\"ml-4\">{WhiteLabeling ? CustomLogo(React) : <Svg name=\"logo-ohif\" />}</div>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex items-center\">{children}</div>\r\n        <div className=\"flex items-center\">\r\n          <span className=\"mr-3 text-lg text-common-light\">\r\n            {t('INVESTIGATIONAL USE ONLY')}\r\n          </span>\r\n          <Dropdown id=\"options\" showDropdownIcon={false} list={menuOptions}>\r\n            <IconButton\r\n              id={\"options-settings-icon\"}\r\n              variant=\"text\"\r\n              color=\"inherit\"\r\n              size=\"initial\"\r\n              className=\"text-primary-active\"\r\n            >\r\n              <Icon name=\"settings\" />\r\n            </IconButton>\r\n            <IconButton\r\n              id={\"options-chevron-down-icon\"}\r\n              variant=\"text\"\r\n              color=\"inherit\"\r\n              size=\"initial\"\r\n              className=\"text-primary-active\"\r\n            >\r\n              <Icon name=\"chevron-down\" />\r\n            </IconButton>\r\n          </Dropdown>\r\n        </div>\r\n      </div>\r\n    </NavBar>\r\n  );\r\n}\r\n\r\nHeader.propTypes = {\r\n  menuOptions: PropTypes.arrayOf(\r\n    PropTypes.shape({\r\n      title: PropTypes.string.isRequired,\r\n      icon: PropTypes.string,\r\n      onClick: PropTypes.func.isRequired,\r\n    })\r\n  ),\r\n  children: PropTypes.oneOfType([PropTypes.node, PropTypes.func]),\r\n  isReturnEnabled: PropTypes.bool,\r\n  isSticky: PropTypes.bool,\r\n  onClickReturnButton: PropTypes.func,\r\n  WhiteLabeling: PropTypes.element,\r\n};\r\n\r\nHeader.defaultProps = {\r\n  isReturnEnabled: true,\r\n  isSticky: false\r\n};\r\n\r\nexport default Header;\r\n","import Header from './Header';\r\nexport default Header;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classnames from 'classnames';\r\n\r\nexport const BackgroundColor = ({ color }) => {\r\n  return (\r\n    <div\r\n      className={classnames(\r\n        `mb-4 w-56 h-10 flex items-center justify-center flex-col text-white text-lg bg-${color} py-8`\r\n      )}\r\n    >\r\n      <p>bg-{color}</p>\r\n    </div>\r\n  );\r\n};\r\n\r\nBackgroundColor.propTypes = {\r\n  color: PropTypes.string,\r\n};\r\n\r\nexport default BackgroundColor;\r\n","import PropTypes from 'prop-types';\r\nimport React from 'react';\r\n\r\nexport const ModalComponent = ({\r\n  content,\r\n  contentProps,\r\n  shouldCloseOnEsc,\r\n  isOpen,\r\n  closeButton,\r\n  title,\r\n  customClassName,\r\n}) => {\r\n  return <></>;\r\n};\r\n\r\nModalComponent.defaultProps = {\r\n  content: null,\r\n  contentProps: null,\r\n  shouldCloseOnEsc: true,\r\n  isOpen: true,\r\n  closeButton: true,\r\n  title: null,\r\n  customClassName: '',\r\n};\r\n\r\nModalComponent.propTypes = {\r\n  content: PropTypes.node,\r\n  contentProps: PropTypes.object,\r\n  shouldCloseOnEsc: PropTypes.bool,\r\n  isOpen: PropTypes.bool,\r\n  closeButton: PropTypes.bool,\r\n  title: PropTypes.string,\r\n  customClassName: PropTypes.string,\r\n};\r\n\r\nexport default ModalComponent;\r\n","const debugMode = !!(\r\n  process.env.NODE_ENV !== 'production' && process.env.REACT_APP_I18N_DEBUG\r\n);\r\n\r\nconst detectionOptions = {\r\n  // order and from where user language should be detected\r\n  order: ['querystring', 'cookie', 'localStorage', 'navigator', 'htmlTag', 'path', 'subdomain'],\r\n\r\n  // keys or params to lookup language from\r\n  lookupQuerystring: 'lng',\r\n  lookupCookie: 'i18next',\r\n  lookupLocalStorage: 'i18nextLng',\r\n  lookupFromPathIndex: 0,\r\n  lookupFromSubdomainIndex: 0,\r\n\r\n  // cache user language on\r\n  caches: ['localStorage', 'cookie'],\r\n  excludeCacheFor: ['cimode'], // languages to not persist (cookie, localStorage)\r\n\r\n  // optional htmlTag with lang attribute, the default is:\r\n  htmlTag: document.documentElement\r\n};\r\n\r\nexport { debugMode, detectionOptions };\r\n","const languagesMap = {\r\n  ar: 'Arabic',\r\n  am: 'Amharic',\r\n  bg: 'Bulgarian',\r\n  bn: 'Bengali',\r\n  ca: 'Catalan',\r\n  cs: 'Czech',\r\n  da: 'Danish',\r\n  de: 'German',\r\n  el: 'Greek',\r\n  en: 'English',\r\n  'en-GB': 'English (Great Britain)',\r\n  'en-US': 'English (USA)',\r\n  es: 'Spanish',\r\n  et: 'Estonian',\r\n  fa: 'Persian',\r\n  fi: 'Finnish',\r\n  fil: 'Filipino',\r\n  fr: 'French',\r\n  gu: 'Gujarati',\r\n  he: 'Hebrew',\r\n  hi: 'Hindi',\r\n  hr: 'Croatian',\r\n  hu: 'Hungarian',\r\n  id: 'Indonesian',\r\n  it: 'Italian',\r\n  ja: 'Japanese',\r\n  'ja-JP': 'Japanese (Japan)',\r\n  kn: 'Kannada',\r\n  ko: 'Korean',\r\n  lt: 'Lithuanian',\r\n  lv: 'Latvian',\r\n  ml: 'Malayalam',\r\n  mr: 'Marathi',\r\n  ms: 'Malay',\r\n  nl: 'Dutch',\r\n  no: 'Norwegian',\r\n  pl: 'Polish',\r\n  'pt-BR': 'Portuguese (Brazil)',\r\n  'pt-PT': 'Portuguese (Portugal)',\r\n  ro: 'Romanian',\r\n  ru: 'Russian',\r\n  sk: 'Slovak',\r\n  sl: 'Slovenian',\r\n  sr: 'Serbian',\r\n  sv: 'Swedish',\r\n  sw: 'Swahili',\r\n  ta: 'Tamil',\r\n  te: 'Telugu',\r\n  th: 'Thai',\r\n  tr: 'Turkish',\r\n  uk: 'Ukrainian',\r\n  vi: 'Vietnamese',\r\n  zh: 'Chinese',\r\n  'zh-CN': 'Chinese (China)',\r\n  'zh-TW': 'Chinese (Taiwan)',\r\n  'test-LNG': 'Test Language',\r\n};\r\n\r\nconst getLanguageLabel = (language) => {\r\n  return languagesMap[language];\r\n};\r\n\r\nexport default function getAvailableLanguagesInfo(locales) {\r\n  const availableLanguagesInfo = [];\r\n\r\n  Object.keys(locales).forEach(key => {\r\n    availableLanguagesInfo.push({\r\n      value: key,\r\n      label: getLanguageLabel(key) || key,\r\n    });\r\n  });\r\n\r\n  return availableLanguagesInfo;\r\n}\r\n\r\nexport { getAvailableLanguagesInfo, getLanguageLabel };\r\n","import UserPreferencesModal from './UserPreferencesModal.json';\r\n\r\nexport default {\r\n  ar: {\r\n    UserPreferencesModal,\r\n  },\r\n};\r\n","import AboutModal from './AboutModal.json';\r\nimport Buttons from './Buttons.json';\r\nimport CineDialog from './CineDialog.json';\r\nimport Common from './Common.json';\r\nimport DatePicker from './DatePicker.json';\r\nimport Header from './Header.json';\r\nimport MeasurementTable from './MeasurementTable.json';\r\nimport StudyList from './StudyList.json';\r\nimport UserPreferencesModal from './UserPreferencesModal.json';\r\nimport ViewportDownloadForm from './ViewportDownloadForm.json';\r\n\r\nexport default {\r\n  'en-US': {\r\n    AboutModal,\r\n    Buttons,\r\n    CineDialog,\r\n    Common,\r\n    DatePicker,\r\n    Header,\r\n    MeasurementTable,\r\n    StudyList,\r\n    UserPreferencesModal,\r\n    ViewportDownloadForm,\r\n  },\r\n};\r\n","import Buttons from './Buttons.json';\r\nimport CineDialog from './CineDialog.json';\r\nimport Common from './Common.json';\r\nimport Header from './Header.json';\r\nimport MeasurementTable from './MeasurementTable.json';\r\nimport StudyList from './StudyList.json';\r\nimport UserPreferencesModal from './UserPreferencesModal.json';\r\n\r\nexport default {\r\n  es: {\r\n    Buttons,\r\n    CineDialog,\r\n    Common,\r\n    Header,\r\n    MeasurementTable,\r\n    StudyList,\r\n    UserPreferencesModal,\r\n  },\r\n};\r\n","import Buttons from './Buttons.json';\r\nimport CineDialog from './CineDialog.json';\r\nimport Common from './Common.json';\r\nimport Header from './Header.json';\r\nimport UserPreferencesModal from './UserPreferencesModal.json';\r\n\r\nexport default {\r\n  fr: {\r\n    Buttons,\r\n    CineDialog,\r\n    Common,\r\n    Header,\r\n    UserPreferencesModal,\r\n  },\r\n};\r\n","import Buttons from './Buttons.json';\r\nimport CineDialog from './CineDialog.json';\r\nimport Common from './Common.json';\r\nimport Header from './Header.json';\r\nimport UserPreferencesModal from './UserPreferencesModal.json';\r\n\r\nexport default {\r\n  'ja-JP': {\r\n    Buttons,\r\n    CineDialog,\r\n    Common,\r\n    Header,\r\n    UserPreferencesModal,\r\n  },\r\n};\r\n","import Buttons from './Buttons.json';\r\nimport Common from './Common.json';\r\nimport Header from './Header.json';\r\n\r\nexport default {\r\n  nl: {\r\n    Buttons,\r\n    Common,\r\n    Header,\r\n  },\r\n};\r\n","import AboutModal from './AboutModal.json';\r\nimport Buttons from './Buttons.json';\r\nimport CineDialog from './CineDialog.json';\r\nimport Common from './Common.json';\r\nimport DatePicker from './DatePicker.json';\r\nimport Header from './Header.json';\r\nimport UserPreferencesModal from './UserPreferencesModal.json';\r\nimport MeasurementTable from './MeasurementTable.json';\r\n\r\nexport default {\r\n  'pt-BR': {\r\n    AboutModal,\r\n    Buttons,\r\n    CineDialog,\r\n    Common,\r\n    DatePicker,\r\n    Header,\r\n    UserPreferencesModal,\r\n    MeasurementTable,\r\n  },\r\n};\r\n","import Buttons from './Buttons.json';\r\nimport CineDialog from './CineDialog.json';\r\nimport Common from './Common.json';\r\nimport Header from './Header.json';\r\nimport StudyList from './StudyList.json';\r\nimport UserPreferencesModal from './UserPreferencesModal.json';\r\n\r\nexport default {\r\n  vi: {\r\n    Buttons,\r\n    CineDialog,\r\n    Common,\r\n    Header,\r\n    StudyList,\r\n    UserPreferencesModal,\r\n  },\r\n};\r\n","import Buttons from './Buttons.json';\r\nimport CineDialog from './CineDialog.json';\r\nimport Common from './Common.json';\r\nimport Header from './Header.json';\r\nimport MeasurementTable from './MeasurementTable.json';\r\nimport StudyList from './StudyList.json';\r\nimport UserPreferencesModal from './UserPreferencesModal.json';\r\n\r\nexport default {\r\n  zh: {\r\n    Buttons,\r\n    CineDialog,\r\n    Common,\r\n    Header,\r\n    MeasurementTable,\r\n    StudyList,\r\n    UserPreferencesModal,\r\n  },\r\n};\r\n","import AboutModal from './AboutModal.json';\r\nimport Buttons from './Buttons.json';\r\nimport CineDialog from './CineDialog.json';\r\nimport Common from './Common.json';\r\nimport DatePicker from './DatePicker.json';\r\nimport Header from './Header.json';\r\nimport MeasurementTable from './MeasurementTable.json';\r\nimport StudyList from './StudyList.json';\r\nimport UserPreferencesModal from './UserPreferencesModal.json';\r\nimport ViewportDownloadForm from './ViewportDownloadForm.json';\r\nimport ToolTip from './ToolTip.json';\r\nimport StudyBrowser from './StudyBrowser.json';\r\nimport SidePanel from './SidePanel.json';\r\nimport PatientInfo from './PatientInfo.json';\r\nimport Modes from './Modes.json';\r\nimport Modals from './Modals.json';\r\n\r\nexport default {\r\n  'test-LNG': {\r\n    AboutModal,\r\n    Buttons,\r\n    CineDialog,\r\n    Common,\r\n    DatePicker,\r\n    Header,\r\n    MeasurementTable,\r\n    StudyList,\r\n    UserPreferencesModal,\r\n    ViewportDownloadForm,\r\n    ToolTip,\r\n    StudyBrowser,\r\n    PatientInfo,\r\n    Modes,\r\n    SidePanel,\r\n    Modals\r\n  },\r\n};\r\n","import ar from './ar/';\r\nimport en_US from './en-US/';\r\nimport es from './es/';\r\nimport fr from './fr/';\r\nimport ja_JP from './ja-JP/';\r\nimport nl from './nl/';\r\nimport pt_BR from './pt-BR/';\r\nimport vi from './vi/';\r\nimport zh from './zh/';\r\nimport test_lng from './test-LNG/';\r\n\r\nexport default {\r\n  ...ar,\r\n  ...en_US,\r\n  ...es,\r\n  ...fr,\r\n  ...ja_JP,\r\n  ...nl,\r\n  ...pt_BR,\r\n  ...vi,\r\n  ...zh,\r\n  ...test_lng\r\n};\r\n","import i18n from 'i18next';\r\nimport Backend from 'i18next-locize-backend';\r\nimport LastUsed from 'locize-lastused';\r\nimport Editor from 'locize-editor';\r\nimport LanguageDetector from 'i18next-browser-languagedetector';\r\nimport { initReactI18next } from 'react-i18next';\r\nimport customDebug from './debugger';\r\nimport pkg from '../package.json';\r\nimport { debugMode, detectionOptions } from './config';\r\nimport { getLanguageLabel, getAvailableLanguagesInfo } from './utils.js';\r\n\r\n// Note: The index.js files inside src/locales are dynamically generated\r\n// by the pullTranslations.sh script\r\nimport locales from './locales';\r\n\r\nfunction addLocales(newLocales) {\r\n  customDebug(`Adding locales ${newLocales}`, 'info');\r\n\r\n  let resourceBundle = [];\r\n\r\n  Object.keys(newLocales).map(key => {\r\n    Object.keys(newLocales[key]).map(namespace => {\r\n      const locale = newLocales[key][namespace];\r\n      resourceBundle.push({ key, namespace, locale });\r\n      i18n.addResourceBundle(key, namespace, locale, true, true);\r\n    });\r\n  });\r\n\r\n  customDebug(`Locales added successfully`, 'info');\r\n  customDebug(resourceBundle, 'info');\r\n}\r\n\r\n/*\r\n * Note: Developers can add the API key to use the\r\n * in-context editor using environment variables.\r\n * (DO NOT commit the API key)\r\n */\r\nconst locizeOptions = {\r\n  projectId: process.env.LOCIZE_PROJECTID,\r\n  apiKey: process.env.LOCIZE_API_KEY,\r\n  referenceLng: 'en-US',\r\n  fallbacklng: 'en-US',\r\n};\r\n\r\nconst envUseLocize = !!process.env.USE_LOCIZE;\r\nconst envApiKeyAvailable = !!process.env.LOCIZE_API_KEY;\r\nconst DEFAULT_LANGUAGE = 'en-US';\r\n\r\nfunction initI18n(\r\n  detection = detectionOptions,\r\n  useLocize = envUseLocize,\r\n  apiKeyAvailable = envApiKeyAvailable\r\n) {\r\n  let initialized;\r\n\r\n  if (useLocize) {\r\n    customDebug(`Using Locize for translation files`, 'info');\r\n    initialized = i18n\r\n      // i18next-locize-backend\r\n      // loads translations from your project, saves new keys to it (saveMissing: true)\r\n      // https://github.com/locize/i18next-locize-backend\r\n      .use(Backend)\r\n      // locize-lastused\r\n      // sets a timestamp of last access on every translation segment on locize\r\n      // -> safely remove the ones not being touched for weeks/months\r\n      // https://github.com/locize/locize-lastused\r\n      .use(LastUsed)\r\n      // locize-editor\r\n      // InContext Editor of locize ?locize=true to show it\r\n      // https://github.com/locize/locize-editor\r\n      .use(Editor)\r\n      // detect user language\r\n      // learn more: https://github.com/i18next/i18next-browser-languageDetector\r\n      .use(LanguageDetector)\r\n      // pass the i18n instance to react-i18next.\r\n      .use(initReactI18next)\r\n      // init i18next\r\n      // for all options read: https://www.i18next.com/overview/configuration-options\r\n      .init({\r\n        fallbackLng: DEFAULT_LANGUAGE,\r\n        saveMissing: apiKeyAvailable,\r\n        debug: debugMode,\r\n        keySeparator: false,\r\n        interpolation: {\r\n          escapeValue: false, // not needed for react as it escapes by default\r\n        },\r\n        detection,\r\n        backend: locizeOptions,\r\n        locizeLastUsed: locizeOptions,\r\n        editor: {\r\n          ...locizeOptions,\r\n          onEditorSaved: async (lng, ns) => {\r\n            // reload that namespace in given language\r\n            await i18n.reloadResources(lng, ns);\r\n            // trigger an event on i18n which triggers a rerender\r\n            // based on bindI18n below in react options\r\n            i18n.emit('editorSaved');\r\n          },\r\n        },\r\n        react: {\r\n          useSuspense: false, // TODO: Was seeing weird errors without this\r\n          wait: true,\r\n          bindI18n: 'languageChanged editorSaved',\r\n        },\r\n      });\r\n  } else {\r\n    customDebug(`Using local translation files`, 'info');\r\n    initialized = i18n\r\n      // detect user language\r\n      // learn more: https://github.com/i18next/i18next-browser-languageDetector\r\n      .use(LanguageDetector)\r\n      // pass the i18n instance to react-i18next.\r\n      .use(initReactI18next)\r\n      // init i18next\r\n      // for all options read: https://www.i18next.com/overview/configuration-options\r\n      .init({\r\n        fallbackLng: DEFAULT_LANGUAGE,\r\n        resources: locales,\r\n        debug: debugMode,\r\n        keySeparator: false,\r\n        interpolation: {\r\n          escapeValue: false, // not needed for react as it escapes by default\r\n        },\r\n        detection,\r\n        react: {\r\n          wait: true,\r\n        },\r\n      });\r\n  }\r\n\r\n  return initialized.then(function (t) {\r\n    i18n.T = t;\r\n    customDebug(`T function available.`, 'info');\r\n  });\r\n}\r\n\r\ncustomDebug(`version ${pkg.version} loaded.`, 'info');\r\n\r\ni18n.initializing = initI18n();\r\ni18n.initI18n = initI18n;\r\ni18n.addLocales = addLocales;\r\ni18n.availableLanguages = getAvailableLanguagesInfo(locales);\r\ni18n.defaultLanguage = { label: getLanguageLabel(DEFAULT_LANGUAGE), value: DEFAULT_LANGUAGE };\r\ni18n.currentLanguage = () => ({ label: getLanguageLabel(i18n.language), value: i18n.language });\r\n\r\nexport default i18n;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\n/**\r\n * Nests React components as ordered in array. We use this to\r\n * simplify composition a Mode specify's in it's configuration\r\n * for React Contexts that should wrap a Mode Route.\r\n */\r\nexport default function Compose(props) {\r\n  const { components = [], children } = props;\r\n\r\n  return (\r\n    <React.Fragment>\r\n      {components.reduceRight((acc, curr) => {\r\n        const [Comp, props] = Array.isArray(curr)\r\n          ? [curr[0], curr[1]]\r\n          : [curr, {}];\r\n        return <Comp {...props}>{acc}</Comp>;\r\n      }, children)}\r\n    </React.Fragment>\r\n  );\r\n}\r\n\r\n// https://juliuskoronci.medium.com/avoid-a-long-list-of-react-providers-c45a269d80c1\r\nCompose.propTypes = {\r\n  components: PropTypes.array,\r\n  children: PropTypes.node.isRequired,\r\n};\r\n","import React, { useState, createContext, useContext } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst appConfigContext = createContext(null);\r\nconst { Provider } = appConfigContext;\r\n\r\nexport const useAppConfig = () => useContext(appConfigContext);\r\n\r\nexport function AppConfigProvider({ children, value: initAppConfig }) {\r\n  const [appConfig, setAppConfig] = useState(initAppConfig);\r\n\r\n  return <Provider value={[appConfig]}>{children}</Provider>;\r\n}\r\n\r\nAppConfigProvider.propTypes = {\r\n  children: PropTypes.any,\r\n  value: PropTypes.any,\r\n};\r\n\r\nexport default AppConfigProvider;\r\n","/* eslint-disable react/jsx-props-no-spreading */\r\nimport React, { useEffect, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { MODULE_TYPES } from '@ohif/core';\r\n//\r\nimport { extensionManager } from '../App.jsx';\r\nimport { useParams, useLocation } from 'react-router';\r\n\r\n/**\r\n * Uses route properties to determine the data source that should be passed\r\n * to the child layout template. In some instances, initiates requests and\r\n * passes data as props.\r\n *\r\n * @param {object} props\r\n * @param {function} props.children - Layout Template React Component\r\n */\r\nfunction DataSourceWrapper(props) {\r\n  const { children: LayoutTemplate, ...rest } = props;\r\n  const params = useParams();\r\n  const location = useLocation();\r\n\r\n  // TODO: Fetch by type, name, etc?\r\n  const dataSourceModules = extensionManager.modules[MODULE_TYPES.DATA_SOURCE];\r\n  // TODO: Good usecase for flatmap?\r\n  const webApiDataSources = dataSourceModules.reduce((acc, curr) => {\r\n    const mods = [];\r\n    curr.module.forEach(mod => {\r\n      if (mod.type === 'webApi') {\r\n        mods.push(mod);\r\n      }\r\n    });\r\n    return acc.concat(mods);\r\n  }, []);\r\n\r\n  // Grabbing first for now - should get active?\r\n  const name = webApiDataSources[0].name;\r\n  // TODO: Why does this return an array?\r\n  const dataSource = extensionManager.getDataSources(name)[0]\r\n\r\n  // Route props --> studies.mapParams\r\n  // mapParams --> studies.search\r\n  // studies.search --> studies.processResults\r\n  // studies.processResults --> <LayoutTemplate studies={} />\r\n  // But only for LayoutTemplate type of 'list'?\r\n  // Or no data fetching here, and just hand down my source\r\n  const STUDIES_LIMIT = 101;\r\n  const [data, setData] = useState({\r\n    studies: [],\r\n    total: 0,\r\n    resultsPerPage: 25,\r\n    pageNumber: 1,\r\n    location: 'Not a valid location, causes first load to occur',\r\n  });\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const queryFilterValues = _getQueryFilterValues(\r\n      location.search,\r\n      STUDIES_LIMIT\r\n    );\r\n\r\n    // 204: no content\r\n    async function getData() {\r\n      setIsLoading(true);\r\n      const studies = await dataSource.query.studies.search(queryFilterValues);\r\n\r\n      setData({\r\n        studies: studies || [],\r\n        total: studies.length,\r\n        resultsPerPage: queryFilterValues.resultsPerPage,\r\n        pageNumber: queryFilterValues.pageNumber,\r\n        location,\r\n      });\r\n\r\n      setIsLoading(false);\r\n    }\r\n\r\n    try {\r\n      // Cache invalidation :thinking:\r\n      // - Anytime change is not just next/previous page\r\n      // - And we didn't cross a result offset range\r\n      const isSamePage = data.pageNumber === queryFilterValues.pageNumber;\r\n      const previousOffset =\r\n        Math.floor((data.pageNumber * data.resultsPerPage) / STUDIES_LIMIT) *\r\n        (STUDIES_LIMIT - 1);\r\n      const newOffset =\r\n        Math.floor(\r\n          (queryFilterValues.pageNumber * queryFilterValues.resultsPerPage) /\r\n          STUDIES_LIMIT\r\n        ) *\r\n        (STUDIES_LIMIT - 1);\r\n      const isLocationUpdated = data.location !== location;\r\n      const isDataInvalid = !isSamePage || !isLoading &&\r\n        (newOffset !== previousOffset || isLocationUpdated);\r\n\r\n      if (isDataInvalid) {\r\n        getData();\r\n      }\r\n    } catch (ex) {\r\n      console.warn(ex);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [data, location, params, isLoading, setIsLoading]);\r\n  // queryFilterValues\r\n\r\n  // TODO: Better way to pass DataSource?\r\n  return (\r\n    <LayoutTemplate\r\n      {...rest}\r\n      data={data.studies}\r\n      dataTotal={data.total}\r\n      dataSource={dataSource}\r\n      isLoadingData={isLoading}\r\n    />\r\n  );\r\n}\r\n\r\nDataSourceWrapper.propTypes = {\r\n  /** Layout Component to wrap with a Data Source */\r\n  children: PropTypes.oneOfType([PropTypes.element, PropTypes.func]).isRequired,\r\n};\r\n\r\nexport default DataSourceWrapper;\r\n\r\n/**\r\n * Duplicated in `workList`\r\n * Need generic that can be shared? Isn't this what qs is for?\r\n * @param {*} query\r\n */\r\nfunction _getQueryFilterValues(query, queryLimit) {\r\n  query = new URLSearchParams(query);\r\n\r\n  const pageNumber = _tryParseInt(query.get('pageNumber'), 1);\r\n  const resultsPerPage = _tryParseInt(query.get('resultsPerPage'), 25);\r\n\r\n  const queryFilterValues = {\r\n    // DCM\r\n    patientId: query.get('mrn'),\r\n    patientName: query.get('patientName'),\r\n    studyDescription: query.get('description'),\r\n    modalitiesInStudy:\r\n      query.get('modalities') && query.get('modalities').split(','),\r\n    accessionNumber: query.get('accession'),\r\n    //\r\n    startDate: query.get('startDate'),\r\n    endDate: query.get('endDate'),\r\n    page: _tryParseInt(query.get('page'), undefined),\r\n    pageNumber,\r\n    resultsPerPage,\r\n    // Rarely supported server-side\r\n    sortBy: query.get('sortBy'),\r\n    sortDirection: query.get('sortDirection'),\r\n    // Offset...\r\n    offset:\r\n      Math.floor((pageNumber * resultsPerPage) / queryLimit) * (queryLimit - 1),\r\n  };\r\n\r\n  // patientName: good\r\n  // studyDescription: good\r\n  // accessionNumber: good\r\n\r\n  // Delete null/undefined keys\r\n  Object.keys(queryFilterValues).forEach(\r\n    key => queryFilterValues[key] == null && delete queryFilterValues[key]\r\n  );\r\n\r\n  return queryFilterValues;\r\n\r\n  function _tryParseInt(str, defaultValue) {\r\n    var retValue = defaultValue;\r\n    if (str !== null) {\r\n      if (str.length > 0) {\r\n        if (!isNaN(str)) {\r\n          retValue = parseInt(str);\r\n        }\r\n      }\r\n    }\r\n    return retValue;\r\n  }\r\n}\r\n","const filtersMeta = [\r\n  {\r\n    name: 'patientName',\r\n    displayName: 'Patient Name',\r\n    inputType: 'Text',\r\n    isSortable: true,\r\n    gridCol: 4,\r\n  },\r\n  {\r\n    name: 'mrn',\r\n    displayName: 'MRN',\r\n    inputType: 'Text',\r\n    isSortable: true,\r\n    gridCol: 3,\r\n  },\r\n  {\r\n    name: 'studyDate',\r\n    displayName: 'Study date',\r\n    inputType: 'DateRange',\r\n    isSortable: true,\r\n    gridCol: 5,\r\n  },\r\n  {\r\n    name: 'description',\r\n    displayName: 'Description',\r\n    inputType: 'Text',\r\n    isSortable: true,\r\n    gridCol: 4,\r\n  },\r\n  {\r\n    name: 'modalities',\r\n    displayName: 'Modality',\r\n    inputType: 'MultiSelect',\r\n    inputProps: {\r\n      options: [\r\n        { value: 'AR', label: 'AR' },\r\n        { value: 'ASMT', label: 'ASMT' },\r\n        { value: 'AU', label: 'AU' },\r\n        { value: 'BDUS', label: 'BDUS' },\r\n        { value: 'BI', label: 'BI' },\r\n        { value: 'BMD', label: 'BMD' },\r\n        { value: 'CR', label: 'CR' },\r\n        { value: 'CT', label: 'CT' },\r\n        { value: 'CTPROTOCOL', label: 'CTPROTOCOL' },\r\n        { value: 'DG', label: 'DG' },\r\n        { value: 'DOC', label: 'DOC' },\r\n        { value: 'DX', label: 'DX' },\r\n        { value: 'ECG', label: 'ECG' },\r\n        { value: 'EPS', label: 'EPS' },\r\n        { value: 'ES', label: 'ES' },\r\n        { value: 'FID', label: 'FID' },\r\n        { value: 'GM', label: 'GM' },\r\n        { value: 'HC', label: 'HC' },\r\n        { value: 'HD', label: 'HD' },\r\n        { value: 'IO', label: 'IO' },\r\n        { value: 'IOL', label: 'IOL' },\r\n        { value: 'IVOCT', label: 'IVOCT' },\r\n        { value: 'IVUS', label: 'IVUS' },\r\n        { value: 'KER', label: 'KER' },\r\n        { value: 'KO', label: 'KO' },\r\n        { value: 'LEN', label: 'LEN' },\r\n        { value: 'LS', label: 'LS' },\r\n        { value: 'MG', label: 'MG' },\r\n        { value: 'MR', label: 'MR' },\r\n        { value: 'M3D', label: 'M3D' },\r\n        { value: 'NM', label: 'NM' },\r\n        { value: 'OAM', label: 'OAM' },\r\n        { value: 'OCT', label: 'OCT' },\r\n        { value: 'OP', label: 'OP' },\r\n        { value: 'OPM', label: 'OPM' },\r\n        { value: 'OPT', label: 'OPT' },\r\n        { value: 'OPTBSV', label: 'OPTBSV' },\r\n        { value: 'OPTENF', label: 'OPTENF' },\r\n        { value: 'OPV', label: 'OPV' },\r\n        { value: 'OSS', label: 'OSS' },\r\n        { value: 'OT', label: 'OT' },\r\n        { value: 'PLAN', label: 'PLAN' },\r\n        { value: 'PR', label: 'PR' },\r\n        { value: 'PT', label: 'PT' },\r\n        { value: 'PX', label: 'PX' },\r\n        { value: 'REG', label: 'REG' },\r\n        { value: 'RESP', label: 'RESP' },\r\n        { value: 'RF', label: 'RF' },\r\n        { value: 'RG', label: 'RG' },\r\n        { value: 'RTDOSE', label: 'RTDOSE' },\r\n        { value: 'RTIMAGE', label: 'RTIMAGE' },\r\n        { value: 'RTINTENT', label: 'RTINTENT' },\r\n        { value: 'RTPLAN', label: 'RTPLAN' },\r\n        { value: 'RTRAD', label: 'RTRAD' },\r\n        { value: 'RTRECORD', label: 'RTRECORD' },\r\n        { value: 'RTSEGANN', label: 'RTSEGANN' },\r\n        { value: 'RTSTRUCT', label: 'RTSTRUCT' },\r\n        { value: 'RWV', label: 'RWV' },\r\n        { value: 'SEG', label: 'SEG' },\r\n        { value: 'SM', label: 'SM' },\r\n        { value: 'SMR', label: 'SMR' },\r\n        { value: 'SR', label: 'SR' },\r\n        { value: 'SRF', label: 'SRF' },\r\n        { value: 'STAIN', label: 'STAIN' },\r\n        { value: 'TEXTUREMAP', label: 'TEXTUREMAP' },\r\n        { value: 'TG', label: 'TG' },\r\n        { value: 'US', label: 'US' },\r\n        { value: 'VA', label: 'VA' },\r\n        { value: 'XA', label: 'XA' },\r\n        { value: 'XC', label: 'XC' },\r\n      ],\r\n    },\r\n    isSortable: true,\r\n    gridCol: 3,\r\n  },\r\n  {\r\n    name: 'accession',\r\n    displayName: 'Accession',\r\n    inputType: 'Text',\r\n    isSortable: true,\r\n    gridCol: 3,\r\n  },\r\n  {\r\n    name: 'instances',\r\n    displayName: 'Instances',\r\n    inputType: 'None',\r\n    isSortable: false,\r\n    gridCol: 2,\r\n  },\r\n];\r\n\r\nexport default filtersMeta;\r\n","import { useState, useEffect } from 'react';\r\n\r\n/**\r\n * See: https://usehooks.com/useDebounce/\r\n *\r\n * @param {*} value\r\n * @param {number} delay - delat in ms\r\n */\r\nexport default function useDebounce(value, delay) {\r\n  // State and setters for debounced value\r\n  const [debouncedValue, setDebouncedValue] = useState(value);\r\n\r\n  useEffect(\r\n    () => {\r\n      // Update debounced value after delay\r\n      const handler = setTimeout(() => {\r\n        setDebouncedValue(value);\r\n      }, delay);\r\n\r\n      // Cancel the timeout if value changes (also on delay change or unmount)\r\n      // This is how we prevent debounced value from updating if value is changed ...\r\n      // .. within the delay period. Timeout gets cleared and restarted.\r\n      return () => {\r\n        clearTimeout(handler);\r\n      };\r\n    },\r\n    [value, delay] // Only re-call effect if value or delay changes\r\n  );\r\n\r\n  return debouncedValue;\r\n}\r\n","import { useLocation } from 'react-router-dom';\r\n\r\nexport default function useQuery() {\r\n  return new URLSearchParams(useLocation().search);\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport classnames from 'classnames';\r\nimport PropTypes from 'prop-types';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport moment from 'moment';\r\nimport qs from 'query-string';\r\nimport isEqual from 'lodash.isequal';\r\nimport { useTranslation } from 'react-i18next';\r\n//\r\nimport filtersMeta from './filtersMeta.js';\r\nimport { useAppConfig } from '@state';\r\nimport { useDebounce, useQuery } from '@hooks';\r\nimport { utils, hotkeys } from '@ohif/core';\r\n\r\nconst { sortBySeriesDate } = utils;\r\n\r\nimport {\r\n  Icon,\r\n  StudyListExpandedRow,\r\n  Button,\r\n  EmptyStudies,\r\n  StudyListTable,\r\n  StudyListPagination,\r\n  StudyListFilter,\r\n  TooltipClipboard,\r\n  Header,\r\n  useModal,\r\n  AboutModal,\r\n  UserPreferences,\r\n} from '@ohif/ui';\r\n\r\nimport i18n from '@ohif/i18n';\r\n\r\nconst { availableLanguages, defaultLanguage, currentLanguage } = i18n;\r\n\r\nconst seriesInStudiesMap = new Map();\r\n\r\n/**\r\n * TODO:\r\n * - debounce `setFilterValues` (150ms?)\r\n */\r\nfunction WorkList({\r\n  data: studies,\r\n  dataTotal: studiesTotal,\r\n  isLoadingData,\r\n  dataSource,\r\n  hotkeysManager,\r\n}) {\r\n  const { hotkeyDefinitions, hotkeyDefaults } = hotkeysManager;\r\n  const { show, hide } = useModal();\r\n  const { t } = useTranslation();\r\n  // ~ Modes\r\n  const [appConfig] = useAppConfig();\r\n  // ~ Filters\r\n  const query = useQuery();\r\n  const navigate = useNavigate();\r\n  const STUDIES_LIMIT = 101;\r\n  const queryFilterValues = _getQueryFilterValues(query);\r\n  const [filterValues, _setFilterValues] = useState({\r\n    ...defaultFilterValues,\r\n    ...queryFilterValues,\r\n  });\r\n\r\n  const debouncedFilterValues = useDebounce(filterValues, 200);\r\n  const { resultsPerPage, pageNumber, sortBy, sortDirection } = filterValues;\r\n\r\n  /*\r\n   * The default sort value keep the filters synchronized with runtime conditional sorting\r\n   * Only applied if no other sorting is specified and there are less than 101 studies\r\n   */\r\n\r\n  const canSort = studiesTotal < STUDIES_LIMIT;\r\n  const shouldUseDefaultSort = sortBy === '' || !sortBy;\r\n  const sortModifier = sortDirection === 'descending' ? 1 : -1;\r\n  const defaultSortValues =\r\n    shouldUseDefaultSort && canSort\r\n      ? { sortBy: 'studyDate', sortDirection: 'ascending' }\r\n      : {};\r\n  const sortedStudies = studies;\r\n\r\n  if (canSort) {\r\n    studies.sort((s1, s2) => {\r\n      if (shouldUseDefaultSort) {\r\n        const ascendingSortModifier = -1;\r\n        return _sortStringDates(s1, s2, ascendingSortModifier);\r\n      }\r\n\r\n      const s1Prop = s1[sortBy];\r\n      const s2Prop = s2[sortBy];\r\n\r\n      if (typeof s1Prop === 'string' && typeof s2Prop === 'string') {\r\n        return s1Prop.localeCompare(s2Prop) * sortModifier;\r\n      } else if (typeof s1Prop === 'number' && typeof s2Prop === 'number') {\r\n        return (s1Prop > s2Prop ? 1 : -1) * sortModifier;\r\n      } else if (!s1Prop && s2Prop) {\r\n        return -1 * sortModifier;\r\n      } else if (!s2Prop && s1Prop) {\r\n        return 1 * sortModifier;\r\n      } else if (sortBy === 'studyDate') {\r\n        return _sortStringDates(s1, s2, sortModifier);\r\n      }\r\n\r\n      return 0;\r\n    });\r\n  }\r\n\r\n  // ~ Rows & Studies\r\n  const [expandedRows, setExpandedRows] = useState([]);\r\n  const [studiesWithSeriesData, setStudiesWithSeriesData] = useState([]);\r\n  const numOfStudies = studiesTotal;\r\n\r\n  const setFilterValues = val => {\r\n    if (filterValues.pageNumber === val.pageNumber) {\r\n      val.pageNumber = 1;\r\n    }\r\n    _setFilterValues(val);\r\n    setExpandedRows([]);\r\n  };\r\n\r\n  const onPageNumberChange = newPageNumber => {\r\n    const oldPageNumber = filterValues.pageNumber;\r\n    const rollingPageNumberMod = Math.floor(101 / filterValues.resultsPerPage);\r\n    const rollingPageNumber = oldPageNumber % rollingPageNumberMod;\r\n    const isNextPage = newPageNumber > oldPageNumber;\r\n    const hasNextPage =\r\n      Math.max(rollingPageNumber, 1) * resultsPerPage < numOfStudies;\r\n\r\n    if (isNextPage && !hasNextPage) {\r\n      return;\r\n    }\r\n\r\n    setFilterValues({ ...filterValues, pageNumber: newPageNumber });\r\n  };\r\n\r\n  const onResultsPerPageChange = newResultsPerPage => {\r\n    setFilterValues({\r\n      ...filterValues,\r\n      pageNumber: 1,\r\n      resultsPerPage: Number(newResultsPerPage),\r\n    });\r\n  };\r\n\r\n  // Set body style\r\n  useEffect(() => {\r\n    document.body.classList.add('bg-black');\r\n    return () => {\r\n      document.body.classList.remove('bg-black');\r\n    };\r\n  }, []);\r\n\r\n  // Sync URL query parameters with filters\r\n  useEffect(() => {\r\n    if (!debouncedFilterValues) {\r\n      return;\r\n    }\r\n\r\n    const queryString = {};\r\n    Object.keys(defaultFilterValues).forEach(key => {\r\n      const defaultValue = defaultFilterValues[key];\r\n      const currValue = debouncedFilterValues[key];\r\n\r\n      // TODO: nesting/recursion?\r\n      if (key === 'studyDate') {\r\n        if (\r\n          currValue.startDate &&\r\n          defaultValue.startDate !== currValue.startDate\r\n        ) {\r\n          queryString.startDate = currValue.startDate;\r\n        }\r\n        if (currValue.endDate && defaultValue.endDate !== currValue.endDate) {\r\n          queryString.endDate = currValue.endDate;\r\n        }\r\n      } else if (key === 'modalities' && currValue.length) {\r\n        queryString.modalities = currValue.join(',');\r\n      } else if (currValue !== defaultValue) {\r\n        queryString[key] = currValue;\r\n      }\r\n    });\r\n\r\n    const search = qs.stringify(queryString, {\r\n      skipNull: true,\r\n      skipEmptyString: true,\r\n    });\r\n\r\n    navigate({\r\n      pathname: '/',\r\n      search: search ? `?${search}` : undefined,\r\n    });\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [debouncedFilterValues]);\r\n\r\n  // Query for series information\r\n  useEffect(() => {\r\n    const fetchSeries = async studyInstanceUid => {\r\n      try {\r\n        const series = await dataSource.query.series.search(studyInstanceUid);\r\n        seriesInStudiesMap.set(\r\n          studyInstanceUid,\r\n          sortBySeriesDate(series)\r\n        );\r\n        setStudiesWithSeriesData([...studiesWithSeriesData, studyInstanceUid]);\r\n      } catch (ex) {\r\n        // TODO: UI Notification Service\r\n        console.warn(ex);\r\n      }\r\n    };\r\n\r\n    // TODO: WHY WOULD YOU USE AN INDEX OF 1?!\r\n    // Note: expanded rows index begins at 1\r\n    for (let z = 0; z < expandedRows.length; z++) {\r\n      const expandedRowIndex = expandedRows[z] - 1;\r\n      const studyInstanceUid = sortedStudies[expandedRowIndex].studyInstanceUid;\r\n\r\n      if (studiesWithSeriesData.includes(studyInstanceUid)) {\r\n        continue;\r\n      }\r\n\r\n      fetchSeries(studyInstanceUid);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [expandedRows, studies]);\r\n\r\n  const isFiltering = (filterValues, defaultFilterValues) => {\r\n    return !isEqual(filterValues, defaultFilterValues);\r\n  };\r\n\r\n  const rollingPageNumberMod = Math.floor(101 / resultsPerPage);\r\n  const rollingPageNumber = (pageNumber - 1) % rollingPageNumberMod;\r\n  const offset = resultsPerPage * rollingPageNumber;\r\n  const offsetAndTake = offset + resultsPerPage;\r\n  const tableDataSource = sortedStudies.map((study, key) => {\r\n    const rowKey = key + 1;\r\n    const isExpanded = expandedRows.some(k => k === rowKey);\r\n    const {\r\n      studyInstanceUid,\r\n      accession,\r\n      modalities,\r\n      instances,\r\n      description,\r\n      mrn,\r\n      patientName,\r\n      date,\r\n      time,\r\n    } = study;\r\n    const studyDate =\r\n      date &&\r\n      moment(date, ['YYYYMMDD', 'YYYY.MM.DD'], true).isValid() &&\r\n      moment(date, ['YYYYMMDD', 'YYYY.MM.DD']).format('MMM-DD-YYYY');\r\n    const studyTime =\r\n      time &&\r\n      moment(time, ['HH', 'HHmm', 'HHmmss', 'HHmmss.SSS']).isValid() &&\r\n      moment(time, ['HH', 'HHmm', 'HHmmss', 'HHmmss.SSS']).format('hh:mm A');\r\n\r\n    return {\r\n      row: [\r\n        {\r\n          key: 'patientName',\r\n          content: patientName ? (\r\n            <TooltipClipboard>{patientName}</TooltipClipboard>\r\n          ) : (\r\n            <span className=\"text-gray-700\">(Empty)</span>\r\n          ),\r\n          gridCol: 4,\r\n        },\r\n        {\r\n          key: 'mrn',\r\n          content: <TooltipClipboard>{mrn}</TooltipClipboard>,\r\n          gridCol: 3,\r\n        },\r\n        {\r\n          key: 'studyDate',\r\n          content: (\r\n            <>\r\n              {studyDate && <span className=\"mr-4\">{studyDate}</span>}\r\n              {studyTime && <span>{studyTime}</span>}\r\n            </>\r\n          ),\r\n          title: `${studyDate || ''} ${studyTime || ''}`,\r\n          gridCol: 5,\r\n        },\r\n        {\r\n          key: 'description',\r\n          content: <TooltipClipboard>{description}</TooltipClipboard>,\r\n          gridCol: 4,\r\n        },\r\n        {\r\n          key: 'modality',\r\n          content: modalities,\r\n          title: modalities,\r\n          gridCol: 3,\r\n        },\r\n        {\r\n          key: 'accession',\r\n          content: <TooltipClipboard>{accession}</TooltipClipboard>,\r\n          gridCol: 3,\r\n        },\r\n        {\r\n          key: 'instances',\r\n          content: (\r\n            <>\r\n              <Icon\r\n                name=\"group-layers\"\r\n                className={classnames('inline-flex mr-2 w-4', {\r\n                  'text-primary-active': isExpanded,\r\n                  'text-secondary-light': !isExpanded,\r\n                })}\r\n              />\r\n              {instances}\r\n            </>\r\n          ),\r\n          title: (instances || 0).toString(),\r\n          gridCol: 4,\r\n        },\r\n      ],\r\n      expandedContent: (\r\n        <StudyListExpandedRow\r\n          seriesTableColumns={{\r\n            description: 'Description',\r\n            seriesNumber: 'Series',\r\n            modality: 'Modality',\r\n            instances: 'Instances',\r\n          }}\r\n          seriesTableDataSource={\r\n            seriesInStudiesMap.has(studyInstanceUid)\r\n              ? seriesInStudiesMap.get(studyInstanceUid).map(s => {\r\n                  return {\r\n                    description: s.description || '(empty)',\r\n                    seriesNumber: s.seriesNumber || '',\r\n                    modality: s.modality || '',\r\n                    instances: s.numSeriesInstances || '',\r\n                  };\r\n                })\r\n              : []\r\n          }\r\n        >\r\n          {appConfig.modes.map((mode, i) => {\r\n            const isFirst = i === 0;\r\n\r\n            const isValidMode = mode.isValidMode({ modalities })\r\n            // TODO: Modes need a default/target route? We mostly support a single one for now.\r\n            // We should also be using the route path, but currently are not\r\n            // mode.id\r\n            // mode.routes[x].path\r\n            // Don't specify default data source, and it should just be picked up... (this may not currently be the case)\r\n            // How do we know which params to pass? Today, it's just StudyInstanceUIDs\r\n            return (\r\n              <Link\r\n                key={i}\r\n                to={`${mode.id}?StudyInstanceUIDs=${studyInstanceUid}`}\r\n                // to={`${mode.id}/dicomweb?StudyInstanceUIDs=${studyInstanceUid}`}\r\n              >\r\n                <Button\r\n                  rounded=\"full\"\r\n                  variant={isValidMode ? \"contained\" : \"disabled\"}\r\n                  disabled={!isValidMode}\r\n                  endIcon={<Icon name=\"launch-arrow\" />} // launch-arrow | launch-info\r\n                  className={classnames('font-bold', { 'ml-2': !isFirst })}\r\n                  onClick={() => {}}\r\n                >\r\n                  {t(`Modes:${mode.displayName}`)}\r\n                </Button>\r\n              </Link>\r\n            );\r\n          })}\r\n        </StudyListExpandedRow>\r\n      ),\r\n      onClickRow: () =>\r\n        setExpandedRows(s =>\r\n          isExpanded ? s.filter(n => rowKey !== n) : [...s, rowKey]\r\n        ),\r\n      isExpanded,\r\n    };\r\n  });\r\n\r\n  const hasStudies = numOfStudies > 0;\r\n  const versionNumber = process.env.VERSION_NUMBER;\r\n  const buildNumber = process.env.BUILD_NUM;\r\n\r\n  const menuOptions = [\r\n    {\r\n      title: t('Header:About'),\r\n      icon: 'info',\r\n      onClick: () => show({ content: AboutModal, title: 'About OHIF Viewer', contentProps: { versionNumber, buildNumber } }),\r\n    },\r\n    {\r\n      title: t('Header:Preferences'),\r\n      icon: 'settings',\r\n      onClick: () =>\r\n        show({\r\n          title: t('UserPreferencesModal:User Preferences'),\r\n          content: UserPreferences,\r\n          contentProps: {\r\n            hotkeyDefaults: hotkeysManager.getValidHotkeyDefinitions(\r\n              hotkeyDefaults\r\n            ),\r\n            hotkeyDefinitions,\r\n            onCancel: hide,\r\n            currentLanguage: currentLanguage(),\r\n            availableLanguages,\r\n            defaultLanguage,\r\n            onSubmit: (state) => {\r\n              i18n.changeLanguage(state.language.value);\r\n              hotkeysManager.setHotkeys(state.hotkeyDefinitions);\r\n              hide();\r\n            },\r\n            onReset: () => hotkeysManager.restoreDefaultBindings(),\r\n            hotkeysModule: hotkeys\r\n          },\r\n        }),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div\r\n      className={classnames('bg-black h-full', {\r\n        'h-screen': !hasStudies,\r\n      })}\r\n    >\r\n      <Header isSticky menuOptions={menuOptions} isReturnEnabled={false} WhiteLabeling={appConfig.whiteLabeling} />\r\n      <StudyListFilter\r\n        numOfStudies={pageNumber * resultsPerPage > 100 ? 101 : numOfStudies}\r\n        filtersMeta={filtersMeta}\r\n        filterValues={{ ...filterValues, ...defaultSortValues }}\r\n        onChange={setFilterValues}\r\n        clearFilters={() => setFilterValues(defaultFilterValues)}\r\n        isFiltering={isFiltering(filterValues, defaultFilterValues)}\r\n      />\r\n      {hasStudies ? (\r\n        <>\r\n          <StudyListTable\r\n            tableDataSource={tableDataSource.slice(offset, offsetAndTake)}\r\n            numOfStudies={numOfStudies}\r\n            filtersMeta={filtersMeta}\r\n          />\r\n          <StudyListPagination\r\n            onChangePage={onPageNumberChange}\r\n            onChangePerPage={onResultsPerPageChange}\r\n            currentPage={pageNumber}\r\n            perPage={resultsPerPage}\r\n          />\r\n        </>\r\n      ) : (\r\n        <div className=\"flex flex-col items-center justify-center pt-48\">\r\n          <EmptyStudies isLoading={isLoadingData} />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nWorkList.propTypes = {\r\n  data: PropTypes.array.isRequired,\r\n  dataSource: PropTypes.shape({\r\n    query: PropTypes.object.isRequired,\r\n  }).isRequired,\r\n  isLoadingData: PropTypes.bool.isRequired,\r\n};\r\n\r\nconst defaultFilterValues = {\r\n  patientName: '',\r\n  mrn: '',\r\n  studyDate: {\r\n    startDate: null,\r\n    endDate: null,\r\n  },\r\n  description: '',\r\n  modalities: [],\r\n  accession: '',\r\n  sortBy: '',\r\n  sortDirection: 'none',\r\n  pageNumber: 1,\r\n  resultsPerPage: 25,\r\n};\r\n\r\nfunction _tryParseInt(str, defaultValue) {\r\n  var retValue = defaultValue;\r\n  if (str !== null) {\r\n    if (str.length > 0) {\r\n      if (!isNaN(str)) {\r\n        retValue = parseInt(str);\r\n      }\r\n    }\r\n  }\r\n  return retValue;\r\n}\r\n\r\nfunction _getQueryFilterValues(query) {\r\n  const queryFilterValues = {\r\n    patientName: query.get('patientName'),\r\n    mrn: query.get('mrn'),\r\n    studyDate: {\r\n      startDate: query.get('startDate'),\r\n      endDate: query.get('endDate'),\r\n    },\r\n    description: query.get('description'),\r\n    modalities: query.get('modalities')\r\n      ? query.get('modalities').split(',')\r\n      : [],\r\n    accession: query.get('accession'),\r\n    sortBy: query.get('sortBy'),\r\n    sortDirection: query.get('sortDirection'),\r\n    pageNumber: _tryParseInt(query.get('pageNumber'), undefined),\r\n    resultsPerPage: _tryParseInt(query.get('resultsPerPage'), undefined),\r\n  };\r\n\r\n  // Delete null/undefined keys\r\n  Object.keys(queryFilterValues).forEach(\r\n    key => queryFilterValues[key] == null && delete queryFilterValues[key]\r\n  );\r\n\r\n  return queryFilterValues;\r\n}\r\n\r\nfunction _sortStringDates(s1, s2, sortModifier) {\r\n  // TODO: Delimiters are non-standard. Should we support them?\r\n  const s1Date = moment(s1.date, ['YYYYMMDD', 'YYYY.MM.DD'], true);\r\n  const s2Date = moment(s2.date, ['YYYYMMDD', 'YYYY.MM.DD'], true);\r\n\r\n  if (s1Date.isValid() && s2Date.isValid()) {\r\n    return (\r\n      (s1Date.toISOString() > s2Date.toISOString() ? 1 : -1) * sortModifier\r\n    );\r\n  } else if (s1Date.isValid()) {\r\n    return sortModifier;\r\n  } else if (s2Date.isValid()) {\r\n    return -1 * sortModifier;\r\n  }\r\n}\r\n\r\nexport default WorkList;\r\n","export default class FileLoader {\r\n  fileType;\r\n  loadFile(file, imageId) { }\r\n  getDataset(image, imageId) { }\r\n  getStudies(dataset, imageId) { }\r\n}\r\n","import cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\r\nimport FileLoader from './fileLoader';\r\n\r\nconst PDFFileLoader = new (class extends FileLoader {\r\n  fileType = 'application/pdf';\r\n  loadFile(file, imageId) {\r\n    return cornerstoneWADOImageLoader.wadouri.loadFileRequest(imageId);\r\n  }\r\n\r\n  getDataset(image, imageId) {\r\n    const dataset = {};\r\n    dataset.imageId = image.imageId || imageId;\r\n    return dataset;\r\n  }\r\n})();\r\n\r\nexport default PDFFileLoader;\r\n","import dcmjs from 'dcmjs';\r\nimport cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\r\nimport FileLoader from './fileLoader';\r\n\r\nconst DICOMFileLoader = new (class extends FileLoader {\r\n  fileType = 'application/dicom';\r\n  loadFile(file, imageId) {\r\n    return cornerstoneWADOImageLoader.wadouri.loadFileRequest(imageId);\r\n  }\r\n\r\n  getDataset(image, imageId) {\r\n    const dicomData = dcmjs.data.DicomMessage.readFile(image);\r\n\r\n    const dataset = dcmjs.data.DicomMetaDictionary.naturalizeDataset(\r\n      dicomData.dict\r\n    );\r\n\r\n    dataset.url = imageId;\r\n\r\n    dataset._meta = dcmjs.data.DicomMetaDictionary.namifyDataset(\r\n      dicomData.meta\r\n    );\r\n\r\n    return dataset;\r\n  }\r\n})();\r\n\r\nexport default DICOMFileLoader;\r\n","import cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\r\nimport { DicomMetadataStore } from '@ohif/core';\r\n\r\nimport FileLoader from './fileLoader';\r\nimport PDFFileLoader from './pdfFileLoader';\r\nimport DICOMFileLoader from './dicomFileLoader';\r\n\r\nclass FileLoaderService extends FileLoader {\r\n  fileType;\r\n  loader;\r\n  constructor(file) {\r\n    super();\r\n    const fileType = file && file.type;\r\n    this.loader = this.getLoader(fileType);\r\n    this.fileType = this.loader.fileType;\r\n  }\r\n\r\n  addFile(file) {\r\n    return cornerstoneWADOImageLoader.wadouri.fileManager.add(file);\r\n  }\r\n\r\n  loadFile(file, imageId) {\r\n    return this.loader.loadFile(file, imageId);\r\n  }\r\n\r\n  getDataset(image, imageId) {\r\n    return this.loader.getDataset(image, imageId);\r\n  }\r\n\r\n  getLoader(fileType) {\r\n    if (fileType === 'application/pdf') {\r\n      return PDFFileLoader;\r\n    } else {\r\n      // Default to dicom loader\r\n      return DICOMFileLoader;\r\n    }\r\n  }\r\n}\r\n\r\nexport default FileLoaderService;\r\n","import FileLoaderService from './fileLoaderService';\r\nimport { DicomMetadataStore } from '@ohif/core';\r\n\r\nconst processFile = async file => {\r\n  try {\r\n    const fileLoaderService = new FileLoaderService(file);\r\n    const imageId = fileLoaderService.addFile(file);\r\n    const image = await fileLoaderService.loadFile(file, imageId);\r\n    const dicomJSONDataset = await fileLoaderService.getDataset(image, imageId);\r\n\r\n    DicomMetadataStore.addInstance(dicomJSONDataset);\r\n  } catch (error) {\r\n    console.log(\r\n      error.name,\r\n      ':Error when trying to load and process local files:',\r\n      error.message\r\n    );\r\n  }\r\n};\r\n\r\nexport default async function filesToStudies(files) {\r\n  const processFilesPromises = files.map(processFile);\r\n  await Promise.all(processFilesPromises);\r\n\r\n  return DicomMetadataStore.getStudyInstanceUIDs();\r\n}\r\n","import React, { useEffect, useRef } from 'react'\r\nimport classnames from 'classnames'\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { MODULE_TYPES } from '@ohif/core'\r\n\r\nimport Dropzone from 'react-dropzone'\r\nimport filesToStudies from './filesToStudies'\r\n\r\nimport { extensionManager } from '../../App.jsx'\r\n\r\nimport { Icon, Button } from '@ohif/ui'\r\n\r\nconst getLoadButton = (onDrop, text, isDir) => {\r\n  return (\r\n    <Dropzone onDrop={onDrop} noDrag>\r\n      {({ getRootProps, getInputProps }) => (\r\n        <div {...getRootProps()}>\r\n          <Button\r\n            rounded=\"full\"\r\n            variant=\"contained\" // outlined\r\n            disabled={false}\r\n            endIcon={<Icon name=\"launch-arrow\" />} // launch-arrow | launch-info\r\n            className={classnames('font-bold', 'ml-2')}\r\n            onClick={() => { }}\r\n          >\r\n            {text}\r\n            {isDir ? (\r\n              <input\r\n                {...getInputProps()}\r\n                webkitdirectory=\"true\"\r\n                mozdirectory=\"true\"\r\n              />\r\n            ) : (\r\n              <input {...getInputProps()} />\r\n            )}\r\n          </Button>\r\n        </div>\r\n      )}\r\n    </Dropzone>)\r\n}\r\n\r\nfunction Local() {\r\n  const navigate = useNavigate();\r\n  const dropzoneRef = useRef()\r\n\r\n  // Initializing the dicom local dataSource\r\n  const dataSourceModules = extensionManager.modules[MODULE_TYPES.DATA_SOURCE]\r\n  const localDataSources = dataSourceModules.reduce((acc, curr) => {\r\n    const mods = []\r\n    curr.module.forEach((mod) => {\r\n      if (mod.type === 'localApi') {\r\n        mods.push(mod)\r\n      }\r\n    })\r\n    return acc.concat(mods)\r\n  }, [])\r\n\r\n  const firstLocalDataSource = localDataSources[0]\r\n  const dataSource = firstLocalDataSource.createDataSource({})\r\n\r\n  const onDrop = async (acceptedFiles) => {\r\n    const studies = await filesToStudies(acceptedFiles, dataSource)\r\n    // Todo: navigate to work list and let user select a mode\r\n    navigate(`/viewer/dicomlocal?StudyInstanceUIDs=${studies[0]}`)\r\n  }\r\n\r\n  // Set body style\r\n  useEffect(() => {\r\n    document.body.classList.add('bg-black')\r\n    return () => {\r\n      document.body.classList.remove('bg-black')\r\n    }\r\n  }, [])\r\n\r\n  return (\r\n    <Dropzone ref={dropzoneRef} onDrop={onDrop} noClick>\r\n      {({ getRootProps }) => (\r\n        <div {...getRootProps()} style={{ width: '100%', height: '100%' }}>\r\n          <div className=\"h-screen w-screen flex justify-center items-center \">\r\n            <div className=\"py-8 px-8 mx-auto bg-secondary-dark shadow-md space-y-2 rounded-lg\">\r\n              <img\r\n                className=\"block mx-auto h-10\"\r\n                src=\"./customLogo.svg\"\r\n                alt=\"OHIF\"\r\n              />\r\n              <div className=\"text-center space-y-2 pt-4\">\r\n                <div className=\"space-y-2\">\r\n                  <p className=\"text-blue-300 text-base\">\r\n                    Note: You data is not uploaded to any server, it will stay\r\n                    in your local browser application\r\n                  </p>\r\n                  <p className=\"text-xg text-primary-active font-semibold pt-8\">\r\n                    Drag and Drop DICOM files here to load them in the Viewer\r\n                  </p>\r\n                  <p className=\"text-blue-300 text-lg\">Or click to </p>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex justify-around pt-4\">\r\n                {getLoadButton(onDrop, 'Load files', false)}\r\n                {getLoadButton(onDrop, 'Load folders', true)}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </Dropzone>\r\n  )\r\n}\r\n\r\nexport default Local\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Link } from 'react-router-dom';\r\n\r\nconst NotFound = ({\r\n  message = 'Sorry, this page does not exist.',\r\n  showGoBackButton = true,\r\n}) => {\r\n  return (\r\n    <div className=\"w-full h-full flex justify-center items-center text-white\">\r\n      <div>\r\n        <h4>{message}</h4>\r\n        {showGoBackButton && (\r\n          <h5>\r\n            <Link to={'/'}>Go back to the Study List</Link>\r\n          </h5>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nNotFound.propTypes = {\r\n  message: PropTypes.string,\r\n  showGoBackButton: PropTypes.bool,\r\n};\r\n\r\nexport default NotFound;\r\n","import React from 'react';\r\n\r\nfunction EmptyViewport() {\r\n  return <div></div>;\r\n}\r\n\r\nexport default EmptyViewport;\r\n","/**\r\n * CSS Grid Reference: http://grid.malven.co/\r\n */\r\nimport React, { useEffect, useCallback } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ViewportGrid, ViewportPane, useViewportGrid } from '@ohif/ui';\r\nimport EmptyViewport from './EmptyViewport';\r\nimport classNames from 'classnames';\r\n\r\nfunction ViewerViewportGrid(props) {\r\n  const { servicesManager, viewportComponents, dataSource } = props;\r\n  const [viewportGrid, viewportGridService] = useViewportGrid();\r\n\r\n  const {\r\n    numCols,\r\n    numRows,\r\n    activeViewportIndex,\r\n    viewports,\r\n    cachedLayout,\r\n  } = viewportGrid;\r\n\r\n  // TODO -> Need some way of selecting which displaySets hit the viewports.\r\n  const {\r\n    DisplaySetService,\r\n    MeasurementService,\r\n    HangingProtocolService,\r\n  } = servicesManager.services;\r\n\r\n\r\n  const updateDisplaysetForViewports = useCallback(\r\n    (displaySets) => {\r\n      const [\r\n        matchDetails,\r\n        hpAlreadyApplied,\r\n      ] = HangingProtocolService.getState();\r\n\r\n      if (!matchDetails.length) return;\r\n      // Match each viewport individually\r\n\r\n      const numViewports = viewportGrid.numRows * viewportGrid.numCols;\r\n      for (let i = 0; i < numViewports; i++) {\r\n        if (hpAlreadyApplied[i] === true) {\r\n          continue;\r\n        }\r\n\r\n        // if current viewport doesn't have a match\r\n        if (matchDetails[i] === undefined) return\r\n\r\n        const { SeriesInstanceUID } = matchDetails[i];\r\n        const matchingDisplaySet = displaySets.find(ds => {\r\n          return ds.SeriesInstanceUID === SeriesInstanceUID;\r\n        });\r\n\r\n        if (!matchingDisplaySet) {\r\n          continue;\r\n        }\r\n\r\n        viewportGridService.setDisplaysetForViewport({\r\n          viewportIndex: i,\r\n          displaySetInstanceUID: matchingDisplaySet.displaySetInstanceUID,\r\n        });\r\n\r\n        HangingProtocolService.setHangingProtocolAppliedForViewport(i);\r\n      }\r\n    },\r\n    [viewportGrid, numRows, numCols],\r\n  )\r\n\r\n  // Using Hanging protocol engine to match the displaySets\r\n  useEffect(() => {\r\n    const { unsubscribe } = DisplaySetService.subscribe(\r\n      DisplaySetService.EVENTS.DISPLAY_SETS_ADDED,\r\n      eventData => {\r\n        const { displaySetsAdded } = eventData;\r\n        updateDisplaysetForViewports(displaySetsAdded)\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [viewportGrid]);\r\n\r\n\r\n\r\n  // Changing the Hanging protocol while viewing\r\n  useEffect(() => {\r\n    const displaySets = DisplaySetService.getActiveDisplaySets();\r\n    updateDisplaysetForViewports(displaySets)\r\n  }, [viewportGrid])\r\n\r\n\r\n\r\n\r\n  // Layout change based on hanging protocols\r\n  useEffect(() => {\r\n    const { unsubscribe } = HangingProtocolService.subscribe(\r\n      HangingProtocolService.EVENTS.NEW_LAYOUT,\r\n      ({ numRows, numCols }) => {\r\n        viewportGridService.setLayout({ numRows, numCols });\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [viewports]);\r\n\r\n\r\n  useEffect(() => {\r\n    const { unsubscribe } = MeasurementService.subscribe(\r\n      MeasurementService.EVENTS.JUMP_TO_MEASUREMENT,\r\n      ({ viewportIndex, measurement }) => {\r\n        const referencedDisplaySetInstanceUID =\r\n          measurement.displaySetInstanceUID;\r\n\r\n        const viewportsDisplaySetInstanceUIDs = viewports.map(\r\n          vp => vp.displaySetInstanceUID\r\n        );\r\n\r\n        // if we already have the displayset in one of the viewports\r\n        if (\r\n          viewportsDisplaySetInstanceUIDs.indexOf(\r\n            referencedDisplaySetInstanceUID\r\n          ) > -1\r\n        ) {\r\n          return;\r\n        }\r\n\r\n        // If not in any of the viewports, hang it inside the active viewport\r\n        viewportGridService.setDisplaysetForViewport({\r\n          viewportIndex,\r\n          displaySetInstanceUID: referencedDisplaySetInstanceUID,\r\n        });\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [viewports]);\r\n\r\n  const onDoubleClick = viewportIndex => {\r\n    // TODO -> Disabled for now.\r\n    // onNewImage on a cornerstone viewport is firing setDisplaySetForViewport.\r\n    // Which it really really shouldn't. We need a larger fix for jump to\r\n    // measurements and all cornerstone \"imageIndex\" state to fix this.\r\n    if (cachedLayout) {\r\n      viewportGridService.set({\r\n        numCols: cachedLayout.numCols,\r\n        numRows: cachedLayout.numRows,\r\n        activeViewportIndex: cachedLayout.activeViewportIndex,\r\n        viewports: cachedLayout.viewports,\r\n        cachedLayout: null,\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    const cachedViewports = viewports.map(viewport => {\r\n      return {\r\n        displaySetInstanceUID: viewport.displaySetInstanceUID,\r\n      };\r\n    });\r\n\r\n    viewportGridService.set({\r\n      numCols: 1,\r\n      numRows: 1,\r\n      activeViewportIndex: 0,\r\n      viewports: [\r\n        {\r\n          displaySetInstanceUID: viewports[viewportIndex].displaySetInstanceUID,\r\n          imageIndex: undefined,\r\n        },\r\n      ],\r\n      cachedLayout: {\r\n        numCols,\r\n        numRows,\r\n        viewports: cachedViewports,\r\n        activeViewportIndex: viewportIndex,\r\n      },\r\n    });\r\n  };\r\n\r\n  const onDropHandler = (viewportIndex, { displaySetInstanceUID }) => {\r\n    viewportGridService.setDisplaysetForViewport({\r\n      viewportIndex,\r\n      displaySetInstanceUID,\r\n    });\r\n  };\r\n\r\n  const getViewportPanes = () => {\r\n    const viewportPanes = [];\r\n    const numViewportPanes = numCols * numRows;\r\n\r\n    for (let i = 0; i < numViewportPanes; i++) {\r\n      const viewportIndex = i;\r\n      const isActive = activeViewportIndex === viewportIndex;\r\n      const paneMetadata = viewports[i] || {};\r\n      const { displaySetInstanceUID } = paneMetadata;\r\n\r\n      const displaySet =\r\n        DisplaySetService.getDisplaySetByUID(displaySetInstanceUID) || {};\r\n\r\n      const ViewportComponent = _getViewportComponent(\r\n        displaySet.SOPClassHandlerId,\r\n        viewportComponents\r\n      );\r\n\r\n      const onInterationHandler = event => {\r\n        if (isActive) return;\r\n\r\n        if (event) {\r\n          event.preventDefault();\r\n          event.stopPropagation();\r\n        }\r\n\r\n        viewportGridService.setActiveViewportIndex(viewportIndex);\r\n      };\r\n\r\n      // TEMP -> Double click disabled for now\r\n      // onDoubleClick={() => onDoubleClick(viewportIndex)}\r\n\r\n      viewportPanes[i] = (\r\n        <ViewportPane\r\n          key={viewportIndex}\r\n          className=\"m-1\"\r\n          acceptDropsFor=\"displayset\"\r\n          onDrop={onDropHandler.bind(null, viewportIndex)}\r\n          onInteraction={onInterationHandler}\r\n          isActive={isActive}\r\n        >\r\n          <div\r\n            className={classNames('h-full w-full flex flex-col', {\r\n              'pointer-events-none': !isActive,\r\n            })}\r\n          >\r\n            <ViewportComponent\r\n              displaySet={displaySet}\r\n              viewportIndex={viewportIndex}\r\n              dataSource={dataSource}\r\n            />\r\n          </div>\r\n        </ViewportPane>\r\n      );\r\n    }\r\n\r\n    return viewportPanes;\r\n  };\r\n\r\n  if (!numCols || !numCols) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <ViewportGrid numRows={numRows} numCols={numCols}>\r\n      {/* {ViewportPanes} */}\r\n      {getViewportPanes()}\r\n    </ViewportGrid>\r\n  );\r\n}\r\n\r\nViewerViewportGrid.propTypes = {\r\n  viewportComponents: PropTypes.array.isRequired,\r\n};\r\n\r\nViewerViewportGrid.defaultProps = {\r\n  viewportComponents: [],\r\n};\r\n\r\nfunction _getViewportComponent(SOPClassHandlerId, viewportComponents) {\r\n  if (!SOPClassHandlerId) {\r\n    return EmptyViewport;\r\n  }\r\n\r\n  for (let i = 0; i < viewportComponents.length; i++) {\r\n    if (\r\n      viewportComponents[i].displaySetsToDisplay.includes(SOPClassHandlerId)\r\n    ) {\r\n      const { component } = viewportComponents[i];\r\n      return component;\r\n    }\r\n  }\r\n}\r\n\r\nexport default ViewerViewportGrid;\r\n","import React, { useEffect, useState, useRef } from 'react';\r\nimport { useParams, useLocation } from 'react-router';\r\nimport PropTypes from 'prop-types';\r\n// TODO: DicomMetadataStore should be injected?\r\nimport { DicomMetadataStore } from '@ohif/core';\r\nimport { DragAndDropProvider, ImageViewerProvider } from '@ohif/ui';\r\nimport { useQuery } from '@hooks';\r\nimport ViewportGrid from '@components/ViewportGrid';\r\nimport Compose from './Compose';\r\n\r\nasync function defaultRouteInit({\r\n  servicesManager,\r\n  studyInstanceUIDs,\r\n  dataSource,\r\n}) {\r\n  const {\r\n    DisplaySetService,\r\n    HangingProtocolService,\r\n  } = servicesManager.services;\r\n\r\n  const unsubscriptions = [];\r\n  // TODO: This should be baked into core, not manual?\r\n  // DisplaySetService would wire this up?\r\n  const {\r\n    unsubscribe: instanceAddedUnsubscribe,\r\n  } = DicomMetadataStore.subscribe(\r\n    DicomMetadataStore.EVENTS.INSTANCES_ADDED,\r\n    ({ StudyInstanceUID, SeriesInstanceUID, madeInClient = false }) => {\r\n      const seriesMetadata = DicomMetadataStore.getSeries(\r\n        StudyInstanceUID,\r\n        SeriesInstanceUID\r\n      );\r\n\r\n      DisplaySetService.makeDisplaySets(seriesMetadata.instances, madeInClient);\r\n    }\r\n  );\r\n\r\n  unsubscriptions.push(instanceAddedUnsubscribe);\r\n\r\n  const { unsubscribe: seriesAddedUnsubscribe } = DicomMetadataStore.subscribe(\r\n    DicomMetadataStore.EVENTS.SERIES_ADDED,\r\n    ({ StudyInstanceUID, madeInClient }) => {\r\n      const studyMetadata = DicomMetadataStore.getStudy(StudyInstanceUID);\r\n      if (!madeInClient) {\r\n        HangingProtocolService.run(studyMetadata);\r\n      }\r\n    }\r\n  );\r\n  unsubscriptions.push(seriesAddedUnsubscribe);\r\n\r\n  studyInstanceUIDs.forEach(StudyInstanceUID => {\r\n    dataSource.retrieveSeriesMetadata({ StudyInstanceUID });\r\n  });\r\n\r\n  return unsubscriptions;\r\n}\r\n\r\nexport default function ModeRoute({\r\n  mode,\r\n  dataSourceName,\r\n  extensionManager,\r\n  servicesManager,\r\n  hotkeysManager,\r\n}) {\r\n  // Parse route params/querystring\r\n  const location = useLocation();\r\n  const query = useQuery();\r\n  const params = useParams();\r\n\r\n  const [studyInstanceUIDs, setStudyInstanceUIDs] = useState();\r\n\r\n  const [refresh, setRefresh] = useState(false);\r\n  const layoutTemplateData = useRef(false);\r\n  const locationRef = useRef(null);\r\n  const isMounted = useRef(false);\r\n\r\n  if (location !== locationRef.current) {\r\n    layoutTemplateData.current = null;\r\n    locationRef.current = location;\r\n  }\r\n\r\n  const {\r\n    DisplaySetService,\r\n    HangingProtocolService,\r\n    UserAuthenticationService,\r\n  } = servicesManager.services;\r\n\r\n  const { extensions, sopClassHandlers, hotkeys, hangingProtocols } = mode;\r\n\r\n  if (dataSourceName === undefined) {\r\n    dataSourceName = extensionManager.defaultDataSourceName;\r\n  }\r\n\r\n  extensionManager.setActiveDataSource(dataSourceName);\r\n\r\n  const dataSources = extensionManager.getActiveDataSource();\r\n\r\n  // Only handling one instance of the datasource type (E.g. one DICOMWeb server)\r\n  const dataSource = dataSources[0];\r\n  // Only handling one route per mode for now\r\n  const route = mode.routes[0];\r\n\r\n  const layoutTemplateRouteData = route.layoutTemplate({ location });\r\n  const layoutTemplateModuleEntry = extensionManager.getModuleEntry(\r\n    layoutTemplateRouteData.id\r\n  );\r\n  const LayoutComponent = layoutTemplateModuleEntry.component;\r\n\r\n  // For each extension, look up their context modules\r\n  // TODO: move to extension manager.\r\n  let contextModules = [];\r\n  extensions.forEach(extensionId => {\r\n    const allRegisteredModuleIds = Object.keys(extensionManager.modulesMap);\r\n    const moduleIds = allRegisteredModuleIds.filter(id =>\r\n      id.includes(`${extensionId}.contextModule.`)\r\n    );\r\n\r\n    if (!moduleIds || !moduleIds.length) {\r\n      return;\r\n    }\r\n\r\n    const modules = moduleIds.map(extensionManager.getModuleEntry);\r\n    contextModules = contextModules.concat(modules);\r\n  });\r\n\r\n  const contextModuleProviders = contextModules.map(a => a.provider);\r\n  const CombinedContextProvider = ({ children }) =>\r\n    Compose({ components: contextModuleProviders, children });\r\n\r\n  function ViewportGridWithDataSource(props) {\r\n    return ViewportGrid({ ...props, dataSource });\r\n  }\r\n\r\n  useEffect(() => {\r\n    // Preventing state update for unmounted component\r\n    isMounted.current = true;\r\n    return () => {\r\n      isMounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    // Todo: this should not be here, data source should not care about params\r\n    const initializeDataSource = async (params, query) => {\r\n      const studyInstanceUIDs = await dataSource.initialize({\r\n        params,\r\n        query,\r\n      });\r\n      setStudyInstanceUIDs(studyInstanceUIDs);\r\n    };\r\n\r\n    initializeDataSource(params, query);\r\n    return () => {\r\n      layoutTemplateData.current = null;\r\n    };\r\n  }, [location]);\r\n\r\n  useEffect(() => {\r\n    const retrieveLayoutData = async () => {\r\n      const layoutData = await route.layoutTemplate({\r\n        location,\r\n        servicesManager,\r\n        studyInstanceUIDs,\r\n      });\r\n      if (isMounted.current) {\r\n        layoutTemplateData.current = layoutData;\r\n        setRefresh(!refresh);\r\n      }\r\n    };\r\n    if (studyInstanceUIDs?.length && studyInstanceUIDs[0] !== undefined) {\r\n      retrieveLayoutData();\r\n    }\r\n    return () => {\r\n      layoutTemplateData.current = null;\r\n    };\r\n  }, [studyInstanceUIDs]);\r\n\r\n  useEffect(() => {\r\n    if (!hotkeys) {\r\n      return;\r\n    }\r\n\r\n    hotkeysManager.setDefaultHotKeys(hotkeys);\r\n\r\n    const userPreferredHotkeys = JSON.parse(\r\n      localStorage.getItem('hotkey-definitions')\r\n    );\r\n\r\n    if (userPreferredHotkeys?.length) {\r\n      hotkeysManager.setHotkeys(userPreferredHotkeys);\r\n    } else {\r\n      hotkeysManager.setHotkeys(hotkeys);\r\n    }\r\n\r\n    return () => {\r\n      hotkeysManager.destroy();\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!layoutTemplateData.current) {\r\n      return;\r\n    }\r\n    // TODO: For some reason this is running before the Providers\r\n    // are calling setServiceImplementationf\r\n    // TOOD -> iterate through services.\r\n\r\n    // Extension\r\n\r\n    // Add SOPClassHandlers to a new SOPClassManager.\r\n    DisplaySetService.init(extensionManager, sopClassHandlers);\r\n\r\n    extensionManager.onModeEnter();\r\n    mode?.onModeEnter({ servicesManager, extensionManager });\r\n\r\n    // Adding hanging protocols of extensions after onModeEnter since\r\n    // it will reset the protocols\r\n    hangingProtocols.forEach(extentionProtocols => {\r\n      const hangingProtocolModule = extensionManager.getModuleEntry(extentionProtocols);\r\n      if (hangingProtocolModule?.protocols) {\r\n        HangingProtocolService.addProtocols(hangingProtocolModule.protocols);\r\n      }\r\n    });\r\n\r\n    const setupRouteInit = async () => {\r\n      if (route.init) {\r\n        return await route.init({\r\n          servicesManager,\r\n          extensionManager,\r\n          hotkeysManager,\r\n          studyInstanceUIDs,\r\n          dataSource,\r\n        });\r\n      }\r\n\r\n      return await defaultRouteInit({\r\n        servicesManager,\r\n        extensionManager,\r\n        hotkeysManager,\r\n        studyInstanceUIDs,\r\n        dataSource,\r\n      });\r\n    };\r\n\r\n    let unsubscriptions;\r\n    setupRouteInit().then(unsubs => {\r\n      unsubscriptions = unsubs;\r\n    });\r\n\r\n    return () => {\r\n      extensionManager.onModeExit();\r\n      mode?.onModeExit({ servicesManager, extensionManager });\r\n      unsubscriptions.forEach(unsub => {\r\n        unsub();\r\n      });\r\n    };\r\n  }, [\r\n    mode,\r\n    dataSourceName,\r\n    location,\r\n    route,\r\n    servicesManager,\r\n    extensionManager,\r\n    hotkeysManager,\r\n    studyInstanceUIDs,\r\n    refresh,\r\n    hangingProtocols,\r\n  ]);\r\n\r\n  const renderLayoutData = props => {\r\n    const layoutTemplateModuleEntry = extensionManager.getModuleEntry(\r\n      layoutTemplateData.current.id\r\n    );\r\n    const LayoutComponent = layoutTemplateModuleEntry.component;\r\n\r\n    return <LayoutComponent {...props} />;\r\n  };\r\n\r\n  return (\r\n    <ImageViewerProvider\r\n      // initialState={{ StudyInstanceUIDs: StudyInstanceUIDs }}\r\n      StudyInstanceUIDs={studyInstanceUIDs}\r\n    // reducer={reducer}\r\n    >\r\n      <CombinedContextProvider>\r\n        <DragAndDropProvider>\r\n          {layoutTemplateData.current &&\r\n            studyInstanceUIDs?.length &&\r\n            studyInstanceUIDs[0] !== undefined &&\r\n            renderLayoutData({\r\n              ...layoutTemplateData.current.props,\r\n              ViewportGridComp: ViewportGridWithDataSource,\r\n            })}\r\n        </DragAndDropProvider>\r\n      </CombinedContextProvider>\r\n    </ImageViewerProvider>\r\n  );\r\n}\r\n\r\nModeRoute.propTypes = {\r\n  mode: PropTypes.object.isRequired,\r\n  dataSourceName: PropTypes.string,\r\n  extensionManager: PropTypes.object,\r\n  servicesManager: PropTypes.object,\r\n  hotkeysManager: PropTypes.object,\r\n};\r\n","import React from \"react\";\r\nimport { Route } from \"react-router-dom\";\r\nimport { useUserAuthentication } from \"@ohif/ui\";\r\n\r\nexport const PrivateRoute = ({ ...rest }) => {\r\n    const [{ user, enabled }, userAuthenticationService] = useUserAuthentication();\r\n\r\n    if (enabled && !user) {\r\n      return userAuthenticationService.handleUnauthenticated();\r\n    }\r\n\r\n    return <Route {...rest}/>;\r\n}\r\n\r\nexport default PrivateRoute;\r\n","import React from 'react';\r\nimport { Routes, Route } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@ohif/ui';\r\n\r\n// Route Components\r\nimport DataSourceWrapper from './DataSourceWrapper';\r\nimport WorkList from './WorkList';\r\nimport Local from './Local';\r\nimport NotFound from './NotFound';\r\nimport buildModeRoutes from './buildModeRoutes';\r\nimport PrivateRoute from './PrivateRoute';\r\n\r\n// TODO: Make these configurable\r\n// TODO: Include \"routes\" debug route if dev build\r\nconst bakedInRoutes = [\r\n  // WORK LIST\r\n  {\r\n    path: '/',\r\n    children: DataSourceWrapper,\r\n    private: true,\r\n    props: { children: WorkList },\r\n  },\r\n  {\r\n    path: '/local',\r\n    children: Local,\r\n  },\r\n  // NOT FOUND (404)\r\n  { component: NotFound },\r\n];\r\n\r\nconst createRoutes = ({\r\n  modes,\r\n  dataSources,\r\n  extensionManager,\r\n  servicesManager,\r\n  hotkeysManager,\r\n  routerBasename,\r\n}) => {\r\n  const routes =\r\n    buildModeRoutes({\r\n      modes,\r\n      dataSources,\r\n      extensionManager,\r\n      servicesManager,\r\n      hotkeysManager,\r\n    }) || [];\r\n\r\n  const allRoutes = [...routes, ...bakedInRoutes];\r\n\r\n  function RouteWithErrorBoundary({ route, ...rest }) {\r\n    // eslint-disable-next-line react/jsx-props-no-spreading\r\n    return (\r\n      <ErrorBoundary context={`Route ${route.path}`} fallbackRoute=\"/\">\r\n        <route.children\r\n          {...rest}\r\n          {...route.props}\r\n          route={route}\r\n          servicesManager={servicesManager}\r\n          hotkeysManager={hotkeysManager}\r\n        />\r\n      </ErrorBoundary>\r\n    );\r\n  }\r\n\r\n  const { UserAuthenticationService } = servicesManager.services;\r\n\r\n  return (\r\n    <Routes basename={routerBasename}>\r\n      {allRoutes.map((route, i) => {\r\n        return route.private === true ? (\r\n          <PrivateRoute\r\n            key={i}\r\n            path={route.path}\r\n            handleUnauthenticated={\r\n              UserAuthenticationService.handleUnauthenticated\r\n            }\r\n            element={<RouteWithErrorBoundary route={route} />}\r\n          />\r\n        ) : (\r\n          <Route\r\n            key={i}\r\n            path={route.path}\r\n            element={<RouteWithErrorBoundary route={route} />}\r\n          />\r\n        );\r\n      })}\r\n    </Routes>\r\n  );\r\n};\r\n\r\nexport default createRoutes;\r\n","import React from 'react';\r\nimport ModeRoute from '@routes/Mode';\r\n\r\n/*\r\n  Routes uniquely define an entry point to:\r\n  - A mode\r\n  - Linked to a data source\r\n  - With a specified data set.\r\n\r\n  The full route template is:\r\n\r\n  /:modeId/:modeRoute/:sourceType/?queryParameters=example\r\n\r\n  Where:\r\n  :modeId - Is the mode selected.\r\n  :modeRoute - Is the route within the mode to select.\r\n  :sourceType - Is the data source identifier, which specifies which DataSource to use.\r\n  ?queryParameters - Are query parameters as defined by data source.\r\n\r\n  A default source can be specified at the app level configuration, and then that source is used if :sourceType is omitted:\r\n\r\n  /:modeId/:modeRoute/?queryParameters=example\r\n */\r\nexport default function buildModeRoutes({\r\n  modes,\r\n  dataSources,\r\n  extensionManager,\r\n  servicesManager,\r\n  hotkeysManager,\r\n}) {\r\n  const routes = [];\r\n\r\n  // const dataSources = Object.keys(extensionManager.dataSourceMap).map(a =>\r\n  //   extensionManager.getDataSources(a)\r\n  // );\r\n\r\n  const dataSourceNames = [];\r\n\r\n  dataSources.forEach(dataSource => {\r\n    const { sourceName } = dataSource;\r\n    if (!dataSourceNames.includes(sourceName)) {\r\n      dataSourceNames.push(sourceName);\r\n    }\r\n  });\r\n\r\n  modes.forEach(mode => {\r\n    // todo: for each route. add route to path.\r\n    dataSourceNames.forEach(dataSourceName => {\r\n      // TODO: name vs id\r\n      const path = `/${mode.id}/${dataSourceName}`;\r\n\r\n      // TODO move up.\r\n      const children = () => (\r\n        <ModeRoute\r\n          mode={mode}\r\n          dataSourceName={dataSourceName}\r\n          extensionManager={extensionManager}\r\n          servicesManager={servicesManager}\r\n          hotkeysManager={hotkeysManager}\r\n        />\r\n      );\r\n\r\n      routes.push({\r\n        path,\r\n        children,\r\n      });\r\n    });\r\n\r\n    const defaultDataSourceName = extensionManager.defaultDataSourceName;\r\n\r\n    // Add default DataSource route.\r\n    const path = `/${mode.id}`;\r\n\r\n    // TODO move up.\r\n    const children = () => (\r\n      <ModeRoute\r\n        mode={mode}\r\n        dataSourceName={defaultDataSourceName}\r\n        extensionManager={extensionManager}\r\n        servicesManager={servicesManager}\r\n        hotkeysManager={hotkeysManager}\r\n      />\r\n    );\r\n\r\n    routes.push({\r\n      path,\r\n      children,\r\n      private: true, // todo: all mode routes are private for now\r\n    });\r\n  });\r\n\r\n  return routes;\r\n}\r\n","import {\r\n  CommandsManager,\r\n  ExtensionManager,\r\n  ServicesManager,\r\n  HotkeysManager,\r\n  UINotificationService,\r\n  UIModalService,\r\n  UIDialogService,\r\n  UIViewportDialogService,\r\n  MeasurementService,\r\n  DisplaySetService,\r\n  ToolBarService,\r\n  ViewportGridService,\r\n  HangingProtocolService,\r\n  CineService,\r\n  UserAuthenticationService,\r\n  errorHandler\r\n  // utils,\r\n} from '@ohif/core';\r\n\r\n/**\r\n * @param {object|func} appConfigOrFunc - application configuration, or a function that returns application configuration\r\n * @param {object[]} defaultExtensions - array of extension objects\r\n */\r\nfunction appInit(appConfigOrFunc, defaultExtensions) {\r\n  const appConfig = {\r\n    ...(typeof appConfigOrFunc === 'function'\r\n      ? appConfigOrFunc({ servicesManager })\r\n      : appConfigOrFunc),\r\n  };\r\n\r\n  const commandsManagerConfig = {\r\n    getAppState: () => {},\r\n    /** Used by commands to determine active context */\r\n    getActiveContexts: () => [\r\n      'VIEWER',\r\n      'DEFAULT',\r\n      'ACTIVE_VIEWPORT::CORNERSTONE',\r\n    ],\r\n  };\r\n\r\n  const commandsManager = new CommandsManager(commandsManagerConfig);\r\n  const servicesManager = new ServicesManager(commandsManager);\r\n  const hotkeysManager = new HotkeysManager(commandsManager, servicesManager);\r\n  const extensionManager = new ExtensionManager({\r\n    commandsManager,\r\n    servicesManager,\r\n    hotkeysManager,\r\n    appConfig,\r\n  });\r\n\r\n  servicesManager.registerServices([\r\n    UINotificationService,\r\n    UIModalService,\r\n    UIDialogService,\r\n    UIViewportDialogService,\r\n    MeasurementService,\r\n    DisplaySetService,\r\n    ToolBarService,\r\n    ViewportGridService,\r\n    HangingProtocolService,\r\n    CineService,\r\n    UserAuthenticationService,\r\n  ]);\r\n\r\n  errorHandler.getHTTPErrorHandler = () => {\r\n    if (typeof appConfig.httpErrorHandler === 'function') {\r\n      return appConfig.httpErrorHandler;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Example: [ext1, ext2, ext3]\r\n   * Example2: [[ext1, config], ext2, [ext3, config]]\r\n   */\r\n  extensionManager.registerExtensions(\r\n    [...defaultExtensions, ...appConfig.extensions],\r\n    appConfig.dataSources\r\n  );\r\n\r\n  // TODO: We no longer use `utils.addServer`\r\n  // TODO: We no longer init webWorkers at app level\r\n  // TODO: We no longer init the user Manager\r\n\r\n  if (!appConfig.modes) {\r\n    throw new Error('No modes are defined! Check your app-config.js');\r\n  }\r\n\r\n  // TODO: Remove this\r\n  if (!appConfig.modes.length) {\r\n    appConfig.modes.push(window.longitudinalMode);\r\n    // appConfig.modes.push(window.segmentationMode);\r\n  }\r\n\r\n  return {\r\n    appConfig,\r\n    commandsManager,\r\n    extensionManager,\r\n    servicesManager,\r\n    hotkeysManager,\r\n  };\r\n}\r\n\r\nexport default appInit;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nfunction CallbackPage({ userManager, onRedirectSuccess }) {\r\n  const onRedirectError = error => {\r\n    throw new Error(error);\r\n  };\r\n\r\n  userManager\r\n    .signinRedirectCallback()\r\n    .then(user => onRedirectSuccess(user))\r\n    .catch(error => onRedirectError(error));\r\n\r\n  // todo: add i18n (or return null?)\r\n  return <div>Redirecting...</div>;\r\n}\r\n\r\nCallbackPage.propTypes = {\r\n  userManager: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default CallbackPage;\r\n","import React from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport PropTypes from 'prop-types';\r\n\r\nfunction SignoutCallbackComponent({ userManager }) {\r\n  const navigate = useNavigate();\r\n\r\n  const onRedirectSuccess = (/* user */) => {\r\n    const { pathname, search = '' } = JSON.parse(\r\n      sessionStorage.getItem('ohif-redirect-to')\r\n    );\r\n\r\n    navigate(`${pathname}?${search}`);\r\n  };\r\n\r\n  const onRedirectError = error => {\r\n    throw new Error(error);\r\n  };\r\n\r\n  userManager\r\n    .signoutRedirectCallback()\r\n    .then(user => onRedirectSuccess(user))\r\n    .catch(error => onRedirectError(error));\r\n\r\n  // todo: add i18n\r\n  return <div>Redirecting...</div>;\r\n}\r\n\r\nSignoutCallbackComponent.propTypes = {\r\n  userManager: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default SignoutCallbackComponent;\r\n","import React from 'react';\r\nimport { useEffect } from 'react';\r\nimport { Route, Routes, useLocation, useNavigate } from 'react-router';\r\nimport CallbackPage from '../routes/CallbackPage';\r\nimport SignoutCallbackComponent from '../routes/SignoutCallbackComponent';\r\nimport getUserManagerForOpenIdConnectClient from './getUserManagerForOpenIdConnectClient.js';\r\n\r\nfunction _isAbsoluteUrl(url) {\r\n  return url.includes('http://') || url.includes('https://');\r\n}\r\n\r\nfunction _makeAbsoluteIfNecessary(url, base_url) {\r\n  if (_isAbsoluteUrl(url)) {\r\n    return url;\r\n  }\r\n\r\n  /*\r\n   * Make sure base_url and url are not duplicating slashes.\r\n   */\r\n  if (base_url[base_url.length - 1] === '/') {\r\n    base_url = base_url.slice(0, base_url.length - 1);\r\n  }\r\n\r\n  return base_url + url;\r\n}\r\n\r\nconst initUserManager = (oidc, routerBasename) => {\r\n  if (!oidc || !oidc.length) {\r\n    return;\r\n  }\r\n\r\n  const firstOpenIdClient = oidc[0];\r\n  const { protocol, host } = window.location;\r\n  const baseUri = `${protocol}//${host}${routerBasename}`;\r\n\r\n  const redirect_uri = firstOpenIdClient.redirect_uri || '/callback';\r\n  const silent_redirect_uri =\r\n    firstOpenIdClient.silent_redirect_uri || '/silent-refresh.html';\r\n  const post_logout_redirect_uri =\r\n    firstOpenIdClient.post_logout_redirect_uri || '/';\r\n\r\n  const openIdConnectConfiguration = Object.assign({}, firstOpenIdClient, {\r\n    redirect_uri: _makeAbsoluteIfNecessary(redirect_uri, baseUri),\r\n    silent_redirect_uri: _makeAbsoluteIfNecessary(\r\n      silent_redirect_uri,\r\n      baseUri\r\n    ),\r\n    post_logout_redirect_uri: _makeAbsoluteIfNecessary(\r\n      post_logout_redirect_uri,\r\n      baseUri\r\n    ),\r\n  });\r\n\r\n  return getUserManagerForOpenIdConnectClient(openIdConnectConfiguration);\r\n}\r\n\r\nfunction LoginComponent(userManager) {\r\n  const queryParams = new URLSearchParams(location.search);\r\n  const iss = queryParams.get('iss');\r\n  const loginHint = queryParams.get('login_hint');\r\n  const targetLinkUri = queryParams.get('target_link_uri');\r\n  if (iss !== oidcAuthority) {\r\n    console.error(\r\n      'iss of /login does not match the oidc authority'\r\n    );\r\n    return null;\r\n  }\r\n\r\n  userManager.removeUser().then(() => {\r\n    if (targetLinkUri !== null) {\r\n      const ohifRedirectTo = {\r\n        pathname: new URL(targetLinkUri).pathname,\r\n      };\r\n      sessionStorage.setItem(\r\n        'ohif-redirect-to',\r\n        JSON.stringify(ohifRedirectTo)\r\n      );\r\n    } else {\r\n      const ohifRedirectTo = {\r\n        pathname: '/',\r\n      };\r\n      sessionStorage.setItem(\r\n        'ohif-redirect-to',\r\n        JSON.stringify(ohifRedirectTo)\r\n      );\r\n    }\r\n\r\n    if (loginHint !== null) {\r\n      userManager.signinRedirect({ login_hint: loginHint });\r\n    } else {\r\n      userManager.signinRedirect();\r\n    }\r\n  });\r\n\r\n  return null;\r\n}\r\n\r\nfunction OpenIdConnectRoutes({\r\n                         oidc,\r\n                         routerBasename,\r\n                         UserAuthenticationService\r\n                        }) {\r\n  const userManager = initUserManager(oidc, routerBasename);\r\n\r\n  const getAuthorizationHeader = () => {\r\n    const user = UserAuthenticationService.getUser();\r\n\r\n    return {\r\n      Authorization: `Bearer ${user.access_token}`\r\n    };\r\n  }\r\n\r\n  const handleUnauthenticated = () => {\r\n    userManager.signinRedirect()\r\n\r\n    // return null because this is used in a react component\r\n    return null;\r\n  };\r\n\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    UserAuthenticationService.set({ enabled: true });\r\n\r\n    UserAuthenticationService.setServiceImplementation({\r\n      getAuthorizationHeader,\r\n      handleUnauthenticated\r\n    });\r\n  }, [])\r\n\r\n  const oidcAuthority = oidc[0].authority;\r\n\r\n  const location = useLocation();\r\n  const { pathname, search } = location;\r\n\r\n  const redirect_uri = new URL(userManager.settings._redirect_uri).pathname//.replace(routerBasename,'')\r\n  const silent_refresh_uri = new URL(userManager.settings._silent_redirect_uri).pathname//.replace(routerBasename,'')\r\n  const post_logout_redirect_uri = new URL(userManager.settings._post_logout_redirect_uri).pathname//.replace(routerBasename,'');\r\n\r\n  // const pathnameRelative = pathname.replace(routerBasename,'');\r\n\r\n  if (pathname !== redirect_uri) {\r\n    sessionStorage.setItem(\r\n      'ohif-redirect-to',\r\n      JSON.stringify({ pathname, search })\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Routes basename={routerBasename}>\r\n      <Route\r\n        path={silent_refresh_uri}\r\n        onEnter={window.location.reload}\r\n      />\r\n      <Route\r\n        path={post_logout_redirect_uri}\r\n        element={\r\n          <SignoutCallbackComponent\r\n            userManager={userManager}\r\n            successCallback={() => console.log('Signout successful')}\r\n            errorCallback={error => {\r\n              console.warn(error);\r\n              console.warn('Signout failed');\r\n            }}\r\n          />\r\n        }\r\n      />\r\n      <Route\r\n        path={redirect_uri}\r\n        element={<CallbackPage userManager={userManager} onRedirectSuccess={(user) => {\r\n          const { pathname, search = '' } = JSON.parse(\r\n            sessionStorage.getItem('ohif-redirect-to')\r\n          );\r\n\r\n          UserAuthenticationService.setUser(user);\r\n\r\n          navigate({\r\n            pathname,\r\n            search\r\n          })\r\n        }}/>}\r\n      />\r\n      <Route\r\n        path=\"/login\"\r\n        element={<LoginComponent userManager={userManager} oidcAuthority={oidcAuthority}/>}\r\n      />\r\n    </Routes>\r\n  );\r\n}\r\n\r\nexport default OpenIdConnectRoutes;\r\n","import { UserManager } from 'oidc-client';\r\n\r\n/**\r\n * Creates a userManager from oidcSettings\r\n * LINK: https://github.com/IdentityModel/oidc-client-js/wiki#configuration\r\n *\r\n * @param {Object} oidcSettings\r\n * @param {string} oidcSettings.authServerUrl,\r\n * @param {string} oidcSettings.clientId,\r\n * @param {string} oidcSettings.authRedirectUri,\r\n * @param {string} oidcSettings.postLogoutRedirectUri,\r\n * @param {string} oidcSettings.responseType,\r\n * @param {string} oidcSettings.extraQueryParams,\r\n */\r\nexport default function getUserManagerForOpenIdConnectClient(oidcSettings) {\r\n  if (!oidcSettings) {\r\n    return;\r\n  }\r\n\r\n  const settings = {\r\n    ...oidcSettings,\r\n    automaticSilentRenew: true,\r\n    revokeAccessTokenOnSignout: true,\r\n    filterProtocolClaims: true,\r\n    loadUserInfo: true,\r\n  };\r\n\r\n  const userManager = new UserManager(settings);\r\n\r\n  return userManager;\r\n}\r\n","// TODO: torn, can either bake this here; or have to create a whole new button type\r\n// Only ways that you can pass in a custom React component for render :l\r\nimport {\r\n  // ExpandableToolbarButton,\r\n  // ListMenu,\r\n  WindowLevelMenuItem,\r\n} from '@ohif/ui';\r\nimport { defaults } from '@ohif/core';\r\n\r\nconst { windowLevelPresets } = defaults;\r\n/**\r\n *\r\n * @param {*} type - 'tool' | 'action' | 'toggle'\r\n * @param {*} id\r\n * @param {*} icon\r\n * @param {*} label\r\n */\r\nfunction _createButton(type, id, icon, label, commandName, commandOptions, tooltip) {\r\n  return {\r\n    id,\r\n    icon,\r\n    label,\r\n    type,\r\n    commandName,\r\n    commandOptions,\r\n    tooltip,\r\n  };\r\n}\r\n\r\nconst _createActionButton = _createButton.bind(null, 'action');\r\nconst _createToggleButton = _createButton.bind(null, 'toggle');\r\nconst _createToolButton = _createButton.bind(null, 'tool');\r\n\r\n/**\r\n *\r\n * @param {*} preset - preset number (from above import)\r\n * @param {*} title\r\n * @param {*} subtitle\r\n */\r\nfunction _createWwwcPreset(preset, title, subtitle) {\r\n  return {\r\n    id: preset.toString(),\r\n    title,\r\n    subtitle,\r\n    type: 'action',\r\n    commandName: 'setWindowLevel',\r\n    commandOptions: windowLevelPresets[preset],\r\n  };\r\n}\r\n\r\nexport default [\r\n  // Measurement\r\n  {\r\n    id: 'MeasurementTools',\r\n    type: 'ohif.splitButton',\r\n    props: {\r\n      groupId: 'MeasurementTools',\r\n      isRadio: true, // ?\r\n      // Switch?\r\n      primary: _createToolButton(\r\n        'Length',\r\n        'tool-length',\r\n        'Length',\r\n        undefined,\r\n        { toolName: 'Length' },\r\n        'Length'\r\n      ),\r\n      secondary: {\r\n        icon: 'chevron-down',\r\n        label: '',\r\n        isActive: true,\r\n        tooltip: 'More Measure Tools',\r\n      },\r\n      items: [\r\n        _createToolButton(\r\n          'Length',\r\n          'tool-length',\r\n          'Length',\r\n          undefined,\r\n          { toolName: 'Length' },\r\n          'Length Tool'\r\n        ),\r\n        _createToolButton(\r\n          'Bidirectional',\r\n          'tool-bidirectional',\r\n          'Bidirectional',\r\n          undefined,\r\n          { toolName: 'Bidirectional' },\r\n          'Bidirectional Tool'\r\n        ),\r\n        _createToolButton(\r\n          'ArrowAnnotate',\r\n          'tool-annotate',\r\n          'Annotation',\r\n          undefined,\r\n          { toolName: 'ArrowAnnotate' },\r\n          'Arrow Annotate'\r\n        ),\r\n        _createToolButton(\r\n          'EllipticalRoi',\r\n          'tool-elipse',\r\n          'Ellipse',\r\n          undefined,\r\n          {\r\n            toolName: 'EllipticalRoi',\r\n          },\r\n          'Ellipse Tool'\r\n        ),\r\n      ],\r\n    },\r\n  },\r\n  // Zoom..\r\n  {\r\n    id: 'Zoom',\r\n    type: 'ohif.radioGroup',\r\n    props: {\r\n      type: 'tool',\r\n      icon: 'tool-zoom',\r\n      label: 'Zoom',\r\n      commandOptions: { toolName: 'Zoom' },\r\n    },\r\n  },\r\n  // Window Level + Presets...\r\n  {\r\n    id: 'WindowLevel',\r\n    type: 'ohif.splitButton',\r\n    props: {\r\n      groupId: 'Wwwc',\r\n      primary: _createToolButton(\r\n        'Wwwc',\r\n        'tool-window-level',\r\n        'Window Level',\r\n        undefined,\r\n        { toolName: 'Wwwc' },\r\n        'Window Level'\r\n      ),\r\n      secondary: {\r\n        icon: 'chevron-down',\r\n        label: 'W/L Manual',\r\n        isActive: true,\r\n        tooltip: 'W/L Presets',\r\n      },\r\n      isAction: true, // ?\r\n      renderer: WindowLevelMenuItem,\r\n      items: [\r\n        _createWwwcPreset(1, 'Soft tissue', '400 / 40'),\r\n        _createWwwcPreset(2, 'Lung', '1500 / -600'),\r\n        _createWwwcPreset(3, 'Liver', '150 / 90'),\r\n        _createWwwcPreset(4, 'Bone', '80 / 40'),\r\n        _createWwwcPreset(5, 'Brain', '2500 / 480'),\r\n      ],\r\n    },\r\n  },\r\n  // Pan...\r\n  {\r\n    id: 'Pan',\r\n    type: 'ohif.radioGroup',\r\n    props: {\r\n      type: 'tool',\r\n      icon: 'tool-move',\r\n      label: 'Pan',\r\n      commandOptions: { toolName: 'Pan' },\r\n    },\r\n  },\r\n  {\r\n    id: 'Capture',\r\n    type: 'ohif.action',\r\n    props: {\r\n      icon: 'tool-capture',\r\n      label: 'Capture',\r\n      type: 'action',\r\n      commandName: 'showDownloadViewportModal',\r\n    },\r\n  },\r\n  {\r\n    id: 'Layout',\r\n    type: 'ohif.layoutSelector',\r\n  },\r\n  // More...\r\n  {\r\n    id: 'MoreTools',\r\n    type: 'ohif.splitButton',\r\n    props: {\r\n      isRadio: true, // ?\r\n      groupId: 'MoreTools',\r\n      primary: _createActionButton(\r\n        'Reset',\r\n        'tool-reset',\r\n        'Reset View',\r\n        'resetViewport',\r\n        undefined,\r\n        'Reset'\r\n      ),\r\n      secondary: {\r\n        icon: 'chevron-down',\r\n        label: '',\r\n        isActive: true,\r\n        tooltip: 'More Tools',\r\n      },\r\n      items: [\r\n        _createActionButton(\r\n          'Reset',\r\n          'tool-reset',\r\n          'Reset View',\r\n          'resetViewport',\r\n          undefined,\r\n          'Reset'\r\n        ),\r\n        _createActionButton(\r\n          'rotate-right',\r\n          'tool-rotate-right',\r\n          'Rotate Right',\r\n          'rotateViewportCW',\r\n          undefined,\r\n          'Rotate +90'\r\n        ),\r\n        _createActionButton(\r\n          'flip-horizontal',\r\n          'tool-flip-horizontal',\r\n          'Flip Horizontally',\r\n          'flipViewportHorizontal',\r\n          undefined,\r\n          'Flip Horizontal'\r\n        ),\r\n        _createToolButton(\r\n          'StackScroll',\r\n          'tool-stack-scroll',\r\n          'Stack Scroll',\r\n          undefined,\r\n          { toolName: 'StackScroll' },\r\n          'Stack Scroll'\r\n        ),\r\n        _createToolButton(\r\n          'Magnify',\r\n          'tool-magnify',\r\n          'Magnify',\r\n          undefined,\r\n          { toolName: 'Magnify' },\r\n          'Magnify'\r\n        ),\r\n        _createActionButton(\r\n          'invert',\r\n          'tool-invert',\r\n          'Invert',\r\n          'invertViewport',\r\n          undefined,\r\n          'Invert Colors'\r\n        ),\r\n        _createToggleButton(\r\n          'cine',\r\n          'tool-cine',\r\n          'Cine',\r\n          'toggleCine',\r\n          undefined,\r\n          'Cine'\r\n        ),\r\n        _createToolButton(\r\n          'Angle',\r\n          'tool-angle',\r\n          'Angle',\r\n          undefined,\r\n          { toolName: 'Angle' },\r\n          'Angle'\r\n        ),\r\n        _createToolButton(\r\n          'DragProbe',\r\n          'tool-probe',\r\n          'Probe',\r\n          undefined,\r\n          { toolName: 'DragProbe' },\r\n          'Probe'\r\n        ),\r\n        _createToolButton(\r\n          'Rectangle',\r\n          'tool-rectangle',\r\n          'Rectangle',\r\n          undefined,\r\n          { toolName: 'RectangleRoi' },\r\n          'Rectangle'\r\n        ),\r\n      ],\r\n    },\r\n  },\r\n];\r\n","import toolbarButtons from './toolbarButtons.js';\r\nimport { hotkeys } from '@ohif/core';\r\n\r\nconst ohif = {\r\n  layout: 'org.ohif.default.layoutTemplateModule.viewerLayout',\r\n  sopClassHandler: 'org.ohif.default.sopClassHandlerModule.stack',\r\n  hangingProtocols: 'org.ohif.default.hangingProtocolModule.default',\r\n};\r\n\r\nconst tracked = {\r\n  measurements: 'org.ohif.measurement-tracking.panelModule.trackedMeasurements',\r\n  thumbnailList: 'org.ohif.measurement-tracking.panelModule.seriesList',\r\n  viewport: 'org.ohif.measurement-tracking.viewportModule.cornerstone-tracked',\r\n};\r\n\r\nconst dicomsr = {\r\n  sopClassHandler: 'org.ohif.dicom-sr.sopClassHandlerModule.dicom-sr',\r\n  viewport: 'org.ohif.dicom-sr.viewportModule.dicom-sr',\r\n};\r\n\r\nexport default function mode({ modeConfiguration }) {\r\n  return {\r\n    // TODO: We're using this as a route segment\r\n    // We should not be.\r\n    id: 'viewer',\r\n    displayName: 'Basic Viewer',\r\n    /**\r\n     * Lifecycle hooks\r\n     */\r\n    onModeEnter: ({ servicesManager, extensionManager }) => {\r\n      // Note: If tool's aren't initialized, this doesn't have viewport/tools\r\n      // to \"set active\". This is mostly for the toolbar UI state?\r\n      // Could update tool manager to be always persistent, and to set state\r\n      // on load?\r\n      const { ToolBarService } = servicesManager.services;\r\n      const interaction = {\r\n        groupId: 'primary',\r\n        itemId: 'Wwwc',\r\n        interactionType: 'tool',\r\n        commandOptions: undefined,\r\n      };\r\n\r\n      ToolBarService.recordInteraction(interaction);\r\n\r\n      ToolBarService.init(extensionManager);\r\n      ToolBarService.addButtons(toolbarButtons);\r\n      ToolBarService.createButtonSection('primary', [\r\n        'MeasurementTools',\r\n        'Zoom',\r\n        'WindowLevel',\r\n        'Pan',\r\n        'Capture',\r\n        'Layout',\r\n        'MoreTools',\r\n      ]);\r\n    },\r\n    onModeExit: () => {},\r\n    validationTags: {\r\n      study: [],\r\n      series: [],\r\n    },\r\n    isValidMode: ({ modalities }) => {\r\n      const modalities_list = modalities.split('\\\\');\r\n\r\n      // Slide Microscopy modality not supported by basic mode yet\r\n      return !modalities_list.includes('SM')\r\n    },\r\n    routes: [\r\n      {\r\n        path: 'longitudinal',\r\n        /*init: ({ servicesManager, extensionManager }) => {\r\n          //defaultViewerRouteInit\r\n        },*/\r\n        layoutTemplate: ({ location, servicesManager }) => {\r\n          return {\r\n            id: ohif.layout,\r\n            props: {\r\n              leftPanels: [tracked.thumbnailList],\r\n              // TODO: Should be optional, or required to pass empty array for slots?\r\n              rightPanels: [tracked.measurements],\r\n              viewports: [\r\n                {\r\n                  namespace: tracked.viewport,\r\n                  displaySetsToDisplay: [ohif.sopClassHandler],\r\n                },\r\n                {\r\n                  namespace: dicomsr.viewport,\r\n                  displaySetsToDisplay: [dicomsr.sopClassHandler],\r\n                },\r\n              ],\r\n            },\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    extensions: [\r\n      'org.ohif.default',\r\n      'org.ohif.cornerstone',\r\n      'org.ohif.measurement-tracking',\r\n      'org.ohif.dicom-sr',\r\n    ],\r\n    hangingProtocols: [ohif.hangingProtocols],\r\n    sopClassHandlers: [ohif.sopClassHandler, dicomsr.sopClassHandler],\r\n    hotkeys: [...hotkeys.defaults.hotkeyBindings],\r\n  };\r\n}\r\n\r\nwindow.longitudinalMode = mode({});\r\n","// External\r\nimport React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport i18n from '@ohif/i18n';\r\nimport { I18nextProvider } from 'react-i18next';\r\nimport { BrowserRouter } from 'react-router-dom';\r\nimport Compose from './routes/Mode/Compose.js';\r\n\r\nimport {\r\n  DialogProvider,\r\n  Modal,\r\n  ModalProvider,\r\n  SnackbarProvider,\r\n  ThemeWrapper,\r\n  ViewportDialogProvider,\r\n  ViewportGridProvider,\r\n  CineProvider,\r\n  UserAuthenticationProvider,\r\n} from '@ohif/ui';\r\n// Viewer Project\r\n// TODO: Should this influence study list?\r\nimport { AppConfigProvider } from '@state';\r\nimport createRoutes from './routes';\r\nimport appInit from './appInit.js';\r\nimport OpenIdConnectRoutes from './utils/OpenIdConnectRoutes.jsx';\r\n\r\n// TODO: Temporarily for testing\r\nimport '@ohif/mode-longitudinal';\r\n\r\nlet commandsManager, extensionManager, servicesManager, hotkeysManager;\r\n\r\nfunction App({ config, defaultExtensions }) {\r\n  const init = appInit(config, defaultExtensions);\r\n\r\n  // Set above for named export\r\n  commandsManager = init.commandsManager;\r\n  extensionManager = init.extensionManager;\r\n  servicesManager = init.servicesManager;\r\n  hotkeysManager = init.hotkeysManager;\r\n\r\n  // Set appConfig\r\n  const appConfigState = init.appConfig;\r\n  const { routerBasename, modes, dataSources, oidc } = appConfigState;\r\n\r\n  // Use config to create routes\r\n  const appRoutes = createRoutes({\r\n    modes,\r\n    dataSources,\r\n    extensionManager,\r\n    servicesManager,\r\n    hotkeysManager,\r\n    routerBasename,\r\n  });\r\n  const {\r\n    UIDialogService,\r\n    UIModalService,\r\n    UINotificationService,\r\n    UIViewportDialogService,\r\n    ViewportGridService,\r\n    CineService,\r\n    UserAuthenticationService,\r\n  } = servicesManager.services;\r\n\r\n  const providers = [\r\n    [AppConfigProvider, { value: appConfigState }],\r\n    [UserAuthenticationProvider, { service: UserAuthenticationService}],\r\n    [I18nextProvider, { i18n }],\r\n    [ThemeWrapper],\r\n    [ViewportGridProvider, {service: ViewportGridService}],\r\n    [ViewportDialogProvider, {service: UIViewportDialogService}],\r\n    [CineProvider, {service: CineService}],\r\n    [SnackbarProvider, {service: UINotificationService}],\r\n    [DialogProvider, {service: UIDialogService}],\r\n    [ModalProvider, {service: UIModalService, modal: Modal}],\r\n  ]\r\n  const CombinedProviders = ({ children }) =>\r\n    Compose({ components: providers, children });\r\n\r\n  let authRoutes = null;\r\n\r\n  if (oidc) {\r\n    authRoutes = (<OpenIdConnectRoutes\r\n                oidc={oidc}\r\n                routerBasename={routerBasename}\r\n                UserAuthenticationService={UserAuthenticationService}\r\n              />)\r\n  }\r\n\r\n  return (\r\n    <CombinedProviders>\r\n      <BrowserRouter>\r\n        {authRoutes}\r\n        {appRoutes}\r\n      </BrowserRouter>\r\n    </CombinedProviders>\r\n  );\r\n}\r\n\r\nApp.propTypes = {\r\n  config: PropTypes.oneOfType([\r\n    PropTypes.func,\r\n    PropTypes.shape({\r\n      routerBasename: PropTypes.string.isRequired,\r\n      oidc: PropTypes.array,\r\n      whiteLabeling: PropTypes.shape({\r\n        createLogoComponentFn: PropTypes.func,\r\n      }),\r\n      extensions: PropTypes.array,\r\n    }),\r\n  ]).isRequired,\r\n  /* Extensions that are \"bundled\" or \"baked-in\" to the application.\r\n   * These would be provided at build time as part of they entry point. */\r\n  defaultExtensions: PropTypes.array,\r\n};\r\n\r\nApp.defaultProps = {\r\n  config: {\r\n    /**\r\n     * Relative route from domain root that OHIF instance is installed at.\r\n     * For example:\r\n     *\r\n     * Hosted at: https://ohif.org/where-i-host-the/viewer/\r\n     * Value: `/where-i-host-the/viewer/`\r\n     * */\r\n    routerBaseName: '/',\r\n    /**\r\n     *\r\n     */\r\n    showStudyList: true,\r\n    oidc: [],\r\n    extensions: [],\r\n  },\r\n  defaultExtensions: [],\r\n};\r\n\r\nexport default App;\r\n\r\nexport { commandsManager, extensionManager, servicesManager };\r\n","/**\r\n * QIDO - Query based on ID for DICOM Objects\r\n * search for studies, series and instances by patient ID, and receive their\r\n * unique identifiers for further usage.\r\n *\r\n * Quick: https://www.dicomstandard.org/dicomweb/query-qido-rs/\r\n * Standard: http://dicom.nema.org/medical/dicom/current/output/html/part18.html#sect_10.6\r\n *\r\n * Routes:\r\n * ==========\r\n * /studies?\r\n * /studies/{studyInstanceUid}/series?\r\n * /studies/{studyInstanceUid}/series/{seriesInstanceUid}/instances?\r\n *\r\n * Query Parameters:\r\n * ================\r\n * | KEY              | VALUE              |\r\n * |------------------|--------------------|\r\n * | {attributeId}    | {value}            |\r\n * | includeField     | {attribute} or all |\r\n * | fuzzymatching    | true OR false      |\r\n * | limit            | {number}           |\r\n * | offset           | {number}           |\r\n */\r\nimport { DICOMWeb, utils } from '@ohif/core';\r\n\r\nconst { getString, getName, getModalities } = DICOMWeb;\r\n\r\n/**\r\n * Parses resulting data from a QIDO call into a set of Study MetaData\r\n *\r\n * @param {Array} qidoStudies - An array of study objects. Each object contains a keys for DICOM tags.\r\n * @param {object} qidoStudies[0].qidoStudy - An object where each key is the DICOM Tag group+element\r\n * @param {object} qidoStudies[0].qidoStudy[dicomTag] - Optional object that represents DICOM Tag\r\n * @param {string} qidoStudies[0].qidoStudy[dicomTag].vr - Value Representation\r\n * @param {string[]} qidoStudies[0].qidoStudy[dicomTag].Value - Optional string array representation of the DICOM Tag's value\r\n * @returns {Array} An array of Study MetaData objects\r\n */\r\nfunction processResults(qidoStudies) {\r\n  if (!qidoStudies || !qidoStudies.length) {\r\n    return [];\r\n  }\r\n\r\n  const studies = [];\r\n\r\n  qidoStudies.forEach(qidoStudy =>\r\n    studies.push({\r\n      studyInstanceUid: getString(qidoStudy['0020000D']),\r\n      date: getString(qidoStudy['00080020']), // YYYYMMDD\r\n      time: getString(qidoStudy['00080030']), // HHmmss.SSS (24-hour, minutes, seconds, fractional seconds)\r\n      accession: getString(qidoStudy['00080050']) || '', // short string, probably a number?\r\n      mrn: getString(qidoStudy['00100020']) || '', // medicalRecordNumber\r\n      patientName: utils.formatPN(getName(qidoStudy['00100010'])) || '',\r\n      instances: Number(getString(qidoStudy['00201208'])) || 0, // number\r\n      description: getString(qidoStudy['00081030']) || '',\r\n      modalities:\r\n        getString(\r\n          getModalities(qidoStudy['00080060'], qidoStudy['00080061'])\r\n        ) || '',\r\n    })\r\n  );\r\n\r\n  return studies;\r\n}\r\n\r\n/**\r\n * Parses resulting data from a QIDO call into a set of Study MetaData\r\n *\r\n * @param {Array} qidoSeries - An array of study objects. Each object contains a keys for DICOM tags.\r\n * @param {object} qidoSeries[0].qidoSeries - An object where each key is the DICOM Tag group+element\r\n * @param {object} qidoSeries[0].qidoSeries[dicomTag] - Optional object that represents DICOM Tag\r\n * @param {string} qidoSeries[0].qidoSeries[dicomTag].vr - Value Representation\r\n * @param {string[]} qidoSeries[0].qidoSeries[dicomTag].Value - Optional string array representation of the DICOM Tag's value\r\n * @returns {Array} An array of Study MetaData objects\r\n */\r\nexport function processSeriesResults(qidoSeries) {\r\n  const series = [];\r\n\r\n  if (qidoSeries && qidoSeries.length) {\r\n    qidoSeries.forEach(qidoSeries =>\r\n      series.push({\r\n        studyInstanceUid: getString(qidoSeries['0020000D']),\r\n        seriesInstanceUid: getString(qidoSeries['0020000E']),\r\n        modality: getString(qidoSeries['00080060']),\r\n        seriesNumber: getString(qidoSeries['00200011']),\r\n        seriesDate: utils.formatDate(getString(qidoSeries['00080021'])),\r\n        numSeriesInstances: Number(getString(qidoSeries['00201209'])),\r\n        description: getString(qidoSeries['0008103E']),\r\n      })\r\n    );\r\n  }\r\n\r\n  return series;\r\n}\r\n\r\n/**\r\n *\r\n * @param {object} dicomWebClient - Client similar to what's provided by `dicomweb-client` library\r\n * @param {function} dicomWebClient.searchForStudies -\r\n * @param {string} [studyInstanceUid]\r\n * @param {string} [seriesInstanceUid]\r\n * @param {string} [queryParamaters]\r\n * @returns {Promise<results>} - Promise that resolves results\r\n */\r\nasync function search(\r\n  dicomWebClient,\r\n  studyInstanceUid,\r\n  seriesInstanceUid,\r\n  queryParameters\r\n) {\r\n  let searchResult = await dicomWebClient.searchForStudies({\r\n    studyInstanceUid: undefined,\r\n    queryParams: queryParameters,\r\n  });\r\n\r\n  return searchResult;\r\n}\r\n\r\n/**\r\n *\r\n * @param {string} studyInstanceUID - ID of study to return a list of series for\r\n * @returns {Promise} - Resolves SeriesMetadata[] in study\r\n */\r\nexport function seriesInStudy(dicomWebClient, studyInstanceUID) {\r\n  // Series Description\r\n  // Already included?\r\n  const commaSeparatedFields = ['0008103E', '00080021'].join(',');\r\n  const queryParams = {\r\n    includefield: commaSeparatedFields,\r\n  };\r\n\r\n  return dicomWebClient.searchForSeries({ studyInstanceUID, queryParams });\r\n}\r\n\r\nexport default function searchStudies(server, filter) {\r\n  const queryParams = getQIDOQueryParams(\r\n    filter,\r\n    server.qidoSupportsIncludeField\r\n  );\r\n  const options = {\r\n    queryParams,\r\n  };\r\n\r\n  return dicomWeb.searchForStudies(options).then(resultDataToStudies);\r\n}\r\n\r\n/**\r\n * Produces a QIDO URL given server details and a set of specified search filter\r\n * items\r\n *\r\n * @param filter\r\n * @param serverSupportsQIDOIncludeField\r\n * @returns {string} The URL with encoded filter query data\r\n */\r\nfunction mapParams(params, options = {}) {\r\n  if (!params) {\r\n    return;\r\n  }\r\n  const commaSeparatedFields = [\r\n    '00081030', // Study Description\r\n    '00080060', // Modality\r\n    // Add more fields here if you want them in the result\r\n  ].join(',');\r\n\r\n  const { supportsWildcard } = options;\r\n  const withWildcard = value => {\r\n    return supportsWildcard && value ? `*${value}*` : value;\r\n  };\r\n\r\n  const parameters = {\r\n    // Named\r\n    PatientName: withWildcard(params.patientName),\r\n    //PatientID: withWildcard(params.patientId),\r\n    \"00100020\": withWildcard(params.patientId), // Temporarily to make the tests pass with dicomweb-server.. Apparently it's broken?\r\n    AccessionNumber: withWildcard(params.accessionNumber),\r\n    StudyDescription: withWildcard(params.studyDescription),\r\n    ModalitiesInStudy: params.modalitiesInStudy,\r\n    // Other\r\n    limit: params.limit || 101,\r\n    offset: params.offset || 0,\r\n    fuzzymatching: options.supportsFuzzyMatching === true,\r\n    includefield: commaSeparatedFields, // serverSupportsQIDOIncludeField ? commaSeparatedFields : 'all',\r\n  };\r\n\r\n  // build the StudyDate range parameter\r\n  if (params.startDate && params.endDate) {\r\n    parameters.StudyDate = `${params.startDate}-${params.endDate}`;\r\n  } else if (params.startDate) {\r\n    const today = new Date();\r\n    const DD = String(today.getDate()).padStart(2, '0');\r\n    const MM = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!\r\n    const YYYY = today.getFullYear();\r\n    const todayStr = `${YYYY}${MM}${DD}`;\r\n\r\n    parameters.StudyDate = `${params.startDate}-${todayStr}`;\r\n  } else if (params.endDate) {\r\n    const oldDateStr = `19700102`;\r\n\r\n    parameters.StudyDate = `${oldDateStr}-${params.endDate}`;\r\n  }\r\n\r\n  // Build the StudyInstanceUID parameter\r\n  if (params.studyInstanceUid) {\r\n    let studyUids = params.studyInstanceUid;\r\n    studyUids = Array.isArray(studyUids) ? studyUids.join() : studyUids;\r\n    studyUids = studyUids.replace(/[^0-9.]+/g, '\\\\');\r\n    parameters.StudyInstanceUID = studyUids;\r\n  }\r\n\r\n  // Clean query params of undefined values.\r\n  const final = {};\r\n  Object.keys(parameters).forEach(key => {\r\n    if (parameters[key] !== undefined && parameters[key] !== '') {\r\n      final[key] = parameters[key];\r\n    }\r\n  });\r\n\r\n  return final;\r\n}\r\n\r\nexport { mapParams, search, processResults };\r\n","import getWADORSImageId from './getWADORSImageId';\r\n\r\nfunction buildInstanceWadoUrl(config, instance) {\r\n  const { StudyInstanceUID, SeriesInstanceUID, SOPInstanceUID } = instance;\r\n  const params = [];\r\n\r\n  params.push('requestType=WADO');\r\n  params.push(`studyUID=${StudyInstanceUID}`);\r\n  params.push(`seriesUID=${SeriesInstanceUID}`);\r\n  params.push(`objectUID=${SOPInstanceUID}`);\r\n  params.push('contentType=application/dicom');\r\n  params.push('transferSyntax=*');\r\n\r\n  const paramString = params.join('&');\r\n\r\n  return `${config.wadoUriRoot}?${paramString}`;\r\n}\r\n\r\n/**\r\n * Obtain an imageId for Cornerstone from an image instance\r\n *\r\n * @param instance\r\n * @param frame\r\n * @param thumbnail\r\n * @returns {string} The imageId to be used by Cornerstone\r\n */\r\nexport default function getImageId({\r\n  instance,\r\n  frame,\r\n  config,\r\n  thumbnail = false,\r\n}) {\r\n  if (!instance) {\r\n    return;\r\n  }\r\n\r\n  if (instance.url) {\r\n    return instance.url;\r\n  }\r\n\r\n  const renderingAttr = thumbnail ? 'thumbnailRendering' : 'imageRendering';\r\n\r\n  if (!config[renderingAttr] || config[renderingAttr] === 'wadouri') {\r\n    const wadouri = buildInstanceWadoUrl(config, instance);\r\n\r\n    let imageId = 'dicomweb:' + wadouri;\r\n    if (frame !== undefined) {\r\n      imageId += '&frame=' + frame;\r\n    }\r\n\r\n    return imageId;\r\n  } else {\r\n    return getWADORSImageId(instance, config, frame); // WADO-RS Retrieve Frame\r\n  }\r\n}\r\n","function buildInstanceWadoRsUri(instance, config) {\r\n  const { StudyInstanceUID, SeriesInstanceUID, SOPInstanceUID } = instance;\r\n  return `${config.wadoRoot}/studies/${StudyInstanceUID}/series/${SeriesInstanceUID}/instances/${SOPInstanceUID}`;\r\n}\r\n\r\nfunction buildInstanceFrameWadoRsUri(instance, config, frame) {\r\n  const baseWadoRsUri = buildInstanceWadoRsUri(instance, config);\r\n\r\n  frame = frame || 1;\r\n\r\n  return `${baseWadoRsUri}/frames/${frame}`;\r\n}\r\n\r\n// function getWADORSImageUrl(instance, frame) {\r\n//   const wadorsuri = buildInstanceFrameWadoRsUri(instance, config, frame);\r\n\r\n//   if (!wadorsuri) {\r\n//     return;\r\n//   }\r\n\r\n//   // Use null to obtain an imageId which represents the instance\r\n//   if (frame === null) {\r\n//     wadorsuri = wadorsuri.replace(/frames\\/(\\d+)/, '');\r\n//   } else {\r\n//     // We need to sum 1 because WADO-RS frame number is 1-based\r\n//     frame = frame ? parseInt(frame) + 1 : 1;\r\n\r\n//     // Replaces /frame/1 by /frame/{frame}\r\n//     wadorsuri = wadorsuri.replace(/frames\\/(\\d+)/, `frames/${frame}`);\r\n//   }\r\n\r\n//   return wadorsuri;\r\n// }\r\n\r\n/**\r\n * Obtain an imageId for Cornerstone based on the WADO-RS scheme\r\n *\r\n * @param {object} instanceMetada metadata object (InstanceMetadata)\r\n * @param {(string\\|number)} [frame] the frame number\r\n * @returns {string} The imageId to be used by Cornerstone\r\n */\r\nexport default function getWADORSImageId(instance, config, frame) {\r\n  //const uri = getWADORSImageUrl(instance, frame);\r\n  const uri = buildInstanceFrameWadoRsUri(instance, config, frame);\r\n\r\n  if (!uri) {\r\n    return;\r\n  }\r\n\r\n  return `wadors:${uri}`;\r\n}\r\n","const LOW_PRIORITY_MODALITIES = Object.freeze(['SEG', 'KO', 'PR', 'SR', 'RTSTRUCT']);\r\n\r\nexport default function isLowPriorityModality(Modality) {\r\n  return LOW_PRIORITY_MODALITIES.includes(Modality);\r\n}\r\n","import isLowPriorityModality from './isLowPriorityModality';\r\n\r\n/**\r\n * Series sorting criteria: series considered low priority are moved to the end\r\n * of the list and series number is used to break ties\r\n * @param {Object} firstSeries\r\n * @param {Object} secondSeries\r\n */\r\nfunction seriesInfoSortingCriteria(firstSeries, secondSeries) {\r\n  const aLowPriority = isLowPriorityModality(firstSeries.Modality);\r\n  const bLowPriority = isLowPriorityModality(secondSeries.Modality);\r\n  if (!aLowPriority && bLowPriority) {\r\n    return -1;\r\n  }\r\n  if (aLowPriority && !bLowPriority) {\r\n    return 1;\r\n  }\r\n\r\n  return firstSeries.SeriesNumber - secondSeries.SeriesNumber;\r\n}\r\n\r\nconst seriesSortCriteria = {\r\n  default: (a, b) => a.SeriesNumber - b.SeriesNumber,\r\n  seriesInfoSortingCriteria,\r\n};\r\n\r\nconst instancesSortCriteria = {\r\n  default: (a, b) => a.InstanceNumber - b.InstanceNumber,\r\n};\r\n\r\nconst sortingCriteria = {\r\n  seriesSortCriteria,\r\n  instancesSortCriteria,\r\n};\r\n\r\n/**\r\n * Sorts given series (given param is modified)\r\n * The default criteria is based on series number in ascending order.\r\n *\r\n * @param {Array} series List of series\r\n * @param {function} seriesSortingCriteria method for sorting\r\n * @returns {Array} sorted series object\r\n */\r\nconst sortStudySeries = (\r\n  series,\r\n  seriesSortingCriteria = seriesSortCriteria.default,\r\n  sortFunction\r\n) => {\r\n  if (typeof sortFunction === 'function') return sortFunction(series);\r\n  else return series.sort(seriesSortingCriteria);\r\n};\r\n\r\n/**\r\n * Sorts given instancesList (given param is modified)\r\n * The default criteria is based on instance number in ascending order.\r\n *\r\n * @param {Array} instancesList List of series\r\n * @param {function} instancesSortingCriteria method for sorting\r\n * @returns {Array} sorted instancesList object\r\n */\r\nconst sortStudyInstances = (\r\n  instancesList,\r\n  instancesSortingCriteria = instancesSortCriteria.default\r\n) => {\r\n  return instancesList.sort(instancesSortingCriteria);\r\n};\r\n\r\n/**\r\n * Sorts the series and instances (by default) inside a study instance based on sortingCriteria (given param is modified)\r\n * The default criteria is based on series and instance numbers in ascending order.\r\n *\r\n * @param {Object} study The study instance\r\n * @param {boolean} [deepSort = true] to sort instance also\r\n * @param {function} [seriesSortingCriteria = seriesSortCriteria.default] method for sorting series\r\n * @param {function} [instancesSortingCriteria = instancesSortCriteria.default] method for sorting instances\r\n * @returns {Object} sorted study object\r\n */\r\nexport default function sortStudy(\r\n  study,\r\n  deepSort = true,\r\n  seriesSortingCriteria = seriesSortCriteria.default,\r\n  instancesSortingCriteria = instancesSortCriteria.default\r\n) {\r\n  if (!study || !study.series) {\r\n    throw new Error('Insufficient study data was provided to sortStudy');\r\n  }\r\n\r\n  sortStudySeries(study.series, seriesSortingCriteria);\r\n\r\n  if (deepSort) {\r\n    study.series.forEach(series => {\r\n      sortStudyInstances(series.instances, instancesSortingCriteria);\r\n    });\r\n  }\r\n\r\n  return study;\r\n}\r\n\r\nexport { sortStudy, sortStudySeries, sortStudyInstances, sortingCriteria };\r\n","import dcmjs from 'dcmjs';\r\nimport { sortStudySeries, sortingCriteria } from '../utils/sortStudy';\r\nimport RetrieveMetadataLoader from './retrieveMetadataLoader';\r\n\r\n\r\n/**\r\n * Creates an immutable series loader object which loads each series sequentially using the iterator interface\r\n * @param {DICOMWebClient} dicomWebClient The DICOMWebClient instance to be used for series load\r\n * @param {string} studyInstanceUID The Study Instance UID from which series will be loaded\r\n * @param {Array} seriesInstanceUIDList A list of Series Instance UIDs\r\n * @returns {Object} Returns an object which supports loading of instances from each of given Series Instance UID\r\n */\r\nfunction makeSeriesAsyncLoader(\r\n  client,\r\n  studyInstanceUID,\r\n  seriesInstanceUIDList\r\n) {\r\n  return Object.freeze({\r\n    hasNext() {\r\n      return seriesInstanceUIDList.length > 0;\r\n    },\r\n    async next() {\r\n      const seriesInstanceUID = seriesInstanceUIDList.shift();\r\n      return client.retrieveSeriesMetadata({\r\n        studyInstanceUID,\r\n        seriesInstanceUID,\r\n      });\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Class for async load of study metadata.\r\n * It inherits from RetrieveMetadataLoader\r\n *\r\n * It loads the one series and then append to seriesLoader the others to be consumed/loaded\r\n */\r\nexport default class RetrieveMetadataLoaderAsync extends RetrieveMetadataLoader {\r\n  /**\r\n   * @returns {Array} Array of preLoaders. To be consumed as queue\r\n   */\r\n  *getPreLoaders() {\r\n    const preLoaders = [];\r\n    const {\r\n      studyInstanceUID,\r\n      filters: { seriesInstanceUID } = {},\r\n      client,\r\n    } = this;\r\n\r\n    if (seriesInstanceUID) {\r\n      const options = {\r\n        studyInstanceUID,\r\n        queryParams: { SeriesInstanceUID: seriesInstanceUID },\r\n      };\r\n      preLoaders.push(client.searchForSeries.bind(client, options));\r\n    }\r\n    // Fallback preloader\r\n    preLoaders.push(client.searchForSeries.bind(client, { studyInstanceUID }));\r\n\r\n    yield* preLoaders;\r\n  }\r\n\r\n  async preLoad() {\r\n    const preLoaders = this.getPreLoaders();\r\n    const result = await this.runLoaders(preLoaders);\r\n    const sortCriteria = this.sortCriteria;\r\n    const sortFunction = this.sortFunction;\r\n\r\n    const { naturalizeDataset } = dcmjs.data.DicomMetaDictionary;\r\n    const naturalized = result.map(naturalizeDataset);\r\n\r\n    return sortStudySeries(\r\n      naturalized,\r\n      sortCriteria ||\r\n        sortingCriteria.seriesSortCriteria.seriesInfoSortingCriteria,\r\n      sortFunction\r\n    );\r\n  }\r\n\r\n  async load(preLoadData) {\r\n    const { client, studyInstanceUID } = this;\r\n\r\n    const seriesInstanceUIDs = preLoadData.map(s => s.SeriesInstanceUID);\r\n\r\n    const seriesAsyncLoader = makeSeriesAsyncLoader(\r\n      client,\r\n      studyInstanceUID,\r\n      seriesInstanceUIDs\r\n    );\r\n\r\n    const promises = [];\r\n\r\n    while (seriesAsyncLoader.hasNext()) {\r\n      promises.push(seriesAsyncLoader.next());\r\n    }\r\n\r\n    return {\r\n      preLoadData,\r\n      promises,\r\n    };\r\n  }\r\n\r\n  async posLoad({ preLoadData, promises }) {\r\n    return {\r\n      preLoadData,\r\n      promises,\r\n    };\r\n  }\r\n}\r\n","/**\r\n * Class to define inheritance of load retrieve strategy.\r\n * The process can be async load (lazy) or sync load\r\n *\r\n * There are methods that must be implemented at consumer level\r\n * To retrieve study call execLoad\r\n */\r\nexport default class RetrieveMetadataLoader {\r\n  /**\r\n   * @constructor\r\n   * @param {Object} client The dicomweb-client.\r\n   * @param {Array} studyInstanceUID Study instance ui to be retrieved\r\n   * @param {Object} [filters] - Object containing filters to be applied on retrieve metadata process\r\n   * @param {string} [filter.seriesInstanceUID] - series instance uid to filter results against\r\n   * @param {Function} [sortSeries] - Custom sort function for series\r\n   */\r\n  constructor(\r\n    client,\r\n    studyInstanceUID,\r\n    filters = {},\r\n    sortCriteria,\r\n    sortFunction\r\n  ) {\r\n    this.client = client;\r\n    this.studyInstanceUID = studyInstanceUID;\r\n    this.filters = filters;\r\n    this.sortCriteria = sortCriteria;\r\n    this.sortFunction = sortFunction;\r\n  }\r\n\r\n  async execLoad() {\r\n    const preLoadData = await this.preLoad();\r\n    const loadData = await this.load(preLoadData);\r\n    const postLoadData = await this.posLoad(loadData);\r\n\r\n    return postLoadData;\r\n  }\r\n\r\n  /**\r\n   * It iterates over given loaders running each one. Loaders parameters must be bind when getting it.\r\n   * @param {Array} loaders - array of loader to retrieve data.\r\n   */\r\n  async runLoaders(loaders) {\r\n    let result;\r\n    for (const loader of loaders) {\r\n      try {\r\n        result = await loader();\r\n        if (result && result.length) {\r\n          break; // closes iterator in case data is retrieved successfully\r\n        }\r\n      } catch (e) {\r\n        throw e;\r\n      }\r\n    }\r\n\r\n    if (loaders.next().done && !result) {\r\n      throw new Error('RetrieveMetadataLoader failed');\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  // Methods to be overwrite\r\n  async configLoad() {}\r\n  async preLoad() {}\r\n  async load(preLoadData) {}\r\n  async posLoad(loadData) {}\r\n}\r\n","//import RetrieveMetadataLoaderSync from './retrieveMetadataLoaderSync';\r\nimport RetrieveMetadataLoaderAsync from './retrieveMetadataLoaderAsync';\r\n\r\n/**\r\n * Retrieve Study metadata from a DICOM server. If the server is configured to use lazy load, only the first series\r\n * will be loaded and the property \"studyLoader\" will be set to let consumer load remaining series as needed.\r\n *\r\n * @param {Object} dicomWebClient The dicomweb-client.\r\n * @param {string} studyInstanceUid The Study Instance UID of the study which needs to be loaded\r\n * @param {Object} [filters] - Object containing filters to be applied on retrieve metadata process\r\n * @param {string} [filter.seriesInstanceUID] - series instance uid to filter results against\r\n * @returns {Object} A study descriptor object\r\n */\r\nasync function RetrieveMetadata(\r\n  dicomWebClient,\r\n  studyInstanceUid,\r\n  enableStudyLazyLoad,\r\n  filters = {},\r\n  sortCriteria,\r\n  sortFunction\r\n) {\r\n  // const RetrieveMetadataLoader =\r\n  //   enableStudyLazyLoad !== false\r\n  //     ? RetrieveMetadataLoaderAsync\r\n  //     : RetrieveMetadataLoaderSync;\r\n\r\n  const RetrieveMetadataLoader = RetrieveMetadataLoaderAsync;\r\n\r\n  const retrieveMetadataLoader = new RetrieveMetadataLoader(\r\n    dicomWebClient,\r\n    studyInstanceUid,\r\n    filters,\r\n    sortCriteria,\r\n    sortFunction\r\n  );\r\n  const { preLoadData, promises } = await retrieveMetadataLoader.execLoad();\r\n\r\n  return {\r\n    seriesSummaryMetadata: preLoadData,\r\n    seriesPromises: promises,\r\n  };\r\n}\r\n\r\nexport default RetrieveMetadata;\r\n","import RetrieveMetadata from './wado/retrieveMetadata.js';\r\n\r\nconst moduleName = 'RetrieveStudyMetadata';\r\n// Cache for promises. Prevents unnecessary subsequent calls to the server\r\nconst StudyMetaDataPromises = new Map();\r\n\r\n/**\r\n * Retrieves study metadata\r\n *\r\n * @param {Object} server Object with server configuration parameters\r\n * @param {string} StudyInstanceUID The UID of the Study to be retrieved\r\n * @param {boolean} enabledStudyLazyLoad Whether the study metadata should be loaded asynchronusly.\r\n * @param {function} storeInstancesCallback A callback used to store the retrieved instance metadata.\r\n * @param {Object} [filters] - Object containing filters to be applied on retrieve metadata process\r\n * @param {string} [filter.seriesInstanceUID] - series instance uid to filter results against\r\n * @returns {Promise} that will be resolved with the metadata or rejected with the error\r\n */\r\nexport function retrieveStudyMetadata(\r\n  dicomWebClient,\r\n  StudyInstanceUID,\r\n  enableStudyLazyLoad,\r\n  filters,\r\n  sortCriteria,\r\n  sortFunction\r\n) {\r\n  // @TODO: Whenever a study metadata request has failed, its related promise will be rejected once and for all\r\n  // and further requests for that metadata will always fail. On failure, we probably need to remove the\r\n  // corresponding promise from the \"StudyMetaDataPromises\" map...\r\n\r\n  if (!dicomWebClient) {\r\n    throw new Error(\r\n      `${moduleName}: Required 'dicomWebClient' parameter not provided.`\r\n    );\r\n  }\r\n  if (!StudyInstanceUID) {\r\n    throw new Error(\r\n      `${moduleName}: Required 'StudyInstanceUID' parameter not provided.`\r\n    );\r\n  }\r\n\r\n  // Already waiting on result? Return cached promise\r\n  if (StudyMetaDataPromises.has(StudyInstanceUID)) {\r\n    return StudyMetaDataPromises.get(StudyInstanceUID);\r\n  }\r\n\r\n  // Create a promise to handle the data retrieval\r\n  const promise = new Promise((resolve, reject) => {\r\n    RetrieveMetadata(\r\n      dicomWebClient,\r\n      StudyInstanceUID,\r\n      enableStudyLazyLoad,\r\n      filters,\r\n      sortCriteria,\r\n      sortFunction\r\n    ).then(function(data) {\r\n      resolve(data);\r\n    }, reject);\r\n  });\r\n\r\n  // Store the promise in cache\r\n  StudyMetaDataPromises.set(StudyInstanceUID, promise);\r\n\r\n  return promise;\r\n}\r\n\r\n/**\r\n * Delete the cached study metadata retrieval promise to ensure that the browser will\r\n * re-retrieve the study metadata when it is next requested\r\n *\r\n * @param {String} StudyInstanceUID The UID of the Study to be removed from cache\r\n *\r\n */\r\nexport function deleteStudyMetadataPromise(StudyInstanceUID) {\r\n  if (StudyMetaDataPromises.has(StudyInstanceUID)) {\r\n    StudyMetaDataPromises.delete(StudyInstanceUID);\r\n  }\r\n}\r\n","import { api } from 'dicomweb-client';\r\n\r\n/**\r\n * An implementation of the static wado client, that fetches data from\r\n * a static response rather than actually doing real queries.  This allows\r\n * fast encoding of test data, but because it is static, anything actually\r\n * performing searches doesn't work.  This version fixes the query issue\r\n * by manually implementing a query option.\r\n */\r\nexport default class StaticWadoClient extends api.DICOMwebClient {\r\n  static filterKeys = {\r\n    \"StudyInstanceUID\": \"0020000D\",\r\n    \"PatientName\": \"00100010\",\r\n    \"00100020\": \"mrn\",\r\n    \"StudyDescription\": \"00081030\",\r\n    \"StudyDate\": \"00080020\",\r\n    \"ModalitiesInStudy\": \"00080061\",\r\n  };\r\n\r\n  constructor(qidoConfig) {\r\n    super(qidoConfig);\r\n    this.staticWado = qidoConfig.staticWado;\r\n  }\r\n\r\n  /**\r\n   * Replace the search for studies remote query with a local version which\r\n   * retrieves a complete query list and then sub-selects from it locally.\r\n   * @param {*} options\r\n   * @returns\r\n   */\r\n  async searchForStudies(options) {\r\n    if (!this.staticWado) return super.searchForStudies(options);\r\n\r\n    let searchResult = await super.searchForStudies(options);\r\n    const { queryParams } = options;\r\n    if (!queryParams) return searchResult;\r\n    const filtered = searchResult.filter(study => {\r\n      for (const key of Object.keys(StaticWadoClient.filterKeys)) {\r\n        if (!this.filterItem(key, queryParams, study)) return false;\r\n      }\r\n      return true;\r\n    });\r\n    return filtered;\r\n  }\r\n\r\n  /**\r\n   * Compares values, matching any instance of desired to any instance of\r\n   * actual by recursively go through the paired set of values.  That is,\r\n   * this is O(m*n) where m is how many items in desired and n is the length of actual\r\n   * Then, at the individual item node, compares the Alphabetic name if present,\r\n   * and does a sub-string matching on string values, and otherwise does an\r\n   * exact match comparison.\r\n   *\r\n   * @param {*} desired\r\n   * @param {*} actual\r\n   * @returns true if the values match\r\n   */\r\n  compareValues(desired, actual) {\r\n    if (Array.isArray(desired)) {\r\n      return desired.find(item => this.compareValues(item, actual));\r\n    }\r\n    if (Array.isArray(actual)) {\r\n      return actual.find(actualItem => this.compareValues(desired, actualItem));\r\n    }\r\n    if (actual?.Alphabetic) {\r\n      actual = actual.Alphabetic;\r\n    }\r\n    if (typeof (actual) == 'string') {\r\n      return actual.indexOf(desired) != -1;\r\n    }\r\n    return desired === actual;\r\n  }\r\n\r\n  /** Compares a pair of dates to see if the value is within the range */\r\n  compareDateRange(range, value) {\r\n    if (!value) return true;\r\n    const dash = range.indexOf('-');\r\n    if (dash === -1) return this.compareValues(range, value);\r\n    const start = range.substring(0, dash);\r\n    const end = range.substring(dash + 1);\r\n    return (!start || value >= start) &&\r\n      (!end || value <= end);\r\n  }\r\n\r\n  /**\r\n   * Filters the return list by the query parameters.\r\n   *\r\n   * @param {*} key\r\n   * @param {*} queryParams\r\n   * @param {*} study\r\n   * @returns\r\n   */\r\n  filterItem(key, queryParams, study) {\r\n    const altKey = StaticWadoClient.filterKeys[key] || key;\r\n    if (!queryParams) return true;\r\n    const testValue = queryParams[key] || queryParams[altKey];\r\n    if (!testValue) return true;\r\n    const valueElem = study[key] || study[altKey];\r\n    if (!valueElem) return false;\r\n    if (valueElem.vr == 'DA') return this.compareDateRange(testValue, valueElem.Value[0]);\r\n    const value = valueElem.Value;\r\n    return this.compareValues(testValue, value) && true;\r\n  }\r\n}\r\n","import { api } from 'dicomweb-client';\r\nimport {\r\n  mapParams,\r\n  search as qidoSearch,\r\n  seriesInStudy,\r\n  processResults,\r\n  processSeriesResults,\r\n} from './qido.js';\r\nimport dcm4cheeReject from './dcm4cheeReject';\r\nimport { DicomMetadataStore, IWebApiDataSource, utils, errorHandler } from '@ohif/core';\r\n\r\nimport getImageId from './utils/getImageId';\r\nimport dcmjs from 'dcmjs';\r\nimport {\r\n  retrieveStudyMetadata,\r\n  deleteStudyMetadataPromise,\r\n} from './retrieveStudyMetadata.js';\r\nimport StaticWadoClient from './utils/StaticWadoClient.js';\r\n\r\nconst { DicomMetaDictionary, DicomDict } = dcmjs.data;\r\n\r\nconst { naturalizeDataset, denaturalizeDataset } = DicomMetaDictionary;\r\nconst { urlUtil } = utils;\r\n\r\nconst ImplementationClassUID =\r\n  '2.25.270695996825855179949881587723571202391.2.0.0';\r\nconst ImplementationVersionName = 'OHIF-VIEWER-2.0.0';\r\nconst EXPLICIT_VR_LITTLE_ENDIAN = '1.2.840.10008.1.2.1';\r\n\r\n/**\r\n *\r\n * @param {string} name - Data source name\r\n * @param {string} wadoUriRoot - Legacy? (potentially unused/replaced)\r\n * @param {string} qidoRoot - Base URL to use for QIDO requests\r\n * @param {string} wadoRoot - Base URL to use for WADO requests\r\n * @param {boolean} qidoSupportsIncludeField - Whether QIDO supports the \"Include\" option to request additional fields in response\r\n * @param {string} imageRengering - wadors | ? (unsure of where/how this is used)\r\n * @param {string} thumbnailRendering - wadors | ? (unsure of where/how this is used)\r\n * @param {bool} supportsReject - Whether the server supports reject calls (i.e. DCM4CHEE)\r\n * @param {bool} lazyLoadStudy - \"enableStudyLazyLoad\"; Request series meta async instead of blocking\r\n */\r\nfunction createDicomWebApi(dicomWebConfig, UserAuthenticationService) {\r\n  const {\r\n    qidoRoot,\r\n    wadoRoot,\r\n    enableStudyLazyLoad,\r\n    supportsFuzzyMatching,\r\n    supportsWildcard,\r\n    supportsReject,\r\n    staticWado,\r\n  } = dicomWebConfig;\r\n\r\n  const qidoConfig = {\r\n    url: qidoRoot,\r\n    staticWado,\r\n    headers: UserAuthenticationService.getAuthorizationHeader(),\r\n    errorInterceptor: errorHandler.getHTTPErrorHandler(),\r\n  };\r\n\r\n  const wadoConfig = {\r\n    url: wadoRoot,\r\n    headers: UserAuthenticationService.getAuthorizationHeader(),\r\n    errorInterceptor: errorHandler.getHTTPErrorHandler(),\r\n  };\r\n\r\n  // TODO -> Two clients sucks, but its better than 1000.\r\n  // TODO -> We'll need to merge auth later.\r\n  const qidoDicomWebClient = staticWado ? new StaticWadoClient(qidoConfig) : new api.DICOMwebClient(qidoConfig);\r\n  const wadoDicomWebClient = new api.DICOMwebClient(wadoConfig);\r\n\r\n  const implementation = {\r\n    initialize: ({ params, query }) => {\r\n      const { StudyInstanceUIDs: paramsStudyInstanceUIDs } = params;\r\n      const queryStudyInstanceUIDs = query.get('StudyInstanceUIDs');\r\n\r\n      const StudyInstanceUIDs =\r\n        queryStudyInstanceUIDs || paramsStudyInstanceUIDs;\r\n      const StudyInstanceUIDsAsArray =\r\n        StudyInstanceUIDs && Array.isArray(StudyInstanceUIDs)\r\n          ? StudyInstanceUIDs\r\n          : [StudyInstanceUIDs];\r\n      return StudyInstanceUIDsAsArray;\r\n    },\r\n    query: {\r\n      studies: {\r\n        mapParams: mapParams.bind(),\r\n        search: async function (origParams) {\r\n          const headers = UserAuthenticationService.getAuthorizationHeader();\r\n          if (headers) {\r\n            qidoDicomWebClient.headers = headers;\r\n          }\r\n\r\n          const { studyInstanceUid, seriesInstanceUid, ...mappedParams } =\r\n            mapParams(origParams, {\r\n              supportsFuzzyMatching,\r\n              supportsWildcard,\r\n            }) || {};\r\n\r\n          const results = await qidoSearch(\r\n            qidoDicomWebClient,\r\n            undefined,\r\n            undefined,\r\n            mappedParams\r\n          );\r\n\r\n          return processResults(results);\r\n        },\r\n        processResults: processResults.bind(),\r\n      },\r\n      series: {\r\n        // mapParams: mapParams.bind(),\r\n        search: async function (studyInstanceUid) {\r\n          const headers = UserAuthenticationService.getAuthorizationHeader();\r\n          if (headers) {\r\n            qidoDicomWebClient.headers = headers;\r\n          }\r\n\r\n          const results = await seriesInStudy(\r\n            qidoDicomWebClient,\r\n            studyInstanceUid\r\n          );\r\n\r\n          return processSeriesResults(results);\r\n        },\r\n        // processResults: processResults.bind(),\r\n      },\r\n      instances: {\r\n        search: (studyInstanceUid, queryParameters) => {\r\n          const headers = UserAuthenticationService.getAuthorizationHeader();\r\n          if (headers) {\r\n            qidoDicomWebClient.headers = headers;\r\n          }\r\n\r\n          qidoSearch.call(\r\n            undefined,\r\n            qidoDicomWebClient,\r\n            studyInstanceUid,\r\n            null,\r\n            queryParameters\r\n          );\r\n        },\r\n      },\r\n    },\r\n    retrieve: {\r\n      series: {\r\n        // TODO: change queryParams to `StudyInstanceUID` for now?\r\n        // Conduct query, return a promise like others\r\n        // Await this call and add to DicomMetadataStore after receiving result\r\n        metadata: (queryParams, callback) => {\r\n          const headers = UserAuthenticationService.getAuthorizationHeader();\r\n          if (headers) {\r\n            wadoDicomWebClient.headers = headers;\r\n          }\r\n\r\n          let { StudyInstanceUIDs } = urlUtil.parse(queryParams, true);\r\n\r\n          StudyInstanceUIDs = urlUtil.paramString.parseParam(StudyInstanceUIDs);\r\n\r\n          if (!StudyInstanceUIDs) {\r\n            throw new Error(\r\n              'Incomplete queryParams, missing StudyInstanceUIDs'\r\n            );\r\n          }\r\n\r\n\r\n          const storeInstances = instances => {\r\n            const naturalizedInstances = instances.map(naturalizeDataset);\r\n            DicomMetadataStore.addInstances(naturalizedInstances);\r\n            callback(naturalizedInstances);\r\n          };\r\n          const studyPromises = StudyInstanceUIDs.map(StudyInstanceUID =>\r\n            retrieveStudyMetadata(\r\n              wadoDicomWebClient,\r\n              StudyInstanceUID,\r\n              enableStudyLazyLoad\r\n            )\r\n          );\r\n\r\n          studyPromises.forEach(studyPromise => {\r\n            studyPromise.then(data => {\r\n              const { seriesPromises } = data;\r\n              seriesPromises.forEach(seriesPromise => {\r\n                seriesPromise.then(instances => {\r\n                  storeInstances(instances);\r\n                });\r\n              });\r\n            });\r\n          });\r\n        },\r\n      },\r\n    },\r\n    store: {\r\n      dicom: async dataset => {\r\n        const headers = UserAuthenticationService.getAuthorizationHeader();\r\n        if (headers) {\r\n          wadoDicomWebClient.headers = headers;\r\n        }\r\n\r\n        const meta = {\r\n          FileMetaInformationVersion:\r\n            dataset._meta.FileMetaInformationVersion.Value,\r\n          MediaStorageSOPClassUID: dataset.SOPClassUID,\r\n          MediaStorageSOPInstanceUID: dataset.SOPInstanceUID,\r\n          TransferSyntaxUID: EXPLICIT_VR_LITTLE_ENDIAN,\r\n          ImplementationClassUID,\r\n          ImplementationVersionName,\r\n        };\r\n\r\n        const denaturalized = denaturalizeDataset(meta);\r\n        const dicomDict = new DicomDict(denaturalized);\r\n\r\n        dicomDict.dict = denaturalizeDataset(dataset);\r\n\r\n        const part10Buffer = dicomDict.write();\r\n\r\n        const options = {\r\n          datasets: [part10Buffer],\r\n        };\r\n\r\n        await wadoDicomWebClient.storeInstances(options);\r\n      },\r\n    },\r\n    // TODO: Rename this it makes no sense at all\r\n    retrieveSeriesMetadata: async ({\r\n      StudyInstanceUID,\r\n      filters,\r\n      sortCriteria,\r\n      sortFunction,\r\n      madeInClient = false,\r\n    } = {}) => {\r\n      const headers = UserAuthenticationService.getAuthorizationHeader();\r\n      if (headers) {\r\n        wadoDicomWebClient.headers = headers;\r\n      }\r\n\r\n      if (!StudyInstanceUID) {\r\n        throw new Error(\r\n          'Unable to query for SeriesMetadata without StudyInstanceUID'\r\n        );\r\n      }\r\n\r\n      // Get Series\r\n      const {\r\n        seriesSummaryMetadata,\r\n        seriesPromises,\r\n      } = await retrieveStudyMetadata(\r\n        wadoDicomWebClient,\r\n        StudyInstanceUID,\r\n        enableStudyLazyLoad,\r\n        filters,\r\n        sortCriteria,\r\n        sortFunction\r\n      );\r\n\r\n      /**\r\n       * naturalizes the dataset, and adds a retrieve bulkdata method\r\n       * to any values containing BulkDataURI.\r\n       * @param {*} instance\r\n       * @returns naturalized dataset, with retrieveBulkData methods\r\n       */\r\n      const addRetrieveBulkData = instance => {\r\n        const naturalized = naturalizeDataset(instance);\r\n        Object.keys(naturalized).forEach(key => {\r\n          const value = naturalized[key];\r\n          // The value.Value will be set with the bulkdata read value\r\n          // in which case it isn't necessary to re-read this.\r\n          if (value && value.BulkDataURI && !value.Value) {\r\n            // Provide a method to fetch bulkdata\r\n            value.retrieveBulkData = () => {\r\n              const options = {\r\n                // The bulkdata fetches work with either multipart or\r\n                // singlepart, so set multipart to false to let the server\r\n                // decide which type to respond with.\r\n                multipart: false,\r\n                BulkDataURI: value.BulkDataURI,\r\n                // The study instance UID is required if the bulkdata uri\r\n                // is relative - that isn't disallowed by DICOMweb, but\r\n                // isn't well specified in the standard, but is needed in\r\n                // any implementation that stores static copies of the metadata\r\n                StudyInstanceUID: naturalized.StudyInstanceUID,\r\n              };\r\n              return qidoDicomWebClient.retrieveBulkData(options).then(val => {\r\n                const ret = val && val[0] || undefined;\r\n                value.Value = ret;\r\n                return ret;\r\n              });\r\n            };\r\n          }\r\n        });\r\n        return naturalized\r\n      };\r\n\r\n      // Async load series, store as retrieved\r\n      function storeInstances(instances) {\r\n        const naturalizedInstances = instances.map(addRetrieveBulkData);\r\n\r\n        DicomMetadataStore.addInstances(naturalizedInstances, madeInClient);\r\n      }\r\n\r\n      function setSuccessFlag() {\r\n        const study = DicomMetadataStore.getStudy(\r\n          StudyInstanceUID,\r\n          madeInClient\r\n        );\r\n        study.isLoaded = true;\r\n      }\r\n\r\n      // Google Cloud Healthcare doesn't return StudyInstanceUID, so we need to add\r\n      // it manually here\r\n      seriesSummaryMetadata.forEach(aSeries => { aSeries.StudyInstanceUID = StudyInstanceUID })\r\n\r\n      DicomMetadataStore.addSeriesMetadata(seriesSummaryMetadata, madeInClient);\r\n\r\n      const numberOfSeries = seriesPromises.length;\r\n      seriesPromises.forEach(async (seriesPromise, index) => {\r\n        const instances = await seriesPromise;\r\n        storeInstances(instances);\r\n        if (index === numberOfSeries - 1) setSuccessFlag();\r\n      });\r\n    },\r\n    deleteStudyMetadataPromise,\r\n    getImageIdsForDisplaySet(displaySet) {\r\n      const images = displaySet.images;\r\n      const imageIds = [];\r\n\r\n      if (!images) {\r\n        return imageIds;\r\n      }\r\n\r\n      displaySet.images.forEach(instance => {\r\n        const NumberOfFrames = instance.NumberOfFrames;\r\n\r\n        if (NumberOfFrames > 1) {\r\n          for (let i = 0; i < NumberOfFrames; i++) {\r\n            const imageId = this.getImageIdsForInstance({\r\n              instance,\r\n              frame: i,\r\n            });\r\n            imageIds.push(imageId);\r\n          }\r\n        } else {\r\n          const imageId = this.getImageIdsForInstance({ instance });\r\n          imageIds.push(imageId);\r\n        }\r\n      });\r\n\r\n      return imageIds;\r\n    },\r\n    getImageIdsForInstance({ instance, frame }) {\r\n      const imageIds = getImageId({\r\n        instance,\r\n        frame,\r\n        config: dicomWebConfig,\r\n      });\r\n      return imageIds;\r\n    },\r\n  };\r\n\r\n  if (supportsReject) {\r\n    implementation.reject = dcm4cheeReject(wadoRoot);\r\n  }\r\n\r\n  return IWebApiDataSource.create(implementation);\r\n}\r\n\r\nexport { createDicomWebApi };\r\n","export default function (wadoRoot) {\r\n  return {\r\n    series: (StudyInstanceUID, SeriesInstanceUID) => {\r\n      return new Promise((resolve, reject) => {\r\n        // Reject because of Quality. (Seems the most sensible out of the options)\r\n        const CodeValueAndCodeSchemeDesignator = `113001%5EDCM`;\r\n\r\n        const url = `${wadoRoot}/studies/${StudyInstanceUID}/series/${SeriesInstanceUID}/reject/${CodeValueAndCodeSchemeDesignator}`;\r\n\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open('POST', url, true);\r\n\r\n        //Send the proper header information along with the request\r\n        // TODO -> Auth when we re-add authorization.\r\n\r\n        console.log(xhr);\r\n\r\n        xhr.onreadystatechange = function () {\r\n          //Call a function when the state changes.\r\n          if (xhr.readyState == 4) {\r\n            switch (xhr.status) {\r\n              case 204:\r\n                resolve(xhr.responseText);\r\n\r\n                break;\r\n              case 404:\r\n                reject('Your dataSource does not support reject functionality');\r\n            }\r\n          }\r\n        };\r\n        xhr.send();\r\n      });\r\n    },\r\n  };\r\n}\r\n","import { DicomMetadataStore, IWebApiDataSource } from '@ohif/core';\r\nimport OHIF from '@ohif/core';\r\n\r\nimport getImageId from '../DicomWebDataSource/utils/getImageId';\r\n\r\nconst metadataProvider = OHIF.classes.MetadataProvider;\r\n\r\nconst mappings = {\r\n  studyInstanceUid: 'StudyInstanceUID',\r\n  patientId: 'PatientID',\r\n};\r\n\r\nlet _store = {\r\n  urls: [],\r\n  // {\r\n  //   url: url1\r\n  //   studies: [Study1, Study2], // if multiple studies\r\n  // }\r\n  // {\r\n  //   url: url2\r\n  //   studies: [Study1],\r\n  // }\r\n  // }\r\n};\r\n\r\nconst getMetaDataByURL = url => {\r\n  return _store.urls.find(metaData => metaData.url === url);\r\n};\r\n\r\nconst findStudies = (key, value) => {\r\n  let studies = [];\r\n  _store.urls.map(metaData => {\r\n    metaData.studies.map(aStudy => {\r\n      if (aStudy[key] === value) {\r\n        studies.push(aStudy);\r\n      }\r\n    });\r\n  });\r\n  return studies;\r\n};\r\n\r\nfunction createDicomJSONApi(dicomJsonConfig) {\r\n  const { name } = dicomJsonConfig;\r\n\r\n  const implementation = {\r\n    initialize: async ({ params, query, url }) => {\r\n      if (!url) url = query.get('url');\r\n      let metaData = getMetaDataByURL(url);\r\n\r\n      // if we have already cached the data from this specific url\r\n      // We are only handling one StudyInstanceUID to run; however,\r\n      // all studies for patientID will be put in the correct tab\r\n      if (metaData) {\r\n        return metaData.studies.map(aStudy => {\r\n          return aStudy.StudyInstanceUID;\r\n        });\r\n      }\r\n\r\n      const response = await fetch(url);\r\n      let data = await response.json();\r\n\r\n      const studyInstanceUIDs = data.studies.map(\r\n        study => study.StudyInstanceUID\r\n      );\r\n\r\n      let StudyInstanceUID;\r\n      let SeriesInstanceUID;\r\n      data.studies.forEach(study => {\r\n        StudyInstanceUID = study.StudyInstanceUID;\r\n\r\n        study.series.forEach(series => {\r\n          SeriesInstanceUID = series.SeriesInstanceUID;\r\n\r\n          series.instances.forEach(instance => {\r\n            const { url: imageId, metadata: naturalizedDicom } = instance;\r\n\r\n            // Add imageId specific mapping to this data as the URL isn't necessarliy WADO-URI.\r\n            metadataProvider.addImageIdToUIDs(imageId, {\r\n              StudyInstanceUID,\r\n              SeriesInstanceUID,\r\n              SOPInstanceUID: naturalizedDicom.SOPInstanceUID,\r\n            });\r\n          });\r\n        });\r\n      });\r\n\r\n      _store.urls.push({\r\n        url,\r\n        studies: [...data.studies],\r\n      });\r\n\r\n      return studyInstanceUIDs;\r\n    },\r\n    query: {\r\n      studies: {\r\n        mapParams: () => {},\r\n        search: async param => {\r\n          const [key, value] = Object.entries(param)[0];\r\n          const mappedParam = mappings[key];\r\n\r\n          // todo: should fetch from dicomMetadataStore\r\n          const studies = findStudies(mappedParam, value);\r\n\r\n          return studies.map(aStudy => {\r\n            return {\r\n              accession: aStudy.AccessionNumber,\r\n              date: aStudy.StudyDate,\r\n              description: aStudy.StudyDescription,\r\n              instances: aStudy.NumInstances,\r\n              modalities: aStudy.Modalities,\r\n              mrn: aStudy.PatientID,\r\n              patientName: aStudy.PatientName,\r\n              studyInstanceUid: aStudy.StudyInstanceUID,\r\n              NumInstances: aStudy.NumInstances,\r\n              time: aStudy.StudyTime,\r\n            };\r\n          });\r\n        },\r\n        processResults: () => {\r\n          console.debug(' DICOMJson QUERY processResults');\r\n        },\r\n      },\r\n      series: {\r\n        // mapParams: mapParams.bind(),\r\n        search: () => {\r\n          console.debug(' DICOMJson QUERY SERIES SEARCH');\r\n        },\r\n      },\r\n      instances: {\r\n        search: () => {\r\n          console.debug(' DICOMJson QUERY instances SEARCH');\r\n        },\r\n      },\r\n    },\r\n    retrieve: {\r\n      series: {\r\n        metaData: () => {\r\n          console.debug(' DICOMJson retrieve series metadata');\r\n        },\r\n      },\r\n    },\r\n    store: {\r\n      dicom: () => {\r\n        console.debug(' DICOMJson store dicom');\r\n      },\r\n    },\r\n    retrieveSeriesMetadata: ({\r\n      StudyInstanceUID,\r\n      madeInClient = false,\r\n      customSort,\r\n    } = {}) => {\r\n      if (!StudyInstanceUID) {\r\n        throw new Error(\r\n          'Unable to query for SeriesMetadata without StudyInstanceUID'\r\n        );\r\n      }\r\n\r\n      const study = findStudies('StudyInstanceUID', StudyInstanceUID)[0];\r\n      let series;\r\n\r\n      if (customSort) {\r\n        series = customSort(study.series);\r\n      } else {\r\n        series = study.series;\r\n      }\r\n\r\n      const seriesSummaryMetadata = series.map(series => {\r\n        const seriesSummary = {\r\n          StudyInstanceUID: study.StudyInstanceUID,\r\n          ...series,\r\n        };\r\n        delete seriesSummary.instances;\r\n        return seriesSummary;\r\n      });\r\n\r\n      // Async load series, store as retrieved\r\n      function storeInstances(naturalizedInstances) {\r\n        DicomMetadataStore.addInstances(naturalizedInstances, madeInClient);\r\n      }\r\n\r\n      DicomMetadataStore.addSeriesMetadata(seriesSummaryMetadata, madeInClient);\r\n\r\n      function setSuccessFlag() {\r\n        const study = DicomMetadataStore.getStudy(\r\n          StudyInstanceUID,\r\n          madeInClient\r\n        );\r\n        study.isLoaded = true;\r\n      }\r\n\r\n      const numberOfSeries = series.length;\r\n      series.forEach((series, index) => {\r\n        const instances = series.instances.map(instance => {\r\n          const obj = {\r\n            ...instance.metadata,\r\n            url: instance.url,\r\n            imageId: instance.url,\r\n            ...series,\r\n          };\r\n          delete obj.instances;\r\n          return obj;\r\n        });\r\n        storeInstances(instances);\r\n        if (index === numberOfSeries - 1) setSuccessFlag();\r\n      });\r\n    },\r\n    getImageIdsForDisplaySet(displaySet) {\r\n      const images = displaySet.images;\r\n      const imageIds = [];\r\n\r\n      if (!images) {\r\n        return imageIds;\r\n      }\r\n\r\n      displaySet.images.forEach(instance => {\r\n        const NumberOfFrames = instance.NumberOfFrames;\r\n\r\n        if (NumberOfFrames > 1) {\r\n          for (let i = 0; i < NumberOfFrames; i++) {\r\n            const imageId = getImageId({\r\n              instance,\r\n              frame: i,\r\n              config: dicomJsonConfig,\r\n            });\r\n            imageIds.push(imageId);\r\n          }\r\n        } else {\r\n          const imageId = getImageId({ instance, config: dicomJsonConfig });\r\n          imageIds.push(imageId);\r\n        }\r\n      });\r\n\r\n      return imageIds;\r\n    },\r\n    getImageIdsForInstance({ instance, frame }) {\r\n      const imageIds = getImageId({\r\n        instance,\r\n        frame,\r\n      });\r\n      return imageIds;\r\n    },\r\n  };\r\n  return IWebApiDataSource.create(implementation);\r\n}\r\n\r\nexport { createDicomJSONApi };\r\n","import { DicomMetadataStore, IWebApiDataSource } from '@ohif/core'\r\nimport OHIF from '@ohif/core'\r\nimport dcmjs from 'dcmjs';\r\n\r\nconst metadataProvider = OHIF.classes.MetadataProvider\r\nconst { EVENTS } = DicomMetadataStore\r\n\r\n// Sorting SR modalities to be at the end of series list\r\nfunction customSort(seriesA, seriesB) {\r\n  const modalityA = seriesA.instances[0].Modality\r\n  const modalityB = seriesB.instances[0].Modality\r\n\r\n  if (modalityA === \"SR\") {\r\n    return +1;\r\n  }\r\n  if (modalityB === \"SR\") {\r\n    return -1;\r\n  }\r\n  return 0;\r\n}\r\n\r\n\r\nfunction createDicomLocalApi(dicomLocalConfig) {\r\n  const { name } = dicomLocalConfig\r\n\r\n  const implementation = {\r\n    initialize: ({ params, query }) => {\r\n      const { StudyInstanceUIDs: paramsStudyInstanceUIDs } = params\r\n      const queryStudyInstanceUIDs = query.get('StudyInstanceUIDs')\r\n\r\n      const StudyInstanceUIDs =\r\n        queryStudyInstanceUIDs || paramsStudyInstanceUIDs\r\n      const StudyInstanceUIDsAsArray =\r\n        StudyInstanceUIDs && Array.isArray(StudyInstanceUIDs)\r\n          ? StudyInstanceUIDs\r\n          : [StudyInstanceUIDs]\r\n\r\n\r\n      // Put SRs at the end of series list to make sure images are loaded first\r\n      StudyInstanceUIDsAsArray.forEach(StudyInstanceUID => {\r\n        const study = DicomMetadataStore.getStudy(StudyInstanceUID)\r\n        study.series = study.series.sort(customSort)\r\n      })\r\n\r\n      return StudyInstanceUIDsAsArray\r\n    },\r\n    query: {\r\n      studies: {\r\n        mapParams: () => { },\r\n        search: (params) => {\r\n          const studyUIDs = DicomMetadataStore.getStudyInstanceUIDs()\r\n\r\n          return studyUIDs.map(StudyInstanceUID => {\r\n            let numInstances = 0\r\n            const modalities = new Set()\r\n\r\n            // Calculating the number of instances in the study and modalities\r\n            // present in the study\r\n            const study = DicomMetadataStore.getStudy(StudyInstanceUID)\r\n            study.series.forEach(aSeries => {\r\n              numInstances += aSeries.instances.length\r\n              modalities.add(aSeries.Modality);\r\n            })\r\n\r\n            // first instance in the first series\r\n            const firstInstance = study?.series[0]?.instances[0]\r\n\r\n            if (firstInstance) {\r\n              return {\r\n                accession: firstInstance.AccessionNumber,\r\n                date: firstInstance.StudyDate,\r\n                description: firstInstance.StudyDescription,\r\n                mrn: firstInstance.PatientID,\r\n                patientName: { Alphabetic: firstInstance.PatientName },\r\n                studyInstanceUid: firstInstance.StudyInstanceUID,\r\n                time: firstInstance.StudyTime,\r\n                //\r\n                instances: numInstances,\r\n                modalities: Array.from(modalities).join('/'),\r\n                NumInstances: numInstances,\r\n              };\r\n            }\r\n          })\r\n        },\r\n        processResults: () => {\r\n          console.debug(' DICOMLocal QUERY processResults')\r\n        },\r\n      },\r\n      series: {\r\n        // mapParams: mapParams.bind(),\r\n        search: () => {\r\n          console.debug(' DICOMLocal QUERY SERIES SEARCH')\r\n        },\r\n      },\r\n      instances: {\r\n        search: () => {\r\n          console.debug(' DICOMLocal QUERY instances SEARCH')\r\n        },\r\n      },\r\n    },\r\n    retrieve: {\r\n      series: {\r\n        metaData: () => {\r\n          console.debug(' DICOMLocal retrieve series metadata')\r\n        },\r\n      },\r\n    },\r\n    store: {\r\n      dicom: (naturalizedReport) => {\r\n        const reportBlob = dcmjs.data.datasetToBlob(naturalizedReport);\r\n\r\n        //Create a URL for the binary.\r\n        var objectUrl = URL.createObjectURL(reportBlob);\r\n        window.location.assign(objectUrl);\r\n      },\r\n    },\r\n    retrieveSeriesMetadata: async ({\r\n      StudyInstanceUID,\r\n      madeInClient = false,\r\n    } = {}) => {\r\n      if (!StudyInstanceUID) {\r\n        throw new Error(\r\n          'Unable to query for SeriesMetadata without StudyInstanceUID'\r\n        )\r\n      }\r\n\r\n      // Instances metadata already added via local upload\r\n      const study = DicomMetadataStore.getStudy(StudyInstanceUID, madeInClient)\r\n\r\n      // Series metadata already added via local upload\r\n      DicomMetadataStore._broadcastEvent(EVENTS.SERIES_ADDED, {\r\n        StudyInstanceUID,\r\n        madeInClient,\r\n      })\r\n\r\n      study.series.forEach((aSeries) => {\r\n        const { SeriesInstanceUID } = aSeries\r\n\r\n        aSeries.instances.forEach((instance) => {\r\n          const {\r\n            url: imageId,\r\n            StudyInstanceUID,\r\n            SeriesInstanceUID,\r\n            SOPInstanceUID,\r\n          } = instance\r\n\r\n            // Add imageId specific mapping to this data as the URL isn't necessarily WADO-URI.\r\n            metadataProvider.addImageIdToUIDs(imageId, {\r\n              StudyInstanceUID,\r\n              SeriesInstanceUID,\r\n              SOPInstanceUID,\r\n            })\r\n          })\r\n\r\n        DicomMetadataStore._broadcastEvent(EVENTS.INSTANCES_ADDED, {\r\n          StudyInstanceUID,\r\n          SeriesInstanceUID,\r\n          madeInClient,\r\n        })\r\n      })\r\n\r\n    },\r\n    getImageIdsForDisplaySet(displaySet) {\r\n      const images = displaySet.images\r\n      const imageIds = []\r\n\r\n      if (!images) {\r\n        return imageIds\r\n      }\r\n\r\n      displaySet.images.forEach((instance) => {\r\n        const NumberOfFrames = instance.NumberOfFrames\r\n\r\n        if (NumberOfFrames > 1) {\r\n          for (let i = 0; i < NumberOfFrames; i++) {\r\n            const imageId = this.getImageIdsForInstance({\r\n              instance,\r\n              frame: i,\r\n            })\r\n            imageIds.push(imageId)\r\n          }\r\n        } else {\r\n          const imageId = this.getImageIdsForInstance({ instance })\r\n          imageIds.push(imageId)\r\n        }\r\n      })\r\n\r\n      return imageIds\r\n    },\r\n    getImageIdsForInstance({ instance, frame }) {\r\n      const { StudyInstanceUID, SeriesInstanceUID, SOPInstanceUID } = instance\r\n      const storedInstance = DicomMetadataStore.getInstance(StudyInstanceUID, SeriesInstanceUID, SOPInstanceUID)\r\n      if (storedInstance.url) {\r\n        return storedInstance.url\r\n      }\r\n    },\r\n    deleteStudyMetadataPromise() {\r\n      console.log(\"deleteStudyMetadataPromise not implemented\")\r\n    }\r\n  }\r\n  return IWebApiDataSource.create(implementation)\r\n}\r\n\r\nexport { createDicomLocalApi }\r\n","// TODO: Pull in IWebClientApi from @ohif/core\r\n// TODO: Use constructor to create an instance of IWebClientApi\r\n// TODO: Use existing DICOMWeb configuration (previously, appConfig, to configure instance)\r\n\r\nimport { createDicomWebApi } from './DicomWebDataSource/index.js';\r\nimport { createDicomJSONApi } from './DicomJSONDataSource/index.js';\r\nimport { createDicomLocalApi } from './DicomLocalDataSource/index.js';\r\n\r\n/**\r\n *\r\n */\r\nfunction getDataSourcesModule() {\r\n  return [\r\n    {\r\n      name: 'dicomweb',\r\n      type: 'webApi',\r\n      createDataSource: createDicomWebApi,\r\n    },\r\n    {\r\n      name: 'dicomjson',\r\n      type: 'jsonApi',\r\n      createDataSource: createDicomJSONApi,\r\n    },\r\n    {\r\n      name: 'dicomlocal',\r\n      type: 'localApi',\r\n      createDataSource: createDicomLocalApi,\r\n    },\r\n  ];\r\n}\r\n\r\nexport default getDataSourcesModule;\r\n","import React, { useEffect, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useTranslation } from 'react-i18next';\r\nimport {\r\n  SidePanel,\r\n  ErrorBoundary,\r\n  UserPreferences,\r\n  AboutModal,\r\n  Header,\r\n  useModal,\r\n} from '@ohif/ui';\r\n\r\nimport i18n from '@ohif/i18n';\r\nimport { hotkeys } from '@ohif/core';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst { availableLanguages, defaultLanguage, currentLanguage } = i18n;\r\n\r\nimport { useAppConfig } from '@state';\r\n\r\nfunction Toolbar({ servicesManager }) {\r\n  const { ToolBarService } = servicesManager.services;\r\n  const [toolbarButtons, setToolbarButtons] = useState([]);\r\n  const [buttonState, setButtonState] = useState({\r\n    primaryToolId: '',\r\n    toggles: {},\r\n    groups: {},\r\n  });\r\n\r\n  // Could track buttons and state separately...?\r\n  useEffect(() => {\r\n    const { unsubscribe: unsub1 } = ToolBarService.subscribe(\r\n      ToolBarService.EVENTS.TOOL_BAR_MODIFIED,\r\n      () => setToolbarButtons(ToolBarService.getButtonSection('primary'))\r\n    );\r\n    const { unsubscribe: unsub2 } = ToolBarService.subscribe(\r\n      ToolBarService.EVENTS.TOOL_BAR_STATE_MODIFIED,\r\n      () => setButtonState({ ...ToolBarService.state })\r\n    );\r\n\r\n    return () => {\r\n      unsub1();\r\n      unsub2();\r\n    };\r\n  }, [ToolBarService]);\r\n\r\n  return (\r\n    <>\r\n      {toolbarButtons.map((toolDef, index) => {\r\n        const { id, Component, componentProps } = toolDef;\r\n        // TODO: ...\r\n\r\n        // isActive if:\r\n        // - id is primary?\r\n        // - id is in list of \"toggled on\"?\r\n        let isActive;\r\n        if (componentProps.type === 'toggle') {\r\n          isActive = buttonState.toggles[id];\r\n        }\r\n        // Also need... to filter list for splitButton, and set primary based on most recently clicked\r\n        // Also need to kill the radioGroup button's magic logic\r\n        // Everything should be reactive off these props, so commands can inform ToolbarService\r\n\r\n        // These can... Trigger toolbar events based on updates?\r\n        // Then sync using useEffect, or simply modify the state here?\r\n        return (\r\n          <Component\r\n            key={id}\r\n            id={id}\r\n            {...componentProps}\r\n            bState={buttonState}\r\n            isActive={isActive}\r\n            onInteraction={args => ToolBarService.recordInteraction(args)}\r\n          />\r\n        );\r\n      })}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction ViewerLayout({\r\n  // From Extension Module Params\r\n  extensionManager,\r\n  servicesManager,\r\n  hotkeysManager,\r\n  commandsManager,\r\n  // From Modes\r\n  leftPanels,\r\n  rightPanels,\r\n  viewports,\r\n  ViewportGridComp,\r\n}) {\r\n  const [appConfig] = useAppConfig();\r\n  const navigate = useNavigate();\r\n\r\n  const onClickReturnButton = () => {\r\n    navigate('/')\r\n  };\r\n\r\n  const { t } = useTranslation();\r\n  const { show, hide } = useModal();\r\n\r\n  const { hotkeyDefinitions, hotkeyDefaults } = hotkeysManager;\r\n  const versionNumber = process.env.VERSION_NUMBER;\r\n  const buildNumber = process.env.BUILD_NUM;\r\n\r\n  const menuOptions = [\r\n    {\r\n      title: t('Header:About'),\r\n      icon: 'info',\r\n      onClick: () => show({ content: AboutModal, title: 'About OHIF Viewer', contentProps: { versionNumber, buildNumber } }),\r\n    },\r\n    {\r\n      title: t('Header:Preferences'),\r\n      icon: 'settings',\r\n      onClick: () =>\r\n        show({\r\n          title: t('UserPreferencesModal:User Preferences'),\r\n          content: UserPreferences,\r\n          contentProps: {\r\n            hotkeyDefaults: hotkeysManager.getValidHotkeyDefinitions(\r\n              hotkeyDefaults\r\n            ),\r\n            hotkeyDefinitions,\r\n            currentLanguage: currentLanguage(),\r\n            availableLanguages,\r\n            defaultLanguage,\r\n            onCancel: () => {\r\n              hotkeys.stopRecord();\r\n              hotkeys.unpause();\r\n              hide();\r\n            },\r\n            onSubmit: ({ hotkeyDefinitions, language }) => {\r\n              i18n.changeLanguage(language.value);\r\n              hotkeysManager.setHotkeys(hotkeyDefinitions);\r\n              hide();\r\n            },\r\n            onReset: () => hotkeysManager.restoreDefaultBindings(),\r\n            hotkeysModule: hotkeys\r\n          },\r\n        }),\r\n    },\r\n  ];\r\n\r\n  /**\r\n   * Set body classes (tailwindcss) that don't allow vertical\r\n   * or horizontal overflow (no scrolling). Also guarantee window\r\n   * is sized to our viewport.\r\n   */\r\n  useEffect(() => {\r\n    document.body.classList.add('bg-black');\r\n    document.body.classList.add('overflow-hidden');\r\n    return () => {\r\n      document.body.classList.remove('bg-black');\r\n      document.body.classList.remove('overflow-hidden');\r\n    };\r\n  }, []);\r\n\r\n  const getPanelData = id => {\r\n    const entry = extensionManager.getModuleEntry(id);\r\n    // TODO, not sure why sidepanel content has to be JSX, and not a children prop?\r\n    const content = entry.component;\r\n\r\n    return {\r\n      iconName: entry.iconName,\r\n      iconLabel: entry.iconLabel,\r\n      label: entry.label,\r\n      name: entry.name,\r\n      content,\r\n    };\r\n  };\r\n\r\n  const getViewportComponentData = viewportComponent => {\r\n    const entry = extensionManager.getModuleEntry(viewportComponent.namespace);\r\n\r\n    return {\r\n      component: entry.component,\r\n      displaySetsToDisplay: viewportComponent.displaySetsToDisplay,\r\n    };\r\n  };\r\n\r\n  const leftPanelComponents = leftPanels.map(getPanelData);\r\n  const rightPanelComponents = rightPanels.map(getPanelData);\r\n  const viewportComponents = viewports.map(getViewportComponentData);\r\n\r\n  return (\r\n    <div>\r\n      <Header menuOptions={menuOptions} onClickReturnButton={onClickReturnButton} WhiteLabeling={appConfig.whiteLabeling} >\r\n        <ErrorBoundary context=\"Primary Toolbar\">\r\n          <div className=\"relative flex justify-center\">\r\n            <Toolbar servicesManager={servicesManager} />\r\n          </div>\r\n        </ErrorBoundary>\r\n      </Header>\r\n      <div\r\n        className=\"flex flex-row flex-nowrap items-stretch w-full overflow-hidden\"\r\n        style={{ height: 'calc(100vh - 52px' }}\r\n      >\r\n        {/* LEFT SIDEPANELS */}\r\n        {leftPanelComponents.length && (\r\n          <ErrorBoundary context=\"Left Panel\">\r\n            <SidePanel\r\n              side=\"left\"\r\n              defaultComponentOpen={leftPanelComponents[0].name}\r\n              childComponents={leftPanelComponents}\r\n            />\r\n          </ErrorBoundary>\r\n        )}\r\n        {/* TOOLBAR + GRID */}\r\n        <div className=\"flex flex-col flex-1 h-full\">\r\n          <div className=\"flex items-center justify-center flex-1 h-full -mt-1 overflow-hidden bg-black\">\r\n            <ErrorBoundary context=\"Grid\">\r\n              <ViewportGridComp\r\n                servicesManager={servicesManager}\r\n                viewportComponents={viewportComponents}\r\n                commandsManager={commandsManager}\r\n              />\r\n            </ErrorBoundary>\r\n          </div>\r\n        </div>\r\n        {rightPanelComponents.length && (\r\n          <ErrorBoundary context=\"Right Panel\">\r\n            <SidePanel\r\n              side=\"right\"\r\n              defaultComponentOpen={rightPanelComponents[0].name}\r\n              childComponents={rightPanelComponents}\r\n            />\r\n          </ErrorBoundary>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nViewerLayout.propTypes = {\r\n  // From extension module params\r\n  extensionManager: PropTypes.shape({\r\n    getModuleEntry: PropTypes.func.isRequired,\r\n  }).isRequired,\r\n  commandsManager: PropTypes.object,\r\n  // From modes\r\n  leftPanels: PropTypes.array,\r\n  rightPanels: PropTypes.array,\r\n  /** Responsible for rendering our grid of viewports; provided by consuming application */\r\n  children: PropTypes.oneOfType([PropTypes.node, PropTypes.func]).isRequired,\r\n};\r\n\r\nViewerLayout.defaultProps = {\r\n  leftPanels: [],\r\n  rightPanels: [],\r\n};\r\n\r\nexport default ViewerLayout;\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { StudyBrowser, useImageViewer } from '@ohif/ui';\r\nimport { utils } from '@ohif/core';\r\n\r\nconst { formatDate } = utils;\r\n\r\n/**\r\n *\r\n * @param {*} param0\r\n */\r\nfunction PanelStudyBrowser({\r\n  DisplaySetService,\r\n  getImageSrc,\r\n  getStudiesForPatientByStudyInstanceUID,\r\n  requestDisplaySetCreationForStudy,\r\n  dataSource,\r\n}) {\r\n  // Normally you nest the components so the tree isn't so deep, and the data\r\n  // doesn't have to have such an intense shape. This works well enough for now.\r\n  // Tabs --> Studies --> DisplaySets --> Thumbnails\r\n  const { StudyInstanceUIDs } = useImageViewer();\r\n  const [activeTabName, setActiveTabName] = useState('primary');\r\n  const [expandedStudyInstanceUIDs, setExpandedStudyInstanceUIDs] = useState([\r\n    ...StudyInstanceUIDs,\r\n  ]);\r\n  const [studyDisplayList, setStudyDisplayList] = useState([]);\r\n  const [displaySets, setDisplaySets] = useState([]);\r\n  const [thumbnailImageSrcMap, setThumbnailImageSrcMap] = useState({});\r\n  const isMounted = useRef(true);\r\n\r\n  // ~~ studyDisplayList\r\n  useEffect(() => {\r\n    // Fetch all studies for the patient in each primary study\r\n    async function fetchStudiesForPatient(StudyInstanceUID) {\r\n      const qidoStudiesForPatient =\r\n        (await getStudiesForPatientByStudyInstanceUID(StudyInstanceUID)) || [];\r\n\r\n      // TODO: This should be \"naturalized DICOM JSON\" studies\r\n      const mappedStudies = _mapDataSourceStudies(qidoStudiesForPatient);\r\n      const actuallyMappedStudies = mappedStudies.map(qidoStudy => {\r\n        return {\r\n          studyInstanceUid: qidoStudy.StudyInstanceUID,\r\n          date: formatDate(qidoStudy.StudyDate),\r\n          description: qidoStudy.StudyDescription,\r\n          modalities: qidoStudy.ModalitiesInStudy,\r\n          numInstances: qidoStudy.NumInstances,\r\n          // displaySets: []\r\n        };\r\n      });\r\n      if (isMounted.current) {\r\n        setStudyDisplayList(actuallyMappedStudies);\r\n      }\r\n    }\r\n\r\n    StudyInstanceUIDs.forEach(sid => fetchStudiesForPatient(sid));\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [StudyInstanceUIDs, getStudiesForPatientByStudyInstanceUID]);\r\n\r\n  // ~~ Initial Thumbnails\r\n  useEffect(() => {\r\n    const currentDisplaySets = DisplaySetService.activeDisplaySets;\r\n    currentDisplaySets.forEach(async dSet => {\r\n      const newImageSrcEntry = {};\r\n      const displaySet = DisplaySetService.getDisplaySetByUID(\r\n        dSet.displaySetInstanceUID\r\n      );\r\n      const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\r\n      const imageId = imageIds[Math.floor(imageIds.length / 2)];\r\n\r\n      // TODO: Is it okay that imageIds are not returned here for SR displaysets?\r\n      if (imageId) {\r\n        // When the image arrives, render it and store the result in the thumbnailImgSrcMap\r\n        newImageSrcEntry[dSet.displaySetInstanceUID] = await getImageSrc(\r\n          imageId\r\n        );\r\n        if (isMounted.current) {\r\n          setThumbnailImageSrcMap(prevState => {\r\n            return { ...prevState, ...newImageSrcEntry };\r\n          });\r\n        }\r\n      }\r\n    });\r\n    return () => {\r\n      isMounted.current = false;\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  // ~~ displaySets\r\n  useEffect(() => {\r\n    // TODO: Are we sure `activeDisplaySets` will always be accurate?\r\n    const currentDisplaySets = DisplaySetService.activeDisplaySets;\r\n    const mappedDisplaySets = _mapDisplaySets(\r\n      currentDisplaySets,\r\n      thumbnailImageSrcMap\r\n    );\r\n\r\n    setDisplaySets(mappedDisplaySets);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [thumbnailImageSrcMap]);\r\n\r\n  // ~~ subscriptions --> displaySets\r\n  useEffect(() => {\r\n    // DISPLAY_SETS_ADDED returns an array of DisplaySets that were added\r\n    const SubscriptionDisplaySetsAdded = DisplaySetService.subscribe(\r\n      DisplaySetService.EVENTS.DISPLAY_SETS_ADDED,\r\n      data => {\r\n        const { displaySetsAdded } = data;\r\n        displaySetsAdded.forEach(async dSet => {\r\n          const newImageSrcEntry = {};\r\n          const displaySet = DisplaySetService.getDisplaySetByUID(\r\n            dSet.displaySetInstanceUID\r\n          );\r\n          const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\r\n          const imageId = imageIds[Math.floor(imageIds.length / 2)];\r\n\r\n          // TODO: Is it okay that imageIds are not returned here for SR displaysets?\r\n          if (imageId) {\r\n            // When the image arrives, render it and store the result in the thumbnailImgSrcMap\r\n            newImageSrcEntry[dSet.displaySetInstanceUID] = await getImageSrc(\r\n              imageId,\r\n              dSet.initialViewport\r\n            );\r\n            if (isMounted.current) {\r\n              setThumbnailImageSrcMap(prevState => {\r\n                return { ...prevState, ...newImageSrcEntry };\r\n              });\r\n            }\r\n          }\r\n        });\r\n      }\r\n    );\r\n\r\n    // TODO: Will this always hold _all_ the displaySets we care about?\r\n    // DISPLAY_SETS_CHANGED returns `DisplaySerService.activeDisplaySets`\r\n    const SubscriptionDisplaySetsChanged = DisplaySetService.subscribe(\r\n      DisplaySetService.EVENTS.DISPLAY_SETS_CHANGED,\r\n      changedDisplaySets => {\r\n        const mappedDisplaySets = _mapDisplaySets(\r\n          changedDisplaySets,\r\n          thumbnailImageSrcMap\r\n        );\r\n        setDisplaySets(mappedDisplaySets);\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      SubscriptionDisplaySetsAdded.unsubscribe();\r\n      SubscriptionDisplaySetsChanged.unsubscribe();\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const tabs = _createStudyBrowserTabs(\r\n    StudyInstanceUIDs,\r\n    studyDisplayList,\r\n    displaySets\r\n  );\r\n\r\n  // TODO: Should not fire this on \"close\"\r\n  function _handleStudyClick(StudyInstanceUID) {\r\n    const shouldCollapseStudy = expandedStudyInstanceUIDs.includes(\r\n      StudyInstanceUID\r\n    );\r\n    const updatedExpandedStudyInstanceUIDs = shouldCollapseStudy\r\n      ? // eslint-disable-next-line prettier/prettier\r\n      [\r\n        ...expandedStudyInstanceUIDs.filter(\r\n          stdyUid => stdyUid !== StudyInstanceUID\r\n        ),\r\n      ]\r\n      : [...expandedStudyInstanceUIDs, StudyInstanceUID];\r\n\r\n    setExpandedStudyInstanceUIDs(updatedExpandedStudyInstanceUIDs);\r\n\r\n    if (!shouldCollapseStudy) {\r\n      const madeInClient = true\r\n      requestDisplaySetCreationForStudy(DisplaySetService, StudyInstanceUID, madeInClient);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <StudyBrowser\r\n      tabs={tabs}\r\n      activeTabName={activeTabName}\r\n      expandedStudyInstanceUIDs={expandedStudyInstanceUIDs}\r\n      onClickStudy={_handleStudyClick}\r\n      onClickTab={clickedTabName => {\r\n        setActiveTabName(clickedTabName);\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\nPanelStudyBrowser.propTypes = {\r\n  DisplaySetService: PropTypes.shape({\r\n    EVENTS: PropTypes.object.isRequired,\r\n    activeDisplaySets: PropTypes.arrayOf(PropTypes.object).isRequired,\r\n    getDisplaySetByUID: PropTypes.func.isRequired,\r\n    subscribe: PropTypes.func.isRequired,\r\n  }).isRequired,\r\n  dataSource: PropTypes.shape({\r\n    getImageIdsForDisplaySet: PropTypes.func.isRequired,\r\n  }).isRequired,\r\n  getImageSrc: PropTypes.func.isRequired,\r\n  getStudiesForPatientByStudyInstanceUID: PropTypes.func.isRequired,\r\n  requestDisplaySetCreationForStudy: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default PanelStudyBrowser;\r\n\r\n/**\r\n * Maps from the DataSource's format to a naturalized object\r\n *\r\n * @param {*} studies\r\n */\r\nfunction _mapDataSourceStudies(studies) {\r\n  return studies.map(study => {\r\n    // TODO: Why does the data source return in this format?\r\n    return {\r\n      AccessionNumber: study.accession,\r\n      StudyDate: study.date,\r\n      StudyDescription: study.description,\r\n      NumInstances: study.instances,\r\n      ModalitiesInStudy: study.modalities,\r\n      PatientID: study.mrn,\r\n      PatientName: study.patientName,\r\n      StudyInstanceUID: study.studyInstanceUid,\r\n      StudyTime: study.time,\r\n    };\r\n  });\r\n}\r\n\r\nfunction _mapDisplaySets(displaySets, thumbnailImageSrcMap) {\r\n  const thumbnailDisplaySets = [];\r\n  const thumbnailNoImageDisplaySets = [];\r\n\r\n  displaySets.forEach(ds => {\r\n    const imageSrc = thumbnailImageSrcMap[ds.displaySetInstanceUID];\r\n    const componentType = _getComponentType(ds.Modality);\r\n\r\n    const array =\r\n      componentType === 'thumbnail'\r\n        ? thumbnailDisplaySets\r\n        : thumbnailNoImageDisplaySets;\r\n\r\n    array.push({\r\n      displaySetInstanceUID: ds.displaySetInstanceUID,\r\n      description: ds.SeriesDescription || '',\r\n      seriesNumber: ds.SeriesNumber,\r\n      modality: ds.Modality,\r\n      seriesDate: ds.SeriesDate,\r\n      numInstances: ds.numImageFrames,\r\n      StudyInstanceUID: ds.StudyInstanceUID,\r\n      componentType,\r\n      imageSrc,\r\n      dragData: {\r\n        type: 'displayset',\r\n        displaySetInstanceUID: ds.displaySetInstanceUID,\r\n        // .. Any other data to pass\r\n      },\r\n    });\r\n  });\r\n\r\n  return [...thumbnailDisplaySets, ...thumbnailNoImageDisplaySets];\r\n}\r\n\r\nconst thumbnailNoImageModalities = [\r\n  'SR',\r\n  'SEG',\r\n  'RTSTRUCT',\r\n  'RTPLAN',\r\n  'RTDOSE',\r\n];\r\n\r\nfunction _getComponentType(Modality) {\r\n  if (thumbnailNoImageModalities.includes(Modality)) {\r\n    // TODO probably others.\r\n    return 'thumbnailNoImage';\r\n  }\r\n\r\n  return 'thumbnail';\r\n}\r\n\r\n/**\r\n *\r\n * @param {string[]} primaryStudyInstanceUIDs\r\n * @param {object[]} studyDisplayList\r\n * @param {string} studyDisplayList.studyInstanceUid\r\n * @param {string} studyDisplayList.date\r\n * @param {string} studyDisplayList.description\r\n * @param {string} studyDisplayList.modalities\r\n * @param {number} studyDisplayList.numInstances\r\n * @param {object[]} displaySets\r\n * @returns tabs - The prop object expected by the StudyBrowser component\r\n */\r\nfunction _createStudyBrowserTabs(\r\n  primaryStudyInstanceUIDs,\r\n  studyDisplayList,\r\n  displaySets\r\n) {\r\n  const primaryStudies = [];\r\n  const recentStudies = [];\r\n  const allStudies = [];\r\n\r\n  studyDisplayList.forEach(study => {\r\n    const displaySetsForStudy = displaySets.filter(\r\n      ds => ds.StudyInstanceUID === study.studyInstanceUid\r\n    );\r\n    const tabStudy = Object.assign({}, study, {\r\n      displaySets: displaySetsForStudy,\r\n    });\r\n\r\n    if (primaryStudyInstanceUIDs.includes(study.studyInstanceUid)) {\r\n      primaryStudies.push(tabStudy);\r\n    } else {\r\n      // TODO: Filter allStudies to dates within one year of current date\r\n      recentStudies.push(tabStudy);\r\n      allStudies.push(tabStudy);\r\n    }\r\n  });\r\n\r\n  const tabs = [\r\n    {\r\n      name: 'primary',\r\n      label: 'Primary',\r\n      studies: primaryStudies,\r\n    },\r\n    {\r\n      name: 'recent',\r\n      label: 'Recent',\r\n      studies: recentStudies,\r\n    },\r\n    {\r\n      name: 'all',\r\n      label: 'All',\r\n      studies: allStudies,\r\n    },\r\n  ];\r\n\r\n  return tabs;\r\n}\r\n","/**\r\n * @param {*} cornerstone\r\n * @param {*} imageId\r\n */\r\nfunction getImageSrcFromImageId(cornerstone, imageId) {\r\n  return new Promise((resolve, reject) => {\r\n    cornerstone\r\n      .loadAndCacheImage(imageId)\r\n      .then(image => {\r\n        const canvas = document.createElement('canvas');\r\n        cornerstone.renderToCanvas(canvas, image);\r\n\r\n        resolve(canvas.toDataURL());\r\n      })\r\n      .catch(reject);\r\n  });\r\n}\r\n\r\nexport default getImageSrcFromImageId;\r\n","async function getStudiesForPatientByStudyInstanceUID(\r\n  dataSource,\r\n  StudyInstanceUID\r\n) {\r\n  if (StudyInstanceUID === undefined) {\r\n    return;\r\n  }\r\n  // TODO: The `DicomMetadataStore` should short-circuit both of these requests\r\n  // Data _could_ be here from route query, or if using JSON data source\r\n  // We could also force this to \"await\" these values being available in the DICOMStore?\r\n  // Kind of like promise fulfillment in cornerstone-wado-image-loader when there are multiple\r\n  // outgoing requests for the same data\r\n  const getStudyResult = await dataSource.query.studies.search({\r\n    studyInstanceUid: StudyInstanceUID,\r\n  });\r\n\r\n  // TODO: To Erik's point, the data source likely shouldn't deviate from\r\n  // Naturalized DICOM JSON when returning. It makes things like this awkward (mrn)\r\n  if (getStudyResult && getStudyResult.length && getStudyResult[0].mrn) {\r\n    return dataSource.query.studies.search({\r\n      patientId: getStudyResult[0].mrn,\r\n    });\r\n  }\r\n}\r\n\r\nexport default getStudiesForPatientByStudyInstanceUID;\r\n","function requestDisplaySetCreationForStudy(\r\n  dataSource,\r\n  DisplaySetService,\r\n  StudyInstanceUID,\r\n  madeInClient,\r\n) {\r\n  // TODO: is this already short-circuited by the map of Retrieve promises?\r\n  if (\r\n    DisplaySetService.activeDisplaySets.some(\r\n      displaySet => displaySet.StudyInstanceUID === StudyInstanceUID\r\n    )\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  dataSource.retrieveSeriesMetadata({ StudyInstanceUID, madeInClient });\r\n}\r\n\r\nexport default requestDisplaySetCreationForStudy;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n//\r\nimport PanelStudyBrowser from './PanelStudyBrowser';\r\nimport getImageSrcFromImageId from './getImageSrcFromImageId';\r\nimport getStudiesForPatientByStudyInstanceUID from './getStudiesForPatientByStudyInstanceUID';\r\nimport requestDisplaySetCreationForStudy from './requestDisplaySetCreationForStudy';\r\n\r\n/**\r\n * Wraps the PanelStudyBrowser and provides features afforded by managers/services\r\n *\r\n * @param {object} params\r\n * @param {object} commandsManager\r\n * @param {object} extensionManager\r\n */\r\nfunction WrappedPanelStudyBrowser({\r\n  commandsManager,\r\n  extensionManager,\r\n  servicesManager,\r\n}) {\r\n  // TODO: This should be made available a different way; route should have\r\n  // already determined our datasource\r\n  const dataSource = extensionManager.getDataSources()[0];\r\n  const _getStudiesForPatientByStudyInstanceUID = getStudiesForPatientByStudyInstanceUID.bind(\r\n    null,\r\n    dataSource\r\n  );\r\n  const _getImageSrcFromImageId = _createGetImageSrcFromImageIdFn(\r\n    commandsManager.getCommand.bind(commandsManager)\r\n  );\r\n  const _requestDisplaySetCreationForStudy = requestDisplaySetCreationForStudy.bind(\r\n    null,\r\n    dataSource\r\n  );\r\n\r\n  return (\r\n    <PanelStudyBrowser\r\n      DisplaySetService={servicesManager.services.DisplaySetService}\r\n      dataSource={dataSource}\r\n      getImageSrc={_getImageSrcFromImageId}\r\n      getStudiesForPatientByStudyInstanceUID={\r\n        _getStudiesForPatientByStudyInstanceUID\r\n      }\r\n      requestDisplaySetCreationForStudy={_requestDisplaySetCreationForStudy}\r\n    />\r\n  );\r\n}\r\n\r\n/**\r\n * Grabs cornerstone library reference using a dependent command from\r\n * the @ohif/extension-cornerstone extension. Then creates a helper function\r\n * that can take an imageId and return an image src.\r\n *\r\n * @param {func} getCommand - CommandManager's getCommand method\r\n * @returns {func} getImageSrcFromImageId - A utility function powered by\r\n * cornerstone\r\n */\r\nfunction _createGetImageSrcFromImageIdFn(getCommand) {\r\n  try {\r\n    const command = getCommand('getCornerstoneLibraries', 'VIEWER');\r\n    if (!command) {\r\n      return;\r\n    }\r\n    const { cornerstone } = command.commandFn();\r\n\r\n    return getImageSrcFromImageId.bind(null, cornerstone);\r\n  } catch (ex) {\r\n    throw new Error('Required command not found');\r\n  }\r\n}\r\n\r\nWrappedPanelStudyBrowser.propTypes = {\r\n  commandsManager: PropTypes.object.isRequired,\r\n  extensionManager: PropTypes.object.isRequired,\r\n  servicesManager: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default WrappedPanelStudyBrowser;\r\n","// Returns a function, that, as long as it continues to be invoked, will not\r\n// be triggered. The function will be called after it stops being called for\r\n// N milliseconds. If `immediate` is passed, trigger the function on the\r\n// leading edge, instead of the trailing.\r\nfunction debounce(func, wait, immediate) {\r\n  var timeout;\r\n  return function() {\r\n    var context = this,\r\n      args = arguments;\r\n    var later = function() {\r\n      timeout = null;\r\n      if (!immediate) func.apply(context, args);\r\n    };\r\n    var callNow = immediate && !timeout;\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n    if (callNow) func.apply(context, args);\r\n  };\r\n}\r\n\r\nexport default debounce;\r\n","import React, { useEffect, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { MeasurementTable } from '@ohif/ui';\r\nimport { DicomMetadataStore } from '@ohif/core';\r\nimport debounce from './debounce.js';\r\n\r\nexport default function PanelMeasurementTable({\r\n  servicesManager,\r\n  // commandsManager,\r\n}) {\r\n  const { MeasurementService } = servicesManager.services;\r\n  const [displayMeasurements, setDisplayMeasurements] = useState([]);\r\n\r\n  useEffect(() => {\r\n    const debouncedSetDisplayMeasurements = debounce(\r\n      setDisplayMeasurements,\r\n      100\r\n    );\r\n    // ~~ Initial\r\n    setDisplayMeasurements(_getMappedMeasurements(MeasurementService));\r\n\r\n    // ~~ Subscription\r\n    const added = MeasurementService.EVENTS.MEASUREMENT_ADDED;\r\n    const addedRaw = MeasurementService.EVENTS.RAW_MEASUREMENT_ADDED;\r\n    const updated = MeasurementService.EVENTS.MEASUREMENT_UPDATED;\r\n    const removed = MeasurementService.EVENTS.MEASUREMENT_REMOVED;\r\n    const cleared = MeasurementService.EVENTS.MEASUREMENTS_CLEARED;\r\n    const subscriptions = [];\r\n\r\n    [added, addedRaw, updated, removed, cleared].forEach(evt => {\r\n      subscriptions.push(\r\n        MeasurementService.subscribe(evt, () => {\r\n          debouncedSetDisplayMeasurements(\r\n            _getMappedMeasurements(MeasurementService)\r\n          );\r\n        }).unsubscribe\r\n      );\r\n    });\r\n\r\n    return () => {\r\n      subscriptions.forEach(unsub => {\r\n        unsub();\r\n      });\r\n    };\r\n  }, [MeasurementService]);\r\n\r\n  return (\r\n    <div className=\"overflow-x-hidden overflow-y-auto invisible-scrollbar\">\r\n      <MeasurementTable\r\n        title=\"Measurements\"\r\n        amount={displayMeasurements.length}\r\n        data={displayMeasurements}\r\n        onClick={({ id }) => alert(`Click: ${id}`)}\r\n        onEdit={({ id }) => alert(`Edit: ${id}`)}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nPanelMeasurementTable.propTypes = {\r\n  servicesManager: PropTypes.shape({\r\n    services: PropTypes.shape({\r\n      MeasurementService: PropTypes.shape({\r\n        getMeasurements: PropTypes.func.isRequired,\r\n        subscribe: PropTypes.func.isRequired,\r\n        EVENTS: PropTypes.object.isRequired,\r\n        VALUE_TYPES: PropTypes.object.isRequired,\r\n      }).isRequired,\r\n    }).isRequired,\r\n  }).isRequired,\r\n};\r\n\r\nfunction _getMappedMeasurements(MeasurementService) {\r\n  const measurements = MeasurementService.getMeasurements();\r\n  const mappedMeasurements = measurements.map((m, index) =>\r\n    _mapMeasurementToDisplay(m, index, MeasurementService.VALUE_TYPES)\r\n  );\r\n\r\n  return mappedMeasurements;\r\n}\r\n\r\nfunction _mapMeasurementToDisplay(measurement, index, types) {\r\n  const {\r\n    id,\r\n    label,\r\n    description,\r\n    // Reference IDs\r\n    referenceStudyUID,\r\n    referenceSeriesUID,\r\n    SOPInstanceUID,\r\n  } = measurement;\r\n  const instance = DicomMetadataStore.getInstance(\r\n    referenceStudyUID,\r\n    referenceSeriesUID,\r\n    SOPInstanceUID\r\n  );\r\n  const { PixelSpacing, SeriesNumber, InstanceNumber } = instance;\r\n\r\n  return {\r\n    id: index + 1,\r\n    label: '(empty)', // 'Label short description',\r\n    displayText:\r\n      _getDisplayText(\r\n        measurement,\r\n        PixelSpacing,\r\n        SeriesNumber,\r\n        InstanceNumber,\r\n        types\r\n      ) || [],\r\n    // TODO: handle one layer down\r\n    isActive: false, // activeMeasurementItem === i + 1,\r\n  };\r\n}\r\n\r\nfunction _getDisplayText(\r\n  measurement,\r\n  pixelSpacing,\r\n  seriesNumber,\r\n  instanceNumber,\r\n  types\r\n) {\r\n  const { type, points } = measurement;\r\n  const hasPixelSpacing =\r\n    pixelSpacing !== undefined &&\r\n    Array.isArray(pixelSpacing) &&\r\n    pixelSpacing.length === 2;\r\n  const [rowPixelSpacing, colPixelSpacing] = hasPixelSpacing\r\n    ? pixelSpacing\r\n    : [1, 1];\r\n  const unit = hasPixelSpacing ? 'mm' : 'px';\r\n\r\n  switch (type) {\r\n    case types.POLYLINE: {\r\n      const { length } = measurement;\r\n      const roundedLength = _round(length, 1);\r\n\r\n      return [\r\n        `${roundedLength} ${unit} (S:${seriesNumber}, I:${instanceNumber})`,\r\n      ];\r\n    }\r\n    case types.BIDIRECTIONAL: {\r\n      const { shortestDiameter, longestDiameter } = measurement;\r\n      const roundedShortestDiameter = _round(shortestDiameter, 1);\r\n      const roundedLongestDiameter = _round(longestDiameter, 1);\r\n\r\n      return [\r\n        `l: ${roundedLongestDiameter} ${unit} (S:${seriesNumber}, I:${instanceNumber})`,\r\n        `s: ${roundedShortestDiameter} ${unit}`,\r\n      ];\r\n    }\r\n    case types.ELLIPSE: {\r\n      const { area } = measurement;\r\n      const roundedArea = _round(area, 1);\r\n\r\n      return [\r\n        `${roundedArea} ${unit}2 (S:${seriesNumber}, I:${instanceNumber})`,\r\n      ];\r\n    }\r\n    case types.POINT: {\r\n      const { text } = measurement;\r\n      return [`${text} (S:${seriesNumber}, I:${instanceNumber})`];\r\n    }\r\n  }\r\n}\r\n\r\nfunction _round(value, decimals) {\r\n  return Number(Math.round(value + 'e' + decimals) + 'e-' + decimals);\r\n}\r\n","import React from 'react';\r\nimport { WrappedPanelStudyBrowser } from './Panels';\r\n\r\nimport PanelMeasurementTable from './PanelMeasurementTable.js';\r\n\r\n// TODO:\r\n// - No loading UI exists yet\r\n// - cancel promises when component is destroyed\r\n// - show errors in UI for thumbnails if promise fails\r\n\r\nfunction getPanelModule({\r\n  commandsManager,\r\n  extensionManager,\r\n  servicesManager,\r\n}) {\r\n  const wrappedMeasurementPanel = () => {\r\n    return (\r\n      <PanelMeasurementTable\r\n        commandsManager={commandsManager}\r\n        servicesManager={servicesManager}\r\n      />\r\n    );\r\n  };\r\n\r\n  return [\r\n    {\r\n      name: 'seriesList',\r\n      iconName: 'group-layers',\r\n      iconLabel: 'Studies',\r\n      label: 'Studies',\r\n      component: WrappedPanelStudyBrowser.bind(null, {\r\n        commandsManager,\r\n        extensionManager,\r\n        servicesManager,\r\n      }),\r\n    },\r\n    {\r\n      name: 'measure',\r\n      iconName: 'list-bullets',\r\n      iconLabel: 'Measure',\r\n      label: 'Measurements',\r\n      component: wrappedMeasurementPanel,\r\n    },\r\n  ];\r\n}\r\n\r\nexport default getPanelModule;\r\n","import { sopClassDictionary } from './sopClassDictionary';\r\n\r\nconst imagesTypes = [\r\n  sopClassDictionary.ComputedRadiographyImageStorage,\r\n  sopClassDictionary.DigitalXRayImageStorageForPresentation,\r\n  sopClassDictionary.DigitalXRayImageStorageForProcessing,\r\n  sopClassDictionary.DigitalMammographyXRayImageStorageForPresentation,\r\n  sopClassDictionary.DigitalMammographyXRayImageStorageForProcessing,\r\n  sopClassDictionary.DigitalIntraOralXRayImageStorageForPresentation,\r\n  sopClassDictionary.DigitalIntraOralXRayImageStorageForProcessing,\r\n  sopClassDictionary.CTImageStorage,\r\n  sopClassDictionary.EnhancedCTImageStorage,\r\n  sopClassDictionary.LegacyConvertedEnhancedCTImageStorage,\r\n  sopClassDictionary.UltrasoundMultiframeImageStorage,\r\n  sopClassDictionary.MRImageStorage,\r\n  sopClassDictionary.EnhancedMRImageStorage,\r\n  sopClassDictionary.EnhancedMRColorImageStorage,\r\n  sopClassDictionary.LegacyConvertedEnhancedMRImageStorage,\r\n  sopClassDictionary.UltrasoundImageStorage,\r\n  sopClassDictionary.SecondaryCaptureImageStorage,\r\n  sopClassDictionary.MultiframeSingleBitSecondaryCaptureImageStorage,\r\n  sopClassDictionary.MultiframeGrayscaleByteSecondaryCaptureImageStorage,\r\n  sopClassDictionary.MultiframeGrayscaleWordSecondaryCaptureImageStorage,\r\n  sopClassDictionary.MultiframeTrueColorSecondaryCaptureImageStorage,\r\n  sopClassDictionary.XRayAngiographicImageStorage,\r\n  sopClassDictionary.EnhancedXAImageStorage,\r\n  sopClassDictionary.XRayRadiofluoroscopicImageStorage,\r\n  sopClassDictionary.EnhancedXRFImageStorage,\r\n  sopClassDictionary.XRay3DAngiographicImageStorage,\r\n  sopClassDictionary.XRay3DCraniofacialImageStorage,\r\n  sopClassDictionary.BreastTomosynthesisImageStorage,\r\n  sopClassDictionary.BreastProjectionXRayImageStorageForPresentation,\r\n  sopClassDictionary.BreastProjectionXRayImageStorageForProcessing,\r\n  sopClassDictionary.IntravascularOpticalCoherenceTomographyImageStorageForPresentation,\r\n  sopClassDictionary.IntravascularOpticalCoherenceTomographyImageStorageForProcessing,\r\n  sopClassDictionary.NuclearMedicineImageStorage,\r\n  sopClassDictionary.VLEndoscopicImageStorage,\r\n  sopClassDictionary.VideoEndoscopicImageStorage,\r\n  sopClassDictionary.VLMicroscopicImageStorage,\r\n  sopClassDictionary.VideoMicroscopicImageStorage,\r\n  sopClassDictionary.VLSlideCoordinatesMicroscopicImageStorage,\r\n  sopClassDictionary.VLPhotographicImageStorage,\r\n  sopClassDictionary.VideoPhotographicImageStorage,\r\n  sopClassDictionary.OphthalmicPhotography8BitImageStorage,\r\n  sopClassDictionary.OphthalmicPhotography16BitImageStorage,\r\n  sopClassDictionary.OphthalmicTomographyImageStorage,\r\n  sopClassDictionary.VLWholeSlideMicroscopyImageStorage,\r\n  sopClassDictionary.PositronEmissionTomographyImageStorage,\r\n  sopClassDictionary.EnhancedPETImageStorage,\r\n  sopClassDictionary.LegacyConvertedEnhancedPETImageStorage,\r\n  sopClassDictionary.RTImageStorage,\r\n];\r\n\r\n/**\r\n * Checks whether dicom files with specified SOP Class UID have image data\r\n * @param {string} SOPClassUID - SOP Class UID to be checked\r\n * @returns {boolean} - true if it has image data\r\n */\r\nexport const isImage = SOPClassUID => {\r\n  if (!SOPClassUID) return false;\r\n  return imagesTypes.indexOf(SOPClassUID) !== -1;\r\n};\r\n","// TODO: Deprecate since we have the same thing in dcmjs?\r\nexport const sopClassDictionary = {\r\n  ComputedRadiographyImageStorage: '1.2.840.10008.5.1.4.1.1.1',\r\n  DigitalXRayImageStorageForPresentation: '1.2.840.10008.5.1.4.1.1.1.1',\r\n  DigitalXRayImageStorageForProcessing: '1.2.840.10008.5.1.4.1.1.1.1.1',\r\n  DigitalMammographyXRayImageStorageForPresentation:\r\n    '1.2.840.10008.5.1.4.1.1.1.2',\r\n  DigitalMammographyXRayImageStorageForProcessing:\r\n    '1.2.840.10008.5.1.4.1.1.1.2.1',\r\n  DigitalIntraOralXRayImageStorageForPresentation:\r\n    '1.2.840.10008.5.1.4.1.1.1.3',\r\n  DigitalIntraOralXRayImageStorageForProcessing:\r\n    '1.2.840.10008.5.1.4.1.1.1.3.1',\r\n  CTImageStorage: '1.2.840.10008.5.1.4.1.1.2',\r\n  EnhancedCTImageStorage: '1.2.840.10008.5.1.4.1.1.2.1',\r\n  LegacyConvertedEnhancedCTImageStorage: '1.2.840.10008.5.1.4.1.1.2.2',\r\n  UltrasoundMultiframeImageStorage: '1.2.840.10008.5.1.4.1.1.3.1',\r\n  MRImageStorage: '1.2.840.10008.5.1.4.1.1.4',\r\n  EnhancedMRImageStorage: '1.2.840.10008.5.1.4.1.1.4.1',\r\n  MRSpectroscopyStorage: '1.2.840.10008.5.1.4.1.1.4.2',\r\n  EnhancedMRColorImageStorage: '1.2.840.10008.5.1.4.1.1.4.3',\r\n  LegacyConvertedEnhancedMRImageStorage: '1.2.840.10008.5.1.4.1.1.4.4',\r\n  UltrasoundImageStorage: '1.2.840.10008.5.1.4.1.1.6.1',\r\n  EnhancedUSVolumeStorage: '1.2.840.10008.5.1.4.1.1.6.2',\r\n  SecondaryCaptureImageStorage: '1.2.840.10008.5.1.4.1.1.7',\r\n  MultiframeSingleBitSecondaryCaptureImageStorage:\r\n    '1.2.840.10008.5.1.4.1.1.7.1',\r\n  MultiframeGrayscaleByteSecondaryCaptureImageStorage:\r\n    '1.2.840.10008.5.1.4.1.1.7.2',\r\n  MultiframeGrayscaleWordSecondaryCaptureImageStorage:\r\n    '1.2.840.10008.5.1.4.1.1.7.3',\r\n  MultiframeTrueColorSecondaryCaptureImageStorage:\r\n    '1.2.840.10008.5.1.4.1.1.7.4',\r\n  Sop12LeadECGWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.1.1',\r\n  GeneralECGWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.1.2',\r\n  AmbulatoryECGWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.1.3',\r\n  HemodynamicWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.2.1',\r\n  CardiacElectrophysiologyWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.3.1',\r\n  BasicVoiceAudioWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.4.1',\r\n  GeneralAudioWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.4.2',\r\n  ArterialPulseWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.5.1',\r\n  RespiratoryWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.6.1',\r\n  GrayscaleSoftcopyPresentationStateStorage: '1.2.840.10008.5.1.4.1.1.11.1',\r\n  ColorSoftcopyPresentationStateStorage: '1.2.840.10008.5.1.4.1.1.11.2',\r\n  PseudoColorSoftcopyPresentationStateStorage: '1.2.840.10008.5.1.4.1.1.11.3',\r\n  BlendingSoftcopyPresentationStateStorage: '1.2.840.10008.5.1.4.1.1.11.4',\r\n  XAXRFGrayscaleSoftcopyPresentationStateStorage:\r\n    '1.2.840.10008.5.1.4.1.1.11.5',\r\n  XRayAngiographicImageStorage: '1.2.840.10008.5.1.4.1.1.12.1',\r\n  EnhancedXAImageStorage: '1.2.840.10008.5.1.4.1.1.12.1.1',\r\n  XRayRadiofluoroscopicImageStorage: '1.2.840.10008.5.1.4.1.1.12.2',\r\n  EnhancedXRFImageStorage: '1.2.840.10008.5.1.4.1.1.12.2.1',\r\n  XRay3DAngiographicImageStorage: '1.2.840.10008.5.1.4.1.1.13.1.1',\r\n  XRay3DCraniofacialImageStorage: '1.2.840.10008.5.1.4.1.1.13.1.2',\r\n  BreastTomosynthesisImageStorage: '1.2.840.10008.5.1.4.1.1.13.1.3',\r\n  BreastProjectionXRayImageStorageForPresentation:\r\n    '1.2.840.10008.5.1.4.1.1.13.1.4',\r\n  BreastProjectionXRayImageStorageForProcessing:\r\n    '1.2.840.10008.5.1.4.1.1.13.1.5',\r\n  IntravascularOpticalCoherenceTomographyImageStorageForPresentation:\r\n    '1.2.840.10008.5.1.4.1.1.14.1',\r\n  IntravascularOpticalCoherenceTomographyImageStorageForProcessing:\r\n    '1.2.840.10008.5.1.4.1.1.14.2',\r\n  NuclearMedicineImageStorage: '1.2.840.10008.5.1.4.1.1.20',\r\n  RawDataStorage: '1.2.840.10008.5.1.4.1.1.66',\r\n  SpatialRegistrationStorage: '1.2.840.10008.5.1.4.1.1.66.1',\r\n  SpatialFiducialsStorage: '1.2.840.10008.5.1.4.1.1.66.2',\r\n  DeformableSpatialRegistrationStorage: '1.2.840.10008.5.1.4.1.1.66.3',\r\n  SegmentationStorage: '1.2.840.10008.5.1.4.1.1.66.4',\r\n  SurfaceSegmentationStorage: '1.2.840.10008.5.1.4.1.1.66.5',\r\n  RealWorldValueMappingStorage: '1.2.840.10008.5.1.4.1.1.67',\r\n  SurfaceScanMeshStorage: '1.2.840.10008.5.1.4.1.1.68.1',\r\n  SurfaceScanPointCloudStorage: '1.2.840.10008.5.1.4.1.1.68.2',\r\n  VLEndoscopicImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.1',\r\n  VideoEndoscopicImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.1.1',\r\n  VLMicroscopicImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.2',\r\n  VideoMicroscopicImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.2.1',\r\n  VLSlideCoordinatesMicroscopicImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.3',\r\n  VLPhotographicImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.4',\r\n  VideoPhotographicImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.4.1',\r\n  OphthalmicPhotography8BitImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.5.1',\r\n  OphthalmicPhotography16BitImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.5.2',\r\n  StereometricRelationshipStorage: '1.2.840.10008.5.1.4.1.1.77.1.5.3',\r\n  OphthalmicTomographyImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.5.4',\r\n  VLWholeSlideMicroscopyImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.6',\r\n  LensometryMeasurementsStorage: '1.2.840.10008.5.1.4.1.1.78.1',\r\n  AutorefractionMeasurementsStorage: '1.2.840.10008.5.1.4.1.1.78.2',\r\n  KeratometryMeasurementsStorage: '1.2.840.10008.5.1.4.1.1.78.3',\r\n  SubjectiveRefractionMeasurementsStorage: '1.2.840.10008.5.1.4.1.1.78.4',\r\n  VisualAcuityMeasurementsStorage: '1.2.840.10008.5.1.4.1.1.78.5',\r\n  SpectaclePrescriptionReportStorage: '1.2.840.10008.5.1.4.1.1.78.6',\r\n  OphthalmicAxialMeasurementsStorage: '1.2.840.10008.5.1.4.1.1.78.7',\r\n  IntraocularLensCalculationsStorage: '1.2.840.10008.5.1.4.1.1.78.8',\r\n  MacularGridThicknessandVolumeReport: '1.2.840.10008.5.1.4.1.1.79.1',\r\n  OphthalmicVisualFieldStaticPerimetryMeasurementsStorage:\r\n    '1.2.840.10008.5.1.4.1.1.80.1',\r\n  OphthalmicThicknessMapStorage: '1.2.840.10008.5.1.4.1.1.81.1',\r\n  CornealTopographyMapStorage: '1.2.840.10008.5.1.4.1.1.82.1',\r\n  BasicTextSR: '1.2.840.10008.5.1.4.1.1.88.11',\r\n  EnhancedSR: '1.2.840.10008.5.1.4.1.1.88.22',\r\n  ComprehensiveSR: '1.2.840.10008.5.1.4.1.1.88.33',\r\n  Comprehensive3DSR: '1.2.840.10008.5.1.4.1.1.88.34',\r\n  ProcedureLog: '1.2.840.10008.5.1.4.1.1.88.40',\r\n  MammographyCADSR: '1.2.840.10008.5.1.4.1.1.88.50',\r\n  KeyObjectSelection: '1.2.840.10008.5.1.4.1.1.88.59',\r\n  ChestCADSR: '1.2.840.10008.5.1.4.1.1.88.65',\r\n  XRayRadiationDoseSR: '1.2.840.10008.5.1.4.1.1.88.67',\r\n  RadiopharmaceuticalRadiationDoseSR: '1.2.840.10008.5.1.4.1.1.88.68',\r\n  ColonCADSR: '1.2.840.10008.5.1.4.1.1.88.69',\r\n  ImplantationPlanSRDocumentStorage: '1.2.840.10008.5.1.4.1.1.88.70',\r\n  EncapsulatedPDFStorage: '1.2.840.10008.5.1.4.1.1.104.1',\r\n  EncapsulatedCDAStorage: '1.2.840.10008.5.1.4.1.1.104.2',\r\n  PositronEmissionTomographyImageStorage: '1.2.840.10008.5.1.4.1.1.128',\r\n  EnhancedPETImageStorage: '1.2.840.10008.5.1.4.1.1.130',\r\n  LegacyConvertedEnhancedPETImageStorage: '1.2.840.10008.5.1.4.1.1.128.1',\r\n  BasicStructuredDisplayStorage: '1.2.840.10008.5.1.4.1.1.131',\r\n  RTImageStorage: '1.2.840.10008.5.1.4.1.1.481.1',\r\n  RTDoseStorage: '1.2.840.10008.5.1.4.1.1.481.2',\r\n  RTStructureSetStorage: '1.2.840.10008.5.1.4.1.1.481.3',\r\n  RTBeamsTreatmentRecordStorage: '1.2.840.10008.5.1.4.1.1.481.4',\r\n  RTPlanStorage: '1.2.840.10008.5.1.4.1.1.481.5',\r\n  RTBrachyTreatmentRecordStorage: '1.2.840.10008.5.1.4.1.1.481.6',\r\n  RTTreatmentSummaryRecordStorage: '1.2.840.10008.5.1.4.1.1.481.7',\r\n  RTIonPlanStorage: '1.2.840.10008.5.1.4.1.1.481.8',\r\n  RTIonBeamsTreatmentRecordStorage: '1.2.840.10008.5.1.4.1.1.481.9',\r\n  RTBeamsDeliveryInstructionStorage: '1.2.840.10008.5.1.4.34.7',\r\n  GenericImplantTemplateStorage: '1.2.840.10008.5.1.4.43.1',\r\n  ImplantAssemblyTemplateStorage: '1.2.840.10008.5.1.4.44.1',\r\n  ImplantTemplateGroupStorage: '1.2.840.10008.5.1.4.45.1',\r\n};\r\n","const id = 'org.ohif.default';\r\n\r\nexport default id;\r\n","import { isImage } from '@ohif/core/src/utils/isImage';\r\nimport ImageSet from '@ohif/core/src/classes/ImageSet';\r\nimport isDisplaySetReconstructable from '@ohif/core/src/utils/isDisplaySetReconstructable';\r\nimport id from './id';\r\n\r\nconst sopClassHandlerName = 'stack';\r\n\r\nconst isMultiFrame = instance => {\r\n  return instance.NumberOfFrames > 1;\r\n};\r\n\r\nconst makeDisplaySet = instances => {\r\n  const instance = instances[0];\r\n  const imageSet = new ImageSet(instances);\r\n\r\n  // set appropriate attributes to image set...\r\n  imageSet.setAttributes({\r\n    displaySetInstanceUID: imageSet.uid, // create a local alias for the imageSet UID\r\n    SeriesDate: instance.SeriesDate,\r\n    SeriesTime: instance.SeriesTime,\r\n    SeriesInstanceUID: instance.SeriesInstanceUID,\r\n    StudyInstanceUID: instance.StudyInstanceUID,\r\n    SeriesNumber: instance.SeriesNumber || 0,\r\n    FrameRate: instance.FrameTime,\r\n    SeriesDescription: instance.SeriesDescription || '',\r\n    Modality: instance.Modality,\r\n    isMultiFrame: isMultiFrame(instance),\r\n    numImageFrames: instances.length,\r\n    SOPClassHandlerId: `${id}.sopClassHandlerModule.${sopClassHandlerName}`,\r\n  });\r\n\r\n  // Sort the images in this series if needed\r\n  const shallSort = true; //!OHIF.utils.ObjectPath.get(Meteor, 'settings.public.ui.sortSeriesByIncomingOrder');\r\n  if (shallSort) {\r\n    imageSet.sortBy((a, b) => {\r\n      // Sort by InstanceNumber (0020,0013)\r\n      return (\r\n        (parseInt(a.InstanceNumber) || 0) - (parseInt(b.InstanceNumber) || 0)\r\n      );\r\n    });\r\n  }\r\n\r\n  // Include the first image instance number (after sorted)\r\n  /*imageSet.setAttribute(\r\n    'instanceNumber',\r\n    imageSet.getImage(0).InstanceNumber\r\n  );*/\r\n\r\n  /*const isReconstructable = isDisplaySetReconstructable(series, instances);\r\n\r\n  imageSet.isReconstructable = isReconstructable.value;\r\n\r\n  if (isReconstructable.missingFrames) {\r\n    // TODO -> This is currently unused, but may be used for reconstructing\r\n    // Volumes with gaps later on.\r\n    imageSet.missingFrames = isReconstructable.missingFrames;\r\n  }*/\r\n\r\n  return imageSet;\r\n};\r\n\r\nconst isSingleImageModality = modality => {\r\n  return modality === 'CR' || modality === 'MG' || modality === 'DX';\r\n};\r\n\r\nfunction getSopClassUids(instances) {\r\n  const uniqueSopClassUidsInSeries = new Set();\r\n  instances.forEach(instance => {\r\n    uniqueSopClassUidsInSeries.add(instance.SOPClassUID);\r\n  });\r\n  const sopClassUids = Array.from(uniqueSopClassUidsInSeries);\r\n\r\n  return sopClassUids;\r\n}\r\n\r\n/**\r\n * Basic SOPClassHandler:\r\n * - For all Image types that are stackable, create\r\n *   a displaySet with a stack of images\r\n *\r\n * @param {Array} sopClassHandlerModules List of SOP Class Modules\r\n * @param {SeriesMetadata} series The series metadata object from which the display sets will be created\r\n * @returns {Array} The list of display sets created for the given series object\r\n */\r\nfunction getDisplaySetsFromSeries(instances) {\r\n  // If the series has no instances, stop here\r\n  if (!instances || !instances.length) {\r\n    throw new Error('No instances were provided');\r\n  }\r\n\r\n  const displaySets = [];\r\n  const sopClassUids = getSopClassUids(instances);\r\n\r\n  // Search through the instances (InstanceMetadata object) of this series\r\n  // Split Multi-frame instances and Single-image modalities\r\n  // into their own specific display sets. Place the rest of each\r\n  // series into another display set.\r\n  const stackableInstances = [];\r\n  instances.forEach(instance => {\r\n    // All imaging modalities must have a valid value for sopClassUid (x00080016) or rows (x00280010)\r\n    if (!isImage(instance.SOPClassUID) && !instance.Rows) {\r\n      return;\r\n    }\r\n\r\n    let displaySet;\r\n\r\n    if (isMultiFrame(instance)) {\r\n      displaySet = makeDisplaySet([instance]);\r\n\r\n      displaySet.setAttributes({\r\n        sopClassUids,\r\n        isClip: true,\r\n        numImageFrames: instance.NumberOfFrames,\r\n        instanceNumber: instance.InstanceNumber,\r\n        acquisitionDatetime: instance.AcquisitionDateTime,\r\n      });\r\n      displaySets.push(displaySet);\r\n    } else if (isSingleImageModality(instance.modality)) {\r\n      displaySet = makeDisplaySet([instance]);\r\n      displaySet.setAttributes({\r\n        sopClassUids,\r\n        instanceNumber: instance.InstanceNumber,\r\n        acquisitionDatetime: instance.AcquisitionDateTime,\r\n      });\r\n      displaySets.push(displaySet);\r\n    } else {\r\n      stackableInstances.push(instance);\r\n    }\r\n  });\r\n\r\n  if (stackableInstances.length) {\r\n    const displaySet = makeDisplaySet(stackableInstances);\r\n    displaySet.setAttribute('studyInstanceUid', instances[0].StudyInstanceUID);\r\n    displaySet.setAttributes({\r\n      sopClassUids,\r\n    });\r\n    displaySets.push(displaySet);\r\n  }\r\n\r\n  return displaySets;\r\n}\r\n\r\n// TODO: Remove since we have roughly the same thing in dcmjs\r\nconst sopClassDictionary = {\r\n  ComputedRadiographyImageStorage: '1.2.840.10008.5.1.4.1.1.1',\r\n  DigitalXRayImageStorageForPresentation: '1.2.840.10008.5.1.4.1.1.1.1',\r\n  DigitalXRayImageStorageForProcessing: '1.2.840.10008.5.1.4.1.1.1.1.1',\r\n  DigitalMammographyXRayImageStorageForPresentation:\r\n    '1.2.840.10008.5.1.4.1.1.1.2',\r\n  DigitalMammographyXRayImageStorageForProcessing:\r\n    '1.2.840.10008.5.1.4.1.1.1.2.1',\r\n  DigitalIntraOralXRayImageStorageForPresentation:\r\n    '1.2.840.10008.5.1.4.1.1.1.3',\r\n  DigitalIntraOralXRayImageStorageForProcessing:\r\n    '1.2.840.10008.5.1.4.1.1.1.3.1',\r\n  CTImageStorage: '1.2.840.10008.5.1.4.1.1.2',\r\n  EnhancedCTImageStorage: '1.2.840.10008.5.1.4.1.1.2.1',\r\n  LegacyConvertedEnhancedCTImageStorage: '1.2.840.10008.5.1.4.1.1.2.2',\r\n  UltrasoundMultiframeImageStorage: '1.2.840.10008.5.1.4.1.1.3.1',\r\n  MRImageStorage: '1.2.840.10008.5.1.4.1.1.4',\r\n  EnhancedMRImageStorage: '1.2.840.10008.5.1.4.1.1.4.1',\r\n  MRSpectroscopyStorage: '1.2.840.10008.5.1.4.1.1.4.2',\r\n  EnhancedMRColorImageStorage: '1.2.840.10008.5.1.4.1.1.4.3',\r\n  LegacyConvertedEnhancedMRImageStorage: '1.2.840.10008.5.1.4.1.1.4.4',\r\n  UltrasoundImageStorage: '1.2.840.10008.5.1.4.1.1.6.1',\r\n  EnhancedUSVolumeStorage: '1.2.840.10008.5.1.4.1.1.6.2',\r\n  SecondaryCaptureImageStorage: '1.2.840.10008.5.1.4.1.1.7',\r\n  MultiframeSingleBitSecondaryCaptureImageStorage:\r\n    '1.2.840.10008.5.1.4.1.1.7.1',\r\n  MultiframeGrayscaleByteSecondaryCaptureImageStorage:\r\n    '1.2.840.10008.5.1.4.1.1.7.2',\r\n  MultiframeGrayscaleWordSecondaryCaptureImageStorage:\r\n    '1.2.840.10008.5.1.4.1.1.7.3',\r\n  MultiframeTrueColorSecondaryCaptureImageStorage:\r\n    '1.2.840.10008.5.1.4.1.1.7.4',\r\n  Sop12LeadECGWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.1.1',\r\n  GeneralECGWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.1.2',\r\n  AmbulatoryECGWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.1.3',\r\n  HemodynamicWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.2.1',\r\n  CardiacElectrophysiologyWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.3.1',\r\n  BasicVoiceAudioWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.4.1',\r\n  GeneralAudioWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.4.2',\r\n  ArterialPulseWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.5.1',\r\n  RespiratoryWaveformStorage: '1.2.840.10008.5.1.4.1.1.9.6.1',\r\n  GrayscaleSoftcopyPresentationStateStorage: '1.2.840.10008.5.1.4.1.1.11.1',\r\n  ColorSoftcopyPresentationStateStorage: '1.2.840.10008.5.1.4.1.1.11.2',\r\n  PseudoColorSoftcopyPresentationStateStorage: '1.2.840.10008.5.1.4.1.1.11.3',\r\n  BlendingSoftcopyPresentationStateStorage: '1.2.840.10008.5.1.4.1.1.11.4',\r\n  XAXRFGrayscaleSoftcopyPresentationStateStorage:\r\n    '1.2.840.10008.5.1.4.1.1.11.5',\r\n  XRayAngiographicImageStorage: '1.2.840.10008.5.1.4.1.1.12.1',\r\n  EnhancedXAImageStorage: '1.2.840.10008.5.1.4.1.1.12.1.1',\r\n  XRayRadiofluoroscopicImageStorage: '1.2.840.10008.5.1.4.1.1.12.2',\r\n  EnhancedXRFImageStorage: '1.2.840.10008.5.1.4.1.1.12.2.1',\r\n  XRay3DAngiographicImageStorage: '1.2.840.10008.5.1.4.1.1.13.1.1',\r\n  XRay3DCraniofacialImageStorage: '1.2.840.10008.5.1.4.1.1.13.1.2',\r\n  BreastTomosynthesisImageStorage: '1.2.840.10008.5.1.4.1.1.13.1.3',\r\n  BreastProjectionXRayImageStorageForPresentation:\r\n    '1.2.840.10008.5.1.4.1.1.13.1.4',\r\n  BreastProjectionXRayImageStorageForProcessing:\r\n    '1.2.840.10008.5.1.4.1.1.13.1.5',\r\n  IntravascularOpticalCoherenceTomographyImageStorageForPresentation:\r\n    '1.2.840.10008.5.1.4.1.1.14.1',\r\n  IntravascularOpticalCoherenceTomographyImageStorageForProcessing:\r\n    '1.2.840.10008.5.1.4.1.1.14.2',\r\n  NuclearMedicineImageStorage: '1.2.840.10008.5.1.4.1.1.20',\r\n  RawDataStorage: '1.2.840.10008.5.1.4.1.1.66',\r\n  SpatialRegistrationStorage: '1.2.840.10008.5.1.4.1.1.66.1',\r\n  SpatialFiducialsStorage: '1.2.840.10008.5.1.4.1.1.66.2',\r\n  DeformableSpatialRegistrationStorage: '1.2.840.10008.5.1.4.1.1.66.3',\r\n  SegmentationStorage: '1.2.840.10008.5.1.4.1.1.66.4',\r\n  SurfaceSegmentationStorage: '1.2.840.10008.5.1.4.1.1.66.5',\r\n  RealWorldValueMappingStorage: '1.2.840.10008.5.1.4.1.1.67',\r\n  SurfaceScanMeshStorage: '1.2.840.10008.5.1.4.1.1.68.1',\r\n  SurfaceScanPointCloudStorage: '1.2.840.10008.5.1.4.1.1.68.2',\r\n  VLEndoscopicImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.1',\r\n  VideoEndoscopicImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.1.1',\r\n  VLMicroscopicImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.2',\r\n  VideoMicroscopicImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.2.1',\r\n  VLSlideCoordinatesMicroscopicImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.3',\r\n  VLPhotographicImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.4',\r\n  VideoPhotographicImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.4.1',\r\n  OphthalmicPhotography8BitImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.5.1',\r\n  OphthalmicPhotography16BitImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.5.2',\r\n  StereometricRelationshipStorage: '1.2.840.10008.5.1.4.1.1.77.1.5.3',\r\n  OphthalmicTomographyImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.5.4',\r\n  VLWholeSlideMicroscopyImageStorage: '1.2.840.10008.5.1.4.1.1.77.1.6',\r\n  LensometryMeasurementsStorage: '1.2.840.10008.5.1.4.1.1.78.1',\r\n  AutorefractionMeasurementsStorage: '1.2.840.10008.5.1.4.1.1.78.2',\r\n  KeratometryMeasurementsStorage: '1.2.840.10008.5.1.4.1.1.78.3',\r\n  SubjectiveRefractionMeasurementsStorage: '1.2.840.10008.5.1.4.1.1.78.4',\r\n  VisualAcuityMeasurementsStorage: '1.2.840.10008.5.1.4.1.1.78.5',\r\n  SpectaclePrescriptionReportStorage: '1.2.840.10008.5.1.4.1.1.78.6',\r\n  OphthalmicAxialMeasurementsStorage: '1.2.840.10008.5.1.4.1.1.78.7',\r\n  IntraocularLensCalculationsStorage: '1.2.840.10008.5.1.4.1.1.78.8',\r\n  MacularGridThicknessandVolumeReport: '1.2.840.10008.5.1.4.1.1.79.1',\r\n  OphthalmicVisualFieldStaticPerimetryMeasurementsStorage:\r\n    '1.2.840.10008.5.1.4.1.1.80.1',\r\n  OphthalmicThicknessMapStorage: '1.2.840.10008.5.1.4.1.1.81.1',\r\n  CornealTopographyMapStorage: '1.2.840.10008.5.1.4.1.1.82.1',\r\n  BasicTextSR: '1.2.840.10008.5.1.4.1.1.88.11',\r\n  EnhancedSR: '1.2.840.10008.5.1.4.1.1.88.22',\r\n  ComprehensiveSR: '1.2.840.10008.5.1.4.1.1.88.33',\r\n  Comprehensive3DSR: '1.2.840.10008.5.1.4.1.1.88.34',\r\n  ProcedureLog: '1.2.840.10008.5.1.4.1.1.88.40',\r\n  MammographyCADSR: '1.2.840.10008.5.1.4.1.1.88.50',\r\n  KeyObjectSelection: '1.2.840.10008.5.1.4.1.1.88.59',\r\n  ChestCADSR: '1.2.840.10008.5.1.4.1.1.88.65',\r\n  XRayRadiationDoseSR: '1.2.840.10008.5.1.4.1.1.88.67',\r\n  RadiopharmaceuticalRadiationDoseSR: '1.2.840.10008.5.1.4.1.1.88.68',\r\n  ColonCADSR: '1.2.840.10008.5.1.4.1.1.88.69',\r\n  ImplantationPlanSRDocumentStorage: '1.2.840.10008.5.1.4.1.1.88.70',\r\n  EncapsulatedPDFStorage: '1.2.840.10008.5.1.4.1.1.104.1',\r\n  EncapsulatedCDAStorage: '1.2.840.10008.5.1.4.1.1.104.2',\r\n  PositronEmissionTomographyImageStorage: '1.2.840.10008.5.1.4.1.1.128',\r\n  EnhancedPETImageStorage: '1.2.840.10008.5.1.4.1.1.130',\r\n  LegacyConvertedEnhancedPETImageStorage: '1.2.840.10008.5.1.4.1.1.128.1',\r\n  BasicStructuredDisplayStorage: '1.2.840.10008.5.1.4.1.1.131',\r\n  RTImageStorage: '1.2.840.10008.5.1.4.1.1.481.1',\r\n  RTDoseStorage: '1.2.840.10008.5.1.4.1.1.481.2',\r\n  RTStructureSetStorage: '1.2.840.10008.5.1.4.1.1.481.3',\r\n  RTBeamsTreatmentRecordStorage: '1.2.840.10008.5.1.4.1.1.481.4',\r\n  RTPlanStorage: '1.2.840.10008.5.1.4.1.1.481.5',\r\n  RTBrachyTreatmentRecordStorage: '1.2.840.10008.5.1.4.1.1.481.6',\r\n  RTTreatmentSummaryRecordStorage: '1.2.840.10008.5.1.4.1.1.481.7',\r\n  RTIonPlanStorage: '1.2.840.10008.5.1.4.1.1.481.8',\r\n  RTIonBeamsTreatmentRecordStorage: '1.2.840.10008.5.1.4.1.1.481.9',\r\n  RTBeamsDeliveryInstructionStorage: '1.2.840.10008.5.1.4.34.7',\r\n  GenericImplantTemplateStorage: '1.2.840.10008.5.1.4.43.1',\r\n  ImplantAssemblyTemplateStorage: '1.2.840.10008.5.1.4.44.1',\r\n  ImplantTemplateGroupStorage: '1.2.840.10008.5.1.4.45.1',\r\n};\r\n\r\nconst sopClassUids = [\r\n  sopClassDictionary.ComputedRadiographyImageStorage,\r\n  sopClassDictionary.DigitalXRayImageStorageForPresentation,\r\n  sopClassDictionary.DigitalXRayImageStorageForProcessing,\r\n  sopClassDictionary.DigitalMammographyXRayImageStorageForPresentation,\r\n  sopClassDictionary.DigitalMammographyXRayImageStorageForProcessing,\r\n  sopClassDictionary.DigitalIntraOralXRayImageStorageForPresentation,\r\n  sopClassDictionary.DigitalIntraOralXRayImageStorageForProcessing,\r\n  sopClassDictionary.CTImageStorage,\r\n  sopClassDictionary.EnhancedCTImageStorage,\r\n  sopClassDictionary.LegacyConvertedEnhancedCTImageStorage,\r\n  sopClassDictionary.UltrasoundMultiframeImageStorage,\r\n  sopClassDictionary.MRImageStorage,\r\n  sopClassDictionary.EnhancedMRImageStorage,\r\n  sopClassDictionary.EnhancedMRColorImageStorage,\r\n  sopClassDictionary.LegacyConvertedEnhancedMRImageStorage,\r\n  sopClassDictionary.UltrasoundImageStorage,\r\n  sopClassDictionary.SecondaryCaptureImageStorage,\r\n  sopClassDictionary.MultiframeSingleBitSecondaryCaptureImageStorage,\r\n  sopClassDictionary.MultiframeGrayscaleByteSecondaryCaptureImageStorage,\r\n  sopClassDictionary.MultiframeGrayscaleWordSecondaryCaptureImageStorage,\r\n  sopClassDictionary.MultiframeTrueColorSecondaryCaptureImageStorage,\r\n  sopClassDictionary.XRayAngiographicImageStorage,\r\n  sopClassDictionary.EnhancedXAImageStorage,\r\n  sopClassDictionary.XRayRadiofluoroscopicImageStorage,\r\n  sopClassDictionary.EnhancedXRFImageStorage,\r\n  sopClassDictionary.XRay3DAngiographicImageStorage,\r\n  sopClassDictionary.XRay3DCraniofacialImageStorage,\r\n  sopClassDictionary.BreastTomosynthesisImageStorage,\r\n  sopClassDictionary.BreastProjectionXRayImageStorageForPresentation,\r\n  sopClassDictionary.BreastProjectionXRayImageStorageForProcessing,\r\n  sopClassDictionary.IntravascularOpticalCoherenceTomographyImageStorageForPresentation,\r\n  sopClassDictionary.IntravascularOpticalCoherenceTomographyImageStorageForProcessing,\r\n  sopClassDictionary.NuclearMedicineImageStorage,\r\n  sopClassDictionary.VLEndoscopicImageStorage,\r\n  sopClassDictionary.VideoEndoscopicImageStorage,\r\n  sopClassDictionary.VLMicroscopicImageStorage,\r\n  sopClassDictionary.VideoMicroscopicImageStorage,\r\n  sopClassDictionary.VLSlideCoordinatesMicroscopicImageStorage,\r\n  sopClassDictionary.VLPhotographicImageStorage,\r\n  sopClassDictionary.VideoPhotographicImageStorage,\r\n  sopClassDictionary.OphthalmicPhotography8BitImageStorage,\r\n  sopClassDictionary.OphthalmicPhotography16BitImageStorage,\r\n  sopClassDictionary.OphthalmicTomographyImageStorage,\r\n  sopClassDictionary.VLWholeSlideMicroscopyImageStorage,\r\n  sopClassDictionary.PositronEmissionTomographyImageStorage,\r\n  sopClassDictionary.EnhancedPETImageStorage,\r\n  sopClassDictionary.LegacyConvertedEnhancedPETImageStorage,\r\n  sopClassDictionary.RTImageStorage,\r\n];\r\n\r\nfunction getSopClassHandlerModule() {\r\n  return [\r\n    {\r\n      name: sopClassHandlerName,\r\n      sopClassUids,\r\n      getDisplaySetsFromSeries,\r\n    },\r\n  ];\r\n}\r\n\r\nexport default getSopClassHandlerModule;\r\n","const hangingProtocolName = 'petCT';\r\n\r\nconst petCTProtocol = {\r\n  id: 'PET/CT',\r\n  locked: true,\r\n  hasUpdatedPriorsInformation: false,\r\n  name: 'PET/CT',\r\n  createdDate: '2021-02-23T18:32:42.849Z',\r\n  modifiedDate: '2021-02-23T18:32:42.849Z',\r\n  availableTo: {},\r\n  editableBy: {},\r\n  protocolMatchingRules: [\r\n    {\r\n      id: 'wauZK2QNEfDPwcAQo',\r\n      weight: 1,\r\n      attribute: 'StudyInstanceUID',\r\n      constraint: {\r\n        equals: {\r\n          value: '1.3.6.1.4.1.25403.345050719074.3824.20170125112931.11',\r\n        },\r\n      },\r\n      required: true,\r\n    },\r\n  ],\r\n  stages: [\r\n    {\r\n      id: 'hYbmMy3b7pz7GLiaT',\r\n      name: 'oneByTwo',\r\n      viewportStructure: {\r\n        type: 'grid',\r\n        properties: {\r\n          rows: 2,\r\n          columns: 2,\r\n        },\r\n      },\r\n      viewports: [\r\n        {\r\n          viewportSettings: [\r\n            {\r\n              options: {\r\n                voi: {\r\n                  windowWidth: 500,\r\n                  windowCenter: 500,\r\n                },\r\n              },\r\n              commandName: '',\r\n              // Type can be viewport or prop\r\n              // viewport:  It is most suited for settings that\r\n              // should be applied before the first render\r\n              // prop: It is the type of command that can be applied\r\n              // after the image render, such as tool activations.\r\n              type: 'viewport',\r\n            },\r\n          ],\r\n          imageMatchingRules: [],\r\n          seriesMatchingRules: [\r\n            {\r\n              id: 'vSjk7NCYjtdS3XZAw',\r\n              weight: 1,\r\n              attribute: 'SeriesNumber',\r\n              constraint: {\r\n                equals: {\r\n                  value: \"4\",\r\n                },\r\n              },\r\n              required: false,\r\n            },\r\n          ],\r\n          studyMatchingRules: [],\r\n        },\r\n        {\r\n          viewportSettings: [\r\n            {\r\n              options: {\r\n                invert: true,\r\n              },\r\n              commandName: '',\r\n              type: 'viewport',\r\n            },\r\n          ],\r\n          imageMatchingRules: [\r\n\r\n          ],\r\n          seriesMatchingRules: [\r\n            {\r\n              id: 'GPEYqFLv2dwzCM322',\r\n              weight: 1,\r\n              attribute: 'SeriesNumber',\r\n              constraint: {\r\n                equals: {\r\n                  value: \"1\",\r\n                },\r\n              },\r\n              required: false,\r\n            },\r\n          ],\r\n          studyMatchingRules: [\r\n\r\n          ],\r\n        },\r\n        {\r\n          viewportSettings: [\r\n            {\r\n              options: {\r\n                invert: true,\r\n              },\r\n              commandName: '',\r\n              type: 'viewport',\r\n            },\r\n          ],\r\n          imageMatchingRules: [\r\n\r\n          ],\r\n          seriesMatchingRules: [\r\n            {\r\n              id: 'GPEYqFLv2dwzCM322',\r\n              weight: 1,\r\n              attribute: 'SeriesNumber',\r\n              constraint: {\r\n                equals: {\r\n                  value: \"6\",\r\n                },\r\n              },\r\n              required: false,\r\n            },\r\n          ],\r\n          studyMatchingRules: [\r\n\r\n          ],\r\n        },\r\n        {\r\n          viewportSettings: [\r\n            {\r\n              options: {\r\n                invert: true,\r\n              },\r\n              commandName: '',\r\n              type: 'viewport',\r\n            },\r\n          ],\r\n          imageMatchingRules: [\r\n\r\n          ],\r\n          seriesMatchingRules: [\r\n            {\r\n              id: 'GPEYqFLv2dwzCM322',\r\n              weight: 1,\r\n              attribute: 'SeriesDescription',\r\n              constraint: {\r\n                contains: {\r\n                  value: \"Corrected\",\r\n                },\r\n              },\r\n              required: false,\r\n            },\r\n            {\r\n              id: 'GPEYqFLv2dwzCM322',\r\n              weight: 2,\r\n              attribute: 'SeriesDescription',\r\n              constraint: {\r\n                doesNotContain: {\r\n                  value: \"Uncorrected\",\r\n                },\r\n              },\r\n              required: false,\r\n            },\r\n          ],\r\n          studyMatchingRules: [\r\n\r\n          ],\r\n        },\r\n      ],\r\n      createdDate: '2021-02-23T18:32:42.850Z',\r\n    },\r\n  ],\r\n  numberOfPriorsReferenced: 0,\r\n};\r\n\r\nfunction getHangingProtocolModule() {\r\n  return [\r\n    {\r\n      name: hangingProtocolName,\r\n      protocols: [petCTProtocol],\r\n    },\r\n  ];\r\n}\r\n\r\nexport default getHangingProtocolModule;\r\n","import React from 'react';\r\n\r\nexport default function ToolbarDivider() {\r\n  return (\r\n    <span className=\"self-center w-1 h-8 mx-2 border-l border-common-dark\" />\r\n  );\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport {\r\n  LayoutSelector as OHIFLayoutSelector,\r\n  ToolbarButton,\r\n  useViewportGrid,\r\n} from '@ohif/ui';\r\n\r\nfunction LayoutSelector() {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [viewportGridState, viewportGridService] = useViewportGrid();\r\n\r\n  const closeOnOutsideClick = () => {\r\n    if (isOpen) {\r\n      setIsOpen(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    window.addEventListener('click', closeOnOutsideClick);\r\n    return () => {\r\n      window.removeEventListener('click', closeOnOutsideClick);\r\n    };\r\n  }, [isOpen]);\r\n\r\n  useEffect(() => {\r\n    /* Reset to default layout when component unmounts */\r\n    return () => {\r\n      viewportGridService.setLayout({ numCols: 1, numRows: 1 });\r\n    };\r\n  }, []);\r\n\r\n  const onInteractionHandler = () => setIsOpen(!isOpen);\r\n  const DropdownContent = isOpen ? OHIFLayoutSelector : null;\r\n\r\n  return (\r\n    <ToolbarButton\r\n      id=\"Layout\"\r\n      label=\"Grid Layout\"\r\n      icon=\"tool-layout\"\r\n      onInteraction={onInteractionHandler}\r\n      dropdownContent={\r\n        DropdownContent !== null && (\r\n          <DropdownContent\r\n            onSelection={({ numRows, numCols }) => {\r\n              viewportGridService.setLayout({ numCols, numRows });\r\n            }}\r\n          />\r\n        )\r\n      }\r\n      isActive={isOpen}\r\n      type=\"toggle\"\r\n    />\r\n  );\r\n}\r\n\r\nexport default LayoutSelector;\r\n","import { SplitButton } from '@ohif/ui';\r\n\r\nexport default SplitButton;\r\n","const commandsModule = ({ servicesManager, commandsManager }) => {\r\n  const {\r\n    MeasurementService,\r\n    ViewportGridService,\r\n    ToolBarService,\r\n    HangingProtocolService,\r\n    CineService,\r\n  } = servicesManager.services;\r\n\r\n  const actions = {\r\n    clearMeasurements: () => {\r\n      MeasurementService.clear();\r\n    },\r\n    toggleCine: () => {\r\n      const { viewports } = ViewportGridService.getState();\r\n      const { isCineEnabled } = CineService.getState();\r\n      CineService.setIsCineEnabled(!isCineEnabled);\r\n      ToolBarService.setButton('Cine', { props: { isActive: !isCineEnabled } });\r\n      viewports.forEach((_, index) =>\r\n        CineService.setCine({ id: index, isPlaying: false })\r\n      );\r\n    },\r\n    nextStage: () => {\r\n      // next stage in hanging protocols\r\n      HangingProtocolService.nextProtocolStage();\r\n    },\r\n    previousStage: () => {\r\n      HangingProtocolService.previousProtocolStage();\r\n    },\r\n  };\r\n\r\n  const definitions = {\r\n    clearMeasurements: {\r\n      commandFn: actions.clearMeasurements,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    toggleCine: {\r\n      commandFn: actions.toggleCine,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    nextStage: {\r\n      commandFn: actions.nextStage,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    previousStage: {\r\n      commandFn: actions.previousStage,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n  };\r\n\r\n  return {\r\n    actions,\r\n    definitions,\r\n    defaultContext: 'DEFAULT',\r\n  };\r\n};\r\n\r\nexport default commandsModule;\r\n","import getDataSourcesModule from './getDataSourcesModule.js';\r\nimport getLayoutTemplateModule from './getLayoutTemplateModule.js';\r\nimport getPanelModule from './getPanelModule.js';\r\nimport getSopClassHandlerModule from './getSopClassHandlerModule.js';\r\nimport getHangingProtocolModule from './getHangingProtocolModule.js';\r\nimport getToolbarModule from './getToolbarModule.js';\r\nimport commandsModule from './commandsModule';\r\nimport id from './id';\r\n\r\nexport default {\r\n  /**\r\n   * Only required property. Should be a unique value across all extensions.\r\n   */\r\n  id,\r\n  getDataSourcesModule,\r\n  getHangingProtocolModule,\r\n  getLayoutTemplateModule,\r\n  getPanelModule,\r\n  getSopClassHandlerModule,\r\n  getToolbarModule,\r\n  getCommandsModule({ servicesManager, commandsManager }) {\r\n    return commandsModule({ servicesManager, commandsManager });\r\n  },\r\n};\r\n","import ViewerLayout from './ViewerLayout';\r\n/*\r\n- Define layout for the viewer in mode configuration.\r\n- Pass in the viewport types that can populate the viewer.\r\n- Init layout based on the displaySets and the objects.\r\n*/\r\n\r\nexport default function ({\r\n  servicesManager,\r\n  extensionManager,\r\n  commandsManager,\r\n  hotkeysManager\r\n}) {\r\n  function ViewerLayoutWithServices(props) {\r\n    return ViewerLayout({\r\n      servicesManager,\r\n      extensionManager,\r\n      commandsManager,\r\n      hotkeysManager,\r\n      ...props,\r\n    });\r\n  }\r\n\r\n  return [\r\n    // Layout Template Definition\r\n    // TODO: this is weird naming\r\n    {\r\n      name: 'viewerLayout',\r\n      id: 'viewerLayout',\r\n      component: ViewerLayoutWithServices,\r\n    },\r\n  ];\r\n}\r\n","import { ToolbarButton } from '@ohif/ui';\r\nimport ToolbarDivider from './Toolbar/ToolbarDivider.jsx';\r\nimport ToolbarLayoutSelector from './Toolbar/ToolbarLayoutSelector.jsx';\r\nimport ToolbarSplitButton from './Toolbar/ToolbarSplitButton.jsx';\r\n\r\nexport default function getToolbarModule({ commandsManager, servicesManager }) {\r\n  const toolbarService = servicesManager.services.ToolBarService;\r\n\r\n  return [\r\n    {\r\n      name: 'ohif.divider',\r\n      defaultComponent: ToolbarDivider,\r\n      clickHandler: () => {},\r\n    },\r\n    {\r\n      name: 'ohif.action',\r\n      defaultComponent: ToolbarButton,\r\n      clickHandler: () => {},\r\n    },\r\n    {\r\n      name: 'ohif.radioGroup',\r\n      defaultComponent: ToolbarButton,\r\n      clickHandler: () => {},\r\n    },\r\n    {\r\n      name: 'ohif.splitButton',\r\n      defaultComponent: ToolbarSplitButton,\r\n      clickHandler: () => {},\r\n    },\r\n    {\r\n      name: 'ohif.layoutSelector',\r\n      defaultComponent: ToolbarLayoutSelector,\r\n      clickHandler: (evt, clickedBtn, btnSectionName) => {},\r\n    },\r\n    {\r\n      name: 'ohif.toggle',\r\n      defaultComponent: ToolbarButton,\r\n      requiredConfig: [],\r\n      optionalConfig: [],\r\n      requiredProps: [],\r\n      optionalProps: [],\r\n      clickHandler: (evt, clickedBtn, btnSectionName) => {\r\n        const { props } = clickedBtn;\r\n        const allButtons = toolbarService.getButtons();\r\n        const thisButton = allButtons[clickedBtn.id];\r\n\r\n        // Set our clicked button to active\r\n        thisButton.props.isActive = !thisButton.props.isActive;\r\n\r\n        // Run button logic/command\r\n        commandsManager.runCommand(props.commandName, props.commandOptions);\r\n\r\n        // What if just toggled \"content\"?\r\n        // commandName OR content?\r\n\r\n        // Set buttons & trigger notification\r\n        toolbarService.setButtons(allButtons);\r\n      },\r\n    },\r\n  ];\r\n}\r\n","import csTools from 'cornerstone-tools';\r\n\r\nconst toolsGroupedByType = {\r\n  touch: [csTools.PanMultiTouchTool, csTools.ZoomTouchPinchTool],\r\n  annotations: [\r\n    csTools.ArrowAnnotateTool,\r\n    csTools.BidirectionalTool,\r\n    csTools.LengthTool,\r\n    csTools.AngleTool,\r\n    csTools.FreehandRoiTool,\r\n    csTools.EllipticalRoiTool,\r\n    csTools.DragProbeTool,\r\n    csTools.RectangleRoiTool,\r\n  ],\r\n  other: [\r\n    csTools.PanTool,\r\n    csTools.ZoomTool,\r\n    csTools.WwwcTool,\r\n    csTools.WwwcRegionTool,\r\n    csTools.MagnifyTool,\r\n    csTools.StackScrollTool,\r\n    csTools.StackScrollMouseWheelTool,\r\n    csTools.OverlayTool,\r\n  ],\r\n};\r\n\r\nexport default function getTools() {\r\n  const tools = [];\r\n  Object.keys(toolsGroupedByType).forEach(toolsGroup =>\r\n    tools.push(...toolsGroupedByType[toolsGroup])\r\n  );\r\n\r\n  return tools;\r\n}\r\n\r\nexport { toolsGroupedByType };\r\n","import Hammer from 'hammerjs';\r\nimport cornerstone from 'cornerstone-core';\r\nimport cornerstoneMath from 'cornerstone-math';\r\nimport cornerstoneTools from 'cornerstone-tools';\r\nimport OHIF from '@ohif/core';\r\n\r\nconst { log } = OHIF;\r\n\r\nexport default function(configuration = {}) {\r\n  // TODO: Cypress tests are currently grabbing this from the window?\r\n  window.cornerstone = cornerstone;\r\n\r\n  // For debugging\r\n  window.cornerstoneTools = cornerstoneTools;\r\n\r\n  cornerstoneTools.external.cornerstone = cornerstone;\r\n  cornerstoneTools.external.Hammer = Hammer;\r\n  cornerstoneTools.external.cornerstoneMath = cornerstoneMath;\r\n  cornerstoneTools.init(configuration);\r\n\r\n  cornerstoneTools.loadHandlerManager.setErrorLoadingHandler(\r\n    (element, imageId, error) => {\r\n      log.error(imageId);\r\n      throw error;\r\n    }\r\n  );\r\n\r\n  // Set the tool font and font size\r\n  // context.font = \"[style] [variant] [weight] [size]/[line height] [font family]\";\r\n  const fontFamily =\r\n    'Roboto, OpenSans, HelveticaNeue-Light, Helvetica Neue Light, Helvetica Neue, Helvetica, Arial, Lucida Grande, sans-serif';\r\n  cornerstoneTools.textStyle.setFont(`16px ${fontFamily}`);\r\n\r\n  // Tool styles/colors\r\n  cornerstoneTools.toolStyle.setToolWidth(2);\r\n  cornerstoneTools.toolColors.setToolColor('rgb(255, 255, 0)');\r\n  cornerstoneTools.toolColors.setActiveColor('rgb(0, 255, 0)');\r\n\r\n  cornerstoneTools.store.state.touchProximity = 40;\r\n\r\n  // Configure stack prefetch\r\n  cornerstoneTools.stackPrefetch.setConfiguration({\r\n    maxImagesToPrefetch: Infinity,\r\n    preserveExistingPool: false,\r\n    maxSimultaneousRequests: 20,\r\n  });\r\n}\r\n","import cornerstone from 'cornerstone-core';\r\nimport cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\r\nimport dicomParser from 'dicom-parser';\r\nimport { errorHandler } from '@ohif/core';\r\n\r\nlet initialized = false;\r\n\r\nfunction initWebWorkers() {\r\n  const config = {\r\n    maxWebWorkers: Math.max(navigator.hardwareConcurrency - 1, 1),\r\n    startWebWorkersOnDemand: true,\r\n    taskConfiguration: {\r\n      decodeTask: {\r\n        initializeCodecsOnStartup: false,\r\n        usePDFJS: false,\r\n        strict: false,\r\n      },\r\n    },\r\n  };\r\n\r\n  if (!initialized) {\r\n    cornerstoneWADOImageLoader.webWorkerManager.initialize(config);\r\n    initialized = true;\r\n  }\r\n}\r\n\r\nexport default function initWADOImageLoader(UserAuthenticationService) {\r\n  cornerstoneWADOImageLoader.external.cornerstone = cornerstone;\r\n  cornerstoneWADOImageLoader.external.dicomParser = dicomParser;\r\n\r\n  cornerstoneWADOImageLoader.configure({\r\n    beforeSend: function(xhr) {\r\n      const headers = UserAuthenticationService.getAuthorizationHeader();\r\n\r\n      // Request:\r\n      // JPEG-LS Lossless (1.2.840.10008.1.2.4.80) if available, otherwise accept\r\n      // whatever transfer-syntax the origin server provides.\r\n      // For now we use image/jls and image/x-jls because some servers still use the old type\r\n      // http://dicom.nema.org/medical/dicom/current/output/html/part18.html\r\n      const xhrRequestHeaders = {\r\n        // To prevent Preflight requests:\r\n        accept: 'multipart/related; type=application/octet-stream',\r\n        //\r\n        //accept: 'multipart/related; type=\"image/x-jls\"',\r\n        // 'multipart/related; type=\"image/x-jls\", multipart/related; type=\"image/jls\"; transfer-syntax=\"1.2.840.10008.1.2.4.80\", multipart/related; type=\"image/x-jls\", multipart/related; type=\"application/octet-stream\"; transfer-syntax=*',\r\n      };\r\n\r\n      if (headers && headers.Authorization) {\r\n        xhrRequestHeaders.Authorization = headers.Authorization;\r\n      }\r\n\r\n      return xhrRequestHeaders;\r\n    },\r\n    errorInterceptor: error => {\r\n      errorHandler.getHTTPErrorHandler(error);\r\n    },\r\n  });\r\n\r\n  initWebWorkers();\r\n}\r\n","import cornerstoneTools from 'cornerstone-tools';\r\n\r\nconst { globalImageIdSpecificToolStateManager } = cornerstoneTools;\r\n\r\nexport default function getCornerstoneMeasurementById(id) {\r\n  const globalToolState = globalImageIdSpecificToolStateManager.saveToolState();\r\n\r\n  const imageIds = Object.keys(globalToolState);\r\n\r\n  for (let i = 0; i < imageIds.length; i++) {\r\n    const imageId = imageIds[i];\r\n    const imageIdSpecificToolState = globalToolState[imageId];\r\n\r\n    const toolTypes = Object.keys(imageIdSpecificToolState);\r\n\r\n    for (let j = 0; j < toolTypes.length; j++) {\r\n      const toolType = toolTypes[j];\r\n      const toolData = imageIdSpecificToolState[toolType].data;\r\n\r\n      if (toolData) {\r\n        for (let k = 0; k < toolData.length; k++) {\r\n          const toolDataK = toolData[k];\r\n\r\n          if (toolDataK.id === id) {\r\n            return toolDataK;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","export default ['Length', 'EllipticalRoi', 'Bidirectional', 'ArrowAnnotate'];\r\n","export default function getPointsFromHandles(handles) {\r\n  let points = [];\r\n  Object.keys(handles).map(handle => {\r\n    if (['start', 'end'].includes(handle)) {\r\n      let point = {};\r\n      if (handles[handle].x) point.x = handles[handle].x;\r\n      if (handles[handle].y) point.y = handles[handle].y;\r\n      points.push(point);\r\n    }\r\n  });\r\n  return points;\r\n}\r\n","import cornerstone from 'cornerstone-core';\r\n\r\nexport default function getSOPInstanceAttributes(element) {\r\n  const enabledElement = cornerstone.getEnabledElement(element);\r\n  const imageId = enabledElement.image.imageId;\r\n  const instance = cornerstone.metaData.get('instance', imageId);\r\n\r\n  return {\r\n    SOPInstanceUID: instance.SOPInstanceUID,\r\n    FrameOfReferenceUID: instance.FrameOfReferenceUID,\r\n    SeriesInstanceUID: instance.SeriesInstanceUID,\r\n    StudyInstanceUID: instance.StudyInstanceUID,\r\n  };\r\n}\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport getHandlesFromPoints from './utils/getHandlesFromPoints';\r\nimport getPointsFromHandles from './utils/getPointsFromHandles';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\n\r\nconst Length = {\r\n  toAnnotation: (measurement, definition) => {},\r\n\r\n  /**\r\n   * Maps cornerstone annotation event data to measurement service format.\r\n   *\r\n   * @param {Object} cornerstone Cornerstone event data\r\n   * @return {Measurement} Measurement instance\r\n   */\r\n  toMeasurement: (\r\n    csToolsAnnotation,\r\n    DisplaySetService,\r\n    getValueTypeFromToolType\r\n  ) => {\r\n    const { element, measurementData } = csToolsAnnotation;\r\n    const tool =\r\n      csToolsAnnotation.toolType ||\r\n      csToolsAnnotation.toolName ||\r\n      measurementData.toolType;\r\n\r\n    const validToolType = toolName => SUPPORTED_TOOLS.includes(toolName);\r\n\r\n    if (!validToolType(tool)) {\r\n      throw new Error('Tool not supported');\r\n    }\r\n\r\n    const {\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      SeriesInstanceUID,\r\n      StudyInstanceUID,\r\n    } = getSOPInstanceAttributes(element);\r\n\r\n    const displaySet = DisplaySetService.getDisplaySetForSOPInstanceUID(\r\n      SOPInstanceUID,\r\n      SeriesInstanceUID\r\n    );\r\n\r\n    return {\r\n      id: measurementData.id,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: measurementData.label,\r\n      description: measurementData.description,\r\n      unit: measurementData.unit,\r\n      length: measurementData.length,\r\n      type: getValueTypeFromToolType(tool),\r\n      points: getPointsFromHandles(measurementData.handles),\r\n    };\r\n  },\r\n};\r\n\r\nexport default Length;\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\nimport getHandlesFromPoints from './utils/getHandlesFromPoints';\r\n\r\nconst Bidirectional = {\r\n  toAnnotation: (measurement, definition) => {},\r\n  toMeasurement: (\r\n    csToolsAnnotation,\r\n    DisplaySetService,\r\n    getValueTypeFromToolType\r\n  ) => {\r\n    const { element, measurementData } = csToolsAnnotation;\r\n    const tool =\r\n      csToolsAnnotation.toolType ||\r\n      csToolsAnnotation.toolName ||\r\n      measurementData.toolType;\r\n\r\n    const validToolType = toolName => SUPPORTED_TOOLS.includes(toolName);\r\n\r\n    if (!validToolType(tool)) {\r\n      throw new Error('Tool not supported');\r\n    }\r\n\r\n    const {\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      SeriesInstanceUID,\r\n      StudyInstanceUID,\r\n    } = getSOPInstanceAttributes(element);\r\n\r\n    const displaySet = DisplaySetService.getDisplaySetForSOPInstanceUID(\r\n      SOPInstanceUID,\r\n      SeriesInstanceUID\r\n    );\r\n\r\n    const { handles } = measurementData;\r\n\r\n    const longAxis = [handles.start, handles.end];\r\n    const shortAxis = [handles.perpendicularStart, handles.perpendicularEnd];\r\n\r\n    return {\r\n      id: measurementData.id,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: measurementData.label,\r\n      description: measurementData.description,\r\n      unit: measurementData.unit,\r\n      shortestDiameter: measurementData.shortestDiameter,\r\n      longestDiameter: measurementData.longestDiameter,\r\n      type: getValueTypeFromToolType(tool),\r\n      points: { longAxis, shortAxis },\r\n    };\r\n  },\r\n};\r\n\r\nexport default Bidirectional;\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport getPointsFromHandles from './utils/getPointsFromHandles';\r\nimport getHandlesFromPoints from './utils/getHandlesFromPoints';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\n\r\nconst ArrowAnnotate = {\r\n  toAnnotation: (measurement, definition) => {},\r\n  toMeasurement: (\r\n    csToolsAnnotation,\r\n    DisplaySetService,\r\n    getValueTypeFromToolType\r\n  ) => {\r\n    const { element, measurementData } = csToolsAnnotation;\r\n    const tool =\r\n      csToolsAnnotation.toolType ||\r\n      csToolsAnnotation.toolName ||\r\n      measurementData.toolType;\r\n\r\n    const validToolType = toolName => SUPPORTED_TOOLS.includes(toolName);\r\n\r\n    if (!validToolType(tool)) {\r\n      throw new Error('Tool not supported');\r\n    }\r\n\r\n    const {\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      SeriesInstanceUID,\r\n      StudyInstanceUID,\r\n    } = getSOPInstanceAttributes(element);\r\n\r\n    const displaySet = DisplaySetService.getDisplaySetForSOPInstanceUID(\r\n      SOPInstanceUID,\r\n      SeriesInstanceUID\r\n    );\r\n\r\n    const points = [];\r\n    points.push(measurementData.handles);\r\n\r\n    return {\r\n      id: measurementData.id,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: measurementData.text,\r\n      description: measurementData.description,\r\n      unit: measurementData.unit,\r\n      text: measurementData.text,\r\n      type: getValueTypeFromToolType(tool),\r\n      points: getPointsFromHandles(measurementData.handles),\r\n    };\r\n  },\r\n};\r\n\r\nexport default ArrowAnnotate;\r\n","import SUPPORTED_TOOLS from './constants/supportedTools';\r\nimport getSOPInstanceAttributes from './utils/getSOPInstanceAttributes';\r\nimport getHandlesFromPoints from './utils/getHandlesFromPoints';\r\n\r\nconst EllipticalRoi = {\r\n  toAnnotation: (measurement, definition) => {},\r\n  toMeasurement: (\r\n    csToolsAnnotation,\r\n    DisplaySetService,\r\n    getValueTypeFromToolType\r\n  ) => {\r\n    const { element, measurementData } = csToolsAnnotation;\r\n    const tool =\r\n      csToolsAnnotation.toolType ||\r\n      csToolsAnnotation.toolName ||\r\n      measurementData.toolType;\r\n\r\n    const validToolType = toolName => SUPPORTED_TOOLS.includes(toolName);\r\n\r\n    if (!validToolType(tool)) {\r\n      throw new Error('Tool not supported');\r\n    }\r\n\r\n    const {\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      SeriesInstanceUID,\r\n      StudyInstanceUID,\r\n    } = getSOPInstanceAttributes(element);\r\n\r\n    const displaySet = DisplaySetService.getDisplaySetForSOPInstanceUID(\r\n      SOPInstanceUID,\r\n      SeriesInstanceUID\r\n    );\r\n\r\n    const { cachedStats, handles } = measurementData;\r\n\r\n    const { start, end } = handles;\r\n\r\n    const halfXLength = Math.abs(start.x - end.x) / 2;\r\n    const halfYLength = Math.abs(start.y - end.y) / 2;\r\n\r\n    const points = [];\r\n    const center = { x: (start.x + end.x) / 2, y: (start.y + end.y) / 2 };\r\n\r\n    // To store similar to SR.\r\n    if (halfXLength > halfYLength) {\r\n      // X-axis major\r\n      // Major axis\r\n      points.push({ x: center.x - halfXLength, y: center.y });\r\n      points.push({ x: center.x + halfXLength, y: center.y });\r\n      // Minor axis\r\n      points.push({ x: center.x, y: center.y - halfYLength });\r\n      points.push({ x: center.x, y: center.y + halfYLength });\r\n    } else {\r\n      // Y-axis major\r\n      // Major axis\r\n      points.push({ x: center.x, y: center.y - halfYLength });\r\n      points.push({ x: center.x, y: center.y + halfYLength });\r\n      // Minor axis\r\n      points.push({ x: center.x - halfXLength, y: center.y });\r\n      points.push({ x: center.x + halfXLength, y: center.y });\r\n    }\r\n\r\n    let meanSUV;\r\n    let stdDevSUV;\r\n\r\n    if (\r\n      cachedStats &&\r\n      cachedStats.meanStdDevSUV &&\r\n      cachedStats.meanStdDevSUV.mean !== 0\r\n    ) {\r\n      const { meanStdDevSUV } = cachedStats;\r\n\r\n      meanSUV = meanStdDevSUV.mean;\r\n      stdDevSUV = meanStdDevSUV.stdDev;\r\n    }\r\n\r\n    return {\r\n      id: measurementData.id,\r\n      SOPInstanceUID,\r\n      FrameOfReferenceUID,\r\n      referenceSeriesUID: SeriesInstanceUID,\r\n      referenceStudyUID: StudyInstanceUID,\r\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\r\n      label: measurementData.label,\r\n      description: measurementData.description,\r\n      unit: measurementData.unit,\r\n      area: cachedStats && cachedStats.area,\r\n      mean: cachedStats && cachedStats.mean,\r\n      stdDev: cachedStats && cachedStats.stdDev,\r\n      meanSUV,\r\n      stdDevSUV,\r\n      type: getValueTypeFromToolType(tool),\r\n      points,\r\n    };\r\n  },\r\n};\r\n\r\nexport default EllipticalRoi;\r\n","import Length from './Length';\r\nimport Bidirectional from './Bidirectional';\r\nimport ArrowAnnotate from './ArrowAnnotate';\r\nimport EllipticalRoi from './EllipticalRoi';\r\n\r\nconst measurementServiceMappingsFactory = (\r\n  MeasurementService,\r\n  DisplaySetService\r\n) => {\r\n  /**\r\n   * Maps measurement service format object to cornerstone annotation object.\r\n   *\r\n   * @param {Measurement} measurement The measurement instance\r\n   * @param {string} definition The source definition\r\n   * @return {Object} Cornerstone annotation data\r\n   */\r\n\r\n  const _getValueTypeFromToolType = toolType => {\r\n    const {\r\n      POLYLINE,\r\n      ELLIPSE,\r\n      POINT,\r\n      BIDIRECTIONAL,\r\n    } = MeasurementService.VALUE_TYPES;\r\n\r\n    // TODO -> I get why this was attemped, but its not nearly flexible enough.\r\n    // A single measurement may have an ellipse + a bidirectional measurement, for instances.\r\n    // You can't define a bidirectional tool as a single type..\r\n    const TOOL_TYPE_TO_VALUE_TYPE = {\r\n      Length: POLYLINE,\r\n      EllipticalRoi: ELLIPSE,\r\n      Bidirectional: BIDIRECTIONAL,\r\n      ArrowAnnotate: POINT,\r\n    };\r\n\r\n    return TOOL_TYPE_TO_VALUE_TYPE[toolType];\r\n  };\r\n\r\n  return {\r\n    Length: {\r\n      toAnnotation: Length.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        Length.toMeasurement(\r\n          csToolsAnnotation,\r\n          DisplaySetService,\r\n          _getValueTypeFromToolType\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.POLYLINE,\r\n          points: 2,\r\n        },\r\n      ],\r\n    },\r\n    Bidirectional: {\r\n      toAnnotation: Bidirectional.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        Bidirectional.toMeasurement(\r\n          csToolsAnnotation,\r\n          DisplaySetService,\r\n          _getValueTypeFromToolType\r\n        ),\r\n      matchingCriteria: [\r\n        // TODO -> We should eventually do something like shortAxis + longAxis,\r\n        // But its still a little unclear how these automatic interpretations will work.\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.POLYLINE,\r\n          points: 2,\r\n        },\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.POLYLINE,\r\n          points: 2,\r\n        },\r\n      ],\r\n    },\r\n    ArrowAnnotate: {\r\n      toAnnotation: ArrowAnnotate.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        ArrowAnnotate.toMeasurement(\r\n          csToolsAnnotation,\r\n          DisplaySetService,\r\n          _getValueTypeFromToolType\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.POINT,\r\n          points: 1,\r\n        },\r\n      ],\r\n    },\r\n    EllipticalRoi: {\r\n      toAnnotation: EllipticalRoi.toAnnotation,\r\n      toMeasurement: csToolsAnnotation =>\r\n        EllipticalRoi.toMeasurement(\r\n          csToolsAnnotation,\r\n          DisplaySetService,\r\n          _getValueTypeFromToolType\r\n        ),\r\n      matchingCriteria: [\r\n        {\r\n          valueType: MeasurementService.VALUE_TYPES.ELLIPSE,\r\n        },\r\n      ],\r\n    },\r\n  };\r\n};\r\n\r\nexport default measurementServiceMappingsFactory;\r\n","const state = {\r\n  // The `defaultContext` of an extension's commandsModule\r\n  DEFAULT_CONTEXT: 'ACTIVE_VIEWPORT::CORNERSTONE',\r\n  enabledElements: {},\r\n};\r\n\r\n/**\r\n * Sets the enabled element `dom` reference for an active viewport.\r\n * @param {HTMLElement} dom Active viewport element.\r\n * @return void\r\n */\r\nconst setEnabledElement = (viewportIndex, element, context) => {\r\n  const targetContext = context || state.DEFAULT_CONTEXT;\r\n\r\n  state.enabledElements[viewportIndex] = {\r\n    element,\r\n    context: targetContext,\r\n  };\r\n};\r\n\r\n/**\r\n * Grabs the enabled element `dom` reference of an adective viewport.\r\n *\r\n * @return {HTMLElement} Active viewport element.\r\n */\r\nconst getEnabledElement = viewportIndex => {\r\n  return state.enabledElements[viewportIndex];\r\n};\r\n\r\nexport { setEnabledElement, getEnabledElement };\r\n","import React from 'react';\r\nimport { Input, Dialog } from '@ohif/ui';\r\n\r\n/**\r\n *\r\n * @param {*} data\r\n * @param {*} data.text\r\n * @param {*} data.label\r\n * @param {*} event\r\n * @param {*} callback\r\n * @param {*} isArrowAnnotateInputDialog\r\n */\r\nfunction callInputDialog(\r\n  UIDialogService,\r\n  data,\r\n  callback,\r\n  isArrowAnnotateInputDialog = true\r\n) {\r\n  const dialogId = 'enter-annotation';\r\n  const label = data\r\n    ? isArrowAnnotateInputDialog\r\n      ? data.text\r\n      : data.label\r\n    : '';\r\n\r\n  const onSubmitHandler = ({ action, value }) => {\r\n    switch (action.id) {\r\n      case 'save':\r\n        callback(value.label, action.id);\r\n        break;\r\n      case 'cancel':\r\n        callback('', action.id);\r\n        break;\r\n    }\r\n    UIDialogService.dismiss({ id: dialogId });\r\n  };\r\n\r\n  if (UIDialogService) {\r\n    UIDialogService.create({\r\n      id: dialogId,\r\n      centralize: true,\r\n      isDraggable: false,\r\n      showOverlay: true,\r\n      content: Dialog,\r\n      contentProps: {\r\n        title: 'Enter your annotation',\r\n        value: { label },\r\n        noCloseButton: true,\r\n        onClose: () => UIDialogService.dismiss({ id: dialogId }),\r\n        actions: [\r\n          { id: 'cancel', text: 'Cancel', type: 'primary' },\r\n          { id: 'save', text: 'Save', type: 'secondary' },\r\n        ],\r\n        onSubmit: onSubmitHandler,\r\n        body: ({ value, setValue }) => {\r\n          return (\r\n            <div className=\"p-4 bg-primary-dark\">\r\n              <Input\r\n                autoFocus\r\n                className=\"mt-2 bg-black border-primary-main\"\r\n                type=\"text\"\r\n                containerClassName=\"mr-2\"\r\n                value={value.label}\r\n                onChange={event => {\r\n                  event.persist();\r\n                  setValue(value => ({ ...value, label: event.target.value }));\r\n                }}\r\n                onKeyPress={event => {\r\n                  if (event.key === 'Enter') {\r\n                    onSubmitHandler({ value, action: { id: 'save' } });\r\n                  }\r\n                }}\r\n              />\r\n            </div>\r\n          );\r\n        },\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\nexport default callInputDialog;\r\n","import OHIF from '@ohif/core';\r\nimport { ContextMenuMeasurements } from '@ohif/ui';\r\nimport cs from 'cornerstone-core';\r\nimport csTools from 'cornerstone-tools';\r\nimport merge from 'lodash.merge';\r\nimport getTools, { toolsGroupedByType } from './utils/getTools.js';\r\nimport initCornerstoneTools from './initCornerstoneTools.js';\r\nimport initWADOImageLoader from './initWADOImageLoader.js';\r\nimport getCornerstoneMeasurementById from './utils/getCornerstoneMeasurementById';\r\nimport measurementServiceMappingsFactory from './utils/measurementServiceMappings/measurementServiceMappingsFactory';\r\nimport { setEnabledElement } from './state';\r\nimport callInputDialog from './callInputDialog.js';\r\n\r\n// TODO -> Global \"context menu open state\", or lots of expensive searches on drag?\r\n\r\nlet CONTEXT_MENU_OPEN = false;\r\nconst { globalImageIdSpecificToolStateManager } = csTools;\r\n\r\nconst TOOL_TYPES_WITH_CONTEXT_MENU = [\r\n  'Angle',\r\n  'ArrowAnnotate',\r\n  'Bidirectional',\r\n  'Length',\r\n  'FreehandMouse',\r\n  'EllipticalRoi',\r\n  'CircleRoi',\r\n  'RectangleRoi',\r\n  // SR Viewport...\r\n  'SRLength',\r\n  'SRBidirectional',\r\n  'SRArrowAnnotate',\r\n  'SREllipticalRoi',\r\n];\r\n\r\nconst _refreshViewports = () =>\r\n  cs.getEnabledElements().forEach(({ element }) => cs.updateImage(element));\r\n\r\n/* Add extension tools configuration here. */\r\nconst _createInternalToolsConfig = UIDialogService => {\r\n  return {\r\n    ArrowAnnotate: {\r\n      configuration: {\r\n        getTextCallback: (callback, eventDetails) =>\r\n          callInputDialog(UIDialogService, null, callback),\r\n        changeTextCallback: (data, eventDetails, callback) =>\r\n          callInputDialog(UIDialogService, data, callback),\r\n        allowEmptyLabel: true,\r\n      },\r\n    },\r\n    DragProbe: {\r\n      defaultStrategy: 'minimal',\r\n    },\r\n  };\r\n};\r\n\r\n/**\r\n *\r\n * @param {Object} servicesManager\r\n * @param {Object} configuration\r\n * @param {Object|Array} configuration.csToolsConfig\r\n */\r\nexport default function init({\r\n  servicesManager,\r\n  commandsManager,\r\n  configuration,\r\n}) {\r\n  const {\r\n    UIDialogService,\r\n    MeasurementService,\r\n    DisplaySetService,\r\n    ToolBarService,\r\n    UserAuthenticationService,\r\n  } = servicesManager.services;\r\n  const tools = getTools();\r\n\r\n  console.log(servicesManager.services);\r\n\r\n  /* Measurement Service */\r\n  const measurementServiceSource = _connectToolsToMeasurementService(\r\n    MeasurementService,\r\n    DisplaySetService\r\n  );\r\n\r\n  const onRightClick = event => {\r\n    if (!UIDialogService) {\r\n      console.warn('Unable to show dialog; no UI Dialog Service available.');\r\n      return;\r\n    }\r\n\r\n    const onGetMenuItems = defaultMenuItems => {\r\n      const { element, currentPoints } = event.detail;\r\n      const nearbyToolData = commandsManager.runCommand('getNearbyToolData', {\r\n        element,\r\n        canvasCoordinates: currentPoints.canvas,\r\n        availableToolTypes: TOOL_TYPES_WITH_CONTEXT_MENU,\r\n      });\r\n\r\n      let menuItems = [];\r\n      if (nearbyToolData) {\r\n        defaultMenuItems.forEach(item => {\r\n          item.value = nearbyToolData;\r\n          menuItems.push(item);\r\n        });\r\n      }\r\n\r\n      return menuItems;\r\n    };\r\n\r\n    CONTEXT_MENU_OPEN = true;\r\n\r\n    UIDialogService.dismiss({ id: 'context-menu' });\r\n    UIDialogService.create({\r\n      id: 'context-menu',\r\n      isDraggable: false,\r\n      preservePosition: false,\r\n      defaultPosition: _getDefaultPosition(event.detail),\r\n      content: ContextMenuMeasurements,\r\n      onClickOutside: () => {\r\n        UIDialogService.dismiss({ id: 'context-menu' });\r\n        CONTEXT_MENU_OPEN = false;\r\n      },\r\n      contentProps: {\r\n        onGetMenuItems,\r\n        eventData: event.detail,\r\n        onDelete: item => {\r\n          const { tool: measurementData, toolType } = item.value;\r\n\r\n          // Sync'd w/ Measurement Service\r\n          if (measurementData.id) {\r\n            measurementServiceSource.remove(measurementData.id);\r\n          }\r\n          // Only in cstools\r\n          else {\r\n            const toolState =\r\n              csTools.globalImageIdSpecificToolStateManager.toolState;\r\n\r\n            Object.keys(toolState).forEach(imageId => {\r\n              Object.keys(toolState[imageId]).forEach(imageToolType => {\r\n                const numMeasurements =\r\n                  toolState[imageId][imageToolType].data.length;\r\n\r\n                for (let i = 0; i < numMeasurements; i++) {\r\n                  const toolData = toolState[imageId][imageToolType].data[i];\r\n                  if (measurementData.uuid === toolData.uuid) {\r\n                    // Clear and nuke matching measurement\r\n                    toolState[imageId][imageToolType].data[i] = null;\r\n                    delete toolState[imageId][imageToolType].data[i];\r\n                    toolState[imageId][imageToolType].data.splice(i, 1);\r\n\r\n                    // Delete \"data\" if we deleted last measurement in array\r\n                    // if (toolState[imageId][imageToolType].data.length === 0) {\r\n                    //   delete toolState[imageId][imageToolType].data;\r\n                    // }\r\n                  }\r\n                }\r\n              });\r\n            });\r\n            console.log(csTools.store.state);\r\n          }\r\n          _refreshViewports();\r\n          CONTEXT_MENU_OPEN = false;\r\n        },\r\n        onClose: () => {\r\n          CONTEXT_MENU_OPEN = false;\r\n          UIDialogService.dismiss({ id: 'context-menu' });\r\n        },\r\n        onSetLabel: item => {\r\n          const { tool: measurementData } = item.value;\r\n\r\n          const measurement = MeasurementService.getMeasurement(\r\n            measurementData.id\r\n          );\r\n\r\n          callInputDialog(\r\n            UIDialogService,\r\n            measurement,\r\n            (label, actionId) => {\r\n              if (actionId === 'cancel') {\r\n                return;\r\n              }\r\n\r\n              const updatedMeasurement = Object.assign({}, measurement, {\r\n                label,\r\n              });\r\n\r\n              MeasurementService.update(\r\n                updatedMeasurement.id,\r\n                updatedMeasurement,\r\n                true\r\n              );\r\n            },\r\n            false\r\n          );\r\n\r\n          CONTEXT_MENU_OPEN = false;\r\n        },\r\n      },\r\n    });\r\n  };\r\n\r\n  const onTouchPress = event => {\r\n    if (!UIDialogService) {\r\n      console.warn('Unable to show dialog; no UI Dialog Service available.');\r\n      return;\r\n    }\r\n\r\n    UIDialogService.create({\r\n      eventData: event.detail,\r\n      content: ContextMenuMeasurements,\r\n      contentProps: { isTouchEvent: true },\r\n    });\r\n  };\r\n\r\n  const resetContextMenu = () => {\r\n    if (!UIDialogService) {\r\n      console.warn('Unable to show dialog; no UI Dialog Service available.');\r\n      return;\r\n    }\r\n\r\n    CONTEXT_MENU_OPEN = false;\r\n\r\n    UIDialogService.dismiss({ id: 'context-menu' });\r\n  };\r\n\r\n  /*\r\n   * Because click gives us the native \"mouse up\", buttons will always be `0`\r\n   * Need to fallback to event.which;\r\n   *\r\n   */\r\n  const contextMenuHandleClick = evt => {\r\n    const mouseUpEvent = evt.detail.event;\r\n    const isRightClick = mouseUpEvent.which === 3;\r\n\r\n    const clickMethodHandler = isRightClick ? onRightClick : resetContextMenu;\r\n    clickMethodHandler(evt);\r\n  };\r\n\r\n  const cancelContextMenuIfOpen = evt => {\r\n    if (CONTEXT_MENU_OPEN) {\r\n      resetContextMenu();\r\n    }\r\n  };\r\n\r\n  // TODO: This is the handler for ALL ENABLED ELEMENT EVENTS\r\n  // ... Activation logic should take place per element, not for all (diff behavior per ext)\r\n  function elementEnabledHandler(tools, evt) {\r\n    const element = evt.detail.element;\r\n\r\n    _addConfiguredToolsForElement(\r\n      UIDialogService,\r\n      element,\r\n      tools,\r\n      configuration\r\n    );\r\n\r\n    element.addEventListener(csTools.EVENTS.TOUCH_PRESS, onTouchPress);\r\n    element.addEventListener(\r\n      csTools.EVENTS.MOUSE_CLICK,\r\n      contextMenuHandleClick\r\n    );\r\n    element.addEventListener(cs.EVENTS.NEW_IMAGE, cancelContextMenuIfOpen);\r\n  }\r\n\r\n  function elementDisabledHandler(evt) {\r\n    const element = evt.detail.element;\r\n    element.removeEventListener(csTools.EVENTS.TOUCH_PRESS, onTouchPress);\r\n    element.removeEventListener(\r\n      csTools.EVENTS.MOUSE_CLICK,\r\n      contextMenuHandleClick\r\n    );\r\n    element.removeEventListener(cs.EVENTS.NEW_IMAGE, cancelContextMenuIfOpen);\r\n  }\r\n\r\n  const { csToolsConfig } = configuration;\r\n  const metadataProvider = OHIF.classes.MetadataProvider;\r\n\r\n  cs.metaData.addProvider(metadataProvider.get.bind(metadataProvider), 9999);\r\n\r\n  initWADOImageLoader(UserAuthenticationService);\r\n\r\n  // ~~\r\n  const defaultCsToolsConfig = csToolsConfig || {\r\n    globalToolSyncEnabled: false, // hold on to your pants!\r\n    showSVGCursors: false,\r\n    autoResizeViewports: false,\r\n  };\r\n\r\n  initCornerstoneTools(defaultCsToolsConfig);\r\n  // TODO: Extensions are still registered at time of registration globally\r\n  // These should be registered as a part of mode route spin up,\r\n  // and they need to self-clean on mode route destroy\r\n  // THIS\r\n  // is a way for extensions that \"depend\" on this extension to notify it of\r\n  // new cornerstone enabled elements so it's commands continue to work.\r\n  const handleOhifCornerstoneEnabledElementEvent = function(evt) {\r\n    const { context, viewportIndex, enabledElement } = evt.detail;\r\n\r\n    setEnabledElement(viewportIndex, enabledElement, context);\r\n  };\r\n\r\n  document.addEventListener(\r\n    'ohif-cornerstone-enabled-element-event',\r\n    handleOhifCornerstoneEnabledElementEvent\r\n  );\r\n\r\n  cs.events.addEventListener(\r\n    cs.EVENTS.ELEMENT_ENABLED,\r\n    elementEnabledHandler.bind(null, tools)\r\n  );\r\n  cs.events.addEventListener(\r\n    cs.EVENTS.ELEMENT_DISABLED,\r\n    elementDisabledHandler\r\n  );\r\n}\r\n\r\nconst _initMeasurementService = (MeasurementService, DisplaySetService) => {\r\n  /* Initialization */\r\n  const {\r\n    Length,\r\n    Bidirectional,\r\n    EllipticalRoi,\r\n    ArrowAnnotate,\r\n  } = measurementServiceMappingsFactory(MeasurementService, DisplaySetService);\r\n  const csToolsVer4MeasurementSource = MeasurementService.createSource(\r\n    'CornerstoneTools',\r\n    '4'\r\n  );\r\n\r\n  /* Mappings */\r\n  MeasurementService.addMapping(\r\n    csToolsVer4MeasurementSource,\r\n    'Length',\r\n    Length.matchingCriteria,\r\n    Length.toAnnotation,\r\n    Length.toMeasurement\r\n  );\r\n\r\n  MeasurementService.addMapping(\r\n    csToolsVer4MeasurementSource,\r\n    'Bidirectional',\r\n    Bidirectional.matchingCriteria,\r\n    Bidirectional.toAnnotation,\r\n    Bidirectional.toMeasurement\r\n  );\r\n\r\n  MeasurementService.addMapping(\r\n    csToolsVer4MeasurementSource,\r\n    'EllipticalRoi',\r\n    EllipticalRoi.matchingCriteria,\r\n    EllipticalRoi.toAnnotation,\r\n    EllipticalRoi.toMeasurement\r\n  );\r\n\r\n  MeasurementService.addMapping(\r\n    csToolsVer4MeasurementSource,\r\n    'ArrowAnnotate',\r\n    ArrowAnnotate.matchingCriteria,\r\n    ArrowAnnotate.toAnnotation,\r\n    ArrowAnnotate.toMeasurement\r\n  );\r\n\r\n  return csToolsVer4MeasurementSource;\r\n};\r\n\r\nconst _connectToolsToMeasurementService = (\r\n  MeasurementService,\r\n  DisplaySetService\r\n) => {\r\n  const csToolsVer4MeasurementSource = _initMeasurementService(\r\n    MeasurementService,\r\n    DisplaySetService\r\n  );\r\n  _connectMeasurementServiceToTools(\r\n    MeasurementService,\r\n    csToolsVer4MeasurementSource\r\n  );\r\n  const { addOrUpdate, remove } = csToolsVer4MeasurementSource;\r\n  const elementEnabledEvt = cs.EVENTS.ELEMENT_ENABLED;\r\n\r\n  /* Measurement Service Events */\r\n  cs.events.addEventListener(elementEnabledEvt, evt => {\r\n    // TODO: Debounced update of measurements that are modified\r\n    function addMeasurement(csToolsEvent) {\r\n      console.log('CSTOOLS::addOrUpdate', csToolsEvent, csToolsEvent.detail);\r\n\r\n      try {\r\n        const evtDetail = csToolsEvent.detail;\r\n        const { toolName, toolType, measurementData } = evtDetail;\r\n        const csToolName = toolName || measurementData.toolType || toolType;\r\n\r\n        const measurementId = addOrUpdate(csToolName, evtDetail);\r\n\r\n        if (measurementId) {\r\n          measurementData.id = measurementId;\r\n        }\r\n      } catch (error) {\r\n        console.warn('Failed to add measurement:', error);\r\n      }\r\n    }\r\n\r\n    function updateMeasurement(csToolsEvent) {\r\n      try {\r\n        if (!csToolsEvent.detail.measurementData.id) {\r\n          return;\r\n        }\r\n\r\n        const evtDetail = csToolsEvent.detail;\r\n        const { toolName, toolType, measurementData } = evtDetail;\r\n        const csToolName = toolName || measurementData.toolType || toolType;\r\n\r\n        evtDetail.id = csToolsEvent.detail.measurementData.id;\r\n        addOrUpdate(csToolName, evtDetail);\r\n      } catch (error) {\r\n        console.warn('Failed to update measurement:', error);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * When csTools fires a removed event, remove the same measurement\r\n     * from the measurement service\r\n     *\r\n     * @param {*} csToolsEvent\r\n     */\r\n    function removeMeasurement(csToolsEvent) {\r\n      console.log('~~ removeEvt', csToolsEvent);\r\n      try {\r\n        if (csToolsEvent.detail.measurementData.id) {\r\n          remove(csToolsEvent.detail.measurementData.id);\r\n        }\r\n      } catch (error) {\r\n        console.warn('Failed to remove measurement:', error);\r\n      }\r\n    }\r\n\r\n    const {\r\n      MEASUREMENTS_CLEARED,\r\n      MEASUREMENT_UPDATED,\r\n    } = MeasurementService.EVENTS;\r\n\r\n    MeasurementService.subscribe(MEASUREMENTS_CLEARED, () => {\r\n      globalImageIdSpecificToolStateManager.restoreToolState({});\r\n      _refreshViewports();\r\n    });\r\n\r\n    MeasurementService.subscribe(\r\n      MEASUREMENT_UPDATED,\r\n      ({ source, measurement, notYetUpdatedAtSource }) => {\r\n        const { id, label } = measurement;\r\n\r\n        if (\r\n          source.name == 'CornerstoneTools' &&\r\n          notYetUpdatedAtSource === false\r\n        ) {\r\n          // This event was fired by cornerstone telling the measurement service to sync. Already in sync.\r\n          return;\r\n        }\r\n        const cornerstoneMeasurement = getCornerstoneMeasurementById(id);\r\n\r\n        if (cornerstoneMeasurement) {\r\n          cornerstoneMeasurement.label = label;\r\n          if (cornerstoneMeasurement.hasOwnProperty('text')) {\r\n            // Deal with the weird case of ArrowAnnotate.\r\n            cornerstoneMeasurement.text = label;\r\n          }\r\n\r\n          _refreshViewports();\r\n        }\r\n      }\r\n    );\r\n\r\n    // on display sets added, check if there are any measurements in measurement service that need to be\r\n    // put into cornerstone tools tooldata\r\n\r\n    const enabledElement = evt.detail.element;\r\n    const completedEvt = csTools.EVENTS.MEASUREMENT_COMPLETED;\r\n    const updatedEvt = csTools.EVENTS.MEASUREMENT_MODIFIED;\r\n    const removedEvt = csTools.EVENTS.MEASUREMENT_REMOVED;\r\n\r\n    enabledElement.addEventListener(completedEvt, addMeasurement);\r\n    enabledElement.addEventListener(updatedEvt, updateMeasurement);\r\n    enabledElement.addEventListener(removedEvt, removeMeasurement);\r\n  });\r\n\r\n  return csToolsVer4MeasurementSource;\r\n};\r\n\r\nconst _connectMeasurementServiceToTools = (\r\n  MeasurementService,\r\n  measurementSource,\r\n  dataSource\r\n) => {\r\n  const {\r\n    MEASUREMENT_REMOVED,\r\n    RAW_MEASUREMENT_ADDED,\r\n  } = MeasurementService.EVENTS;\r\n  const sourceId = measurementSource.id;\r\n\r\n  // TODO: This is an unsafe delete\r\n  // Cornerstone-tools should probably expose a more generic \"delete by id\"\r\n  // And have toolState managers expose a method to find any of their toolState by ID\r\n  // --> csTools.deleteById --> internally checks all registered modules/managers?\r\n  //\r\n  // This implementation assumes a single globalImageIdSpecificToolStateManager\r\n  // It iterates all toolState for all toolTypes, and deletes any with a matching id\r\n  //\r\n  // Could potentially use \"source\" from event to determine tool type and skip some\r\n  // iterations?\r\n\r\n  const {\r\n    POLYLINE,\r\n    ELLIPSE,\r\n    POINT,\r\n    BIDIRECTIONAL,\r\n  } = MeasurementService.VALUE_TYPES;\r\n\r\n  // TODO -> I get why this was attemped, but its not nearly flexible enough.\r\n  // A single measurement may have an ellipse + a bidirectional measurement, for instances.\r\n  // You can't define a bidirectional tool as a single type..\r\n  // OHIF-230\r\n  const TOOL_TYPE_TO_VALUE_TYPE = {\r\n    Length: POLYLINE,\r\n    EllipticalRoi: ELLIPSE,\r\n    Bidirectional: BIDIRECTIONAL,\r\n    ArrowAnnotate: POINT,\r\n  };\r\n\r\n  const VALUE_TYPE_TO_TOOL_TYPE = {\r\n    [POLYLINE]: 'Length',\r\n    [ELLIPSE]: 'EllipticalRoi',\r\n    [BIDIRECTIONAL]: 'Bidirectional',\r\n    [POINT]: 'ArrowAnnotate',\r\n  };\r\n\r\n  MeasurementService.subscribe(\r\n    RAW_MEASUREMENT_ADDED,\r\n    ({ source, measurement, data, dataSource }) => {\r\n      const {\r\n        referenceStudyUID: StudyInstanceUID,\r\n        referenceSeriesUID: SeriesInstanceUID,\r\n        SOPInstanceUID,\r\n      } = measurement;\r\n\r\n      let toolType;\r\n      try {\r\n        toolType = VALUE_TYPE_TO_TOOL_TYPE[measurement.type];\r\n      } catch {\r\n        throw Error('Cannot add tool to cornerstone tools');\r\n      }\r\n\r\n      let imageId;\r\n      if (data.imageId) {\r\n        // handle dicom json launch, since we cannot create image id from\r\n        // instance UIDs, each tool should embed the instance metadata\r\n        // TODO: handle multi instance case\r\n        imageId = data.imageId;\r\n      } else {\r\n        // handle general case of dicom web\r\n        const instance = {\r\n          StudyInstanceUID,\r\n          SeriesInstanceUID,\r\n          SOPInstanceUID,\r\n        };\r\n        // TODO: handle multi frame\r\n        imageId = dataSource.getImageIdsForInstance({ instance });\r\n      }\r\n\r\n      const toolState = cornerstoneTools.globalImageIdSpecificToolStateManager.saveToolState();\r\n\r\n      if (toolState[imageId] === undefined) {\r\n        toolState[imageId] = {};\r\n      }\r\n\r\n      const imageIdToolState = toolState[imageId];\r\n\r\n      // If we don't have tool state for this type of tool, add an empty object\r\n      if (imageIdToolState[toolType] === undefined) {\r\n        imageIdToolState[toolType] = {\r\n          data: [],\r\n        };\r\n      }\r\n\r\n      const toolData = imageIdToolState[toolType];\r\n\r\n      toolData.data.push(data);\r\n    }\r\n  );\r\n\r\n  MeasurementService.subscribe(\r\n    MEASUREMENT_REMOVED,\r\n    ({ source, measurement: removedMeasurementId }) => {\r\n      // THIS POINTS TO ORIGINAL; Not a copy\r\n      const imageIdSpecificToolState = globalImageIdSpecificToolStateManager.saveToolState();\r\n\r\n      // ImageId -->\r\n      Object.keys(imageIdSpecificToolState).forEach(imageId => {\r\n        // ImageId --> Tool -->\r\n        Object.keys(imageIdSpecificToolState[imageId]).forEach(toolName => {\r\n          const toolState = imageIdSpecificToolState[imageId][toolName];\r\n\r\n          let annotationIndex = toolState.data.length - 1;\r\n          while (annotationIndex >= 0) {\r\n            const annotation = toolState.data[annotationIndex];\r\n\r\n            if (annotation.id === removedMeasurementId) {\r\n              toolState.data.splice(annotationIndex, 1);\r\n            }\r\n\r\n            annotationIndex--;\r\n          }\r\n        });\r\n      });\r\n    }\r\n  );\r\n};\r\n\r\nconst _getDefaultPosition = event => ({\r\n  x: (event && event.currentPoints.client.x) || 0,\r\n  y: (event && event.currentPoints.client.y) || 0,\r\n});\r\n\r\n/**\r\n * @private\r\n */\r\nfunction _addConfiguredToolsForElement(\r\n  UIDialogService,\r\n  element,\r\n  tools,\r\n  configuration\r\n) {\r\n  const internalToolsConfig = _createInternalToolsConfig(UIDialogService);\r\n  /* Add tools with its custom props through extension configuration. */\r\n  tools.forEach(tool => {\r\n    const toolName = new tool().name;\r\n    const externalToolsConfig = configuration.tools || {};\r\n    const externalToolProps = externalToolsConfig[toolName] || {};\r\n    const internalToolProps = internalToolsConfig[toolName] || {};\r\n    const props = merge(\r\n      internalToolProps,\r\n      _parseToolProps(configuration, externalToolProps, tool)\r\n    );\r\n    csTools.addToolForElement(element, tool, props);\r\n  });\r\n}\r\n/* Abstract tools configuration using extension configuration. */\r\nfunction _parseToolProps(configuration, props, tool) {\r\n  const { annotations } = toolsGroupedByType;\r\n  // An alternative approach would be to remove the `drawHandlesOnHover` config\r\n  // from the supported configuration properties in `cornerstone-tools`\r\n  const toolsWithHideableHandles = annotations.filter(\r\n    tool => !['RectangleRoiTool', 'EllipticalRoiTool'].includes(tool.name)\r\n  );\r\n\r\n  let parsedProps = { ...props };\r\n\r\n  /**\r\n   * drawHandles - Never/Always show handles\r\n   * drawHandlesOnHover - Only show handles on handle hover (pointNearHandle)\r\n   * hideHandlesIfMoving - Hides the handles whilst you are moving them, for better visibility.\r\n   *\r\n   * Does not apply to tools where handles aren't placed in predictable\r\n   * locations.\r\n   */\r\n  if (\r\n    configuration.hideHandles !== false &&\r\n    toolsWithHideableHandles.includes(tool)\r\n  ) {\r\n    if (props.configuration) {\r\n      parsedProps.configuration.drawHandlesOnHover = true;\r\n      parsedProps.configuration.hideHandlesIfMoving = true;\r\n    } else {\r\n      parsedProps.configuration = {\r\n        drawHandlesOnHover: true,\r\n        hideHandlesIfMoving: true,\r\n      };\r\n    }\r\n  }\r\n\r\n  return parsedProps;\r\n}\r\n","import React from 'react';\r\nimport cornerstone from 'cornerstone-core';\r\nimport cornerstoneTools from 'cornerstone-tools';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport { ViewportDownloadForm } from '@ohif/ui';\r\nimport { utils } from '@ohif/core';\r\n\r\nimport { getEnabledElement } from './state';\r\n\r\nconst MINIMUM_SIZE = 100;\r\nconst DEFAULT_SIZE = 512;\r\nconst MAX_TEXTURE_SIZE = 10000;\r\n\r\nconst CornerstoneViewportDownloadForm = ({ onClose, activeViewportIndex }) => {\r\n  const enabledElement = getEnabledElement(\r\n    activeViewportIndex\r\n  );\r\n  const activeEnabledElement = enabledElement?.element\r\n\r\n  const enableViewport = viewportElement => {\r\n    if (viewportElement) {\r\n      cornerstone.enable(viewportElement);\r\n    }\r\n  };\r\n\r\n  const disableViewport = viewportElement => {\r\n    if (viewportElement) {\r\n      cornerstone.disable(viewportElement);\r\n    }\r\n  };\r\n\r\n  const updateViewportPreview = (viewportElement, downloadCanvas, fileType) =>\r\n    new Promise(resolve => {\r\n      cornerstone.fitToWindow(viewportElement);\r\n\r\n      viewportElement.addEventListener(\r\n        'cornerstoneimagerendered',\r\n        function updateViewport(event) {\r\n          const enabledElement = cornerstone.getEnabledElement(event.target)\r\n            .element;\r\n          const type = 'image/' + fileType;\r\n          const dataUrl = downloadCanvas.toDataURL(type, 1);\r\n\r\n          let newWidth = enabledElement.offsetHeight;\r\n          let newHeight = enabledElement.offsetWidth;\r\n\r\n          if (newWidth > DEFAULT_SIZE || newHeight > DEFAULT_SIZE) {\r\n            const multiplier = DEFAULT_SIZE / Math.max(newWidth, newHeight);\r\n            newHeight *= multiplier;\r\n            newWidth *= multiplier;\r\n          }\r\n\r\n          resolve({ dataUrl, width: newWidth, height: newHeight });\r\n\r\n          viewportElement.removeEventListener(\r\n            'cornerstoneimagerendered',\r\n            updateViewport\r\n          );\r\n        }\r\n      );\r\n    });\r\n\r\n  const loadImage = (activeViewport, viewportElement, width, height) =>\r\n    new Promise(resolve => {\r\n      if (activeViewport && viewportElement) {\r\n        const enabledElement = cornerstone.getEnabledElement(activeViewport);\r\n        const viewport = Object.assign({}, enabledElement.viewport);\r\n        delete viewport.scale;\r\n        viewport.translation = {\r\n          x: 0,\r\n          y: 0,\r\n        };\r\n\r\n        cornerstone.loadImage(enabledElement.image.imageId).then(image => {\r\n          cornerstone.displayImage(viewportElement, image);\r\n          cornerstone.setViewport(viewportElement, viewport);\r\n          cornerstone.resize(viewportElement, true);\r\n\r\n          const newWidth = Math.min(width || image.width, MAX_TEXTURE_SIZE);\r\n          const newHeight = Math.min(height || image.height, MAX_TEXTURE_SIZE);\r\n\r\n          resolve({ image, width: newWidth, height: newHeight });\r\n        });\r\n      }\r\n    });\r\n\r\n  const toggleAnnotations = (toggle, viewportElement) => {\r\n    cornerstoneTools.store.state.tools.forEach(({ name }) => {\r\n      if (toggle) {\r\n        cornerstoneTools.setToolEnabledForElement(viewportElement, name);\r\n      } else {\r\n        cornerstoneTools.setToolDisabledForElement(viewportElement, name);\r\n      }\r\n    });\r\n  };\r\n\r\n  const downloadBlob = (\r\n    filename,\r\n    fileType,\r\n    viewportElement,\r\n    downloadCanvas\r\n  ) => {\r\n    const file = `${filename}.${fileType}`;\r\n    const mimetype = `image/${fileType}`;\r\n\r\n    /* Handles JPEG images for IE11 */\r\n    if (downloadCanvas.msToBlob && fileType === 'jpeg') {\r\n      const image = downloadCanvas.toDataURL(mimetype, 1);\r\n      const blob = utils.b64toBlob(\r\n        image.replace('data:image/jpeg;base64,', ''),\r\n        mimetype\r\n      );\r\n      return window.navigator.msSaveBlob(blob, file);\r\n    }\r\n\r\n    viewportElement.querySelector('canvas').toBlob(blob => {\r\n      const URLObj = window.URL || window.webkitURL;\r\n      const a = document.createElement('a');\r\n\r\n      a.href = URLObj.createObjectURL(blob);\r\n      a.download = file;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      document.body.removeChild(a);\r\n    });\r\n  };\r\n\r\n  return (\r\n    <ViewportDownloadForm\r\n      onClose={onClose}\r\n      minimumSize={MINIMUM_SIZE}\r\n      maximumSize={MAX_TEXTURE_SIZE}\r\n      defaultSize={DEFAULT_SIZE}\r\n      canvasClass={'cornerstone-canvas'}\r\n      activeViewport={activeEnabledElement}\r\n      enableViewport={enableViewport}\r\n      disableViewport={disableViewport}\r\n      updateViewportPreview={updateViewportPreview}\r\n      loadImage={loadImage}\r\n      toggleAnnotations={toggleAnnotations}\r\n      downloadBlob={downloadBlob}\r\n    />\r\n  );\r\n};\r\n\r\nCornerstoneViewportDownloadForm.propTypes = {\r\n  onClose: PropTypes.func,\r\n  activeViewportIndex: PropTypes.number.isRequired,\r\n};\r\n\r\nexport default CornerstoneViewportDownloadForm;\r\n","import cornerstone from 'cornerstone-core';\r\nimport cornerstoneTools from 'cornerstone-tools';\r\nimport OHIF from '@ohif/core';\r\n\r\n//import setCornerstoneLayout from './utils/setCornerstoneLayout.js';\r\nimport { getEnabledElement } from './state';\r\nimport CornerstoneViewportDownloadForm from './CornerstoneViewportDownloadForm';\r\nconst scroll = cornerstoneTools.import('util/scroll');\r\n\r\nconst { studyMetadataManager } = OHIF.utils;\r\n\r\nconst imagePositionSynchronizer = new cornerstoneTools.Synchronizer(\r\n  cornerstone.EVENTS.NEW_IMAGE,\r\n  cornerstoneTools.stackImagePositionSynchronizer\r\n);\r\n\r\nconst panZoomSynchronizer = new cornerstoneTools.Synchronizer(\r\n  cornerstone.EVENTS.IMAGE_RENDERED,\r\n  cornerstoneTools.panZoomSynchronizer\r\n);\r\n\r\nfunction onElementEnabledAddToSync(event) {\r\n  const { element } = event.detail;\r\n\r\n  imagePositionSynchronizer.add(element);\r\n  // panZoomSynchronizer.add(element);\r\n}\r\n\r\nfunction onElementDisabledRemoveFromSync(event) {\r\n  const { element } = event.detail;\r\n\r\n  imagePositionSynchronizer.remove(element);\r\n  panZoomSynchronizer.remove(element);\r\n}\r\n\r\nconst commandsModule = ({ servicesManager, commandsManager }) => {\r\n  const { ViewportGridService } = servicesManager.services;\r\n\r\n  function _getActiveViewportsEnabledElement() {\r\n    const { activeViewportIndex } = ViewportGridService.getState();\r\n    const { element } = getEnabledElement(activeViewportIndex) || {};\r\n    return element;\r\n  }\r\n\r\n  const actions = {\r\n    getCornerstoneLibraries: () => {\r\n      return { cornerstone, cornerstoneTools };\r\n    },\r\n    rotateViewport: ({ rotation }) => {\r\n      const enabledElement = _getActiveViewportsEnabledElement();\r\n\r\n      if (enabledElement) {\r\n        let viewport = cornerstone.getViewport(enabledElement);\r\n        viewport.rotation += rotation;\r\n        cornerstone.setViewport(enabledElement, viewport);\r\n      }\r\n    },\r\n    flipViewportHorizontal: () => {\r\n      const enabledElement = _getActiveViewportsEnabledElement();\r\n\r\n      if (enabledElement) {\r\n        let viewport = cornerstone.getViewport(enabledElement);\r\n        viewport.hflip = !viewport.hflip;\r\n        cornerstone.setViewport(enabledElement, viewport);\r\n      }\r\n    },\r\n    flipViewportVertical: () => {\r\n      const enabledElement = _getActiveViewportsEnabledElement();\r\n\r\n      if (enabledElement) {\r\n        let viewport = cornerstone.getViewport(enabledElement);\r\n        viewport.vflip = !viewport.vflip;\r\n        cornerstone.setViewport(enabledElement, viewport);\r\n      }\r\n    },\r\n    scaleViewport: ({ direction }) => {\r\n      const enabledElement = _getActiveViewportsEnabledElement();\r\n      const step = direction * 0.15;\r\n\r\n      if (enabledElement) {\r\n        if (step) {\r\n          let viewport = cornerstone.getViewport(enabledElement);\r\n          viewport.scale += step;\r\n          cornerstone.setViewport(enabledElement, viewport);\r\n        } else {\r\n          cornerstone.fitToWindow(enabledElement);\r\n        }\r\n      }\r\n    },\r\n    resetViewport: () => {\r\n      const enabledElement = _getActiveViewportsEnabledElement();\r\n\r\n      if (enabledElement) {\r\n        cornerstone.reset(enabledElement);\r\n      }\r\n    },\r\n    toggleSynchronizer: ({ toggledState }) => {\r\n      const synchronizers = [imagePositionSynchronizer];\r\n      // Set synchronizer state when the command is run.\r\n      synchronizers.forEach(s => {\r\n        s.enabled = toggledState;\r\n      });\r\n\r\n      const unsubscribe = () => {\r\n        cornerstone.events.removeEventListener(\r\n          cornerstone.EVENTS.ELEMENT_ENABLED,\r\n          onElementEnabledAddToSync\r\n        );\r\n        cornerstone.events.removeEventListener(\r\n          cornerstone.EVENTS.ELEMENT_DISABLED,\r\n          onElementDisabledRemoveFromSync\r\n        );\r\n      };\r\n      const subscribe = () => {\r\n        cornerstone.events.addEventListener(\r\n          cornerstone.EVENTS.ELEMENT_ENABLED,\r\n          onElementEnabledAddToSync\r\n        );\r\n        cornerstone.events.addEventListener(\r\n          cornerstone.EVENTS.ELEMENT_DISABLED,\r\n          onElementDisabledRemoveFromSync\r\n        );\r\n      };\r\n\r\n      // Add event handlers so that if the layout is changed, new elements\r\n      // are automatically added to the synchronizer while it is enabled.\r\n      if (toggledState === true) {\r\n        subscribe();\r\n      } else {\r\n        // If the synchronizer is disabled, remove the event handlers\r\n        unsubscribe();\r\n      }\r\n\r\n      // Erase existing state and then set up all currently existing elements\r\n      cornerstone.getEnabledElements().map(e => {\r\n        synchronizers.forEach(s => {\r\n          s.remove(e.element);\r\n          s.add(e.element);\r\n        });\r\n      });\r\n      return unsubscribe;\r\n    },\r\n    invertViewport: ({ element }) => {\r\n      let enabledElement;\r\n\r\n      if (element === undefined) {\r\n        enabledElement = _getActiveViewportsEnabledElement();\r\n      } else {\r\n        enabledElement = element;\r\n      }\r\n\r\n      if (enabledElement) {\r\n        let viewport = cornerstone.getViewport(enabledElement);\r\n        viewport.invert = !viewport.invert;\r\n        cornerstone.setViewport(enabledElement, viewport);\r\n      }\r\n    },\r\n    cancelMeasurement: () => {\r\n      const enabledElement = _getActiveViewportsEnabledElement();\r\n\r\n      if (enabledElement) {\r\n        const cancelActiveManipulatorsForElement = cornerstoneTools.getModule(\r\n          'manipulatorState'\r\n        ).setters.cancelActiveManipulatorsForElement;\r\n\r\n        cancelActiveManipulatorsForElement(enabledElement);\r\n\r\n        cornerstone.updateImage(enabledElement);\r\n      }\r\n    },\r\n    // TODO: this is receiving `evt` from `ToolbarRow`. We could use it to have\r\n    //       better mouseButtonMask sets.\r\n    setToolActive: ({ toolName }) => {\r\n      if (!toolName) {\r\n        console.warn('No toolname provided to setToolActive command');\r\n      }\r\n\r\n      // Find total number of tool indexes\r\n      const { viewports } = ViewportGridService.getState() || { viewports: [] };\r\n      for (let i = 0; i < viewports.length; i++) {\r\n        const viewport = viewports[i];\r\n        const hasDisplaySet = viewport.displaySetInstanceUID !== undefined;\r\n\r\n        if (!hasDisplaySet) {\r\n          continue;\r\n        }\r\n\r\n        const viewportInfo = getEnabledElement(i);\r\n        const hasCornerstoneContext =\r\n          viewportInfo.context === 'ACTIVE_VIEWPORT::CORNERSTONE';\r\n\r\n        if (hasCornerstoneContext) {\r\n          cornerstoneTools.setToolActiveForElement(\r\n            viewportInfo.element,\r\n            toolName,\r\n            { mouseButtonMask: 1 }\r\n          );\r\n        } else {\r\n          commandsManager.runCommand(\r\n            'setToolActive',\r\n            {\r\n              element: viewportInfo.element,\r\n              toolName,\r\n            },\r\n            viewportInfo.context\r\n          );\r\n        }\r\n      }\r\n    },\r\n    clearAnnotations: () => {\r\n      const element = _getActiveViewportsEnabledElement();\r\n      if (!element) {\r\n        return;\r\n      }\r\n\r\n      const { enabledElement } = cornerstone.getEnabledElement(element) || {};\r\n      if (!enabledElement || !enabledElement.image) {\r\n        return;\r\n      }\r\n\r\n      const {\r\n        toolState,\r\n      } = cornerstoneTools.globalImageIdSpecificToolStateManager;\r\n      if (\r\n        !toolState ||\r\n        toolState.hasOwnProperty(enabledElement.image.imageId) === false\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      const imageIdToolState = toolState[enabledElement.image.imageId];\r\n\r\n      const measurementsToRemove = [];\r\n\r\n      Object.keys(imageIdToolState).forEach(toolType => {\r\n        const { data } = imageIdToolState[toolType];\r\n\r\n        data.forEach(measurementData => {\r\n          const {\r\n            _id,\r\n            lesionNamingNumber,\r\n            measurementNumber,\r\n          } = measurementData;\r\n\r\n          if (!_id) {\r\n            return;\r\n          }\r\n\r\n          measurementsToRemove.push({\r\n            toolType,\r\n            _id,\r\n            lesionNamingNumber,\r\n            measurementNumber,\r\n          });\r\n        });\r\n      });\r\n\r\n      measurementsToRemove.forEach(measurementData => {\r\n        OHIF.measurements.MeasurementHandlers.onRemoved({\r\n          detail: {\r\n            toolType: measurementData.toolType,\r\n            measurementData,\r\n          },\r\n        });\r\n      });\r\n    },\r\n    nextImage: () => {\r\n      const enabledElement = _getActiveViewportsEnabledElement();\r\n      scroll(enabledElement, 1);\r\n    },\r\n    previousImage: () => {\r\n      const enabledElement = _getActiveViewportsEnabledElement();\r\n      scroll(enabledElement, -1);\r\n    },\r\n    getActiveViewportEnabledElement: () => {\r\n      const enabledElement = _getActiveViewportsEnabledElement();\r\n      return enabledElement;\r\n    },\r\n    showDownloadViewportModal: () => {\r\n      const { activeViewportIndex } = ViewportGridService.getState();\r\n      const { UIModalService } = servicesManager.services;\r\n\r\n      if (UIModalService) {\r\n        UIModalService.show({\r\n          content: CornerstoneViewportDownloadForm,\r\n          title: 'Download High Quality Image',\r\n          contentProps: {\r\n            activeViewportIndex,\r\n            onClose: UIModalService.hide,\r\n          },\r\n        });\r\n      }\r\n    },\r\n    getNearbyToolData({ element, canvasCoordinates, availableToolTypes }) {\r\n      const nearbyTool = {};\r\n      let pointNearTool = false;\r\n\r\n      availableToolTypes.forEach(toolType => {\r\n        const elementToolData = cornerstoneTools.getToolState(\r\n          element,\r\n          toolType\r\n        );\r\n\r\n        if (!elementToolData) {\r\n          return;\r\n        }\r\n\r\n        elementToolData.data.forEach((toolData, index) => {\r\n          let elementToolInstance = cornerstoneTools.getToolForElement(\r\n            element,\r\n            toolType\r\n          );\r\n\r\n          if (!elementToolInstance) {\r\n            elementToolInstance = cornerstoneTools.getToolForElement(\r\n              element,\r\n              `${toolType}Tool`\r\n            );\r\n          }\r\n\r\n          if (!elementToolInstance) {\r\n            console.warn('Tool not found.');\r\n            return undefined;\r\n          }\r\n\r\n          if (\r\n            elementToolInstance.pointNearTool(\r\n              element,\r\n              toolData,\r\n              canvasCoordinates\r\n            )\r\n          ) {\r\n            pointNearTool = true;\r\n            nearbyTool.tool = toolData;\r\n            nearbyTool.index = index;\r\n            nearbyTool.toolType = toolType;\r\n          }\r\n        });\r\n\r\n        if (pointNearTool) {\r\n          return false;\r\n        }\r\n      });\r\n\r\n      return pointNearTool ? nearbyTool : undefined;\r\n    },\r\n    removeToolState: ({ element, toolType, tool }) => {\r\n      cornerstoneTools.removeToolState(element, toolType, tool);\r\n      cornerstone.updateImage(element);\r\n    },\r\n    // setCornerstoneLayout: () => {\r\n    //   setCornerstoneLayout();\r\n    // },\r\n    setWindowLevel: ({ window, level }) => {\r\n      const enabledElement = _getActiveViewportsEnabledElement();\r\n\r\n      if (enabledElement) {\r\n        let viewport = cornerstone.getViewport(enabledElement);\r\n\r\n        viewport.voi = {\r\n          windowWidth: Number(window),\r\n          windowCenter: Number(level),\r\n        };\r\n        cornerstone.setViewport(enabledElement, viewport);\r\n      }\r\n    },\r\n  };\r\n\r\n  const definitions = {\r\n    jumpToImage: {\r\n      commandFn: actions.jumpToImage,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    getCornerstoneLibraries: {\r\n      commandFn: actions.getCornerstoneLibraries,\r\n      storeContexts: [],\r\n      options: {},\r\n      context: 'VIEWER',\r\n    },\r\n    getNearbyToolData: {\r\n      commandFn: actions.getNearbyToolData,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    toggleSynchronizer: {\r\n      commandFn: actions.toggleSynchronizer,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    removeToolState: {\r\n      commandFn: actions.removeToolState,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    showDownloadViewportModal: {\r\n      commandFn: actions.showDownloadViewportModal,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    getActiveViewportEnabledElement: {\r\n      commandFn: actions.getActiveViewportEnabledElement,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    rotateViewportCW: {\r\n      commandFn: actions.rotateViewport,\r\n      storeContexts: [],\r\n      options: { rotation: 90 },\r\n    },\r\n    rotateViewportCCW: {\r\n      commandFn: actions.rotateViewport,\r\n      storeContexts: [],\r\n      options: { rotation: -90 },\r\n    },\r\n    invertViewport: {\r\n      commandFn: actions.invertViewport,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    cancelMeasurement: {\r\n      commandFn: actions.cancelMeasurement,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    flipViewportVertical: {\r\n      commandFn: actions.flipViewportVertical,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    flipViewportHorizontal: {\r\n      commandFn: actions.flipViewportHorizontal,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    scaleUpViewport: {\r\n      commandFn: actions.scaleViewport,\r\n      storeContexts: [],\r\n      options: { direction: 1 },\r\n    },\r\n    scaleDownViewport: {\r\n      commandFn: actions.scaleViewport,\r\n      storeContexts: [],\r\n      options: { direction: -1 },\r\n    },\r\n    fitViewportToWindow: {\r\n      commandFn: actions.scaleViewport,\r\n      storeContexts: [],\r\n      options: { direction: 0 },\r\n    },\r\n    resetViewport: {\r\n      commandFn: actions.resetViewport,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    clearAnnotations: {\r\n      commandFn: actions.clearAnnotations,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    nextImage: {\r\n      commandFn: actions.nextImage,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    previousImage: {\r\n      commandFn: actions.previousImage,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    // TOOLS\r\n    setToolActive: {\r\n      commandFn: actions.setToolActive,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n    setZoomTool: {\r\n      commandFn: actions.setToolActive,\r\n      storeContexts: [],\r\n      options: { toolName: 'Zoom' },\r\n    },\r\n    // setCornerstoneLayout: {\r\n    //   commandFn: actions.setCornerstoneLayout,\r\n    //   storeContexts: [],\r\n    //   options: {},\r\n    //   context: 'VIEWER',\r\n    // },\r\n    setWindowLevel: {\r\n      commandFn: actions.setWindowLevel,\r\n      storeContexts: [],\r\n      options: {},\r\n    },\r\n  };\r\n\r\n  return {\r\n    actions,\r\n    definitions,\r\n    defaultContext: 'ACTIVE_VIEWPORT::CORNERSTONE',\r\n  };\r\n};\r\n\r\nexport default commandsModule;\r\n","import React from 'react';\r\nimport init from './init.js';\r\nimport commandsModule from './commandsModule.js';\r\nimport CornerstoneViewportDownloadForm from './CornerstoneViewportDownloadForm';\r\n\r\nconst Component = React.lazy(() => {\r\n  return import(/* webpackPrefetch: true */ './OHIFCornerstoneViewport');\r\n});\r\n\r\nconst OHIFCornerstoneViewport = props => {\r\n  return (\r\n    <React.Suspense fallback={<div>Loading...</div>}>\r\n      <Component {...props} />\r\n    </React.Suspense>\r\n  );\r\n};\r\n\r\n/**\r\n *\r\n */\r\nexport default {\r\n  /**\r\n   * Only required property. Should be a unique value across all extensions.\r\n   */\r\n  id: 'org.ohif.cornerstone',\r\n\r\n  /**\r\n   *\r\n   *\r\n   * @param {object} [configuration={}]\r\n   * @param {object|array} [configuration.csToolsConfig] - Passed directly to `initCornerstoneTools`\r\n   */\r\n  preRegistration({ servicesManager, commandsManager, configuration = {} }) {\r\n    init({ servicesManager, commandsManager, configuration });\r\n  },\r\n  getViewportModule({ servicesManager, commandsManager }) {\r\n    const ExtendedOHIFCornerstoneViewport = props => {\r\n      const onNewImageHandler = jumpData => {\r\n        commandsManager.runCommand('jumpToImage', jumpData);\r\n      };\r\n      const { ToolBarService } = servicesManager.services;\r\n\r\n      return (\r\n        <OHIFCornerstoneViewport\r\n          {...props}\r\n          ToolBarService={ToolBarService}\r\n          servicesManager={servicesManager}\r\n          commandsManager={commandsManager}\r\n          onNewImage={onNewImageHandler}\r\n        />\r\n      );\r\n    };\r\n\r\n    return [\r\n      { name: 'cornerstone', component: ExtendedOHIFCornerstoneViewport },\r\n    ];\r\n  },\r\n  getCommandsModule({ servicesManager, commandsManager }) {\r\n    return commandsModule({ servicesManager, commandsManager });\r\n  },\r\n};\r\n\r\nexport { CornerstoneViewportDownloadForm };\r\n","import React, { useState, useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { utils } from '@ohif/core';\r\nimport {\r\n  StudyBrowser,\r\n  useImageViewer,\r\n  useViewportGrid,\r\n  Dialog,\r\n} from '@ohif/ui';\r\nimport { useTrackedMeasurements } from '../../getContextModule';\r\n\r\nconst { formatDate } = utils;\r\n\r\n/**\r\n *\r\n * @param {*} param0\r\n */\r\nfunction PanelStudyBrowserTracking({\r\n  MeasurementService,\r\n  DisplaySetService,\r\n  UIDialogService,\r\n  UINotificationService,\r\n  getImageSrc,\r\n  getStudiesForPatientByStudyInstanceUID,\r\n  requestDisplaySetCreationForStudy,\r\n  dataSource,\r\n}) {\r\n  // Normally you nest the components so the tree isn't so deep, and the data\r\n  // doesn't have to have such an intense shape. This works well enough for now.\r\n  // Tabs --> Studies --> DisplaySets --> Thumbnails\r\n  const { StudyInstanceUIDs } = useImageViewer();\r\n  const [\r\n    { activeViewportIndex, viewports, numCols, numRows },\r\n    viewportGridService,\r\n  ] = useViewportGrid();\r\n  const [\r\n    trackedMeasurements,\r\n    sendTrackedMeasurementsEvent,\r\n  ] = useTrackedMeasurements();\r\n  const [activeTabName, setActiveTabName] = useState('primary');\r\n  const [expandedStudyInstanceUIDs, setExpandedStudyInstanceUIDs] = useState([\r\n    ...StudyInstanceUIDs,\r\n  ]);\r\n  const [studyDisplayList, setStudyDisplayList] = useState([]);\r\n  const [displaySets, setDisplaySets] = useState([]);\r\n  const [thumbnailImageSrcMap, setThumbnailImageSrcMap] = useState({});\r\n  const [jumpToDisplaySet, setJumpToDisplaySet] = useState(null);\r\n\r\n  const onDoubleClickThumbnailHandler = displaySetInstanceUID => {\r\n    viewportGridService.setDisplaysetForViewport({\r\n      viewportIndex: activeViewportIndex,\r\n      displaySetInstanceUID,\r\n    });\r\n  };\r\n\r\n  const activeDisplaySetInstanceUID =\r\n    viewports[activeViewportIndex]?.displaySetInstanceUID;\r\n\r\n  const isSingleViewport = numCols === 1 && numRows === 1;\r\n\r\n  useEffect(() => {\r\n    const added = MeasurementService.EVENTS.MEASUREMENT_ADDED;\r\n    const addedRaw = MeasurementService.EVENTS.RAW_MEASUREMENT_ADDED;\r\n    const subscriptions = [];\r\n\r\n    [added, addedRaw].forEach(evt => {\r\n      subscriptions.push(\r\n        MeasurementService.subscribe(evt, ({ source, measurement }) => {\r\n          const {\r\n            referenceSeriesUID: SeriesInstanceUID,\r\n            referenceStudyUID: StudyInstanceUID,\r\n          } = measurement;\r\n\r\n          sendTrackedMeasurementsEvent('SET_DIRTY', { SeriesInstanceUID });\r\n          sendTrackedMeasurementsEvent('TRACK_SERIES', {\r\n            viewportIndex: activeViewportIndex,\r\n            StudyInstanceUID,\r\n            SeriesInstanceUID,\r\n          });\r\n        }).unsubscribe\r\n      );\r\n    });\r\n\r\n    return () => {\r\n      subscriptions.forEach(unsub => {\r\n        unsub();\r\n      });\r\n    };\r\n  }, [MeasurementService, activeViewportIndex, sendTrackedMeasurementsEvent]);\r\n\r\n  const { trackedStudy, trackedSeries } = trackedMeasurements.context;\r\n\r\n  // ~~ studyDisplayList\r\n  useEffect(() => {\r\n    // Fetch all studies for the patient in each primary study\r\n    async function fetchStudiesForPatient(StudyInstanceUID) {\r\n      const qidoStudiesForPatient =\r\n        (await getStudiesForPatientByStudyInstanceUID(StudyInstanceUID)) || [];\r\n      // TODO: This should be \"naturalized DICOM JSON\" studies\r\n      const mappedStudies = _mapDataSourceStudies(qidoStudiesForPatient);\r\n      const actuallyMappedStudies = mappedStudies.map(qidoStudy => {\r\n        return {\r\n          studyInstanceUid: qidoStudy.StudyInstanceUID,\r\n          date: formatDate(qidoStudy.StudyDate),\r\n          description: qidoStudy.StudyDescription,\r\n          modalities: qidoStudy.ModalitiesInStudy,\r\n          numInstances: qidoStudy.NumInstances,\r\n          // displaySets: []\r\n        };\r\n      });\r\n\r\n      setStudyDisplayList(actuallyMappedStudies);\r\n    }\r\n\r\n    StudyInstanceUIDs.forEach(sid => fetchStudiesForPatient(sid));\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [StudyInstanceUIDs, getStudiesForPatientByStudyInstanceUID]);\r\n\r\n  // ~~ Initial Thumbnails\r\n  useEffect(() => {\r\n    const currentDisplaySets = DisplaySetService.activeDisplaySets;\r\n    currentDisplaySets.forEach(async dSet => {\r\n      const newImageSrcEntry = {};\r\n      const displaySet = DisplaySetService.getDisplaySetByUID(\r\n        dSet.displaySetInstanceUID\r\n      );\r\n      const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\r\n      const imageId = imageIds[Math.floor(imageIds.length / 2)];\r\n\r\n      // TODO: Is it okay that imageIds are not returned here for SR displaysets?\r\n      if (imageId) {\r\n        // When the image arrives, render it and store the result in the thumbnailImgSrcMap\r\n        newImageSrcEntry[dSet.displaySetInstanceUID] = await getImageSrc(\r\n          imageId\r\n        );\r\n        setThumbnailImageSrcMap(prevState => {\r\n          return { ...prevState, ...newImageSrcEntry };\r\n        });\r\n      }\r\n    });\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [DisplaySetService, dataSource, getImageSrc]);\r\n\r\n  // ~~ displaySets\r\n  useEffect(() => {\r\n    // TODO: Are we sure `activeDisplaySets` will always be accurate?\r\n    const currentDisplaySets = DisplaySetService.activeDisplaySets;\r\n    const mappedDisplaySets = _mapDisplaySets(\r\n      currentDisplaySets,\r\n      thumbnailImageSrcMap,\r\n      trackedSeries,\r\n      viewports,\r\n      isSingleViewport,\r\n      dataSource,\r\n      DisplaySetService,\r\n      UIDialogService,\r\n      UINotificationService\r\n    );\r\n\r\n    setDisplaySets(mappedDisplaySets);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [\r\n    DisplaySetService.activeDisplaySets,\r\n    trackedSeries,\r\n    thumbnailImageSrcMap,\r\n    viewports,\r\n    dataSource,\r\n  ]);\r\n\r\n  // ~~ subscriptions --> displaySets\r\n  useEffect(() => {\r\n    // DISPLAY_SETS_ADDED returns an array of DisplaySets that were added\r\n    const SubscriptionDisplaySetsAdded = DisplaySetService.subscribe(\r\n      DisplaySetService.EVENTS.DISPLAY_SETS_ADDED,\r\n      data => {\r\n        const { displaySetsAdded, options } = data;\r\n        displaySetsAdded.forEach(async dSet => {\r\n          const displaySetInstanceUID = dSet.displaySetInstanceUID;\r\n\r\n          const newImageSrcEntry = {};\r\n          const displaySet = DisplaySetService.getDisplaySetByUID(\r\n            displaySetInstanceUID\r\n          );\r\n\r\n          if (options.madeInClient) {\r\n            setJumpToDisplaySet(displaySetInstanceUID);\r\n          }\r\n\r\n          const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\r\n          const imageId = imageIds[Math.floor(imageIds.length / 2)];\r\n\r\n          // TODO: Is it okay that imageIds are not returned here for SR displaysets?\r\n          if (imageId) {\r\n            // When the image arrives, render it and store the result in the thumbnailImgSrcMap\r\n            newImageSrcEntry[displaySetInstanceUID] = await getImageSrc(\r\n              imageId\r\n            );\r\n            setThumbnailImageSrcMap(prevState => {\r\n              return { ...prevState, ...newImageSrcEntry };\r\n            });\r\n          }\r\n        });\r\n      }\r\n    );\r\n\r\n    // TODO: Will this always hold _all_ the displaySets we care about?\r\n    // DISPLAY_SETS_CHANGED returns `DisplaySerService.activeDisplaySets`\r\n    const SubscriptionDisplaySetsChanged = DisplaySetService.subscribe(\r\n      DisplaySetService.EVENTS.DISPLAY_SETS_CHANGED,\r\n      changedDisplaySets => {\r\n        const mappedDisplaySets = _mapDisplaySets(\r\n          changedDisplaySets,\r\n          thumbnailImageSrcMap,\r\n          trackedSeries,\r\n          viewports,\r\n          isSingleViewport,\r\n          dataSource,\r\n          DisplaySetService,\r\n          UIDialogService,\r\n          UINotificationService\r\n        );\r\n\r\n        setDisplaySets(mappedDisplaySets);\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      SubscriptionDisplaySetsAdded.unsubscribe();\r\n      SubscriptionDisplaySetsChanged.unsubscribe();\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [\r\n    DisplaySetService,\r\n    dataSource,\r\n    getImageSrc,\r\n    thumbnailImageSrcMap,\r\n    trackedSeries,\r\n    viewports,\r\n  ]);\r\n\r\n  const tabs = _createStudyBrowserTabs(\r\n    StudyInstanceUIDs,\r\n    studyDisplayList,\r\n    displaySets\r\n  );\r\n\r\n  // TODO: Should not fire this on \"close\"\r\n  function _handleStudyClick(StudyInstanceUID) {\r\n    const shouldCollapseStudy = expandedStudyInstanceUIDs.includes(\r\n      StudyInstanceUID\r\n    );\r\n    const updatedExpandedStudyInstanceUIDs = shouldCollapseStudy\r\n      ? [\r\n          ...expandedStudyInstanceUIDs.filter(\r\n            stdyUid => stdyUid !== StudyInstanceUID\r\n          ),\r\n        ]\r\n      : [...expandedStudyInstanceUIDs, StudyInstanceUID];\r\n\r\n    setExpandedStudyInstanceUIDs(updatedExpandedStudyInstanceUIDs);\r\n\r\n    if (!shouldCollapseStudy) {\r\n      const madeInClient = true\r\n      requestDisplaySetCreationForStudy(DisplaySetService, StudyInstanceUID, madeInClient);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (jumpToDisplaySet) {\r\n      // Get element by displaySetInstanceUID\r\n      const displaySetInstanceUID = jumpToDisplaySet;\r\n      const element = document.getElementById(\r\n        `thumbnail-${displaySetInstanceUID}`\r\n      );\r\n\r\n      if (element && typeof element.scrollIntoView === 'function') {\r\n        // TODO: Any way to support IE here?\r\n        element.scrollIntoView({ behavior: 'smooth' });\r\n\r\n        setJumpToDisplaySet(null);\r\n      }\r\n    }\r\n  }, [jumpToDisplaySet, expandedStudyInstanceUIDs, activeTabName]);\r\n\r\n  useEffect(() => {\r\n    if (!jumpToDisplaySet) {\r\n      return;\r\n    }\r\n\r\n    const displaySetInstanceUID = jumpToDisplaySet;\r\n    // Set the activeTabName and expand the study\r\n    const thumbnailLocation = _findTabAndStudyOfDisplaySet(\r\n      displaySetInstanceUID,\r\n      tabs\r\n    );\r\n    if (!thumbnailLocation) {\r\n      console.warn('jumpToThumbnail: displaySet thumbnail not found.');\r\n\r\n      return;\r\n    }\r\n    const { tabName, StudyInstanceUID } = thumbnailLocation;\r\n    setActiveTabName(tabName);\r\n    const studyExpanded = expandedStudyInstanceUIDs.includes(StudyInstanceUID);\r\n    if (!studyExpanded) {\r\n      const updatedExpandedStudyInstanceUIDs = [\r\n        ...expandedStudyInstanceUIDs,\r\n        StudyInstanceUID,\r\n      ];\r\n      setExpandedStudyInstanceUIDs(updatedExpandedStudyInstanceUIDs);\r\n    }\r\n  }, [expandedStudyInstanceUIDs, jumpToDisplaySet, tabs]);\r\n\r\n  return (\r\n    <StudyBrowser\r\n      tabs={tabs}\r\n      activeTabName={activeTabName}\r\n      expandedStudyInstanceUIDs={expandedStudyInstanceUIDs}\r\n      onClickStudy={_handleStudyClick}\r\n      onClickTab={clickedTabName => {\r\n        setActiveTabName(clickedTabName);\r\n      }}\r\n      onClickUntrack={displaySetInstanceUID => {\r\n        const displaySet = DisplaySetService.getDisplaySetByUID(\r\n          displaySetInstanceUID\r\n        );\r\n        // TODO: shift this somewhere else where we're centralizing this logic?\r\n        // Potentially a helper from displaySetInstanceUID to this\r\n        sendTrackedMeasurementsEvent('UNTRACK_SERIES', {\r\n          SeriesInstanceUID: displaySet.SeriesInstanceUID,\r\n        });\r\n      }}\r\n      onClickThumbnail={() => {}}\r\n      onDoubleClickThumbnail={onDoubleClickThumbnailHandler}\r\n      activeDisplaySetInstanceUID={activeDisplaySetInstanceUID}\r\n    />\r\n  );\r\n}\r\n\r\nPanelStudyBrowserTracking.propTypes = {\r\n  MeasurementService: PropTypes.shape({\r\n    subscribe: PropTypes.func.isRequired,\r\n    EVENTS: PropTypes.object.isRequired,\r\n  }).isRequired,\r\n  DisplaySetService: PropTypes.shape({\r\n    EVENTS: PropTypes.object.isRequired,\r\n    activeDisplaySets: PropTypes.arrayOf(PropTypes.object).isRequired,\r\n    getDisplaySetByUID: PropTypes.func.isRequired,\r\n    subscribe: PropTypes.func.isRequired,\r\n  }).isRequired,\r\n  dataSource: PropTypes.shape({\r\n    getImageIdsForDisplaySet: PropTypes.func.isRequired,\r\n  }).isRequired,\r\n  getImageSrc: PropTypes.func.isRequired,\r\n  getStudiesForPatientByStudyInstanceUID: PropTypes.func.isRequired,\r\n  requestDisplaySetCreationForStudy: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default PanelStudyBrowserTracking;\r\n\r\n/**\r\n * Maps from the DataSource's format to a naturalized object\r\n *\r\n * @param {*} studies\r\n */\r\nfunction _mapDataSourceStudies(studies) {\r\n  return studies.map(study => {\r\n    // TODO: Why does the data source return in this format?\r\n    return {\r\n      AccessionNumber: study.accession,\r\n      StudyDate: study.date,\r\n      StudyDescription: study.description,\r\n      NumInstances: study.instances,\r\n      ModalitiesInStudy: study.modalities,\r\n      PatientID: study.mrn,\r\n      PatientName: study.patientName,\r\n      StudyInstanceUID: study.studyInstanceUid,\r\n      StudyTime: study.time,\r\n    };\r\n  });\r\n}\r\n\r\nfunction _mapDisplaySets(\r\n  displaySets,\r\n  thumbnailImageSrcMap,\r\n  trackedSeriesInstanceUIDs,\r\n  viewports, // TODO: make array of `displaySetInstanceUIDs`?\r\n  isSingleViewport,\r\n  dataSource,\r\n  DisplaySetService,\r\n  UIDialogService,\r\n  UINotificationService\r\n) {\r\n  const thumbnailDisplaySets = [];\r\n  const thumbnailNoImageDisplaySets = [];\r\n  displaySets.forEach(ds => {\r\n    const imageSrc = thumbnailImageSrcMap[ds.displaySetInstanceUID];\r\n    const componentType = _getComponentType(ds.Modality);\r\n    const viewportIdentificator = isSingleViewport\r\n      ? []\r\n      : viewports.reduce((acc, viewportData, index) => {\r\n          if (viewportData.displaySetInstanceUID === ds.displaySetInstanceUID) {\r\n            acc.push(_viewportLabels[index]);\r\n          }\r\n          return acc;\r\n        }, []);\r\n\r\n    const array =\r\n      componentType === 'thumbnailTracked'\r\n        ? thumbnailDisplaySets\r\n        : thumbnailNoImageDisplaySets;\r\n\r\n    const { displaySetInstanceUID } = ds;\r\n\r\n    const thumbnailProps = {\r\n      displaySetInstanceUID,\r\n      description: ds.SeriesDescription,\r\n      seriesNumber: ds.SeriesNumber,\r\n      modality: ds.Modality,\r\n      seriesDate: formatDate(ds.SeriesDate),\r\n      numInstances: ds.numImageFrames,\r\n      StudyInstanceUID: ds.StudyInstanceUID,\r\n      componentType,\r\n      imageSrc,\r\n      dragData: {\r\n        type: 'displayset',\r\n        displaySetInstanceUID,\r\n        // .. Any other data to pass\r\n      },\r\n      isTracked: trackedSeriesInstanceUIDs.includes(ds.SeriesInstanceUID),\r\n      viewportIdentificator,\r\n    };\r\n\r\n    if (componentType === 'thumbnailNoImage') {\r\n      if (dataSource.reject && dataSource.reject.series) {\r\n        thumbnailProps.canReject = true;\r\n        thumbnailProps.onReject = () => {\r\n          UIDialogService.create({\r\n            id: 'ds-reject-sr',\r\n            centralize: true,\r\n            isDraggable: false,\r\n            showOverlay: true,\r\n            content: Dialog,\r\n            contentProps: {\r\n              title: 'Delete Report',\r\n              body: () => (\r\n                <div className=\"p-4 text-white bg-primary-dark\">\r\n                  <p>Are you sure you want to delete this report?</p>\r\n                  <p>This action cannot be undone.</p>\r\n                </div>\r\n              ),\r\n              actions: [\r\n                { id: 'cancel', text: 'Cancel', type: 'secondary' },\r\n                {\r\n                  id: 'yes',\r\n                  text: 'Yes',\r\n                  type: 'primary',\r\n                  classes: ['reject-yes-button'],\r\n                },\r\n              ],\r\n              onClose: () => UIDialogService.dismiss({ id: 'ds-reject-sr' }),\r\n              onShow: () => {\r\n                const yesButton = document.querySelector('.reject-yes-button');\r\n\r\n                yesButton.focus();\r\n              },\r\n              onSubmit: async ({ action }) => {\r\n                switch (action.id) {\r\n                  case 'yes':\r\n                    try {\r\n                      await dataSource.reject.series(\r\n                        ds.StudyInstanceUID,\r\n                        ds.SeriesInstanceUID\r\n                      );\r\n                      DisplaySetService.deleteDisplaySet(displaySetInstanceUID);\r\n                      UIDialogService.dismiss({ id: 'ds-reject-sr' });\r\n                      UINotificationService.show({\r\n                        title: 'Delete Report',\r\n                        message: 'Report deleted successfully',\r\n                        type: 'success',\r\n                      });\r\n                    } catch (error) {\r\n                      UIDialogService.dismiss({ id: 'ds-reject-sr' });\r\n                      UINotificationService.show({\r\n                        title: 'Delete Report',\r\n                        message: 'Failed to delete report',\r\n                        type: 'error',\r\n                      });\r\n                    }\r\n                    break;\r\n                  case 'cancel':\r\n                    UIDialogService.dismiss({ id: 'ds-reject-sr' });\r\n                    break;\r\n                }\r\n              },\r\n            },\r\n          });\r\n        };\r\n      } else {\r\n        thumbnailProps.canReject = false;\r\n      }\r\n    }\r\n\r\n    array.push(thumbnailProps);\r\n  });\r\n\r\n  return [...thumbnailDisplaySets, ...thumbnailNoImageDisplaySets];\r\n}\r\n\r\nconst thumbnailNoImageModalities = [\r\n  'SR',\r\n  'SEG',\r\n  'RTSTRUCT',\r\n  'RTPLAN',\r\n  'RTDOSE',\r\n];\r\n\r\nfunction _getComponentType(Modality) {\r\n  if (thumbnailNoImageModalities.includes(Modality)) {\r\n    return 'thumbnailNoImage';\r\n  }\r\n\r\n  return 'thumbnailTracked';\r\n}\r\n\r\nconst _viewportLabels = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'];\r\n\r\n/**\r\n *\r\n * @param {string[]} primaryStudyInstanceUIDs\r\n * @param {object[]} studyDisplayList\r\n * @param {string} studyDisplayList.studyInstanceUid\r\n * @param {string} studyDisplayList.date\r\n * @param {string} studyDisplayList.description\r\n * @param {string} studyDisplayList.modalities\r\n * @param {number} studyDisplayList.numInstances\r\n * @param {object[]} displaySets\r\n * @returns tabs - The prop object expected by the StudyBrowser component\r\n */\r\nfunction _createStudyBrowserTabs(\r\n  primaryStudyInstanceUIDs,\r\n  studyDisplayList,\r\n  displaySets\r\n) {\r\n  const primaryStudies = [];\r\n  const recentStudies = [];\r\n  const allStudies = [];\r\n\r\n  // Iterate over each study...\r\n  studyDisplayList.forEach(study => {\r\n    // Find it's display sets\r\n    const displaySetsForStudy = displaySets.filter(\r\n      ds => ds.StudyInstanceUID === study.studyInstanceUid\r\n    );\r\n\r\n    // Sort them\r\n    const sortedDisplaySetsForStudy = utils.sortBySeriesDate(\r\n      displaySetsForStudy\r\n    );\r\n\r\n    /* Sort by series number, then by series date\r\n      displaySetsForStudy.sort((a, b) => {\r\n        if (a.seriesNumber !== b.seriesNumber) {\r\n          return a.seriesNumber - b.seriesNumber;\r\n        }\r\n\r\n        const seriesDateA = Date.parse(a.seriesDate);\r\n        const seriesDateB = Date.parse(b.seriesDate);\r\n\r\n        return seriesDateA - seriesDateB;\r\n      });\r\n    */\r\n\r\n    // Map the study to it's tab/view representation\r\n    const tabStudy = Object.assign({}, study, {\r\n      displaySets: displaySetsForStudy,\r\n    });\r\n\r\n    // Add the \"tab study\" to the 'primary', 'recent', and/or 'all' tab group(s)\r\n    if (primaryStudyInstanceUIDs.includes(study.studyInstanceUid)) {\r\n      primaryStudies.push(tabStudy);\r\n      allStudies.push(tabStudy);\r\n    } else {\r\n      // TODO: Filter allStudies to dates within one year of current date\r\n      recentStudies.push(tabStudy);\r\n      allStudies.push(tabStudy);\r\n    }\r\n  });\r\n\r\n  // Newest first\r\n  const _byDate = (a, b) => {\r\n    const dateA = Date.parse(a);\r\n    const dateB = Date.parse(b);\r\n\r\n    return dateB - dateA;\r\n  };\r\n\r\n  const tabs = [\r\n    {\r\n      name: 'primary',\r\n      label: 'Primary',\r\n      studies: primaryStudies.sort((studyA, studyB) =>\r\n        _byDate(studyA.date, studyB.date)\r\n      ),\r\n    },\r\n    {\r\n      name: 'recent',\r\n      label: 'Recent',\r\n      studies: recentStudies.sort((studyA, studyB) =>\r\n        _byDate(studyA.date, studyB.date)\r\n      ),\r\n    },\r\n    {\r\n      name: 'all',\r\n      label: 'All',\r\n      studies: allStudies.sort((studyA, studyB) =>\r\n        _byDate(studyA.date, studyB.date)\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return tabs;\r\n}\r\n\r\nfunction _findTabAndStudyOfDisplaySet(displaySetInstanceUID, tabs) {\r\n  for (let t = 0; t < tabs.length; t++) {\r\n    const { studies } = tabs[t];\r\n\r\n    for (let s = 0; s < studies.length; s++) {\r\n      const { displaySets } = studies[s];\r\n\r\n      for (let d = 0; d < displaySets.length; d++) {\r\n        const displaySet = displaySets[d];\r\n\r\n        if (displaySet.displaySetInstanceUID === displaySetInstanceUID) {\r\n          return {\r\n            tabName: tabs[t].name,\r\n            StudyInstanceUID: studies[s].studyInstanceUid,\r\n          };\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @param {*} cornerstone\r\n * @param {*} imageId\r\n */\r\nfunction getImageSrcFromImageId(cornerstone, imageId) {\r\n  return new Promise((resolve, reject) => {\r\n    cornerstone\r\n      .loadAndCacheImage(imageId)\r\n      .then(image => {\r\n        const canvas = document.createElement('canvas');\r\n        cornerstone.renderToCanvas(canvas, image);\r\n\r\n        resolve(canvas.toDataURL());\r\n      })\r\n      .catch(reject);\r\n  });\r\n}\r\n\r\nexport default getImageSrcFromImageId;\r\n","async function getStudiesForPatientByStudyInstanceUID(\r\n  dataSource,\r\n  StudyInstanceUID\r\n) {\r\n  if (StudyInstanceUID === undefined) {\r\n    return;\r\n  }\r\n  // TODO: The `DicomMetadataStore` should short-circuit both of these requests\r\n  // Data _could_ be here from route query, or if using JSON data source\r\n  // We could also force this to \"await\" these values being available in the DICOMStore?\r\n  // Kind of like promise fulfillment in cornerstone-wado-image-loader when there are multiple\r\n  // outgoing requests for the same data\r\n  const getStudyResult = await dataSource.query.studies.search({\r\n    studyInstanceUid: StudyInstanceUID,\r\n  });\r\n\r\n  // TODO: To Erik's point, the data source likely shouldn't deviate from\r\n  // Naturalized DICOM JSON when returning. It makes things like this awkward (mrn)\r\n  if (getStudyResult && getStudyResult.length && getStudyResult[0].mrn) {\r\n    return dataSource.query.studies.search({\r\n      patientId: getStudyResult[0].mrn,\r\n    });\r\n  }\r\n  console.log('No mrn found for', getStudyResult);\r\n  // The original study we KNOW belongs to the same set, so just return it\r\n  return getStudyResult;\r\n}\r\n\r\nexport default getStudiesForPatientByStudyInstanceUID;\r\n","function requestDisplaySetCreationForStudy(\r\n  dataSource,\r\n  DisplaySetService,\r\n  StudyInstanceUID,\r\n  madeInClient,\r\n) {\r\n  if (\r\n    DisplaySetService.activeDisplaySets.some(\r\n      displaySet => displaySet.StudyInstanceUID === StudyInstanceUID\r\n    )\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  dataSource.retrieveSeriesMetadata({ StudyInstanceUID, madeInClient });\r\n}\r\n\r\nexport default requestDisplaySetCreationForStudy;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n//\r\nimport PanelStudyBrowserTracking from './PanelStudyBrowserTracking';\r\nimport getImageSrcFromImageId from './getImageSrcFromImageId';\r\nimport getStudiesForPatientByStudyInstanceUID from './getStudiesForPatientByStudyInstanceUID';\r\nimport requestDisplaySetCreationForStudy from './requestDisplaySetCreationForStudy';\r\n\r\n/**\r\n * Wraps the PanelStudyBrowser and provides features afforded by managers/services\r\n *\r\n * @param {object} params\r\n * @param {object} commandsManager\r\n * @param {object} extensionManager\r\n */\r\nfunction WrappedPanelStudyBrowserTracking({\r\n  commandsManager,\r\n  extensionManager,\r\n  servicesManager,\r\n}) {\r\n  const dataSource = extensionManager.getActiveDataSource()[0];\r\n  const _getStudiesForPatientByStudyInstanceUID = getStudiesForPatientByStudyInstanceUID.bind(\r\n    null,\r\n    dataSource\r\n  );\r\n  const _getImageSrcFromImageId = _createGetImageSrcFromImageIdFn(\r\n    commandsManager.getCommand.bind(commandsManager)\r\n  );\r\n  const _requestDisplaySetCreationForStudy = requestDisplaySetCreationForStudy.bind(\r\n    null,\r\n    dataSource\r\n  );\r\n\r\n  return (\r\n    <PanelStudyBrowserTracking\r\n      MeasurementService={servicesManager.services.MeasurementService}\r\n      DisplaySetService={servicesManager.services.DisplaySetService}\r\n      UIDialogService={servicesManager.services.UIDialogService}\r\n      UINotificationService={servicesManager.services.UINotificationService}\r\n      dataSource={dataSource}\r\n      getImageSrc={_getImageSrcFromImageId}\r\n      getStudiesForPatientByStudyInstanceUID={\r\n        _getStudiesForPatientByStudyInstanceUID\r\n      }\r\n      requestDisplaySetCreationForStudy={_requestDisplaySetCreationForStudy}\r\n    />\r\n  );\r\n}\r\n\r\n/**\r\n * Grabs cornerstone library reference using a dependent command from\r\n * the @ohif/extension-cornerstone extension. Then creates a helper function\r\n * that can take an imageId and return an image src.\r\n *\r\n * @param {func} getCommand - CommandManager's getCommand method\r\n * @returns {func} getImageSrcFromImageId - A utility function powered by\r\n * cornerstone\r\n */\r\nfunction _createGetImageSrcFromImageIdFn(getCommand) {\r\n  try {\r\n    const command = getCommand('getCornerstoneLibraries', 'VIEWER');\r\n    if (!command) {\r\n      return;\r\n    }\r\n    const { cornerstone } = command.commandFn();\r\n\r\n    return getImageSrcFromImageId.bind(null, cornerstone);\r\n  } catch (ex) {\r\n    throw new Error('Required command not found');\r\n  }\r\n}\r\n\r\nWrappedPanelStudyBrowserTracking.propTypes = {\r\n  commandsManager: PropTypes.object.isRequired,\r\n  extensionManager: PropTypes.object.isRequired,\r\n  servicesManager: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default WrappedPanelStudyBrowserTracking;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport { Button, ButtonGroup } from '@ohif/ui';\r\n\r\nfunction ActionButtons({ onExportClick, onCreateReportClick }) {\r\n  const { t } = useTranslation('MeasurementTable');\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <ButtonGroup color=\"black\" size=\"inherit\">\r\n        <Button className=\"text-base px-2 py-2\" onClick={onExportClick}>\r\n          {t('Export')}\r\n        </Button>\r\n      </ButtonGroup>\r\n      <Button\r\n        className=\"ml-2 text-base\"\r\n        variant=\"outlined\"\r\n        size=\"small\"\r\n        color=\"black\"\r\n        onClick={onCreateReportClick}\r\n      >\r\n        {t('Create Report')}\r\n      </Button>\r\n    </React.Fragment>\r\n  );\r\n}\r\n\r\nActionButtons.propTypes = {\r\n  onExportClick: PropTypes.func,\r\n  onCreateReportClick: PropTypes.func,\r\n};\r\n\r\nActionButtons.defaultProps = {\r\n  onExportClick: () => alert('Export'),\r\n  onCreateReportClick: () => alert('Create Report'),\r\n};\r\n\r\nexport default ActionButtons;\r\n","import { DicomMetadataStore } from '@ohif/core';\r\n\r\nexport default function downloadCSVReport(\r\n  measurementData,\r\n  StudyInstanceUID,\r\n  referencedSeriesInstanceUIDs,\r\n  MeasurementService\r\n) {\r\n  const { VALUE_TYPES } = MeasurementService;\r\n\r\n  if (measurementData.length === 0) {\r\n    // Prevent download of report with no measurements.\r\n    return;\r\n  }\r\n\r\n  const seriesMetadataMap = {};\r\n\r\n  referencedSeriesInstanceUIDs.forEach(SeriesInstanceUID => {\r\n    seriesMetadataMap[SeriesInstanceUID] = DicomMetadataStore.getSeries(\r\n      StudyInstanceUID,\r\n      SeriesInstanceUID\r\n    );\r\n  });\r\n\r\n  const rows = [\r\n    [\r\n      'Patient ID',\r\n      'Patient Name',\r\n      'StudyInstanceUID',\r\n      'SeriesInstanceUID',\r\n      'SOPInstanceUID',\r\n      'Label',\r\n      'Long Axis (mm)',\r\n      'Short Axis (mm)',\r\n      'Length (mm)',\r\n      'Area (mmˆ2)',\r\n      'Mean',\r\n      'StDev',\r\n      'Units',\r\n    ],\r\n  ];\r\n\r\n  measurementData.forEach(measurement => {\r\n    switch (measurement.type) {\r\n      case VALUE_TYPES.BIDIRECTIONAL:\r\n        rows.push(_getBidirectionalRow(measurement, seriesMetadataMap));\r\n        break;\r\n      case VALUE_TYPES.ELLIPSE:\r\n        rows.push(_getEllipseRow(measurement, seriesMetadataMap));\r\n        break;\r\n      case VALUE_TYPES.POINT:\r\n        rows.push(_getAdditionalFindingRow(measurement, seriesMetadataMap));\r\n        break;\r\n      case VALUE_TYPES.POLYLINE:\r\n        rows.push(_getLengthRow(measurement, seriesMetadataMap));\r\n    }\r\n  });\r\n\r\n  let csvContent =\r\n    'data:text/csv;charset=utf-8,' + rows.map(row => row.join(',')).join('\\n');\r\n\r\n  _createAndDownloadFile(csvContent);\r\n}\r\n\r\nfunction _getBidirectionalRow(measurement, seriesMetadataMap) {\r\n  const commonRowItems = _getCommonRowItems(measurement, seriesMetadataMap);\r\n\r\n  return [\r\n    ...commonRowItems,\r\n    measurement.longestDiameter, // Long Axis (mm)\r\n    measurement.shortestDiameter, // Short Axis (mm)\r\n  ];\r\n}\r\n\r\nfunction _getCommonRowItems(measurement, seriesMetadataMap) {\r\n  const seriesMetadata = seriesMetadataMap[measurement.referenceSeriesUID];\r\n  const firstInstance = seriesMetadata.instances[0];\r\n\r\n  const row = [\r\n    firstInstance.PatientID, // Patient ID\r\n    firstInstance.PatientName.Alphabetic, // PatientName\r\n    measurement.referenceStudyUID, // StudyInstanceUID\r\n    measurement.referenceSeriesUID, // SeriesInstanceUID\r\n    measurement.SOPInstanceUID, // SOPInstanceUID\r\n    measurement.label || '', // Label\r\n  ];\r\n\r\n  return row;\r\n}\r\n\r\nfunction _getAdditionalFindingRow(measurement, seriesMetadataMap) {\r\n  const commonRowItems = _getCommonRowItems(measurement, seriesMetadataMap);\r\n\r\n  return [...commonRowItems];\r\n}\r\n\r\nfunction _getEllipseRow(measurement, seriesMetadataMap) {\r\n  const commonRowItems = _getCommonRowItems(measurement, seriesMetadataMap);\r\n  const blankColumns = ['', '', ''];\r\n\r\n  const { area, mean, stdDev, unit } = _getEllipseStatsWithUnits(\r\n    measurement,\r\n    seriesMetadataMap\r\n  );\r\n\r\n  return [\r\n    ...commonRowItems,\r\n    ...blankColumns,\r\n    area, // Area (mmˆ2)\r\n    mean, // Mean\r\n    stdDev, // StDev\r\n    unit,\r\n  ];\r\n}\r\n\r\nfunction _getEllipseStatsWithUnits(measurement, seriesMetadataMap) {\r\n  const seriesMetadata = seriesMetadataMap[measurement.referenceSeriesUID];\r\n  const firstInstance = seriesMetadata.instances[0];\r\n  const modality = firstInstance.Modality;\r\n\r\n  switch (modality) {\r\n    case 'CT':\r\n      return {\r\n        mean: `${measurement.mean.toFixed(1)}`,\r\n        stdDev: `${measurement.stdDev.toFixed(1)}`,\r\n        area: measurement.area.toFixed(1),\r\n        unit: 'HU',\r\n      };\r\n    case 'PT':\r\n      if (measurement.meanSUV) {\r\n        return {\r\n          mean: `${measurement.meanSUV.toFixed(1)}`,\r\n          stdDev: `${measurement.stdDevSUV.toFixed(1)}`,\r\n          area: measurement.area.toFixed(1),\r\n          unit: 'SUV',\r\n        };\r\n      }\r\n    // If no SUV calculation then fallback to default.\r\n    default:\r\n      return {\r\n        mean: `${measurement.mean.toFixed(1)}`,\r\n        stdDev: `${measurement.stdDev.toFixed(1)}`,\r\n        area: measurement.area.toFixed(1),\r\n        unit: 'Pixel Values',\r\n      };\r\n  }\r\n}\r\n\r\nfunction _getLengthRow(measurement, seriesMetadataMap) {\r\n  const commonRowItems = _getCommonRowItems(measurement, seriesMetadataMap);\r\n  const blankColumns = ['', ''];\r\n\r\n  return [...commonRowItems, ...blankColumns, measurement.length.toFixed(1)];\r\n}\r\n\r\nfunction _createAndDownloadFile(csvContent) {\r\n  const encodedUri = encodeURI(csvContent);\r\n\r\n  const link = document.createElement('a');\r\n  link.setAttribute('href', encodedUri);\r\n  link.setAttribute('download', 'MeasurementReport.csv');\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport {\r\n  StudySummary,\r\n  MeasurementTable,\r\n  Dialog,\r\n  Input,\r\n  useViewportGrid,\r\n} from '@ohif/ui';\r\nimport { DicomMetadataStore, utils } from '@ohif/core';\r\nimport { useDebounce } from '@hooks';\r\nimport ActionButtons from './ActionButtons';\r\nimport { useTrackedMeasurements } from '../../getContextModule';\r\nimport createReportDialogPrompt from '../../_shared/createReportDialogPrompt';\r\nimport RESPONSES from '../../_shared/PROMPT_RESPONSES';\r\nimport downloadCSVReport from '../../_shared/downloadCSVReport';\r\n\r\nconst { formatDate } = utils;\r\n\r\nconst DISPLAY_STUDY_SUMMARY_INITIAL_VALUE = {\r\n  key: undefined, //\r\n  date: undefined, // '07-Sep-2010',\r\n  modality: undefined, // 'CT',\r\n  description: undefined, // 'CHEST/ABD/PELVIS W CONTRAST',\r\n};\r\n\r\nfunction PanelMeasurementTableTracking({ servicesManager, extensionManager }) {\r\n  const [viewportGrid, viewportGridService] = useViewportGrid();\r\n  const [measurementChangeTimestamp, setMeasurementsUpdated] = useState(\r\n    Date.now().toString()\r\n  );\r\n  const debouncedMeasurementChangeTimestamp = useDebounce(\r\n    measurementChangeTimestamp,\r\n    200\r\n  );\r\n  const {\r\n    MeasurementService,\r\n    UIDialogService,\r\n    DisplaySetService,\r\n  } = servicesManager.services;\r\n  const [\r\n    trackedMeasurements,\r\n    sendTrackedMeasurementsEvent,\r\n  ] = useTrackedMeasurements();\r\n  const { trackedStudy, trackedSeries } = trackedMeasurements.context;\r\n  const [displayStudySummary, setDisplayStudySummary] = useState(\r\n    DISPLAY_STUDY_SUMMARY_INITIAL_VALUE\r\n  );\r\n  const [displayMeasurements, setDisplayMeasurements] = useState([]);\r\n\r\n  useEffect(() => {\r\n    const measurements = MeasurementService.getMeasurements();\r\n    const filteredMeasurements = measurements.filter(\r\n      m =>\r\n        trackedStudy === m.referenceStudyUID &&\r\n        trackedSeries.includes(m.referenceSeriesUID)\r\n    );\r\n\r\n    const mappedMeasurements = filteredMeasurements.map(m =>\r\n      _mapMeasurementToDisplay(\r\n        m,\r\n        MeasurementService.VALUE_TYPES,\r\n        DisplaySetService\r\n      )\r\n    );\r\n    setDisplayMeasurements(mappedMeasurements);\r\n    // eslint-ignore-next-line\r\n  }, [\r\n    MeasurementService,\r\n    trackedStudy,\r\n    trackedSeries,\r\n    debouncedMeasurementChangeTimestamp,\r\n  ]);\r\n\r\n  const updateDisplayStudySummary = async () => {\r\n    if (trackedMeasurements.matches('tracking')) {\r\n      const StudyInstanceUID = trackedStudy;\r\n      const studyMeta = DicomMetadataStore.getStudy(StudyInstanceUID);\r\n      const instanceMeta = studyMeta.series[0].instances[0];\r\n      const { StudyDate, StudyDescription } = instanceMeta;\r\n\r\n      const modalities = new Set();\r\n      studyMeta.series.forEach(series => {\r\n        if (trackedSeries.includes(series.SeriesInstanceUID)) {\r\n          modalities.add(series.instances[0].Modality);\r\n        }\r\n      });\r\n      const modality = Array.from(modalities).join('/');\r\n\r\n      if (displayStudySummary.key !== StudyInstanceUID) {\r\n        setDisplayStudySummary({\r\n          key: StudyInstanceUID,\r\n          date: StudyDate, // TODO: Format: '07-Sep-2010'\r\n          modality,\r\n          description: StudyDescription,\r\n        });\r\n      }\r\n    } else if (trackedStudy === '' || trackedStudy === undefined) {\r\n      setDisplayStudySummary(DISPLAY_STUDY_SUMMARY_INITIAL_VALUE);\r\n    }\r\n  };\r\n\r\n  // ~~ DisplayStudySummary\r\n  useEffect(() => {\r\n    updateDisplayStudySummary();\r\n  }, [\r\n    displayStudySummary.key,\r\n    trackedMeasurements,\r\n    trackedStudy,\r\n    updateDisplayStudySummary,\r\n  ]);\r\n\r\n  // TODO: Better way to consolidated, debounce, check on change?\r\n  // Are we exposing the right API for measurementService?\r\n  // This watches for ALL MeasurementService changes. It updates a timestamp,\r\n  // which is debounced. After a brief period of inactivity, this triggers\r\n  // a re-render where we grab up-to-date measurements\r\n  useEffect(() => {\r\n    const added = MeasurementService.EVENTS.MEASUREMENT_ADDED;\r\n    const addedRaw = MeasurementService.EVENTS.RAW_MEASUREMENT_ADDED;\r\n    const updated = MeasurementService.EVENTS.MEASUREMENT_UPDATED;\r\n    const removed = MeasurementService.EVENTS.MEASUREMENT_REMOVED;\r\n    const cleared = MeasurementService.EVENTS.MEASUREMENTS_CLEARED;\r\n    const subscriptions = [];\r\n\r\n    [added, addedRaw, updated, removed, cleared].forEach(evt => {\r\n      subscriptions.push(\r\n        MeasurementService.subscribe(evt, () => {\r\n          setMeasurementsUpdated(Date.now().toString());\r\n        }).unsubscribe\r\n      );\r\n    });\r\n\r\n    return () => {\r\n      subscriptions.forEach(unsub => {\r\n        unsub();\r\n      });\r\n    };\r\n  }, [MeasurementService, sendTrackedMeasurementsEvent]);\r\n\r\n  async function exportReport() {\r\n    const measurements = MeasurementService.getMeasurements();\r\n    const trackedMeasurements = measurements.filter(\r\n      m =>\r\n        trackedStudy === m.referenceStudyUID &&\r\n        trackedSeries.includes(m.referenceSeriesUID)\r\n    );\r\n\r\n    downloadCSVReport(\r\n      trackedMeasurements,\r\n      trackedStudy,\r\n      trackedSeries,\r\n      MeasurementService\r\n    );\r\n  }\r\n\r\n  const jumpToImage = ({ id, isActive }) => {\r\n    MeasurementService.jumpToMeasurement(viewportGrid.activeViewportIndex, id);\r\n\r\n    onMeasurementItemClickHandler({ id, isActive });\r\n  };\r\n\r\n  const onMeasurementItemEditHandler = ({ id, isActive }) => {\r\n    const measurement = MeasurementService.getMeasurement(id);\r\n    jumpToImage({ id, isActive });\r\n\r\n    const onSubmitHandler = ({ action, value }) => {\r\n      switch (action.id) {\r\n        case 'save': {\r\n          MeasurementService.update(\r\n            id,\r\n            {\r\n              ...measurement,\r\n              ...value,\r\n            },\r\n            true\r\n          );\r\n        }\r\n      }\r\n      UIDialogService.dismiss({ id: 'enter-annotation' });\r\n    };\r\n\r\n    UIDialogService.create({\r\n      id: 'enter-annotation',\r\n      centralize: true,\r\n      isDraggable: false,\r\n      showOverlay: true,\r\n      content: Dialog,\r\n      contentProps: {\r\n        title: 'Enter your annotation',\r\n        noCloseButton: true,\r\n        value: { label: measurement.label || '' },\r\n        body: ({ value, setValue }) => {\r\n          const onChangeHandler = event => {\r\n            event.persist();\r\n            setValue(value => ({ ...value, label: event.target.value }));\r\n          };\r\n\r\n          const onKeyPressHandler = event => {\r\n            if (event.key === 'Enter') {\r\n              onSubmitHandler({ value, action: { id: 'save' } });\r\n            }\r\n          };\r\n          return (\r\n            <div className=\"p-4 bg-primary-dark\">\r\n              <Input\r\n                autoFocus\r\n                className=\"mt-2 bg-black border-primary-main\"\r\n                type=\"text\"\r\n                containerClassName=\"mr-2\"\r\n                value={value.label}\r\n                onChange={onChangeHandler}\r\n                onKeyPress={onKeyPressHandler}\r\n              />\r\n            </div>\r\n          );\r\n        },\r\n        actions: [\r\n          // temp: swap button types until colors are updated\r\n          { id: 'cancel', text: 'Cancel', type: 'primary' },\r\n          { id: 'save', text: 'Save', type: 'secondary' },\r\n        ],\r\n        onSubmit: onSubmitHandler,\r\n      },\r\n    });\r\n  };\r\n\r\n  const onMeasurementItemClickHandler = ({ id, isActive }) => {\r\n    if (!isActive) {\r\n      const measurements = [...displayMeasurements];\r\n      const measurement = measurements.find(m => m.id === id);\r\n\r\n      measurements.forEach(m => (m.isActive = m.id !== id ? false : true));\r\n      measurement.isActive = true;\r\n      setDisplayMeasurements(measurements);\r\n    }\r\n  };\r\n\r\n  const displayMeasurementsWithoutFindings = displayMeasurements.filter(\r\n    dm => dm.measurementType !== MeasurementService.VALUE_TYPES.POINT\r\n  );\r\n  const additionalFindings = displayMeasurements.filter(\r\n    dm => dm.measurementType === MeasurementService.VALUE_TYPES.POINT\r\n  );\r\n\r\n  return (\r\n    <>\r\n      <div className=\"overflow-x-hidden overflow-y-auto invisible-scrollbar\"\r\n           data-cy={\"trackedMeasurements-panel\"}>\r\n        {displayStudySummary.key && (\r\n          <StudySummary\r\n            date={formatDate(displayStudySummary.date)}\r\n            modality={displayStudySummary.modality}\r\n            description={displayStudySummary.description}\r\n          />\r\n        )}\r\n        <MeasurementTable\r\n          title=\"Measurements\"\r\n          amount={displayMeasurementsWithoutFindings.length}\r\n          data={displayMeasurementsWithoutFindings}\r\n          onClick={jumpToImage}\r\n          onEdit={onMeasurementItemEditHandler}\r\n        />\r\n        {additionalFindings.length !== 0 && (\r\n          <MeasurementTable\r\n            title=\"Additional Findings\"\r\n            amount={additionalFindings.length}\r\n            data={additionalFindings}\r\n            onClick={jumpToImage}\r\n            onEdit={onMeasurementItemEditHandler}\r\n          />\r\n        )}\r\n      </div>\r\n      <div className=\"flex justify-center p-4\">\r\n        <ActionButtons\r\n          onExportClick={exportReport}\r\n          onCreateReportClick={() => {\r\n            sendTrackedMeasurementsEvent('SAVE_REPORT', {\r\n              viewportIndex: viewportGrid.activeViewportIndex,\r\n              isBackupSave: true,\r\n            });\r\n          }}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nPanelMeasurementTableTracking.propTypes = {\r\n  servicesManager: PropTypes.shape({\r\n    services: PropTypes.shape({\r\n      MeasurementService: PropTypes.shape({\r\n        getMeasurements: PropTypes.func.isRequired,\r\n        VALUE_TYPES: PropTypes.object.isRequired,\r\n      }).isRequired,\r\n    }).isRequired,\r\n  }).isRequired,\r\n};\r\n\r\n// TODO: This could be a MeasurementService mapper\r\nfunction _mapMeasurementToDisplay(measurement, types, DisplaySetService) {\r\n  const { referenceStudyUID, referenceSeriesUID, SOPInstanceUID } = measurement;\r\n\r\n  // TODO: We don't deal with multiframe well yet, would need to update\r\n  // This in OHIF-312 when we add FrameIndex to measurements.\r\n\r\n  const instance = DicomMetadataStore.getInstance(\r\n    referenceStudyUID,\r\n    referenceSeriesUID,\r\n    SOPInstanceUID\r\n  );\r\n\r\n  const displaySets = DisplaySetService.getDisplaySetsForSeries(\r\n    referenceSeriesUID\r\n  );\r\n\r\n  if (!displaySets[0] || !displaySets[0].images) {\r\n    throw new Error(\r\n      'The tracked measurements panel should only be tracking \"stack\" displaySets.'\r\n    );\r\n  }\r\n\r\n  const { PixelSpacing, SeriesNumber, InstanceNumber } = instance;\r\n  const displayText = _getDisplayText(\r\n    measurement,\r\n    PixelSpacing,\r\n    SeriesNumber,\r\n    InstanceNumber,\r\n    types\r\n  );\r\n\r\n  return {\r\n    id: measurement.id,\r\n    label: measurement.label || '(empty)',\r\n    measurementType: measurement.type,\r\n    displayText: displayText || [],\r\n    isActive: false, // activeMeasurementItem === i + 1,\r\n  };\r\n}\r\n\r\n/**\r\n *\r\n * @param {*} measurement\r\n * @param {*} pixelSpacing\r\n * @param {*} seriesNumber\r\n * @param {*} instanceNumber\r\n * @param {*} types\r\n */\r\nfunction _getDisplayText(\r\n  measurement,\r\n  pixelSpacing,\r\n  seriesNumber,\r\n  instanceNumber,\r\n  types\r\n) {\r\n  const { type, points } = measurement;\r\n  const hasPixelSpacing =\r\n    pixelSpacing !== undefined &&\r\n    Array.isArray(pixelSpacing) &&\r\n    pixelSpacing.length === 2;\r\n  const [rowPixelSpacing, colPixelSpacing] = hasPixelSpacing\r\n    ? pixelSpacing\r\n    : [1, 1];\r\n  const unit = hasPixelSpacing ? 'mm' : 'px';\r\n\r\n  switch (type) {\r\n    case types.POLYLINE: {\r\n      const { length } = measurement;\r\n      const roundedLength = _round(length, 2);\r\n\r\n      return [\r\n        `${roundedLength} ${unit} (S:${seriesNumber}, I:${instanceNumber})`,\r\n      ];\r\n    }\r\n    case types.BIDIRECTIONAL: {\r\n      const { shortestDiameter, longestDiameter } = measurement;\r\n      const roundedShortestDiameter = _round(shortestDiameter, 1);\r\n      const roundedLongestDiameter = _round(longestDiameter, 1);\r\n\r\n      return [\r\n        `L: ${roundedLongestDiameter} ${unit} (S:${seriesNumber}, I:${instanceNumber})`,\r\n        `W: ${roundedShortestDiameter} ${unit}`,\r\n      ];\r\n    }\r\n    case types.ELLIPSE: {\r\n      const { area } = measurement;\r\n      const roundedArea = _round(area, 2);\r\n\r\n      return [\r\n        `${roundedArea} ${unit}<sup>2</sup> (S:${seriesNumber}, I:${instanceNumber})`,\r\n      ];\r\n    }\r\n    case types.POINT: {\r\n      const { text } = measurement; // Will display in \"short description\"\r\n      return [`(S:${seriesNumber}, I:${instanceNumber})`];\r\n    }\r\n  }\r\n}\r\n\r\nfunction _round(value, decimals) {\r\n  return parseFloat(value).toFixed(decimals);\r\n}\r\n\r\nexport default PanelMeasurementTableTracking;\r\n","import {\r\n  PanelStudyBrowserTracking,\r\n  PanelMeasurementTableTracking,\r\n} from './panels';\r\n\r\n// TODO:\r\n// - No loading UI exists yet\r\n// - cancel promises when component is destroyed\r\n// - show errors in UI for thumbnails if promise fails\r\nfunction getPanelModule({\r\n  commandsManager,\r\n  extensionManager,\r\n  servicesManager,\r\n}) {\r\n  return [\r\n    {\r\n      name: 'seriesList',\r\n      iconName: 'group-layers',\r\n      iconLabel: 'Studies',\r\n      label: 'Studies',\r\n      component: PanelStudyBrowserTracking.bind(null, {\r\n        commandsManager,\r\n        extensionManager,\r\n        servicesManager,\r\n      }),\r\n    },\r\n    {\r\n      name: 'trackedMeasurements',\r\n      iconName: 'list-bullets',\r\n      iconLabel: 'Measure',\r\n      label: 'Measurements',\r\n      component: PanelMeasurementTableTracking.bind(null, {\r\n        commandsManager,\r\n        extensionManager,\r\n        servicesManager,\r\n      }),\r\n    },\r\n  ];\r\n}\r\n\r\nexport default getPanelModule;\r\n","import React from 'react';\r\n\r\nconst Component = React.lazy(() => {\r\n  return import(\r\n    /* webpackPrefetch: true */ './viewports/TrackedCornerstoneViewport'\r\n  );\r\n});\r\n\r\nconst OHIFCornerstoneViewport = props => {\r\n  return (\r\n    <React.Suspense fallback={<div>Loading...</div>}>\r\n      <Component {...props} />\r\n    </React.Suspense>\r\n  );\r\n};\r\n\r\nfunction getViewportModule({\r\n  servicesManager,\r\n  commandsManager,\r\n  extensionManager,\r\n}) {\r\n  const ExtendedOHIFCornerstoneTrackingViewport = props => {\r\n    return (\r\n      <OHIFCornerstoneViewport\r\n        servicesManager={servicesManager}\r\n        commandsManager={commandsManager}\r\n        extensionManager={extensionManager}\r\n        {...props}\r\n      />\r\n    );\r\n  };\r\n\r\n  return [\r\n    {\r\n      name: 'cornerstone-tracked',\r\n      component: ExtendedOHIFCornerstoneTrackingViewport,\r\n    },\r\n  ];\r\n}\r\n\r\nexport default getViewportModule;\r\n","import getContextModule from './getContextModule.js';\r\nimport getPanelModule from './getPanelModule.js';\r\nimport getViewportModule from './getViewportModule.js';\r\n\r\nexport default {\r\n  /**\r\n   * Only required property. Should be a unique value across all extensions.\r\n   */\r\n  id: 'org.ohif.measurement-tracking',\r\n  getContextModule,\r\n  getPanelModule,\r\n  getViewportModule,\r\n  getCommandsModule({ servicesManager }) {\r\n    return {\r\n      definitions: {\r\n        setToolActive: {\r\n          commandFn: ({ toolName, element }) => {\r\n            if (!toolName) {\r\n              console.warn('No toolname provided to setToolActive command');\r\n            }\r\n\r\n            // Set same tool or alt tool\r\n            cornerstoneTools.setToolActiveForElement(element, toolName, {\r\n              mouseButtonMask: 1,\r\n            });\r\n          },\r\n          storeContexts: [],\r\n          options: {},\r\n        },\r\n      },\r\n      defaultContext: 'ACTIVE_VIEWPORT::TRACKED',\r\n    };\r\n  },\r\n};\r\n","import cornerstoneTools from 'cornerstone-tools';\r\nimport cornerstoneMath from 'cornerstone-math';\r\nimport cornerstone from 'cornerstone-core';\r\nimport TOOL_NAMES from '../constants/toolNames';\r\nimport SCOORD_TYPES from '../constants/scoordTypes';\r\n\r\nconst globalImageIdSpecificToolStateManager =\r\n  cornerstoneTools.globalImageIdSpecificToolStateManager;\r\n\r\nexport default function addMeasurement(\r\n  measurement,\r\n  imageId,\r\n  displaySetInstanceUID\r\n) {\r\n  // TODO -> Render rotated ellipse .\r\n\r\n  const toolName = TOOL_NAMES.DICOM_SR_DISPLAY_TOOL;\r\n\r\n  const measurementData = {\r\n    TrackingUniqueIdentifier: measurement.TrackingUniqueIdentifier,\r\n    renderableData: {},\r\n    labels: measurement.labels,\r\n  };\r\n\r\n  measurement.coords.forEach(coord => {\r\n    const { GraphicType, GraphicData } = coord;\r\n\r\n    if (measurementData.renderableData[GraphicType] === undefined) {\r\n      measurementData.renderableData[GraphicType] = [];\r\n    }\r\n\r\n    measurementData.renderableData[GraphicType].push(\r\n      _getRenderableData(GraphicType, GraphicData)\r\n    );\r\n  });\r\n\r\n  const toolState = globalImageIdSpecificToolStateManager.saveToolState();\r\n\r\n  if (toolState[imageId] === undefined) {\r\n    toolState[imageId] = {};\r\n  }\r\n\r\n  const imageIdToolState = toolState[imageId];\r\n\r\n  // If we don't have tool state for this type of tool, add an empty object\r\n  if (imageIdToolState[toolName] === undefined) {\r\n    imageIdToolState[toolName] = {\r\n      data: [],\r\n    };\r\n  }\r\n\r\n  const toolData = imageIdToolState[toolName];\r\n\r\n  toolData.data.push(measurementData);\r\n\r\n  measurement.loaded = true;\r\n  measurement.imageId = imageId;\r\n  measurement.displaySetInstanceUID = displaySetInstanceUID;\r\n\r\n  // Remove the unneeded coord now its processed, but keep the SOPInstanceUID.\r\n  // NOTE: We assume that each SCOORD in the MeasurementGroup maps onto one frame,\r\n  // It'd be super werid if it didn't anyway as a SCOORD.\r\n  measurement.ReferencedSOPInstanceUID =\r\n    measurement.coords[0].ReferencedSOPSequence.ReferencedSOPInstanceUID;\r\n  delete measurement.coords;\r\n}\r\n\r\nfunction _getRenderableData(GraphicType, GraphicData) {\r\n  let renderableData;\r\n\r\n  switch (GraphicType) {\r\n    case SCOORD_TYPES.POINT:\r\n    case SCOORD_TYPES.MULTIPOINT:\r\n    case SCOORD_TYPES.POLYLINE:\r\n      renderableData = [];\r\n\r\n      for (let i = 0; i < GraphicData.length; i += 2) {\r\n        renderableData.push({ x: GraphicData[i], y: GraphicData[i + 1] });\r\n      }\r\n      break;\r\n    case SCOORD_TYPES.CIRCLE:\r\n      const center = { x: GraphicData[0], y: GraphicData[1] };\r\n      const onPerimeter = { x: GraphicData[2], y: GraphicData[3] };\r\n\r\n      const radius = cornerstoneMath.point.distance(center, onPerimeter);\r\n\r\n      renderableData = {\r\n        center,\r\n        radius,\r\n      };\r\n      break;\r\n    case SCOORD_TYPES.ELLIPSE:\r\n      console.warn('ROTATED ELLIPSE NOT YET SUPPORTED!');\r\n\r\n      const majorAxis = [\r\n        { x: GraphicData[0], y: GraphicData[1] },\r\n        { x: GraphicData[2], y: GraphicData[3] },\r\n      ];\r\n      const minorAxis = [\r\n        { x: GraphicData[4], y: GraphicData[5] },\r\n        { x: GraphicData[6], y: GraphicData[7] },\r\n      ];\r\n\r\n      // Calculate two opposite corners of box defined by two axes.\r\n\r\n      const minorAxisLength = cornerstoneMath.point.distance(\r\n        minorAxis[0],\r\n        minorAxis[1]\r\n      );\r\n\r\n      const minorAxisDirection = {\r\n        x: (minorAxis[1].x - minorAxis[0].x) / minorAxisLength,\r\n        y: (minorAxis[1].y - minorAxis[0].y) / minorAxisLength,\r\n      };\r\n\r\n      const halfMinorAxisLength = minorAxisLength / 2;\r\n\r\n      // First end point of major axis + half minor axis vector\r\n      const corner1 = {\r\n        x: majorAxis[0].x + minorAxisDirection.x * halfMinorAxisLength,\r\n        y: majorAxis[0].y + minorAxisDirection.y * halfMinorAxisLength,\r\n      };\r\n\r\n      // Second end point of major axis - half of minor axis vector\r\n      const corner2 = {\r\n        x: majorAxis[1].x - minorAxisDirection.x * halfMinorAxisLength,\r\n        y: majorAxis[1].y - minorAxisDirection.y * halfMinorAxisLength,\r\n      };\r\n\r\n      renderableData = {\r\n        corner1,\r\n        corner2,\r\n      };\r\n      break;\r\n  }\r\n\r\n  return renderableData;\r\n}\r\n","import { adapters } from 'dcmjs';\r\n\r\nconst cornerstoneAdapters = adapters.Cornerstone;\r\n\r\n/**\r\n * Checks if the given `displaySet`can be rehydrated into the `MeasurementService`.\r\n *\r\n * @param {object} displaySet The SR `displaySet` to check.\r\n * @param {object[]} mappings The CornerstoneTools 4 mappings to the `MeasurementService`.\r\n * @returns {boolean} True if the SR can be rehydrated into the `MeasurementService`.\r\n */\r\nexport default function isRehydratable(displaySet, mappings) {\r\n  if (!mappings || !mappings.length) {\r\n    return false;\r\n  }\r\n\r\n  const mappingDefinitions = mappings.map(m => m.definition);\r\n  const { measurements } = displaySet;\r\n\r\n  const adapterKeys = Object.keys(cornerstoneAdapters).filter(\r\n    adapterKey =>\r\n      typeof cornerstoneAdapters[adapterKey]\r\n        .isValidCornerstoneTrackingIdentifier === 'function'\r\n  );\r\n\r\n  const adapters = [];\r\n\r\n  adapterKeys.forEach(key => {\r\n    if (mappingDefinitions.includes(key)) {\r\n      // Must have both a dcmjs adapter and a MeasurementService\r\n      // Definition in order to be a candidate for import.\r\n      adapters.push(cornerstoneAdapters[key]);\r\n    }\r\n  });\r\n\r\n  for (let i = 0; i < measurements.length; i++) {\r\n    const TrackingIdentifier = measurements[i].TrackingIdentifier;\r\n    const hydratable = adapters.some(adapter =>\r\n      adapter.isValidCornerstoneTrackingIdentifier(TrackingIdentifier)\r\n    );\r\n\r\n    if (hydratable) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n","import { SOPClassHandlerName, SOPClassHandlerId } from './id';\r\nimport { utils, classes } from '@ohif/core';\r\nimport addMeasurement from './utils/addMeasurement';\r\nimport isRehydratable from './utils/isRehydratable';\r\n\r\nconst { ImageSet } = classes;\r\n\r\n// TODO ->\r\n// Add SR thumbnail\r\n// Make viewport\r\n// Get stacks from referenced displayInstanceUID and load into wrapped CornerStone viewport.\r\n\r\nconst sopClassUids = [\r\n  '1.2.840.10008.5.1.4.1.1.88.11', //BASIC_TEXT_SR:\r\n  '1.2.840.10008.5.1.4.1.1.88.22', //ENHANCED_SR:\r\n  '1.2.840.10008.5.1.4.1.1.88.33', //COMPREHENSIVE_SR:\r\n];\r\n\r\nconst CodeNameCodeSequenceValues = {\r\n  ImagingMeasurementReport: '126000',\r\n  ImageLibrary: '111028',\r\n  ImagingMeasurements: '126010',\r\n  MeasurementGroup: '125007',\r\n  ImageLibraryGroup: '126200',\r\n  TrackingUniqueIdentifier: '112040',\r\n  TrackingIdentifier: '112039',\r\n  Finding: '121071',\r\n  FindingSite: 'G-C0E3', // SRT\r\n  CornerstoneFreeText: 'CORNERSTONEFREETEXT', // CST4\r\n};\r\n\r\nconst CodingSchemeDesignators = {\r\n  SRT: 'SRT',\r\n  cornerstoneTools4: 'CST4',\r\n};\r\n\r\nconst RELATIONSHIP_TYPE = {\r\n  INFERRED_FROM: 'INFERRED FROM',\r\n};\r\n\r\nconst CORNERSTONE_FREETEXT_CODE_VALUE = 'CORNERSTONEFREETEXT';\r\n\r\n/**\r\n * Basic SOPClassHandler:\r\n * - For all Image types that are stackable, create\r\n *   a displaySet with a stack of images\r\n *\r\n * @param {Array} sopClassHandlerModules List of SOP Class Modules\r\n * @param {SeriesMetadata} series The series metadata object from which the display sets will be created\r\n * @returns {Array} The list of display sets created for the given series object\r\n */\r\nfunction _getDisplaySetsFromSeries(\r\n  instances,\r\n  servicesManager,\r\n  extensionManager\r\n) {\r\n  // If the series has no instances, stop here\r\n  if (!instances || !instances.length) {\r\n    throw new Error('No instances were provided');\r\n  }\r\n\r\n  const instance = instances[0];\r\n\r\n  const {\r\n    StudyInstanceUID,\r\n    SeriesInstanceUID,\r\n    SOPInstanceUID,\r\n    SeriesDescription,\r\n    SeriesNumber,\r\n    SeriesDate,\r\n    ConceptNameCodeSequence,\r\n  } = instance;\r\n\r\n  if (\r\n    !ConceptNameCodeSequence ||\r\n    ConceptNameCodeSequence.CodeValue !==\r\n      CodeNameCodeSequenceValues.ImagingMeasurementReport\r\n  ) {\r\n    console.warn(\r\n      'Only support Imaging Measurement Report SRs (TID1500) for now'\r\n    );\r\n    return [];\r\n  }\r\n\r\n  const displaySet = {\r\n    //plugin: id,\r\n    Modality: 'SR',\r\n    displaySetInstanceUID: utils.guid(),\r\n    SeriesDescription,\r\n    SeriesNumber,\r\n    SeriesDate,\r\n    SOPInstanceUID,\r\n    SeriesInstanceUID,\r\n    StudyInstanceUID,\r\n    SOPClassHandlerId,\r\n    referencedImages: null,\r\n    measurements: null,\r\n    isDerivedDisplaySet: true,\r\n    isLoaded: false,\r\n    sopClassUids,\r\n    instance,\r\n  };\r\n\r\n  displaySet.load = () => _load(displaySet, servicesManager, extensionManager);\r\n\r\n  return [displaySet];\r\n}\r\n\r\nfunction _load(displaySet, servicesManager, extensionManager) {\r\n  const { DisplaySetService, MeasurementService } = servicesManager.services;\r\n  const dataSources = extensionManager.getDataSources();\r\n  const dataSource = dataSources[0];\r\n\r\n  const { ContentSequence } = displaySet.instance;\r\n\r\n  displaySet.referencedImages = _getReferencedImagesList(ContentSequence);\r\n  displaySet.measurements = _getMeasurements(ContentSequence);\r\n\r\n  const mappings = MeasurementService.getSourceMappings(\r\n    'CornerstoneTools',\r\n    '4'\r\n  );\r\n\r\n  displaySet.isHydrated = false;\r\n  displaySet.isRehydratable = isRehydratable(displaySet, mappings);\r\n  displaySet.isLoaded = true;\r\n\r\n  // Check currently added displaySets and add measurements if the sources exist.\r\n  DisplaySetService.activeDisplaySets.forEach(activeDisplaySet => {\r\n    _checkIfCanAddMeasurementsToDisplaySet(\r\n      displaySet,\r\n      activeDisplaySet,\r\n      dataSource\r\n    );\r\n  });\r\n\r\n  // Subscribe to new displaySets as the source may come in after.\r\n  DisplaySetService.subscribe(\r\n    DisplaySetService.EVENTS.DISPLAY_SETS_ADDED,\r\n    data => {\r\n      const { displaySetsAdded } = data;\r\n      // If there are still some measurements that have not yet been loaded into cornerstone,\r\n      // See if we can load them onto any of the new displaySets.\r\n      displaySetsAdded.forEach(newDisplaySet => {\r\n        _checkIfCanAddMeasurementsToDisplaySet(\r\n          displaySet,\r\n          newDisplaySet,\r\n          dataSource\r\n        );\r\n      });\r\n    }\r\n  );\r\n}\r\n\r\nfunction _checkIfCanAddMeasurementsToDisplaySet(\r\n  srDisplaySet,\r\n  newDisplaySet,\r\n  dataSource\r\n) {\r\n  let unloadedMeasurements = srDisplaySet.measurements.filter(\r\n    measurement => measurement.loaded === false\r\n  );\r\n\r\n  if (unloadedMeasurements.length === 0) {\r\n    // All already loaded!\r\n    return;\r\n  }\r\n\r\n  if (!newDisplaySet instanceof ImageSet) {\r\n    // This also filters out _this_ displaySet, as it is not an ImageSet.\r\n    return;\r\n  }\r\n\r\n  const { sopClassUids, images } = newDisplaySet;\r\n\r\n  // Check if any have the newDisplaySet is the correct SOPClass.\r\n  unloadedMeasurements = unloadedMeasurements.filter(measurement =>\r\n    measurement.coords.some(coord =>\r\n      sopClassUids.includes(coord.ReferencedSOPSequence.ReferencedSOPClassUID)\r\n    )\r\n  );\r\n\r\n  if (unloadedMeasurements.length === 0) {\r\n    // New displaySet isn't the correct SOPClass, so can't contain the referenced images.\r\n    return;\r\n  }\r\n\r\n  const SOPInstanceUIDs = [];\r\n\r\n  unloadedMeasurements.forEach(measurement => {\r\n    const { coords } = measurement;\r\n\r\n    coords.forEach(coord => {\r\n      const SOPInstanceUID =\r\n        coord.ReferencedSOPSequence.ReferencedSOPInstanceUID;\r\n\r\n      if (!SOPInstanceUIDs.includes(SOPInstanceUID)) {\r\n        SOPInstanceUIDs.push(SOPInstanceUID);\r\n      }\r\n    });\r\n  });\r\n\r\n  const imageIdsForDisplaySet = dataSource.getImageIdsForDisplaySet(\r\n    newDisplaySet\r\n  );\r\n\r\n  for (let i = 0; i < images.length; i++) {\r\n    if (!unloadedMeasurements.length) {\r\n      // All measurements loaded.\r\n      break;\r\n    }\r\n\r\n    const image = images[i];\r\n    const { SOPInstanceUID } = image;\r\n    if (SOPInstanceUIDs.includes(SOPInstanceUID)) {\r\n      const imageId = imageIdsForDisplaySet[i];\r\n\r\n      for (let j = unloadedMeasurements.length - 1; j >= 0; j--) {\r\n        const measurement = unloadedMeasurements[j];\r\n        if (_measurmentReferencesSOPInstanceUID(measurement, SOPInstanceUID)) {\r\n          addMeasurement(\r\n            measurement,\r\n            imageId,\r\n            newDisplaySet.displaySetInstanceUID\r\n          );\r\n\r\n          unloadedMeasurements.splice(j, 1);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction _measurmentReferencesSOPInstanceUID(measurement, SOPInstanceUID) {\r\n  const { coords } = measurement;\r\n\r\n  for (let j = 0; j < coords.length; j++) {\r\n    const coord = coords[j];\r\n    const { ReferencedSOPInstanceUID } = coord.ReferencedSOPSequence;\r\n\r\n    if (ReferencedSOPInstanceUID === SOPInstanceUID) {\r\n      return true;\r\n    }\r\n  }\r\n}\r\n\r\nfunction getSopClassHandlerModule({ servicesManager, extensionManager }) {\r\n  const getDisplaySetsFromSeries = instances => {\r\n    return _getDisplaySetsFromSeries(\r\n      instances,\r\n      servicesManager,\r\n      extensionManager\r\n    );\r\n  };\r\n\r\n  return [\r\n    {\r\n      name: SOPClassHandlerName,\r\n      sopClassUids,\r\n      getDisplaySetsFromSeries,\r\n    },\r\n  ];\r\n}\r\n\r\nfunction _getMeasurements(ImagingMeasurementReportContentSequence) {\r\n  const ImagingMeasurements = ImagingMeasurementReportContentSequence.find(\r\n    item =>\r\n      item.ConceptNameCodeSequence.CodeValue ===\r\n      CodeNameCodeSequenceValues.ImagingMeasurements\r\n  );\r\n\r\n  const MeasurementGroups = _getSequenceAsArray(\r\n    ImagingMeasurements.ContentSequence\r\n  ).filter(\r\n    item =>\r\n      item.ConceptNameCodeSequence.CodeValue ===\r\n      CodeNameCodeSequenceValues.MeasurementGroup\r\n  );\r\n\r\n  const mergedContentSequencesByTrackingUniqueIdentifiers = _getMergedContentSequencesByTrackingUniqueIdentifiers(\r\n    MeasurementGroups\r\n  );\r\n\r\n  let measurements = [];\r\n\r\n  Object.keys(mergedContentSequencesByTrackingUniqueIdentifiers).forEach(\r\n    trackingUniqueIdentifier => {\r\n      const mergedContentSequence =\r\n        mergedContentSequencesByTrackingUniqueIdentifiers[\r\n          trackingUniqueIdentifier\r\n        ];\r\n\r\n      const measurement = _processMeasurement(mergedContentSequence);\r\n\r\n      if (measurement) {\r\n        measurements.push(measurement);\r\n      }\r\n    }\r\n  );\r\n\r\n  return measurements;\r\n}\r\n\r\nfunction _getMergedContentSequencesByTrackingUniqueIdentifiers(\r\n  MeasurementGroups\r\n) {\r\n  const mergedContentSequencesByTrackingUniqueIdentifiers = {};\r\n\r\n  MeasurementGroups.forEach(MeasurementGroup => {\r\n    const ContentSequence = _getSequenceAsArray(\r\n      MeasurementGroup.ContentSequence\r\n    );\r\n\r\n    const TrackingUniqueIdentifierItem = ContentSequence.find(\r\n      item =>\r\n        item.ConceptNameCodeSequence.CodeValue ===\r\n        CodeNameCodeSequenceValues.TrackingUniqueIdentifier\r\n    );\r\n\r\n    if (!TrackingUniqueIdentifierItem) {\r\n      console.warn(\r\n        'No Tracking Unique Identifier, skipping ambiguous measurement.'\r\n      );\r\n    }\r\n\r\n    const trackingUniqueIdentifier = TrackingUniqueIdentifierItem.UID;\r\n\r\n    if (\r\n      mergedContentSequencesByTrackingUniqueIdentifiers[\r\n        trackingUniqueIdentifier\r\n      ] === undefined\r\n    ) {\r\n      // Add the full ContentSequence\r\n      mergedContentSequencesByTrackingUniqueIdentifiers[\r\n        trackingUniqueIdentifier\r\n      ] = [...ContentSequence];\r\n    } else {\r\n      // Add the ContentSequence minus the tracking identifier, as we have this\r\n      // Information in the merged ContentSequence anyway.\r\n      ContentSequence.forEach(item => {\r\n        if (\r\n          item.ConceptNameCodeSequence.CodeValue !==\r\n          CodeNameCodeSequenceValues.TrackingUniqueIdentifier\r\n        ) {\r\n          mergedContentSequencesByTrackingUniqueIdentifiers[\r\n            trackingUniqueIdentifier\r\n          ].push(item);\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n  return mergedContentSequencesByTrackingUniqueIdentifiers;\r\n}\r\n\r\nfunction _processMeasurement(mergedContentSequence) {\r\n  if (\r\n    mergedContentSequence.some(\r\n      group => group.ValueType === 'SCOORD' || group.ValueType === 'SCOORD3D'\r\n    )\r\n  ) {\r\n    return _processTID1410Measurement(mergedContentSequence);\r\n  }\r\n\r\n  return _processNonGeometricallyDefinedMeasurement(mergedContentSequence);\r\n}\r\n\r\nfunction _processTID1410Measurement(mergedContentSequence) {\r\n  // Need to deal with TID 1410 style measurements, which will have a SCOORD or SCOORD3D at the top level,\r\n  // And non-geometric representations where each NUM has \"INFERRED FROM\" SCOORD/SCOORD3D\r\n  // TODO -> Look at RelationshipType => Contains means\r\n\r\n  const graphicItem = mergedContentSequence.find(\r\n    group => group.ValueType === 'SCOORD'\r\n  );\r\n\r\n  const UIDREFContentItem = mergedContentSequence.find(\r\n    group => group.ValueType === 'UIDREF'\r\n  );\r\n\r\n  const TrackingIdentifierContentItem = mergedContentSequence.find(\r\n    item =>\r\n      item.ConceptNameCodeSequence.CodeValue ===\r\n      CodeNameCodeSequenceValues.TrackingIdentifier\r\n  );\r\n\r\n  if (!graphicItem) {\r\n    console.warn(\r\n      `graphic ValueType ${graphicItem.ValueType} not currently supported, skipping annotation.`\r\n    );\r\n    return;\r\n  }\r\n\r\n  const NUMContentItems = mergedContentSequence.filter(\r\n    group => group.ValueType === 'NUM'\r\n  );\r\n\r\n  const measurement = {\r\n    loaded: false,\r\n    labels: [],\r\n    coords: [_getCoordsFromSCOORDOrSCOORD3D(graphicItem)],\r\n    TrackingUniqueIdentifier: UIDREFContentItem.UID,\r\n    TrackingIdentifier: TrackingIdentifierContentItem.TextValue,\r\n  };\r\n\r\n  NUMContentItems.forEach(item => {\r\n    const { ConceptNameCodeSequence, MeasuredValueSequence } = item;\r\n\r\n    if (MeasuredValueSequence) {\r\n      measurement.labels.push(\r\n        _getLabelFromMeasuredValueSequence(\r\n          ConceptNameCodeSequence,\r\n          MeasuredValueSequence\r\n        )\r\n      );\r\n    }\r\n  });\r\n\r\n  return measurement;\r\n}\r\n\r\nfunction _processNonGeometricallyDefinedMeasurement(mergedContentSequence) {\r\n  const NUMContentItems = mergedContentSequence.filter(\r\n    group => group.ValueType === 'NUM'\r\n  );\r\n\r\n  const UIDREFContentItem = mergedContentSequence.find(\r\n    group => group.ValueType === 'UIDREF'\r\n  );\r\n\r\n  const TrackingIdentifierContentItem = mergedContentSequence.find(\r\n    item =>\r\n      item.ConceptNameCodeSequence.CodeValue ===\r\n      CodeNameCodeSequenceValues.TrackingIdentifier\r\n  );\r\n\r\n  const Finding = mergedContentSequence.find(\r\n    item =>\r\n      item.ConceptNameCodeSequence.CodeValue ===\r\n      CodeNameCodeSequenceValues.Finding\r\n  );\r\n\r\n  const FindingSites = mergedContentSequence.filter(\r\n    item =>\r\n      item.ConceptNameCodeSequence.CodingSchemeDesignator ===\r\n        CodingSchemeDesignators.SRT &&\r\n      item.ConceptNameCodeSequence.CodeValue ===\r\n        CodeNameCodeSequenceValues.FindingSite\r\n  );\r\n\r\n  const measurement = {\r\n    loaded: false,\r\n    labels: [],\r\n    coords: [],\r\n    TrackingUniqueIdentifier: UIDREFContentItem.UID,\r\n    TrackingIdentifier: TrackingIdentifierContentItem.TextValue,\r\n  };\r\n\r\n  if (\r\n    Finding &&\r\n    Finding.ConceptCodeSequence.CodingSchemeDesignator ===\r\n      CodingSchemeDesignators.cornerstoneTools4 &&\r\n    Finding.ConceptCodeSequence.CodeValue ===\r\n      CodeNameCodeSequenceValues.CornerstoneFreeText\r\n  ) {\r\n    measurement.labels.push({\r\n      label: CORNERSTONE_FREETEXT_CODE_VALUE,\r\n      value: Finding.ConceptCodeSequence.CodeMeaning,\r\n    });\r\n  }\r\n\r\n  // TODO -> Eventually hopefully support SNOMED or some proper code library, just free text for now.\r\n  if (FindingSites.length) {\r\n    const cornerstoneFreeTextFindingSite = FindingSites.find(\r\n      FindingSite =>\r\n        FindingSite.ConceptCodeSequence.CodingSchemeDesignator ===\r\n          CodingSchemeDesignators.cornerstoneTools4 &&\r\n        FindingSite.ConceptCodeSequence.CodeValue ===\r\n          CodeNameCodeSequenceValues.CornerstoneFreeText\r\n    );\r\n\r\n    if (cornerstoneFreeTextFindingSite) {\r\n      measurement.labels.push({\r\n        label: CORNERSTONE_FREETEXT_CODE_VALUE,\r\n        value: cornerstoneFreeTextFindingSite.ConceptCodeSequence.CodeMeaning,\r\n      });\r\n    }\r\n  }\r\n\r\n  NUMContentItems.forEach(item => {\r\n    const {\r\n      ConceptNameCodeSequence,\r\n      ContentSequence,\r\n      MeasuredValueSequence,\r\n    } = item;\r\n\r\n    const { ValueType } = ContentSequence;\r\n\r\n    if (!ValueType === 'SCOORD') {\r\n      console.warn(\r\n        `Graphic ${ValueType} not currently supported, skipping annotation.`\r\n      );\r\n\r\n      return;\r\n    }\r\n\r\n    const coords = _getCoordsFromSCOORDOrSCOORD3D(ContentSequence);\r\n\r\n    if (coords) {\r\n      measurement.coords.push(coords);\r\n    }\r\n\r\n    if (MeasuredValueSequence) {\r\n      measurement.labels.push(\r\n        _getLabelFromMeasuredValueSequence(\r\n          ConceptNameCodeSequence,\r\n          MeasuredValueSequence\r\n        )\r\n      );\r\n    }\r\n  });\r\n\r\n  return measurement;\r\n}\r\n\r\nfunction _getCoordsFromSCOORDOrSCOORD3D(item) {\r\n  const { ValueType, RelationshipType, GraphicType, GraphicData } = item;\r\n\r\n  if (RelationshipType !== RELATIONSHIP_TYPE.INFERRED_FROM) {\r\n    console.warn(\r\n      `Relationshiptype === ${RelationshipType}. Cannot deal with NON TID-1400 SCOORD group with RelationshipType !== \"INFERRED FROM.\"`\r\n    );\r\n\r\n    return;\r\n  }\r\n\r\n  const coords = { ValueType, GraphicType, GraphicData };\r\n\r\n  // ContentSequence has length of 1 as RelationshipType === 'INFERRED FROM'\r\n  if (ValueType === 'SCOORD') {\r\n    const { ReferencedSOPSequence } = item.ContentSequence;\r\n\r\n    coords.ReferencedSOPSequence = ReferencedSOPSequence;\r\n  } else if (ValueType === 'SCOORD3D') {\r\n    const { ReferencedFrameOfReferenceSequence } = item.ContentSequence;\r\n\r\n    coords.ReferencedFrameOfReferenceSequence = ReferencedFrameOfReferenceSequence;\r\n  }\r\n\r\n  return coords;\r\n}\r\n\r\nfunction _getLabelFromMeasuredValueSequence(\r\n  ConceptNameCodeSequence,\r\n  MeasuredValueSequence\r\n) {\r\n  const { CodeMeaning } = ConceptNameCodeSequence;\r\n  const { NumericValue, MeasurementUnitsCodeSequence } = MeasuredValueSequence;\r\n  const { CodeValue } = MeasurementUnitsCodeSequence;\r\n\r\n  const formatedNumericValue = NumericValue\r\n    ? Number(NumericValue).toFixed(1)\r\n    : '';\r\n\r\n  return {\r\n    label: CodeMeaning,\r\n    value: `${formatedNumericValue} ${CodeValue}`,\r\n  }; // E.g. Long Axis: 31.0 mm\r\n}\r\n\r\nfunction _getReferencedImagesList(ImagingMeasurementReportContentSequence) {\r\n  const ImageLibrary = ImagingMeasurementReportContentSequence.find(\r\n    item =>\r\n      item.ConceptNameCodeSequence.CodeValue ===\r\n      CodeNameCodeSequenceValues.ImageLibrary\r\n  );\r\n\r\n  const ImageLibraryGroup = _getSequenceAsArray(\r\n    ImageLibrary.ContentSequence\r\n  ).find(\r\n    item =>\r\n      item.ConceptNameCodeSequence.CodeValue ===\r\n      CodeNameCodeSequenceValues.ImageLibraryGroup\r\n  );\r\n\r\n  const referencedImages = [];\r\n\r\n  _getSequenceAsArray(ImageLibraryGroup.ContentSequence).forEach(item => {\r\n    const { ReferencedSOPSequence } = item;\r\n    const {\r\n      ReferencedSOPClassUID,\r\n      ReferencedSOPInstanceUID,\r\n    } = ReferencedSOPSequence;\r\n\r\n    referencedImages.push({ ReferencedSOPClassUID, ReferencedSOPInstanceUID });\r\n  });\r\n\r\n  return referencedImages;\r\n}\r\n\r\nfunction _getSequenceAsArray(sequence) {\r\n  return Array.isArray(sequence) ? sequence : [sequence];\r\n}\r\n\r\nexport default getSopClassHandlerModule;\r\n","import cornerstone from 'cornerstone-core';\r\n\r\nconst state = {\r\n  TrackingUniqueIdentifier: null,\r\n  trackingIdentifiersByEnabledElementUUID: {},\r\n};\r\n\r\nfunction setTrackingUniqueIdentifiersForElement(\r\n  element,\r\n  trackingUniqueIdentifiers,\r\n  activeIndex = 0\r\n) {\r\n  const enabledElement = cornerstone.getEnabledElement(element);\r\n  const { uuid } = enabledElement;\r\n\r\n  state.trackingIdentifiersByEnabledElementUUID[uuid] = {\r\n    trackingUniqueIdentifiers,\r\n    activeIndex,\r\n  };\r\n}\r\n\r\nfunction setActiveTrackingUniqueIdentifierForElement(\r\n  element,\r\n  TrackingUniqueIdentifier\r\n) {\r\n  const enabledElement = cornerstone.getEnabledElement(element);\r\n  const { uuid } = enabledElement;\r\n\r\n  const trackingIdentifiersForElement =\r\n    state.trackingIdentifiersByEnabledElementUUID[uuid];\r\n\r\n  if (trackingIdentifiersForElement) {\r\n    const activeIndex = trackingIdentifiersForElement.trackingUniqueIdentifiers.findIndex(\r\n      tuid => tuid === TrackingUniqueIdentifier\r\n    );\r\n\r\n    trackingIdentifiersForElement.activeIndex = activeIndex;\r\n  }\r\n}\r\n\r\nfunction getTrackingUniqueIdentifiersForElement(element) {\r\n  const enabledElement = cornerstone.getEnabledElement(element);\r\n  const { uuid } = enabledElement;\r\n\r\n  if (state.trackingIdentifiersByEnabledElementUUID[uuid]) {\r\n    return state.trackingIdentifiersByEnabledElementUUID[uuid];\r\n  }\r\n\r\n  return { trackingUniqueIdentifiers: [] };\r\n}\r\n\r\nexport default {\r\n  state,\r\n  getters: {\r\n    trackingUniqueIdentifiersForElement: getTrackingUniqueIdentifiersForElement,\r\n  },\r\n  setters: {\r\n    trackingUniqueIdentifiersForElement: setTrackingUniqueIdentifiersForElement,\r\n    activeTrackingUniqueIdentifierForElement: setActiveTrackingUniqueIdentifierForElement,\r\n  },\r\n};\r\n","import cornerstoneTools from 'cornerstone-tools';\r\nimport dicomSRModule from './tools/modules/dicomSRModule';\r\nimport id from './id';\r\n\r\nimport TOOL_NAMES from './constants/toolNames';\r\n\r\nconst defaultConfig = {\r\n  TOOL_NAMES: {\r\n    DICOM_SR_DISPLAY_TOOL: 'DICOMSRDisplayTool',\r\n  },\r\n};\r\n\r\n/**\r\n * @param {object} configuration\r\n */\r\nexport default function init({ configuration = {} }) {\r\n  const conifg = Object.assign({}, defaultConfig, configuration);\r\n\r\n  TOOL_NAMES.DICOM_SR_DISPLAY_TOOL = conifg.TOOL_NAMES.DICOM_SR_DISPLAY_TOOL;\r\n\r\n  cornerstoneTools.register('module', id, dicomSRModule);\r\n}\r\n","import React from 'react';\r\nimport getSopClassHandlerModule from './getSopClassHandlerModule';\r\nimport onModeEnter from './onModeEnter';\r\nimport id from './id.js';\r\nimport init from './init';\r\n\r\nconst Component = React.lazy(() => {\r\n  return import(\r\n    /* webpackPrefetch: true */ './viewports/OHIFCornerstoneSRViewport'\r\n  );\r\n});\r\n\r\nconst OHIFCornerstoneSRViewport = props => {\r\n  return (\r\n    <React.Suspense fallback={<div>Loading...</div>}>\r\n      <Component {...props} />\r\n    </React.Suspense>\r\n  );\r\n};\r\n\r\n/**\r\n *\r\n */\r\nexport default {\r\n  /**\r\n   * Only required property. Should be a unique value across all extensions.\r\n   */\r\n  id,\r\n  dependencies: [\r\n    // TODO -> This isn't used anywhere yet, but we do have a hard dependency, and need to check for these in the future.\r\n    // OHIF-229\r\n    {\r\n      id: 'org.ohif.cornerstone',\r\n      version: '3.0.0',\r\n    },\r\n    {\r\n      id: 'org.ohif.measurement-tracking',\r\n      version: '^0.0.1',\r\n    },\r\n  ],\r\n\r\n  preRegistration({ servicesManager, configuration = {} }) {\r\n    init({ servicesManager, configuration });\r\n  },\r\n\r\n  /**\r\n   *\r\n   *\r\n   * @param {object} [configuration={}]\r\n   * @param {object|array} [configuration.csToolsConfig] - Passed directly to `initCornerstoneTools`\r\n   */\r\n  getViewportModule({ servicesManager, extensionManager }) {\r\n    const ExtendedOHIFCornerstoneSRViewport = props => {\r\n      return (\r\n        <OHIFCornerstoneSRViewport\r\n          servicesManager={servicesManager}\r\n          extensionManager={extensionManager}\r\n          {...props}\r\n        />\r\n      );\r\n    };\r\n\r\n    return [{ name: 'dicom-sr', component: ExtendedOHIFCornerstoneSRViewport }];\r\n  },\r\n  getCommandsModule({ servicesManager }) {\r\n    return {\r\n      definitions: {\r\n        setToolActive: {\r\n          commandFn: ({ toolName, element }) => {\r\n            if (!toolName) {\r\n              console.warn('No toolname provided to setToolActive command');\r\n            }\r\n\r\n            // Set same tool or alt tool\r\n            const toolAlias = _getToolAlias(toolName);\r\n\r\n            cornerstoneTools.setToolActiveForElement(element, toolAlias, {\r\n              mouseButtonMask: 1,\r\n            });\r\n          },\r\n          storeContexts: [],\r\n          options: {},\r\n        },\r\n      },\r\n      defaultContext: 'ACTIVE_VIEWPORT::STRUCTURED_REPORT',\r\n    };\r\n  },\r\n  getSopClassHandlerModule,\r\n  onModeEnter,\r\n};\r\n\r\nfunction _getToolAlias(toolName) {\r\n  let toolAlias = toolName;\r\n\r\n  switch (toolName) {\r\n    case 'Length':\r\n      toolAlias = 'SRLength';\r\n      break;\r\n    case 'Bidirectional':\r\n      toolAlias = 'SRBidirectional';\r\n      break;\r\n    case 'ArrowAnnotate':\r\n      toolAlias = 'SRArrowAnnotate';\r\n      break;\r\n    case 'EllipticalRoi':\r\n      toolAlias = 'SREllipticalRoi';\r\n      break;\r\n  }\r\n\r\n  return toolAlias;\r\n}\r\n","import { SOPClassHandlerId } from './id';\r\n\r\nexport default function onModeEnter({ servicesManager }) {\r\n  const { DisplaySetService } = servicesManager.services;\r\n  const displaySetCache = DisplaySetService.getDisplaySetCache();\r\n\r\n  const srDisplaySets = displaySetCache.filter(\r\n    ds => ds.SOPClassHandlerId === SOPClassHandlerId\r\n  );\r\n\r\n  srDisplaySets.forEach(ds => {\r\n    // New mode route, allow SRs to be hydrated again\r\n    ds.isHydrated = false;\r\n  });\r\n}\r\n","/**\r\n * Entry point for development and production PWA builds.\r\n */\r\nimport 'regenerator-runtime/runtime';\r\nimport App from './App.jsx';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\n/**\r\n * EXTENSIONS\r\n * =================\r\n *\r\n * Importing and modifying the extensions our app uses HERE allows us to leverage\r\n * tree shaking and a few other niceties. However, by including them here they become\r\n * \"baked in\" to the published application.\r\n *\r\n * Depending on your use case/needs, you may want to consider not adding any extensions\r\n * by default HERE, and instead provide them via the extensions configuration key or\r\n * by using the exported `App` component, and passing in your extensions as props using\r\n * the defaultExtensions property.\r\n */\r\nimport OHIFDefaultExtension from '@ohif/extension-default';\r\nimport OHIFCornerstoneExtension from '@ohif/extension-cornerstone';\r\nimport OHIFMeasurementTrackingExtension from '@ohif/extension-measurement-tracking';\r\nimport OHIFDICOMSRExtension from '@ohif/extension-dicom-sr';\r\n\r\n/** Combine our appConfiguration and \"baked-in\" extensions */\r\nconst appProps = {\r\n  config: window ? window.config : {},\r\n  defaultExtensions: [\r\n    OHIFDefaultExtension,\r\n    OHIFCornerstoneExtension,\r\n    OHIFMeasurementTrackingExtension,\r\n    OHIFDICOMSRExtension,\r\n  ],\r\n};\r\n\r\n/** Create App */\r\nconst app = React.createElement(App, appProps, null);\r\n\r\n/** Render */\r\nReactDOM.render(app, document.getElementById('root'));\r\n","var map = {\n\t\"./af\": 95286,\n\t\"./af.js\": 95286,\n\t\"./ar\": 6561,\n\t\"./ar-dz\": 2146,\n\t\"./ar-dz.js\": 2146,\n\t\"./ar-kw\": 38047,\n\t\"./ar-kw.js\": 38047,\n\t\"./ar-ly\": 22833,\n\t\"./ar-ly.js\": 22833,\n\t\"./ar-ma\": 30186,\n\t\"./ar-ma.js\": 30186,\n\t\"./ar-sa\": 66922,\n\t\"./ar-sa.js\": 66922,\n\t\"./ar-tn\": 490,\n\t\"./ar-tn.js\": 490,\n\t\"./ar.js\": 6561,\n\t\"./az\": 48641,\n\t\"./az.js\": 48641,\n\t\"./be\": 23299,\n\t\"./be.js\": 23299,\n\t\"./bg\": 21502,\n\t\"./bg.js\": 21502,\n\t\"./bm\": 24574,\n\t\"./bm.js\": 24574,\n\t\"./bn\": 11729,\n\t\"./bn.js\": 11729,\n\t\"./bo\": 9925,\n\t\"./bo.js\": 9925,\n\t\"./br\": 1988,\n\t\"./br.js\": 1988,\n\t\"./bs\": 85793,\n\t\"./bs.js\": 85793,\n\t\"./ca\": 60347,\n\t\"./ca.js\": 60347,\n\t\"./cs\": 10999,\n\t\"./cs.js\": 10999,\n\t\"./cv\": 81690,\n\t\"./cv.js\": 81690,\n\t\"./cy\": 72638,\n\t\"./cy.js\": 72638,\n\t\"./da\": 66820,\n\t\"./da.js\": 66820,\n\t\"./de\": 38413,\n\t\"./de-at\": 15502,\n\t\"./de-at.js\": 15502,\n\t\"./de-ch\": 67569,\n\t\"./de-ch.js\": 67569,\n\t\"./de.js\": 38413,\n\t\"./dv\": 15335,\n\t\"./dv.js\": 15335,\n\t\"./el\": 21406,\n\t\"./el.js\": 21406,\n\t\"./en-SG\": 43432,\n\t\"./en-SG.js\": 43432,\n\t\"./en-au\": 19612,\n\t\"./en-au.js\": 19612,\n\t\"./en-ca\": 87302,\n\t\"./en-ca.js\": 87302,\n\t\"./en-gb\": 21543,\n\t\"./en-gb.js\": 21543,\n\t\"./en-ie\": 96745,\n\t\"./en-ie.js\": 96745,\n\t\"./en-il\": 69560,\n\t\"./en-il.js\": 69560,\n\t\"./en-nz\": 87883,\n\t\"./en-nz.js\": 87883,\n\t\"./eo\": 38066,\n\t\"./eo.js\": 38066,\n\t\"./es\": 96730,\n\t\"./es-do\": 61848,\n\t\"./es-do.js\": 61848,\n\t\"./es-us\": 32779,\n\t\"./es-us.js\": 32779,\n\t\"./es.js\": 96730,\n\t\"./et\": 61386,\n\t\"./et.js\": 61386,\n\t\"./eu\": 49220,\n\t\"./eu.js\": 49220,\n\t\"./fa\": 81123,\n\t\"./fa.js\": 81123,\n\t\"./fi\": 95495,\n\t\"./fi.js\": 95495,\n\t\"./fo\": 15855,\n\t\"./fo.js\": 15855,\n\t\"./fr\": 93843,\n\t\"./fr-ca\": 72251,\n\t\"./fr-ca.js\": 72251,\n\t\"./fr-ch\": 41713,\n\t\"./fr-ch.js\": 41713,\n\t\"./fr.js\": 93843,\n\t\"./fy\": 91316,\n\t\"./fy.js\": 91316,\n\t\"./ga\": 70089,\n\t\"./ga.js\": 70089,\n\t\"./gd\": 39957,\n\t\"./gd.js\": 39957,\n\t\"./gl\": 28775,\n\t\"./gl.js\": 28775,\n\t\"./gom-latn\": 82190,\n\t\"./gom-latn.js\": 82190,\n\t\"./gu\": 22018,\n\t\"./gu.js\": 22018,\n\t\"./he\": 41636,\n\t\"./he.js\": 41636,\n\t\"./hi\": 96602,\n\t\"./hi.js\": 96602,\n\t\"./hr\": 91898,\n\t\"./hr.js\": 91898,\n\t\"./hu\": 23597,\n\t\"./hu.js\": 23597,\n\t\"./hy-am\": 86557,\n\t\"./hy-am.js\": 86557,\n\t\"./id\": 48186,\n\t\"./id.js\": 48186,\n\t\"./is\": 92004,\n\t\"./is.js\": 92004,\n\t\"./it\": 31032,\n\t\"./it-ch\": 62219,\n\t\"./it-ch.js\": 62219,\n\t\"./it.js\": 31032,\n\t\"./ja\": 31461,\n\t\"./ja.js\": 31461,\n\t\"./jv\": 40721,\n\t\"./jv.js\": 40721,\n\t\"./ka\": 22116,\n\t\"./ka.js\": 22116,\n\t\"./kk\": 31007,\n\t\"./kk.js\": 31007,\n\t\"./km\": 7765,\n\t\"./km.js\": 7765,\n\t\"./kn\": 3735,\n\t\"./kn.js\": 3735,\n\t\"./ko\": 86880,\n\t\"./ko.js\": 86880,\n\t\"./ku\": 98841,\n\t\"./ku.js\": 98841,\n\t\"./ky\": 24125,\n\t\"./ky.js\": 24125,\n\t\"./lb\": 10047,\n\t\"./lb.js\": 10047,\n\t\"./lo\": 16396,\n\t\"./lo.js\": 16396,\n\t\"./lt\": 93903,\n\t\"./lt.js\": 93903,\n\t\"./lv\": 4162,\n\t\"./lv.js\": 4162,\n\t\"./me\": 53933,\n\t\"./me.js\": 53933,\n\t\"./mi\": 4044,\n\t\"./mi.js\": 4044,\n\t\"./mk\": 26326,\n\t\"./mk.js\": 26326,\n\t\"./ml\": 5774,\n\t\"./ml.js\": 5774,\n\t\"./mn\": 9012,\n\t\"./mn.js\": 9012,\n\t\"./mr\": 52738,\n\t\"./mr.js\": 52738,\n\t\"./ms\": 77364,\n\t\"./ms-my\": 35304,\n\t\"./ms-my.js\": 35304,\n\t\"./ms.js\": 77364,\n\t\"./mt\": 35926,\n\t\"./mt.js\": 35926,\n\t\"./my\": 49515,\n\t\"./my.js\": 49515,\n\t\"./nb\": 38267,\n\t\"./nb.js\": 38267,\n\t\"./ne\": 68871,\n\t\"./ne.js\": 68871,\n\t\"./nl\": 130,\n\t\"./nl-be\": 33615,\n\t\"./nl-be.js\": 33615,\n\t\"./nl.js\": 130,\n\t\"./nn\": 4484,\n\t\"./nn.js\": 4484,\n\t\"./pa-in\": 75380,\n\t\"./pa-in.js\": 75380,\n\t\"./pl\": 80255,\n\t\"./pl.js\": 80255,\n\t\"./pt\": 15179,\n\t\"./pt-br\": 43809,\n\t\"./pt-br.js\": 43809,\n\t\"./pt.js\": 15179,\n\t\"./ro\": 71998,\n\t\"./ro.js\": 71998,\n\t\"./ru\": 13586,\n\t\"./ru.js\": 13586,\n\t\"./sd\": 65424,\n\t\"./sd.js\": 65424,\n\t\"./se\": 19412,\n\t\"./se.js\": 19412,\n\t\"./si\": 19220,\n\t\"./si.js\": 19220,\n\t\"./sk\": 47374,\n\t\"./sk.js\": 47374,\n\t\"./sl\": 67574,\n\t\"./sl.js\": 67574,\n\t\"./sq\": 62977,\n\t\"./sq.js\": 62977,\n\t\"./sr\": 76792,\n\t\"./sr-cyrl\": 53388,\n\t\"./sr-cyrl.js\": 53388,\n\t\"./sr.js\": 76792,\n\t\"./ss\": 41676,\n\t\"./ss.js\": 41676,\n\t\"./sv\": 89807,\n\t\"./sv.js\": 89807,\n\t\"./sw\": 39893,\n\t\"./sw.js\": 39893,\n\t\"./ta\": 81610,\n\t\"./ta.js\": 81610,\n\t\"./te\": 38921,\n\t\"./te.js\": 38921,\n\t\"./tet\": 16791,\n\t\"./tet.js\": 16791,\n\t\"./tg\": 7353,\n\t\"./tg.js\": 7353,\n\t\"./th\": 10035,\n\t\"./th.js\": 10035,\n\t\"./tl-ph\": 72526,\n\t\"./tl-ph.js\": 72526,\n\t\"./tlh\": 8730,\n\t\"./tlh.js\": 8730,\n\t\"./tr\": 59059,\n\t\"./tr.js\": 59059,\n\t\"./tzl\": 88459,\n\t\"./tzl.js\": 88459,\n\t\"./tzm\": 46357,\n\t\"./tzm-latn\": 98904,\n\t\"./tzm-latn.js\": 98904,\n\t\"./tzm.js\": 46357,\n\t\"./ug-cn\": 40014,\n\t\"./ug-cn.js\": 40014,\n\t\"./uk\": 87166,\n\t\"./uk.js\": 87166,\n\t\"./ur\": 42450,\n\t\"./ur.js\": 42450,\n\t\"./uz\": 76150,\n\t\"./uz-latn\": 42939,\n\t\"./uz-latn.js\": 42939,\n\t\"./uz.js\": 76150,\n\t\"./vi\": 62959,\n\t\"./vi.js\": 62959,\n\t\"./x-pseudo\": 76756,\n\t\"./x-pseudo.js\": 76756,\n\t\"./yo\": 21873,\n\t\"./yo.js\": 21873,\n\t\"./zh-cn\": 26077,\n\t\"./zh-cn.js\": 26077,\n\t\"./zh-hk\": 18230,\n\t\"./zh-hk.js\": 18230,\n\t\"./zh-tw\": 99603,\n\t\"./zh-tw.js\": 99603\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 84179;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","__webpack_require__.amdD = function () {\n\tthrow new Error('define cannot be used indirect');\n};","__webpack_require__.F = {};\n__webpack_require__.E = function(chunkId) {\n\tObject.keys(__webpack_require__.F).map(function(key) {\n\t\t__webpack_require__.F[key](chunkId);\n\t});\n}","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = function(chunkId) {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce(function(promises, key) {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = function(chunkId) {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".bundle.\" + {\"63\":\"956ffbd9a80f756f2731\",\"196\":\"02469277c9c797aef9e0\",\"407\":\"f4abdacb09653e6db3db\",\"668\":\"4851be16587769973311\"}[chunkId] + \".js\";\n};","// This function allow to reference all chunks\n__webpack_require__.miniCssF = function(chunkId) {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nmd = function(module) {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","__webpack_require__.p = \"/\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t143: 0\n};\n\n__webpack_require__.f.j = function(chunkId, promises) {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise(function(resolve, reject) { installedChunkData = installedChunks[chunkId] = [resolve, reject]; });\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = function(event) {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t} else installedChunks[chunkId] = 0;\n\t\t\t}\n\t\t}\n};\n\n__webpack_require__.F.j = function(chunkId) {\n\tif((!__webpack_require__.o(installedChunks, chunkId) || installedChunks[chunkId] === undefined) && true) {\n\t\tinstalledChunks[chunkId] = null;\n\t\tvar link = document.createElement('link');\n\n\t\tif (__webpack_require__.nc) {\n\t\t\tlink.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tlink.rel = \"prefetch\";\n\t\tlink.as = \"script\";\n\t\tlink.href = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\tdocument.head.appendChild(link);\n\t}\n};\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tfor(moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) var result = runtime(__webpack_require__);\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkIds[i]] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunk\"] = self[\"webpackChunk\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","__webpack_require__.O(0, [143], function() {\n\t[196,407,63,668].map(__webpack_require__.E);\n}, 5);","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [400], function() { return __webpack_require__(15066); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","inProgress","POINT","MULTIPOINT","POLYLINE","CIRCLE","ELLIPSE","DICOM_SR_DISPLAY_TOOL","id","SOPClassHandlerName","SOPClassHandlerId","NO_NEVER","CANCEL","CREATE_REPORT","ADD_SERIES","SET_STUDY_AND_SERIES","NO_NOT_FOR_SERIES","createReportDialogPrompt","UIDialogService","Promise","resolve","reject","dialogId","undefined","create","centralize","isDraggable","content","Dialog","useLastPosition","showOverlay","contentProps","title","value","label","noCloseButton","onClose","dismiss","action","RESPONSE","actions","text","type","onSubmit","body","setValue","className","autoFocus","containerClassName","onChange","event","persist","target","onKeyPress","key","machineConfiguration","initial","context","trackedStudy","trackedSeries","ignoredSeries","prevTrackedStudy","prevTrackedSeries","prevIgnoredSeries","ignoredSRSeriesForHydration","isDirty","states","off","idle","entry","on","TRACK_SERIES","SET_TRACKED_SERIES","PROMPT_HYDRATE_SR","cond","RESTORE_PROMPT_HYDRATE_SR","promptBeginTracking","invoke","src","onDone","onError","tracking","UNTRACK_SERIES","SAVE_REPORT","SET_DIRTY","promptTrackNewSeries","promptTrackNewStudy","promptSaveReport","promptHydrateStructuredReport","strict","defaultOptions","services","ctx","evt","discardPreviouslyTrackedMeasurements","console","log","clearAllMeasurements","jumpToFirstMeasurementInActiveViewport","warn","showStructuredReportDisplaySetInActiveViewport","clearContext","assign","setTrackedStudyAndSeries","slice","data","StudyInstanceUID","SeriesInstanceUID","setTrackedStudyAndMultipleSeries","studyInstanceUID","seriesInstanceUIDs","SeriesInstanceUIDs","setIsDirtyToClean","setIsDirty","ignoreSeries","ignoreHydrationForSRSeries","srSeriesInstanceUID","addTrackedSeries","removeTrackedSeries","filter","ser","guards","shouldSetDirty","includes","shouldKillMachine","userResponse","shouldAddSeries","shouldSetStudyAndSeries","shouldAddIgnoredSeries","shouldPromptSaveReport","shouldIgnoreHydrationForSR","shouldSaveAndContinueWithSameReport","isBackupSave","shouldSaveAndStartNewReport","shouldHydrateStructuredReport","hasRemainingTrackedSeries","length","hasNotIgnoredSRSeriesForHydration","isNewStudy","isNewSeries","_askTrackMeasurements","UIViewportDialogService","viewportIndex","show","message","result","hide","onOutsideClick","servicesManager","extensionManager","promptResult","_askShouldAddMeasurements","_askSaveDiscardOrCancel","dataSource","measurements","options","DisplaySetService","UINotificationService","loadingDialogId","Loading","DICOMSR","naturalizedReport","DicomMetadataStore","displaySetInstanceUID","getMostRecentDisplaySet","createReportAsync","getNextSRSeriesNumber","srSeriesNumbers","getActiveDisplaySets","ds","Modality","map","SeriesNumber","Math","max","displaySetInstanceUIDs","MeasurementService","dataSources","getDataSources","getMeasurements","trackedMeasurements","m","referenceStudyUID","referenceSeriesUID","SeriesDescription","createdDisplaySetInstanceUIDs","getCornerstoneToolStateToMeasurementSchema","toolType","SOPInstanceUID","FrameOfReferenceUID","_getValueTypeFromToolType","VALUE_TYPES","Length","EllipticalRoi","Bidirectional","BIDIRECTIONAL","ArrowAnnotate","measurementData","tool","toolName","_getDisplaySetInstanceUID","handles","points","Object","keys","handle","point","x","y","push","description","unit","longAxis","start","end","shortAxis","perpendicularStart","perpendicularEnd","shortestDiameter","longestDiameter","halfXLength","abs","halfYLength","center","area","cachedStats","getDisplaySetForSOPInstanceUID","guid","OHIF","cornerstoneTools","_hydrateStructuredReport","getActiveDataSource","displaySet","getDisplaySetByUID","mappings","getSourceMappings","Error","instance","MeasurementReport","adapters","sopInstanceUIDToImageId","forEach","measurement","ReferencedSOPInstanceUID","imageId","storedMeasurementByToolType","generateToolState","mappingDefinitions","definition","hydratableMeasurementsInSR","targetStudyInstanceUID","imageIds","sopInstanceUid","i","cornerstone","metaData","get","toolData","findingSites","finding","freeTextLabel","toMeasurementSchema","source","getSource","find","fs","CodeValue","CodeMeaning","addRawMeasurement","isHydrated","srDisplaySet","hydrationResult","hydrateStructuredReport","TrackedMeasurementsContext","React","displayName","useTrackedMeasurements","useContext","SR_SOPCLASSHANDLERID","TrackedMeasurementsContextProvider","children","useViewportGrid","viewportGrid","viewportGridService","activeViewportIndex","viewports","machineOptions","jumpToMeasurement","StructuredReportDisplaySetInstanceUID","setDisplaysetForViewport","measurementIds","ms","fm","remove","bind","measurementTrackingMachine","Machine","useMachine","sendTrackedMeasurementsEvent","useEffect","activeViewport","isLoaded","load","isRehydratable","Provider","propTypes","PropTypes","BoundTrackedMeasurementsContextProvider","name","provider","dcmjs","generateReport","additionalFindingTypes","filteredToolState","_getFilteredCornerstoneToolState","report","dataset","uidFilter","md","globalToolState","addToFilteredToolState","toolDataI","imageIdSpecificToolState","measurmentDataI","CodingSchemeDesignator","uids","toolTypes","j","k","toolDataK","uidIndex","findIndex","uid","splice","storeMeasurements","store","dicom","deleteStudyMetadataPromise","downloadReport","srDataset","reportBlob","objectUrl","URL","createObjectURL","window","location","isToolSupported","getAttribute","element","defaultValue","Value","input","padFour","l","output","charCodeAt","toString","parseInt","convertToInt","getAuthorizationHeader","requestOptions","user","headers","accessToken","getAccessToken","auth","Authorization","btoa","getModalities","ModalitiesInStudy","modalities","vr","indexOf","getName","Alphabetic","getNumber","parseFloat","getString","join","IWebApiDataSource","query","retrieve","initialize","retrieveSeriesMetadata","getImageIdsForDisplaySet","getImageIdsForInstance","defaultStore","naturalizedDataset","studies","mapParams","params","requestResults","processResults","results","series","instances","CommandsManager","getActiveContexts","commandName","contextName","foundCommand","contexts","getContext","_getActiveContexts","activeContext","this","getCommand","commandFn","commandParams","HotkeysManager","commandsManager","hotkeyDefinitions","hotkeyDefaults","isEnabled","_servicesManager","_commandsManager","hotkeys","definitions","getValidDefinitions","registerHotkeys","localStorage","setItem","JSON","stringify","error","Array","isArray","_parseToArrayLike","objectDefinitions","commandOptions","commandHash","objectHash","hotkeyDefinitionsObj","copy","entries","entryValue","_parseToHotKeyObj","propertyName","propertyValue","isEditable","previouslyRegisteredDefinition","previouslyRegisteredKeys","_unbindHotkeys","_bindHotkeys","setHotkeys","isKeyDefined","isKeyArray","combinedKeys","preventDefault","stopPropagation","runCommand","ImageSet","images","defineProperty","enumerable","configurable","writable","attribute","attributes","hasOwn","prototype","hasOwnProperty","call","index","sortingCallback","sort","referenceImagePositionPatient","_getImagePositionPatient","refIppVec","Vector3","ImageOrientationPatient","getData","metadata","scanAxisNormal","cross","distanceImagePairs","image","ippVec","distance","clone","sub","dot","a","b","sortedImages","ImagePositionPatient","metadataProvider","MetadataProvider","Map","imageIdToUIDs","set","_getUIDsFromImageID","fallback","_getInstance","INSTANCE","getTagFromInstance","naturalizedTagOrWADOImageLoaderTag","_getCornerstoneWADOImageLoaderTag","wadoImageLoaderTag","WADO_IMAGE_LOADER_TAGS","GENERAL_SERIES_MODULE","seriesDate","seriesTime","SeriesDate","SeriesTime","dicomParser","modality","seriesInstanceUID","seriesNumber","validNumber","PATIENT_STUDY_MODULE","patientAge","PatientAge","patientSize","PatientSize","patientWeight","PatientWeight","IMAGE_PLANE_MODULE","rowPixelSpacing","columnPixelSpacing","rowCosines","columnCosines","PixelSpacing","ImagerPixelSpacing","SOPClassUID","PixelSpacingCalibrationType","PixelSpacingCalibrationDescription","EstimatedRadiographicMagnificationFactor","SequenceOfUltrasoundRegions","isProjection","TYPES","CorrectedImagerPixelSpacing","pixelSpacing","PhysicalDeltaX","PhysicalDeltaY","getPixelSpacingInformation","frameOfReferenceUID","rows","Rows","columns","Columns","imageOrientationPatient","imagePositionPatient","sliceThickness","SliceThickness","sliceLocation","SliceLocation","IMAGE_PIXEL_MODULE","samplesPerPixel","SamplesPerPixel","photometricInterpretation","PhotometricInterpretation","bitsAllocated","BitsAllocated","bitsStored","BitsStored","highBit","HighBit","pixelRepresentation","PixelRepresentation","planarConfiguration","PlanarConfiguration","pixelAspectRatio","PixelAspectRatio","smallestPixelValue","SmallestPixelValue","largestPixelValue","LargestPixelValue","redPaletteColorLookupTableDescriptor","RedPaletteColorLookupTableDescriptor","greenPaletteColorLookupTableDescriptor","GreenPaletteColorLookupTableDescriptor","bluePaletteColorLookupTableDescriptor","BluePaletteColorLookupTableDescriptor","redPaletteColorLookupTableData","RedPaletteColorLookupTableData","greenPaletteColorLookupTableData","GreenPaletteColorLookupTableData","bluePaletteColorLookupTableData","BluePaletteColorLookupTableData","VOI_LUT_MODULE","WindowCenter","WindowWidth","windowCenter","windowWidth","MODALITY_LUT_MODULE","RescaleIntercept","RescaleSlope","rescaleIntercept","rescaleSlope","rescaleType","RescaleType","SOP_COMMON_MODULE","sopClassUID","sopInstanceUID","PET_ISOTOPE_MODULE","RadiopharmaceuticalInformationSequence","RadiopharmaceuticalInformation","RadiopharmaceuticalStartTime","RadionuclideTotalDose","RadionuclideHalfLife","radiopharmaceuticalInfo","radiopharmaceuticalStartTime","radionuclideTotalDose","radionuclideHalfLife","OVERLAY_PLANE_MODULE","overlays","overlayGroup","groupStr","OverlayData","OverlayRowsTag","OverlayColumnsTag","OverlayType","OverlayOriginTag","OverlayDescriptionTag","OverlayLabelTag","ROIAreaTag","ROIMeanTag","ROIStandardDeviationTag","OverlayOrigin","overlay","pixelData","roiArea","roiMean","roiStandardDeviation","PATIENT_MODULE","patientName","PatientName","patientId","PatientID","GENERAL_IMAGE_MODULE","instanceNumber","InstanceNumber","lossyImageCompression","LossyImageCompression","lossyImageCompressionRatio","LossyImageCompressionRatio","lossyImageCompressionMethod","LossyImageCompressionMethod","GENERAL_STUDY_MODULE","studyDescription","StudyDescription","studyDate","StudyDate","studyTime","StudyTime","accessionNumber","AccessionNumber","CINE_MODULE","frameTime","FrameTime","splitImageId","split","qs","queryString","studyUID","seriesUID","objectUID","val","v","Number","level","hotkeyBindings","windowLevelPresets","getHTTPErrorHandler","ExtensionManager","hotkeysManager","appConfig","extensions","extension","ohifExtension","configuration","registerExtension","extensionId","registeredExtensionIds","preRegistration","_hotkeysManager","_appConfig","onModeEnter","_extensionLifeCycleHooks","onModeExit","moduleTypeNames","moduleType","extensionModule","_getExtensionModule","MODULE_TYPES","_initCommandsModule","_initDataSourcesModule","modulesMap","modules","module","stringEntry","dataSourceName","activeDataSource","dataSourceMap","lower","getModuleFnName","charAt","toUpperCase","substr","getModuleFn","ex","defaultContext","createContext","commandDefinition","registerCommand","values","defaultDataSourceName","ViewportGridService","HangingProtocolService","clearMeasurements","reset","UserAuthenticationService","namespace","dataSourceInstance","createDataSource","sourceName","COMMANDS","DATA_SOURCE","PANEL","SOP_CLASS_HANDLER","TOOLBAR","VIEWPORT","CONTEXT","LAYOUT_TEMPLATE","HANGING_PROTOCOL","getNestedObject","shallowObject","nestedObject","propertyArray","currentObject","currentProperty","shift","getShallowObject","putValues","baseKey","resultObject","currentKey","currentValue","isObject","subject","isString","search","object","property","pattern","RegExp","trim","item","test","encodeId","string","replace","match","userLoggedIn","getUserId","login","logout","setData","utils","defaults","ServicesManager","classes","errorHandler","DICOMWeb","viewer","CineService","UIModalService","ToolBarService","pubSubServiceInterface","info","trace","debug","time","timeEnd","publicAPI","getState","serviceImplementation","_getState","setCine","frameRate","isPlaying","_setCine","setIsCineEnabled","isCineEnabled","_setIsCineEnabled","setServiceImplementation","getStateImplementation","setCineImplementation","setIsCineEnabledImplementation","addInstanceToSeries","existingSeries","s","createSeriesMetadata","addInstancesToSeries","setSeriesMetadata","seriesMetadata","STUDY_ADDED","INSTANCES_ADDED","SERIES_ADDED","_model","_getStudy","aStudy","_getSeries","study","aSeries","BaseImplementation","EVENTS","listeners","addInstance","dicomJSONDatasetOrP10ArrayBuffer","dicomJSONDataset","ArrayBuffer","dict","createStudyMetadata","addInstances","madeInClient","_broadcastEvent","addSeriesMetadata","seriesSummaryMetadata","addStudy","newStudy","NumInstances","getStudyInstanceUIDs","getStudy","getSeries","getInstance","getInstanceFromImageId","DISPLAY_SETS_ADDED","DISPLAY_SETS_CHANGED","DISPLAY_SETS_REMOVED","displaySetCache","displaySetInstanceUid","batch","settings","displaySetsAdded","displaySets","makeDisplaySetForInstances","activeDisplaySets","SOPClassHandlerIds","getDisplaySetsForSeries","getDisplaySetCache","some","displaySetCacheIndex","activeDisplaySetsIndex","existingDisplaySets","handler","getModuleEntry","sopClassUids","getDisplaySetsFromSeries","_addDisplaySetsToCache","_addActiveDisplaySets","validate","startsWith","endsWith","HPMatcher","metadataInstance","rules","customAttributeRetrievalCallbacks","format","details","passed","failed","requiredFailed","score","rule","customAttribute","callback","errorMessages","testConstraint","constraint","attributeMap","e","required","weight","deafultProtocol","locked","hasUpdatedPriorsInformation","createdDate","modifiedDate","availableTo","editableBy","protocolMatchingRules","stages","viewportStructure","properties","viewportSettings","imageMatchingRules","seriesMatchingRules","studyMatchingRules","numberOfPriorsReferenced","ProtocolEngine","protocols","matchedProtocols","matchedProtocolScores","studyMetaData","getBestProtocolMatch","updateProtocolMatches","bestMatch","_getHighestScoringProtocol","_clearMatchedProtocols","findMatchByStudy","matchedDetail","protocol","has","matched","findMatch","clear","obj","reduce","highestScoringProtocolId","_largestKeyByValue","STAGE_CHANGE","NEW_LAYOUT","VIEWPORT_SETTING_TYPES","stage","matchDetails","hpAlreadyApplied","customViewportSettings","_setProtocol","matchedProtocol","run","attributeId","attributeName","_setCurrentProtocolStage","_updateViewports","_getNumProtocolStages","stageModel","_getCurrentStageModel","layoutProps","numCols","numRows","_broadcastChange","viewport","currentMatch","_matchImages","currentViewportData","protocolCallbacks","setting","customCallbacks","callbacks","concat","renderedCallback","recordInteraction","protocolInitialViewport","customInitialViewport","initialViewport","viewportOptions","cloneDeep","matchingScores","highestStudyMatchingScore","highestSeriesMatchingScore","studyMatchDetails","seriesMatchDetails","totalMatchScore","imageDetails","matchingScore","sortingInfo","sortingFunction","sortBy","reverse","numberOfStages","stageAction","_isPreviousStageAvailable","_isNextStageAvailable","eventName","eventData","hasListeners","hasCallbacks","listener","MEASUREMENT_SCHEMA_KEYS","MEASUREMENT_UPDATED","INTERNAL_MEASUREMENT_UPDATED","MEASUREMENT_ADDED","RAW_MEASUREMENT_ADDED","MEASUREMENT_REMOVED","MEASUREMENTS_CLEARED","JUMP_TO_MEASUREMENT","sources","_jumpToMeasurementCache","_arrayOfObjects","version","addOrUpdate","measurementId","getAnnotation","_getSourceId","sourceId","matchingCriteria","toSourceSchema","_isValidSource","mapping","_getSourceInfo","_getMappingByMeasurementSource","getMeasurement","matchingMapping","_getMatchingMapping","notYetUpdatedAtSource","updatedMeasurement","modifiedTimestamp","floor","Date","now","sourceInfo","_sourceHasMappings","_isValidMeasurement","internalId","newMeasurement","sourceMeasurement","_addJumpToMeasurement","registeredServiceNames","service","ohifService","registerService","TOOL_BAR_MODIFIED","TOOL_BAR_STATE_MODIFIED","buttons","unsubscriptions","buttonSections","state","primaryToolId","toggles","groups","unsub","interaction","unsubscribe","groupId","itemId","interactionType","toggledState","button","merge","buttonTypes","registeredToolbarModules","toolbarModule","def","props","buttonSectionIds","buttonsInSection","btnId","btn","mappedBtn","_mapButtonToDisplay","btnSection","component","buttonType","_buttonTypes","Component","defaultComponent","componentProps","_dismiss","dismissAll","_dismissAll","onStart","onDrag","onStop","preservePosition","onClickOutside","defaultPosition","_create","dismissImplementation","dismissAllImplementation","createImplementation","_hide","shouldCloseOnEsc","isOpen","closeButton","customClassName","_show","hideImplementation","showImplementation","serviceShowRequestQueue","duration","position","autoClose","showArguments","pop","setUser","_setUser","getUser","_getUser","_getAuthorizationHeader","handleUnauthenticated","_handleUnauthenticated","setUserImplementation","getUserImplementation","getAuthorizationHeaderImplementation","handleUnauthenticatedImplementation","resetImplementation","setImplementation","_reset","_set","setActiveViewportIndex","_setActiveViewportIndex","_setDisplaysetForViewport","setLayout","_setLayout","setCachedLayout","setActiveViewportIndexImplementation","setDisplaysetForViewportImplementation","setCachedLayoutImplementation","setLayoutImplementation","_setCachedLayout","subscribe","_isValidEvent","listenerId","subscription","_unsubscribe","callbackProps","getFourRandomValues","random","substring","Mousetrap","_originalStopCallback","timeout","_recordedSequence","_recordedSequenceCallback","_currentRecordedKeys","_recordedCharacterKey","_recordTimer","_origHandleKey","handleKey","_handleKey","character","modifiers","self","recording","_recordCurrentCombo","_recordKey","apply","arguments","_restartRecordTimer","_normalizeSequence","sequence","_finishRecording","clearTimeout","setTimeout","record","stopRecord","startRecording","init","recordPlugin","stopCallback","combo","paused","pause","unpause","path","components","ObjectPath","getPathComponents","isValidObject","last","field","found","isValid","stackMap","stackUpdatedCallbacks","createAndAddStack","isClip","initialImageIdIndex","stack","clearStacks","makeAndAddStack","findStack","findOrCreateStack","getAllStacks","addStackUpdatedCallback","getConfiguration","setConfiguration","config","absolutePath","absoluteUrl","origin","absoluteUrlParts","rootUrlPrefixIndex","array","parse","getImageId","imageObj","url","someInvalidStrings","strings","getImageInstance","getImageInstanceId","imageInstance","fetchIt","fetch","then","response","arrayBuffer","cornerstoneRetriever","byteArray","buffer","wadorsRetriever","errorInterceptor","dicomWeb","api","retrieveInstance","DicomLoaderService","localFile","findImageIdOnStudies","cornerstoneWADOImageLoader","getDicomDataMethod","loaderRegExp","loaderType","exec","lastIndex","getImageLoaderType","wadoRoot","getStudyInstanceUID","getSeriesInstanceUID","getSOPInstanceUID","authorizationHeaders","wadoUri","getLocalData","getDataByImageType","getDataByDatasetType","getLoaderIterator","loader","b64Data","contentType","sliceSize","byteCharacters","atob","byteArrays","offset","byteNumbers","Uint8Array","blob","Blob","toLowerCaseFirstLetter","word","toLowerCase","toParse","lib","getQueryFilters","searchParameters","filters","paramString","isValidPath","paramPatternPiece","parseParam","paramStr","_paramDecoded","strToDecode","decode","replaceParam","paramKey","paramValue","paramPattern","makeDeferred","promise","res","rej","freeze","Queue","limit","size","awaiting","task","boundTask","queue","cleaner","clean","args","chain","prev","forEachValue","list","isSublist","addValuesToList","add","sublist","toSublist","addToList","getItem","indexOrPath","subpath","separator","print","prevLen","repeat","TYPE","Symbol","TASK","LIST","isList","isOfType","createTask","next","objectWithType","isTask","progress","increaseList","head","notify","getOverallProgress","finish","status","seal","total","partial","failures","isValidProgress","waitOn","thenable","observers","observer","createList","named","update","addDeferred","setTaskName","contains","getTaskByName","addObserver","removeObserver","LOW_PRIORITY_MODALITIES","sortBySeriesDate","writeScript","fileName","script","document","createElement","onload","appendChild","formatDate","date","moment","formatPN","b64toBlob","StackManager","urlUtil","makeCancelable","isCanceled","cancel","isDicomUid","resolveObjectPath","root","hierarchicalListUtils","progressTrackingUtils","isLowPriorityModality","fields","n_fields","A","B","primer","DialogContext","DialogProvider","useState","isDragging","setIsDragging","dialogs","setDialogs","lastDialogId","setLastDialogId","lastDialogPosition","setLastDialogPosition","centerPositions","setCenterPositions","dialog","getCenterPosition","querySelector","centerX","offsetLeft","offsetWidth","centerY","offsetTop","offsetHeight","itemBounds","getBoundingClientRect","width","height","_bringToFront","useCallback","isEmpty","topDialog","_updateLastDialogPosition","draggableItemBounds","validCallback","onKeyDown","DialogContent","disabled","bounds","srcElement","tagName","classNames","style","zIndex","onClick","OutsideAlerter","defaultProps","isRequired","wrapperRef","useRef","handleInteractionOutside","current","addEventListener","removeEventListener","ref","isTouchDevice","navigator","maxTouchPoints","DragAndDropProvider","backend","HTML5Backend","DndProvider","opts","ModalContext","useModal","ModalProvider","Modal","modal","DEFAULT_OPTIONS","t","useTranslation","setOptions","ModalContent","ImageViewerContext","Consumer","ImageViewerProvider","StudyInstanceUIDs","reducer","initialState","useMemo","useImageViewer","DEFAULT_STATE","cines","DEFAULT_CINE","CineContext","CineProvider","useReducer","payload","dispatch","useCine","handleClose","typeClasses","SnackbarTypes","visible","items","useSnackbar","snackbarItems","topLeft","topCenter","topRight","bottomLeft","bottomCenter","bottomRight","pos","renderItem","SnackbarContext","SnackbarProvider","count","setCount","setSnackbarItems","newItem","hideAll","snackbar","onDismiss","ViewportDialogContext","useViewportDialog","ViewportDialogProvider","viewportDialogState","setViewportDialogState","ViewportGridContext","ViewportGridProvider","cachedLayout","numPanes","viewportGridState","enabled","UserAuthenticationContext","UserAuthenticationProvider","userAuthenticationState","useUserAuthentication","Link","href","showIcon","rel","variant","Row","link","AboutModal","buildNumber","versionNumber","detect","os","browser","renderRowTitle","roundedClasses","none","small","medium","large","full","variantClasses","default","primary","secondary","white","black","outlined","contained","light","sizeClasses","fullWidthClasses","true","false","Button","color","rounded","fullWidth","startIconProp","startIcon","endIconProp","endIcon","rest","classnames","buttonElement","blur","vertical","horizontal","borderClasses","orientationClasses","ButtonGroup","orientation","other","buttonClasses","role","child","ContextMenu","onContextMenu","actionType","CinePlayer","minFrameRate","maxFrameRate","stepFrameRate","defaultFrameRate","onFrameRateChange","onPlayPauseChange","setFrameRate","debouncedSetFrameRate","debounce","icon","min","step","toFixed","noop","today","studyDatePresets","subtract","renderYearsOptions","currentYear","year","DateRange","startDate","endDate","focusedInput","setFocusedInput","renderYearsOptionsCallback","parsedStartDate","parsedEndDate","DateRangePicker","startDateId","endDateId","onDatesChange","newStartDate","newEndDate","onFocusChange","updatedVal","renderCalendarInfo","preset","renderMonthElement","month","onMonthSelect","onYearSelect","handleOnBlur","onBlur","startDatePlaceholderText","endDatePlaceholderText","phrases","closeDatePicker","clearDates","isOutsideRange","day","isInclusivelyBeforeDay","hideKeyboardShortcutsPanel","numberOfMonths","showClearDates","anchorDirection","Footer","isFirst","isPrimary","transition","Body","CloseButton","Header","onShow","HeaderComponent","header","BodyComponent","FooterComponent","footer","Dropdown","showDropdownIcon","open","setOpen","DropdownItem","handleClick","idx","EmptyStudies","isLoading","ReactModal","getElementById","overlayClassName","onRequestClose","DefaultFallback","componentStack","resetErrorBoundary","fallbackRoute","ErrorBoundary","onReset","FallbackComponent","fallbackComponent","isPage","setIsOpen","Fallback","fallbackRender","arrowDown","arrowLeft","calendar","clipboard","close","dottedCircle","circledCheckmark","chevronDown","chevronLeft","chevronRight","eyeVisible","eyeHidden","exclamation","externalLink","groupLayers","infoLink","launchArrow","launchInfo","listBullets","lock","logoOhifSmall","magnifier","notificationwarningDiamond","pencil","profile","pushLeft","pushRight","sorting","sortingActiveDown","sortingActiveUp","tracked","unlink","toolZoom","toolCapture","toolLayout","toolMore","toolMove","toolWindow","toolAnnotate","toolBidirectional","toolElipse","toolLength","toolStackScroll","toolMagnify","toolFlipHorizontal","toolInvert","toolRotateRight","toolCine","toolProbe","toolAngle","toolReset","toolRectangle","oldTrash","oldPlay","oldStop","ICONS","Icon","otherProps","disabledClasses","toolbar","iconSizeClasses","IconButton","padding","Label","transparentClasses","Input","labelClassName","transparent","onFocus","readOnly","InputDateRange","isSortable","sortDirection","onLabelClick","getGridWidthClass","gridCol","InputGroup","inputMeta","onValuesChange","onSortingChange","isSortingEnabled","renderFieldInputComponent","inputProps","inputType","_isSortable","_sortDirection","handleFilterLabelClick","handleFieldChange","newValue","option","sortIconMap","descending","ascending","InputLabelWrapper","onClickHandler","tabIndex","InputMultiSelect","placeholder","isMulti","isClearable","isSearchable","closeMenuOnSelect","hideSelectedOptions","selectedOptions","InputText","LayoutSelector","onSelection","hoveredIndex","setHoveredIndex","hoverX","hoverY","isHovered","display","gridTemplateColumns","gridTemplateRows","backgroundColor","border","onMouseEnter","onMouseLeave","MeasurementItem","displayText","isActive","onEdit","isHovering","setIsHovering","line","dangerouslySetInnerHTML","__html","top","right","transform","MeasurementTable","amount","measurementItem","NavBar","isSticky","paddingTop","paddingBottom","minHeight","Notification","notificationRef","notificationElement","warning","success","MultiValue","selectProps","lastValue","Option","checked","isSelected","Select","isDisabled","noIcons","menuPlacement","_components","DropdownIndicator","IndicatorSeparator","opt","inputId","classNamePrefix","newSelection","acc","curr","SegmentationTable","activeItem","setActiveItem","colorLUT","alert","itemKey","currentItem","handleOnClick","baseStyle","maxWidth","styleMap","left","marginLeft","marginRight","closed","expandedWidth","classesMap","openIconName","SidePanel","side","defaultComponentOpen","childComponents","componentOpen","setComponentOpen","openStatus","childComponent","_childComponent","getChildComponent","minWidth","iconName","iconLabel","baseClasses","isExpanded","SplitButton","isRadio","isAction","bState","_primary","_items","renderer","onInteraction","getSplitButtonItems","setState","isPrimaryActive","tooltip","getTrackedSeries","isTracked","StudyBrowser","tabs","activeTabName","expandedStudyInstanceUIDs","onClickTab","onClickStudy","onClickThumbnail","onDoubleClickThumbnail","onClickUntrack","activeDisplaySetInstanceUID","tab","studyInstanceUid","numInstances","thumbnails","onThumbnailClick","onThumbnailDoubleClick","imageSrc","imageAltText","componentType","viewportIdentificator","dragData","StudyItem","StudyListExpandedRow","seriesTableColumns","seriesTableDataSource","columnKey","row","cellKey","StudyListFilter","filtersMeta","filterValues","clearFilters","isFiltering","numOfStudies","filterSorting","sortingValues","StudyListPagination","onChangePage","currentPage","perPage","onChangePerPage","navigateToPage","page","ranges","r","selectedRange","setSelectedRange","StudyListTableRow","tableData","expandedContent","onClickRow","cell","colSpan","StudyListTable","tableDataSource","StudySummary","logoOhif","SVGS","Svg","Table","base","TableBody","isTableHead","propName","componentName","elements","TableCell","cellsNum","align","justify","TableHead","TableRow","childrens","Thumbnail","onDoubleClick","useDrag","canDrag","monitor","drag","margin","alt","ThumbnailNoImage","modalityTooltip","canReject","onReject","ThumbnailTracked","trackedIcon","viewportIdentificatorLabel","ThumbnailList","_getModalityTooltip","_modalityTooltips","SR","ToolbarButton","dropdownContent","_isActive","activeClass","shouldShowDropdown","tight","ContextMenuMeasurements","onGetMenuItems","onSetLabel","onDelete","menuItems","ExpandableToolbarButton","Content","ListMenu","selectedIndex","setSelectedIndex","ListItem","arrowPositionStyle","bottom","Tooltip","setIsActive","handleMouseOver","handleMouseOut","onMouseOver","onMouseOut","block","hidden","xmlns","viewBox","fill","d","TooltipClipboard","setMessage","isCopying","setIsCopying","timeoutShow","timeoutHide","tooltipBoxRef","tooltipContainerRef","copyToClipboard","writeText","refreshElementPosition","resetState","resetTimeout","timeOut","tooltipContainer","tooltipBox","containerX","defaultVariantMapping","h1","h2","h3","h4","h5","h6","subtitle","caption","overline","srOnly","inherit","inline","gutterBottom","paragraph","noWrap","Typography","Viewport","onSeriesChange","studyData","isLocked","currentSeries","seriesDescription","patientInformation","patientSex","MRN","thickness","spacing","scanner","ViewportActionBar","clickOutsideHandler","showNavArrows","showStatus","showCine","cineProps","patientInfoVisibility","showPatientInfo","onPillClick","setShowPatientInfo","useAltStyling","showPatientInfoRef","clickOutsideListener","borderColor","ToolTipMessage","StatusIcon","StatusPill","renderIconStatus","pointerEvents","PatientInfo","FILE_TYPE_OPTIONS","DEFAULT_FILENAME","updateViewportPreview","enableViewport","disableViewport","toggleAnnotations","loadImage","downloadBlob","defaultSize","minimumSize","maximumSize","canvasClass","filename","setFilename","fileType","setFileType","dimensions","setDimensions","showAnnotations","setShowAnnotations","keepAspect","setKeepAspect","aspectMultiplier","setAspectMultiplier","viewportElement","setViewportElement","viewportElementDimensions","setViewportElementDimensions","createRef","downloadCanvas","setDownloadCanvas","setViewportPreview","setError","hasError","refreshViewport","onDimensionsChange","dimension","oppositeDimension","sanitizedTargetValue","newDimensions","updatedDimension","round","error_messages","renderErrorHandler","errorType","validSize","loadAndUpdateViewports","scaledWidth","scaledHeight","scaledDimensions","dataUrl","viewportElementWidth","viewportElementHeight","htmlFor","ViewportGrid","rowSize","colSize","ViewportPane","onDrop","acceptDropsFor","dropElement","useDrop","accept","drop","droppedItem","canDrop","isOver","onInteractionHandler","collect","isHighlighted","focus","onMouseDown","onScroll","onWheel","WindowLevelMenuItem","UserPreferences","availableLanguages","defaultLanguage","currentLanguage","onCancel","hotkeysModule","hotkeyErrors","language","Section","errors","every","languageOptions","MODIFIER_KEYS","DISALLOWED_COMBINATIONS","ctrl","formatPressedKeys","pressedKeysArray","ERROR_MESSAGES","hotkeysValidators","pressedKeys","lastPressedKey","conflictingCommand","currentCommandName","firstConflictingCommand","formatedPressedHotkeys","toolHotkeys","findConflictingCommand","modifierCommand","disallowedCombination","HotkeysPreferences","controlledErrors","visibleHotkeys","setErrors","splitedHotkeys","arrayHotkeys","halfwayThrough","ceil","splitHotkeyDefinitionsAndCreateTuples","onHotkeyChangeHandler","validation","validator","prevState","hotkey","hotkeyIndex","modifierKeys","HotkeyField","inputValue","formatKeysForInput","keysArray","getKeys","menuOptions","isReturnEnabled","onClickReturnButton","WhiteLabeling","createLogoComponentFn","CustomLogo","BackgroundColor","ModalComponent","debugMode","detectionOptions","order","lookupQuerystring","lookupCookie","lookupLocalStorage","lookupFromPathIndex","lookupFromSubdomainIndex","caches","excludeCacheFor","htmlTag","documentElement","languagesMap","ar","am","bg","bn","ca","cs","da","de","el","en","es","et","fa","fi","fil","fr","gu","he","hi","hr","hu","it","ja","kn","ko","lt","lv","ml","mr","nl","no","pl","ro","ru","sk","sl","sr","sv","sw","ta","te","th","tr","uk","vi","zh","getLanguageLabel","UserPreferencesModal","Buttons","CineDialog","Common","DatePicker","StudyList","ViewportDownloadForm","ToolTip","Modes","Modals","en_US","ja_JP","pt_BR","test_lng","locizeOptions","projectId","process","apiKey","referenceLng","fallbacklng","DEFAULT_LANGUAGE","initI18n","detection","useLocize","apiKeyAvailable","i18n","Backend","use","LastUsed","Editor","LanguageDetector","initReactI18next","fallbackLng","saveMissing","keySeparator","interpolation","escapeValue","locizeLastUsed","editor","onEditorSaved","lng","ns","react","useSuspense","wait","bindI18n","resources","locales","newLocales","resourceBundle","locale","availableLanguagesInfo","getAvailableLanguagesInfo","Compose","reduceRight","Comp","appConfigContext","useAppConfig","AppConfigProvider","initAppConfig","DataSourceWrapper","LayoutTemplate","useParams","useLocation","mods","mod","STUDIES_LIMIT","resultsPerPage","pageNumber","setIsLoading","queryFilterValues","queryLimit","_tryParseInt","URLSearchParams","modalitiesInStudy","str","retValue","isNaN","_getQueryFilterValues","isSamePage","previousOffset","newOffset","isLocationUpdated","dataTotal","isLoadingData","useDebounce","delay","debouncedValue","setDebouncedValue","useQuery","seriesInStudiesMap","WorkList","studiesTotal","navigate","useNavigate","mrn","accession","defaultFilterValues","_setFilterValues","debouncedFilterValues","canSort","shouldUseDefaultSort","sortModifier","defaultSortValues","sortedStudies","s1","s2","_sortStringDates","s1Prop","s2Prop","localeCompare","expandedRows","setExpandedRows","studiesWithSeriesData","setStudiesWithSeriesData","setFilterValues","classList","currValue","skipNull","skipEmptyString","pathname","fetchSeries","z","expandedRowIndex","rollingPageNumberMod","offsetAndTake","rowKey","numSeriesInstances","modes","mode","isValidMode","to","n","hasStudies","getValidHotkeyDefinitions","restoreDefaultBindings","whiteLabeling","isEqual","newPageNumber","oldPageNumber","rollingPageNumber","isNextPage","hasNextPage","newResultsPerPage","s1Date","s2Date","toISOString","FileLoader","file","dicomData","_meta","meta","FileLoaderService","getLoader","loadFile","getDataset","PDFFileLoader","DICOMFileLoader","processFile","fileLoaderService","addFile","filesToStudies","files","processFilesPromises","all","getLoadButton","isDir","noDrag","getRootProps","getInputProps","webkitdirectory","mozdirectory","dropzoneRef","acceptedFiles","noClick","NotFound","showGoBackButton","ViewerViewportGrid","viewportComponents","updateDisplaysetForViewports","numViewports","matchingDisplaySet","setHangingProtocolAppliedForViewport","referencedDisplaySetInstanceUID","vp","onDropHandler","viewportPanes","numViewportPanes","ViewportComponent","EmptyViewport","displaySetsToDisplay","_getViewportComponent","getViewportPanes","defaultRouteInit","studyInstanceUIDs","makeDisplaySets","instanceAddedUnsubscribe","studyMetadata","seriesAddedUnsubscribe","ModeRoute","setStudyInstanceUIDs","refresh","setRefresh","layoutTemplateData","locationRef","isMounted","sopClassHandlers","hangingProtocols","setActiveDataSource","route","routes","layoutTemplateRouteData","layoutTemplate","contextModules","moduleIds","contextModuleProviders","CombinedContextProvider","initializeDataSource","retrieveLayoutData","layoutData","setDefaultHotKeys","userPreferredHotkeys","destroy","extentionProtocols","hangingProtocolModule","addProtocols","setupRouteInit","unsubs","LayoutComponent","renderLayoutData","ViewportGridComp","userAuthenticationService","bakedInRoutes","private","Local","routerBasename","dataSourceNames","buildModeRoutes","allRoutes","RouteWithErrorBoundary","basename","appConfigOrFunc","defaultExtensions","getAppState","registerServices","httpErrorHandler","registerExtensions","longitudinalMode","CallbackPage","userManager","onRedirectSuccess","signinRedirectCallback","catch","onRedirectError","SignoutCallbackComponent","signoutRedirectCallback","sessionStorage","_makeAbsoluteIfNecessary","base_url","_isAbsoluteUrl","initUserManager","oidc","firstOpenIdClient","host","baseUri","redirect_uri","silent_redirect_uri","post_logout_redirect_uri","oidcSettings","automaticSilentRenew","revokeAccessTokenOnSignout","filterProtocolClaims","loadUserInfo","UserManager","getUserManagerForOpenIdConnectClient","LoginComponent","queryParams","iss","loginHint","targetLinkUri","oidcAuthority","removeUser","ohifRedirectTo","signinRedirect","login_hint","access_token","authority","_redirect_uri","silent_refresh_uri","_silent_redirect_uri","_post_logout_redirect_uri","onEnter","reload","successCallback","errorCallback","_createButton","_createActionButton","_createToggleButton","_createToolButton","_createWwwcPreset","ohif","dicomsr","App","appInit","appConfigState","appRoutes","createRoutes","providers","I18nextProvider","ThemeWrapper","CombinedProviders","authRoutes","modeConfiguration","addButtons","toolbarButtons","createButtonSection","validationTags","leftPanels","rightPanels","routerBaseName","showStudyList","qidoStudies","qidoStudy","processSeriesResults","qidoSeries","seriesInstanceUid","dicomWebClient","queryParameters","searchForStudies","searchResult","commaSeparatedFields","supportsWildcard","withWildcard","parameters","fuzzymatching","supportsFuzzyMatching","includefield","DD","String","getDate","padStart","MM","getMonth","YYYY","getFullYear","todayStr","oldDateStr","studyUids","final","frame","thumbnail","renderingAttr","uri","baseWadoRsUri","buildInstanceWadoRsUri","buildInstanceFrameWadoRsUri","getWADORSImageId","wadoUriRoot","buildInstanceWadoUrl","seriesSortCriteria","seriesInfoSortingCriteria","firstSeries","secondSeries","aLowPriority","bLowPriority","instancesSortCriteria","sortingCriteria","sortStudySeries","seriesSortingCriteria","sortFunction","makeSeriesAsyncLoader","client","seriesInstanceUIDList","hasNext","RetrieveMetadataLoaderAsync","preLoaders","searchForSeries","getPreLoaders","runLoaders","sortCriteria","naturalizeDataset","naturalized","preLoadData","seriesAsyncLoader","promises","RetrieveMetadataLoader","preLoad","loadData","posLoad","postLoadData","loaders","done","enableStudyLazyLoad","retrieveMetadataLoader","execLoad","seriesPromises","RetrieveMetadata","moduleName","StudyMetaDataPromises","retrieveStudyMetadata","delete","StaticWadoClient","qidoConfig","staticWado","filtered","filterKeys","filterItem","desired","actual","compareValues","actualItem","range","dash","altKey","testValue","valueElem","compareDateRange","DicomMetaDictionary","DicomDict","denaturalizeDataset","createDicomWebApi","dicomWebConfig","qidoRoot","supportsReject","wadoConfig","qidoDicomWebClient","wadoDicomWebClient","implementation","paramsStudyInstanceUIDs","origParams","mappedParams","qidoSearch","studyPromise","seriesPromise","naturalizedInstances","storeInstances","FileMetaInformationVersion","MediaStorageSOPClassUID","MediaStorageSOPInstanceUID","TransferSyntaxUID","ImplementationClassUID","ImplementationVersionName","denaturalized","dicomDict","part10Buffer","write","datasets","setSuccessFlag","addRetrieveBulkData","BulkDataURI","retrieveBulkData","multipart","ret","numberOfSeries","NumberOfFrames","xhr","XMLHttpRequest","onreadystatechange","readyState","responseText","send","dcm4cheeReject","_store","urls","getMetaDataByURL","findStudies","createDicomJSONApi","dicomJsonConfig","json","naturalizedDicom","addImageIdToUIDs","param","Modalities","customSort","seriesSummary","seriesA","seriesB","modalityA","modalityB","createDicomLocalApi","dicomLocalConfig","StudyInstanceUIDsAsArray","Set","firstInstance","from","storedInstance","Toolbar","setToolbarButtons","buttonState","setButtonState","unsub1","getButtonSection","unsub2","toolDef","ViewerLayout","getPanelData","leftPanelComponents","rightPanelComponents","viewportComponent","PanelStudyBrowser","getImageSrc","getStudiesForPatientByStudyInstanceUID","requestDisplaySetCreationForStudy","setActiveTabName","setExpandedStudyInstanceUIDs","studyDisplayList","setStudyDisplayList","setDisplaySets","thumbnailImageSrcMap","setThumbnailImageSrcMap","qidoStudiesForPatient","mappedStudies","_mapDataSourceStudies","actuallyMappedStudies","sid","fetchStudiesForPatient","dSet","newImageSrcEntry","mappedDisplaySets","_mapDisplaySets","SubscriptionDisplaySetsAdded","SubscriptionDisplaySetsChanged","changedDisplaySets","primaryStudyInstanceUIDs","primaryStudies","recentStudies","allStudies","displaySetsForStudy","tabStudy","_createStudyBrowserTabs","shouldCollapseStudy","updatedExpandedStudyInstanceUIDs","stdyUid","clickedTabName","thumbnailDisplaySets","thumbnailNoImageDisplaySets","thumbnailNoImageModalities","_getComponentType","numImageFrames","loadAndCacheImage","canvas","renderToCanvas","toDataURL","getStudyResult","WrappedPanelStudyBrowser","_getStudiesForPatientByStudyInstanceUID","_getImageSrcFromImageId","command","getImageSrcFromImageId","_createGetImageSrcFromImageIdFn","_requestDisplaySetCreationForStudy","func","immediate","later","callNow","PanelMeasurementTable","displayMeasurements","setDisplayMeasurements","debouncedSetDisplayMeasurements","_getMappedMeasurements","added","addedRaw","updated","removed","cleared","subscriptions","types","_getDisplayText","_mapMeasurementToDisplay","hasPixelSpacing","roundedLength","_round","roundedShortestDiameter","roundedLongestDiameter","roundedArea","decimals","imagesTypes","sopClassHandlerName","isMultiFrame","makeDisplaySet","imageSet","setAttributes","FrameRate","uniqueSopClassUidsInSeries","getSopClassUids","stackableInstances","acquisitionDatetime","AcquisitionDateTime","setAttribute","petCTProtocol","equals","voi","invert","doesNotContain","ToolbarDivider","closeOnOutsideClick","DropdownContent","OHIFLayoutSelector","toggleCine","setButton","_","nextStage","nextProtocolStage","previousStage","previousProtocolStage","storeContexts","getDataSourcesModule","getHangingProtocolModule","getLayoutTemplateModule","getPanelModule","getSopClassHandlerModule","getToolbarModule","toolbarService","clickHandler","ToolbarSplitButton","ToolbarLayoutSelector","clickedBtn","btnSectionName","requiredConfig","optionalConfig","requiredProps","optionalProps","allButtons","getButtons","thisButton","setButtons","getCommandsModule","commandsModule","toolsGroupedByType","touch","csTools","annotations","initialized","initWADOImageLoader","beforeSend","xhrRequestHeaders","maxWebWorkers","hardwareConcurrency","startWebWorkersOnDemand","taskConfiguration","decodeTask","initializeCodecsOnStartup","usePDFJS","globalImageIdSpecificToolStateManager","getPointsFromHandles","getSOPInstanceAttributes","toAnnotation","toMeasurement","csToolsAnnotation","getValueTypeFromToolType","SUPPORTED_TOOLS","meanSUV","stdDevSUV","meanStdDevSUV","mean","stdDev","valueType","DEFAULT_CONTEXT","enabledElements","getEnabledElement","isArrowAnnotateInputDialog","onSubmitHandler","CONTEXT_MENU_OPEN","TOOL_TYPES_WITH_CONTEXT_MENU","_refreshViewports","tools","toolsGroup","getTools","measurementServiceSource","_connectToolsToMeasurementService","onRightClick","_getDefaultPosition","detail","defaultMenuItems","currentPoints","nearbyToolData","canvasCoordinates","availableToolTypes","toolState","imageToolType","numMeasurements","uuid","callInputDialog","actionId","onTouchPress","isTouchEvent","resetContextMenu","contextMenuHandleClick","which","cancelContextMenuIfOpen","csToolsConfig","Hammer","cornerstoneMath","fontFamily","maxImagesToPrefetch","Infinity","preserveExistingPool","maxSimultaneousRequests","initCornerstoneTools","globalToolSyncEnabled","showSVGCursors","autoResizeViewports","targetContext","setEnabledElement","enabledElement","internalToolsConfig","getTextCallback","eventDetails","changeTextCallback","allowEmptyLabel","DragProbe","defaultStrategy","_createInternalToolsConfig","externalToolProps","internalToolProps","toolsWithHideableHandles","parsedProps","hideHandles","drawHandlesOnHover","hideHandlesIfMoving","_parseToolProps","_addConfiguredToolsForElement","csToolsVer4MeasurementSource","measurementServiceMappingsFactory","createSource","addMapping","_initMeasurementService","_connectMeasurementServiceToTools","elementEnabledEvt","restoreToolState","cornerstoneMeasurement","saveToolState","getCornerstoneMeasurementById","completedEvt","updatedEvt","removedEvt","csToolsEvent","evtDetail","csToolName","measurementSource","VALUE_TYPE_TO_TOOL_TYPE","imageIdToolState","removedMeasurementId","annotationIndex","DEFAULT_SIZE","MAX_TEXTURE_SIZE","CornerstoneViewportDownloadForm","activeEnabledElement","updateViewport","newWidth","newHeight","multiplier","scale","translation","toggle","mimetype","msToBlob","msSaveBlob","toBlob","URLObj","webkitURL","download","click","removeChild","scroll","imagePositionSynchronizer","panZoomSynchronizer","onElementEnabledAddToSync","onElementDisabledRemoveFromSync","_getActiveViewportsEnabledElement","getCornerstoneLibraries","rotateViewport","rotation","flipViewportHorizontal","hflip","flipViewportVertical","vflip","scaleViewport","direction","resetViewport","toggleSynchronizer","synchronizers","invertViewport","cancelMeasurement","cancelActiveManipulatorsForElement","setters","setToolActive","viewportInfo","mouseButtonMask","clearAnnotations","measurementsToRemove","_id","lesionNamingNumber","measurementNumber","nextImage","previousImage","getActiveViewportEnabledElement","showDownloadViewportModal","getNearbyToolData","nearbyTool","pointNearTool","elementToolData","elementToolInstance","removeToolState","setWindowLevel","jumpToImage","rotateViewportCW","rotateViewportCCW","scaleUpViewport","scaleDownViewport","fitViewportToWindow","setZoomTool","OHIFCornerstoneViewport","getViewportModule","onNewImage","jumpData","PanelStudyBrowserTracking","jumpToDisplaySet","setJumpToDisplaySet","isSingleViewport","_byDate","dateA","studyA","studyB","scrollIntoView","behavior","thumbnailLocation","tabName","_findTabAndStudyOfDisplaySet","trackedSeriesInstanceUIDs","viewportData","_viewportLabels","thumbnailProps","deleteDisplaySet","WrappedPanelStudyBrowserTracking","ActionButtons","onExportClick","onCreateReportClick","downloadCSVReport","referencedSeriesInstanceUIDs","seriesMetadataMap","commonRowItems","_getCommonRowItems","_getBidirectionalRow","blankColumns","_getEllipseStatsWithUnits","_getEllipseRow","_getAdditionalFindingRow","_getLengthRow","csvContent","encodedUri","encodeURI","_createAndDownloadFile","DISPLAY_STUDY_SUMMARY_INITIAL_VALUE","PanelMeasurementTableTracking","measurementChangeTimestamp","setMeasurementsUpdated","debouncedMeasurementChangeTimestamp","displayStudySummary","setDisplayStudySummary","mappedMeasurements","measurementType","updateDisplayStudySummary","matches","studyMeta","instanceMeta","onMeasurementItemClickHandler","onMeasurementItemEditHandler","displayMeasurementsWithoutFindings","dm","additionalFindings","getContextModule","setToolActiveForElement","addMeasurement","TOOL_NAMES","TrackingUniqueIdentifier","renderableData","labels","coords","coord","GraphicType","GraphicData","SCOORD_TYPES","onPerimeter","radius","majorAxis","minorAxis","minorAxisLength","minorAxisDirection","halfMinorAxisLength","corner1","corner2","_getRenderableData","loaded","ReferencedSOPSequence","cornerstoneAdapters","CodeNameCodeSequenceValues","CodingSchemeDesignators","RELATIONSHIP_TYPE","CORNERSTONE_FREETEXT_CODE_VALUE","_getDisplaySetsFromSeries","ConceptNameCodeSequence","referencedImages","isDerivedDisplaySet","ContentSequence","ImagingMeasurementReportContentSequence","ImageLibraryGroup","_getSequenceAsArray","ReferencedSOPClassUID","mergedContentSequencesByTrackingUniqueIdentifiers","MeasurementGroups","MeasurementGroup","TrackingUniqueIdentifierItem","trackingUniqueIdentifier","UID","_getMergedContentSequencesByTrackingUniqueIdentifiers","mergedContentSequence","group","ValueType","graphicItem","UIDREFContentItem","TrackingIdentifierContentItem","NUMContentItems","_getCoordsFromSCOORDOrSCOORD3D","TrackingIdentifier","TextValue","MeasuredValueSequence","_getLabelFromMeasuredValueSequence","_processTID1410Measurement","Finding","FindingSites","ConceptCodeSequence","cornerstoneFreeTextFindingSite","FindingSite","_processNonGeometricallyDefinedMeasurement","_processMeasurement","_getMeasurements","adapterKeys","adapterKey","isValidCornerstoneTrackingIdentifier","adapter","activeDisplaySet","_checkIfCanAddMeasurementsToDisplaySet","newDisplaySet","_load","unloadedMeasurements","SOPInstanceUIDs","imageIdsForDisplaySet","_measurmentReferencesSOPInstanceUID","RelationshipType","ReferencedFrameOfReferenceSequence","NumericValue","MeasurementUnitsCodeSequence","formatedNumericValue","trackingIdentifiersByEnabledElementUUID","getters","trackingUniqueIdentifiersForElement","trackingUniqueIdentifiers","activeIndex","activeTrackingUniqueIdentifierForElement","trackingIdentifiersForElement","tuid","defaultConfig","OHIFCornerstoneSRViewport","dependencies","conifg","dicomSRModule","toolAlias","_getToolAlias","appProps","OHIFDefaultExtension","OHIFCornerstoneExtension","OHIFMeasurementTrackingExtension","OHIFDICOMSRExtension","app","ReactDOM","webpackContext","req","webpackContextResolve","__webpack_require__","o","code","exports","__webpack_module_cache__","moduleId","cachedModule","__webpack_modules__","amdD","O","chunkIds","fn","priority","notFulfilled","fulfilled","F","E","chunkId","getter","__esModule","f","u","miniCssF","g","globalThis","Function","prop","needAttach","scripts","getElementsByTagName","charset","nc","onScriptComplete","onerror","doneFns","parentNode","toStringTag","nmd","paths","p","installedChunks","installedChunkData","realSrc","request","as","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","chunkLoadingGlobal","__webpack_exports__"],"sourceRoot":""}