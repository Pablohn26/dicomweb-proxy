"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[407],{55407:function(e,t,n){n.r(t),n.d(t,{default:function(){return j}});var r=n(32735),a=n(60216),o=n.n(a),i=n(29684),l=n.n(i),c=n(82656),s=n.n(c),u=n(91196),m=n(39016),f=n(52938),d=function(e){var t=e.error;return t?r.createElement(r.Fragment,null,r.createElement("div",{className:"bg-black h-full w-full absolute opacity-50"}),r.createElement("div",{className:"text-primary-light text-xl font-light"},r.createElement("h4",null,"Error Loading Image"),r.createElement("p",null,"An error has occurred."),r.createElement("p",null,t.message))):r.createElement(r.Fragment,null,r.createElement("div",{className:"bg-black h-full w-full absolute opacity-50"}),r.createElement("div",{className:"absolute transparent w-full h-full flex items-center justify-center"},r.createElement("p",{className:"text-primary-light text-xl font-light"},"Loading...")))};d.propTypes={percentComplete:o().number,error:o().object},d.defaultProps={percentComplete:0,error:null};var p=d,v=s().globalImageIdSpecificToolStateManager;function E(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var y={touch:[s().PanMultiTouchTool,s().ZoomTouchPinchTool],annotations:[s().ArrowAnnotateTool,s().BidirectionalTool,s().LengthTool,s().AngleTool,s().FreehandRoiTool,s().EllipticalRoiTool,s().DragProbeTool,s().RectangleRoiTool],other:[s().PanTool,s().ZoomTool,s().WwwcTool,s().WwwcRegionTool,s().MagnifyTool,s().StackScrollTool,s().StackScrollMouseWheelTool,s().OverlayTool]};var h=n(40841),b=n.n(h),I=function(e){var t=e.imageId,n=e.scale,a=e.windowWidth,o=e.windowCenter,i=e.imageIndex,c=e.stackSize,s=e.activeTools,u="absolute pointer-events-none",m=s.includes("Zoom"),f=s.includes("Wwwc");if(!t)return null;var d=(l().metaData.get("generalImageModule",t)||{}).instanceNumber;return r.createElement("div",{className:"text-primary-light"},r.createElement("div",{"data-cy":"viewport-overlay-top-left",className:b()(u,"top-viewport left-viewport")},m&&r.createElement("div",{className:"flex flex-row"},r.createElement("span",{className:"mr-1"},"Zoom:"),r.createElement("span",{className:"font-light"},n.toFixed(2),"x")),f&&r.createElement("div",{className:"flex flex-row"},r.createElement("span",{className:"mr-1"},"W:"),r.createElement("span",{className:"ml-1 mr-2 font-light"},a.toFixed(0)),r.createElement("span",{className:"mr-1"},"L:"),r.createElement("span",{className:"ml-1 font-light"},o.toFixed(0)))),r.createElement("div",{"data-cy":"viewport-overlay-top-right",className:b()(u,"top-viewport right-viewport-scrollbar")},c>1&&r.createElement("div",{className:"flex flex-row"},r.createElement("span",{className:"mr-1"},"I:"),r.createElement("span",{className:"font-light"},"".concat(d," (").concat(i,"/").concat(c,")")))),r.createElement("div",{"data-cy":"viewport-overlay-bottom-right",className:b()(u,"bottom-viewport right-viewport-scrollbar")}),r.createElement("div",{"data-cy":"viewport-overlay-bottom-left",className:b()(u,"bottom-viewport left-viewport")}))};I.propTypes={scale:o().number.isRequired,windowWidth:o().number.isRequired,windowCenter:o().number.isRequired,imageId:o().string.isRequired,imageIndex:o().number.isRequired,stackSize:o().number.isRequired,activeTools:o().arrayOf(o().string)},I.defaultProps={activeTools:[]};var w=I;function T(e,t,n,r,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,a)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){T(o,r,a,i,l,"next",e)}function l(e){T(o,r,a,i,l,"throw",e)}i(void 0)}))}}function x(){return(x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){l=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return N(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var k=s().importInternal("util/scrollToIndex"),M=s().importInternal("base/BaseAnnotationTool"),P=m.ZP.utils.StackManager;function D(e){var t=e.children,n=e.dataSource,a=e.displaySet,o=e.onElementEnabled,i=e.element,c=e.viewportIndex,m=e.servicesManager,d=(e.commandsManager,m.services),v=d.ToolBarService,g=d.DisplaySetService,h=d.MeasurementService,b=d.HangingProtocolService,I=A((0,r.useState)(null),2),T=I[0],S=I[1],N=A((0,f.vQ)(),2),k=N[0].cines,D=N[1],R=A((0,f.O_)(),2),j=(R[0].viewports,R[1]),C=(0,r.useRef)(!1),F=(0,r.useRef)(!1),B=function(e,t){e.addEventListener(l().EVENTS.IMAGE_RENDERED,(function n(){e.removeEventListener(l().EVENTS.IMAGE_RENDERED,n),t(e,v)}))};(0,r.useEffect)((function(){return C.current=!0,function(){C.current=!1,P.clearStacks()}}),[]),(0,r.useEffect)((function(){var e=b.subscribe(b.EVENTS.STAGE_CHANGE,(function(){F.current=!0})).unsubscribe;return function(){e()}}),[]),(0,r.useEffect)((function(){D.setCine({id:c})}),[c]),(0,r.useEffect)((function(){var e=a.StudyInstanceUID,t=a.displaySetInstanceUID,r=a.sopClassUids;e&&t&&(r&&r.length>1&&console.warn("More than one SOPClassUID in the same series is not yet supported."),function(e,t){return O.apply(this,arguments)}(n,a).then((function(e){C.current&&S(e)})))}),[n,a,c]),(0,r.useEffect)((function(){var e=function(e,t,n,r,a,o){return e.subscribe(e.EVENTS.JUMP_TO_MEASUREMENT,(function(i){var l=i.measurement;l&&l.displaySetInstanceUID===a&&U(l,n,r,e,t,o)})).unsubscribe}(h,g,i,c,a.displaySetInstanceUID,j);return function(e,t,n,r,a,o){var i=e.getJumpToMeasurement(r);if(i&&n){var l=e.getMeasurement(i);l.displaySetInstanceUID===a&&U(l,n,r,e,t,o)}}(h,g,i,c,a.displaySetInstanceUID,j),i&&B(i,(function(){F.current=!1})),i&&a.renderedCallback&&B(i,a.renderedCallback),function(){e()}}),[i,a]);var W=null;if(!T)return null;var L=T.stack,V=L.imageIds,Z=L.initialImageIdIndex;t&&t.length&&(W=t.map((function(e,t){return e&&r.cloneElement(e,{viewportIndex:c,key:t})})));var q=k[c],_=q&&q.isPlaying||!1,G=q&&q.frameRate||24;return r.createElement("div",{className:"relative flex flex-row w-full h-full overflow-hidden"},r.createElement(u.Z,{onElementEnabled:o||function(e){var t=e.detail.element,n=function(){var e=[];return Object.keys(y).forEach((function(t){return e.push.apply(e,E(y[t]))})),e}(),r=v.state.primaryToolId;!function(e,t){var n=s().importInternal("base/BaseAnnotationTool");t.forEach((function(t){if(t.prototype instanceof n){var r=(new t).name;s().setToolPassiveForElement(e,r)}})),s().setToolActiveForElement(e,"Pan",{mouseButtonMask:4}),s().setToolActiveForElement(e,"Zoom",{mouseButtonMask:2}),s().setToolActiveForElement(e,"Wwwc",{mouseButtonMask:1}),s().setToolActiveForElement(e,"StackScrollMouseWheel",{}),s().setToolActiveForElement(e,"PanMultiTouch",{pointers:2}),s().setToolActiveForElement(e,"ZoomTouchPinch",{}),s().setToolEnabledForElement(e,"Overlay",{})}(t,n),s().setToolActiveForElement(t,r,{mouseButtonMask:1}),s().store.state.tools.filter((function(e){return e.element===t})).forEach((function(e){if(e instanceof M){var t=e.configuration;t.renderDashed=!0,e.configuration=t}})),l().getEnabledElement(t).image&&l().updateImage(t)},viewportIndex:c,imageIds:V,imageIdIndex:Z,initialViewport:a.initialViewport,stageChanged:F.current,resizeRefreshRateMs:150,isActive:!0,isStackPrefetchEnabled:!0,isPlaying:_,frameRate:G,isOverlayVisible:!0,loadingIndicatorComponent:p,viewportOverlayComponent:function(e){return r.createElement(w,x({},e,{activeTools:v.getActiveTools()}))}}),W)}D.propTypes={displaySet:o().object,viewportIndex:o().number,dataSource:o().object,children:o().node,customProps:o().object,ToolBarService:o().object},D.defaultProps={customProps:{}};function R(e,t){var n=P.findOrCreateStack(e,t);return Object.assign({},n)}function O(){return(O=S(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=R(n,t),a={StudyInstanceUID:n.StudyInstanceUID,displaySetInstanceUID:n.displaySetInstanceUID,stack:r},e.abrupt("return",a);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e,t,n,r,a,o){var i=e.displaySetInstanceUID,c=e.SOPInstanceUID,u=a.getDisplaySetByUID(i).images.findIndex((function(e){return e.SOPInstanceUID===c}));if(function(e){var t=e.id,n=v.saveToolState();Object.keys(n).forEach((function(e){var r=n[e];Object.keys(r).forEach((function(e){var n=r[e].data;n&&n.length&&n.forEach((function(e){e.active=e.id===t}))}))})),s().store.state.enabledElements.forEach((function(e){try{l().updateImage(e)}catch(e){}}))}(e),o.setActiveViewportIndex(n),null!==t){var m=l().getEnabledElement(t);t.addEventListener("cornerstoneimagerendered",(function e(n){k(t,u),t.removeEventListener("cornerstoneimagerendered",e)})),m.image&&l().updateImage(t),r.removeJumpToMeasurement(n)}}var j=D}}]);
//# sourceMappingURL=407.bundle.f4abdacb09653e6db3db.js.map